{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/uploads/wechat-qcode.jpg","path":"uploads/wechat-qcode.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/images/sim002.jpg","path":"images/sim002.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/images/sim01.jpg","path":"images/sim01.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/love.js","path":"js/src/love.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","path":"lib/needsharebutton/font-embedded.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","path":"lib/Han/dist/font/han.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/next/.gitignore","hash":"0b5c2ffd41f66eb1849d6426ba8cf9649eeed329","modified":1514806389000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1514806389000},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1514806389000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1514806389000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1514806389000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1514806389000},{"_id":"themes/next/.javascript_ignore","hash":"8a224b381155f10e6eb132a4d815c5b52962a9d1","modified":1514806389000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1514806389000},{"_id":"themes/next/.travis.yml","hash":"d60d4a5375fea23d53b2156b764a99b2e56fa660","modified":1514806389000},{"_id":"themes/next/README.cn.md","hash":"58ffe752bc4b7f0069fcd6304bbc2d5ff7b80f89","modified":1514806389000},{"_id":"themes/next/README.md","hash":"898213e66d34a46c3cf8446bf693bd50db0d3269","modified":1514806389000},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1514806389000},{"_id":"themes/next/_config.yml","hash":"5ea2666d7cdc10692ccc0287b30e7daed928642e","modified":1531733141049},{"_id":"themes/next/bower.json","hash":"0674f11d3d514e087a176da0e1d85c2286aa5fba","modified":1514806389000},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1514806389000},{"_id":"themes/next/package.json","hash":"036d3a1346203d2f1a3958024df7f74e7ac07bfe","modified":1514806389000},{"_id":"source/404/index.html","hash":"a5991bb3598c5d934bd97e3bc4ed14b71ebf1e62","modified":1531716817722},{"_id":"source/_posts/Hdfs1.md","hash":"a537ab59b217a7cf18e8f3eedc9a2fb5b3ffa714","modified":1531479968756},{"_id":"source/_posts/HEXO 安装使用说明.md","hash":"b444ce41be913244efe586a544228f8634671508","modified":1531479968755},{"_id":"source/_posts/Hive2.md","hash":"e4d8dc8b78092eb6cd69ab8f2a5e27bd6acc8909","modified":1531479968757},{"_id":"source/_posts/VisitorStreaming.md","hash":"98d2cfee8687df4230a80a4f2d0dc28eda66cf28","modified":1531479968762},{"_id":"source/_posts/alias_tag.md","hash":"e4503b697f24cad81cb42a7e8b8f7929269ad5e7","modified":1531479968766},{"_id":"source/_posts/Hive3.md","hash":"c2352f73eeb97e2d3c279f30f6f4eb4f4b1a9b85","modified":1531479968758},{"_id":"source/_posts/cardRectify.md","hash":"9084751669f615641a1aa9992eec33d3f910b1cb","modified":1531479968767},{"_id":"source/_posts/clouderaCluster.md","hash":"c636add1b40c5e10c6ac50b06083124b47a9e0bd","modified":1531479968769},{"_id":"source/_posts/imageFeatures.md","hash":"c9221336ead1db54cbc9caa06048fecb94c66b2c","modified":1531479968773},{"_id":"source/_posts/cardUpdateNotification.md","hash":"4a2f1ef8cc2dccf9361d99e22854da334cee3cbb","modified":1531479968767},{"_id":"source/_posts/industryTagger.md","hash":"0328a62420e46de8d87b8ee7c9e77203a39c9be5","modified":1531479968775},{"_id":"source/_posts/jaro-winkler算法原理和应用.md","hash":"03104bbce6ba3cd39d7c529c37c0144ec3e98a4e","modified":1531733293759},{"_id":"source/_posts/meeting.md","hash":"f4a843bc39c088c7b97c26da0a2b2eb13d410614","modified":1531479968776},{"_id":"source/_posts/monthlyReport.md","hash":"60b0a4a44700e987f257f2a93385f80eafd5e964","modified":1531479968778},{"_id":"source/_posts/message_pushing.md","hash":"5942d5fd73861070ae312b161bad6cf5e7188c68","modified":1531479968777},{"_id":"source/_posts/opencv_installation.md","hash":"e8841685aefa742857a5cffd00eda5f36db8ac61","modified":1531479968786},{"_id":"source/_posts/namecard_extra.md","hash":"30112f5abf6cae5d51cb948bb7202892767839cd","modified":1531479968782},{"_id":"source/_posts/如何在hexo中支持Mathjax.md","hash":"1ee8e989538290a21da9f1c27054b6bce776349f","modified":1531736248636},{"_id":"source/about/index.md","hash":"c07420c67a014fa4a4b90c837c588d09a9f7a24f","modified":1531729886029},{"_id":"source/categories/index.md","hash":"18e422cabc8449b9592995b7e5967705c5314c1a","modified":1531714276820},{"_id":"source/tags/index.md","hash":"7cc8c49b09e1bd417b248189f2e162ea11b978c6","modified":1531714254799},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1514806389000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"352093a1b210c72136687fd2eee649244cee402c","modified":1514806389000},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1514806389000},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"902f627155a65099e0a37842ff396a58d0dc306f","modified":1514806389000},{"_id":"themes/next/languages/de.yml","hash":"057e7df11ddeb1c8c15a5d7c5ff29430d725ec6b","modified":1514806389000},{"_id":"themes/next/languages/default.yml","hash":"44ef3f26917f467459326c2c8be2f73e4d947f35","modified":1514806389000},{"_id":"themes/next/languages/en.yml","hash":"7e680d9bb8f3a3a9d1ba1c9d312b3d257183dded","modified":1514806389000},{"_id":"themes/next/languages/fr-FR.yml","hash":"7e4eb7011b8feee641cfb11c6e73180b0ded1c0f","modified":1514806389000},{"_id":"themes/next/languages/it.yml","hash":"aa595f2bda029f73ef7bfa104b4c55c3f4e9fb4c","modified":1514806389000},{"_id":"themes/next/languages/id.yml","hash":"b5de1ea66dd9ef54cac9a1440eaa4e3f5fc011f5","modified":1514806389000},{"_id":"themes/next/languages/ja.yml","hash":"3c76e16fd19b262864475faa6854b718bc08c4d8","modified":1514806389000},{"_id":"themes/next/languages/ko.yml","hash":"ea5b46056e73ebcee121d5551627af35cbffc900","modified":1514806389000},{"_id":"themes/next/languages/nl-NL.yml","hash":"edca4f3598857dbc3cbf19ed412213329b6edd47","modified":1514806389000},{"_id":"themes/next/languages/pt-BR.yml","hash":"b1694ae766ed90277bcc4daca4b1cfa19cdcb72b","modified":1514806389000},{"_id":"themes/next/languages/pt.yml","hash":"44b61f2d085b827b507909a0b8f8ce31c6ef5d04","modified":1514806389000},{"_id":"themes/next/languages/vi.yml","hash":"fd08d3c8d2c62965a98ac420fdaf95e54c25d97c","modified":1514806389000},{"_id":"themes/next/languages/ru.yml","hash":"98ec6f0b7183282e11cffc7ff586ceb82400dd75","modified":1514806389000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"16ef56d0dea94638de7d200984c90ae56f26b4fe","modified":1514806389000},{"_id":"themes/next/languages/zh-hk.yml","hash":"9396f41ae76e4fef99b257c93c7354e661f6e0fa","modified":1514806389000},{"_id":"themes/next/languages/zh-tw.yml","hash":"50b71abb3ecc0686f9739e179e2f829cd074ecd9","modified":1514806389000},{"_id":"themes/next/layout/_layout.swig","hash":"f641680c203063e1509c8837aec59a253592fbd3","modified":1531718755569},{"_id":"themes/next/layout/category.swig","hash":"4472255f4a3e3dd6d79201523a9526dcabdfbf18","modified":1514806389000},{"_id":"themes/next/layout/archive.swig","hash":"f0a8225feafd971419837cdb4bcfec98a4a59b2f","modified":1514806389000},{"_id":"themes/next/layout/index.swig","hash":"783611349c941848a0e26ee2f1dc44dd14879bd1","modified":1514806389000},{"_id":"themes/next/layout/page.swig","hash":"969caaee05bdea725e99016eb63d810893a73e99","modified":1514806389000},{"_id":"themes/next/scripts/merge-configs.js","hash":"81e86717ecfb775986b945d17f0a4ba27532ef07","modified":1514806389000},{"_id":"themes/next/layout/schedule.swig","hash":"d86f8de4e118f8c4d778b285c140474084a271db","modified":1514806389000},{"_id":"themes/next/layout/tag.swig","hash":"7e0a7d7d832883eddb1297483ad22c184e4368de","modified":1514806389000},{"_id":"themes/next/layout/post.swig","hash":"b3589a8e46288a10d20e41c7a5985d2493725aec","modified":1514806389000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1514806389000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1514806389000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1514806389000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1514806389000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1514806389000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1514806389000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1514806389000},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"665a928604f99d2ba7dc4a4a9150178229568cc6","modified":1514806389000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"6a54c3c85ff6b19d275827a327abbf4bd99b2ebf","modified":1514806389000},{"_id":"themes/next/layout/_macro/post.swig","hash":"446a35a2cd389f8cfc3aa38973a9b44ad0740134","modified":1514806389000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"56e8d8556cf474c56ae1bef9cb7bbd26554adb07","modified":1514806389000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"39852700e4084ecccffa6d4669168e5cc0514c9e","modified":1514806389000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"c4d6181f5d3db5365e622f78714af8cc58d7a45e","modified":1514806389000},{"_id":"themes/next/layout/_partials/head.swig","hash":"6b94fe8f3279daea5623c49ef4bb35917ba57510","modified":1514806389000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"4a6f5b1792b2e5262b7fdab9a716b3108e2f09c7","modified":1514806389000},{"_id":"themes/next/layout/_partials/header.swig","hash":"ed042be6252848058c90109236ec988e392d91d4","modified":1514806389000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1514806389000},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1514806389000},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1514806389000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1514806389000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1514806389000},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1514806389000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"a266f96ad06ee87bdeae6e105a4b53cd587bbd04","modified":1514806389000},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1514806389000},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1514806389000},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"5fe0447cc88a5a63b530cf0426f93c4634811876","modified":1514806389000},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1514806389000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1514806389000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1514806389000},{"_id":"themes/next/scripts/tags/button.js","hash":"d023f10a00077f47082b0517e2ad666e6e994f60","modified":1514806389000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1514806389000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1514806389000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1514806389000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1514806389000},{"_id":"themes/next/scripts/tags/label.js","hash":"2f8f41a7316372f0d1ed6b51190dc4acd3e16fff","modified":1514806389000},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"eeeabede68cf263de9e6593ecf682f620da16f0a","modified":1514806389000},{"_id":"themes/next/scripts/tags/note.js","hash":"64de4e9d01cf3b491ffc7d53afdf148ee5ad9779","modified":1514806389000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"5786545d51c38e8ca38d1bfc7dd9e946fc70a316","modified":1514806389000},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1514806389000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1514806389000},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1514806389000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1514806389000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1514806389000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1514806389000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1514806389000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1514806389000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1514806389000},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1514806389000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1514806389000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1514806389000},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1514806389000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1514806389000},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1514806389000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1514806389000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1514806389000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1514806389000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1514806389000},{"_id":"themes/next/source/uploads/wechat-qcode.jpg","hash":"c806e15f44bce0fc5d866b20d41a5a1937e3c0bd","modified":1531729412528},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1514806389000},{"_id":"themes/next/source/images/sim002.jpg","hash":"5aa35942063111226dbd2317e4e1583aee27a938","modified":1531719146397},{"_id":"themes/next/source/images/sim01.jpg","hash":"2f94fad668c9f3f9267867f7d2fc366281143aa0","modified":1531719146400},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1514806389000},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1514806389000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1514806389000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1514806389000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1514806389000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1514806389000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1514806389000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1514806389000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"048fd5e98149469f8c28c21ba3561a7a67952c9b","modified":1514806389000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1514806389000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1514806389000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"10160daceaa6f1ecf632323d422ebe2caae49ddf","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"aa0629277d751c55c6d973e7691bf84af9b17a60","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"fcabbb241f894c9a6309c44e126cf3e8fea81fd4","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"8b6650f77fe0a824c8075b2659e0403e0c78a705","modified":1514806389000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"8a2e393d2e49f7bf560766d8a07cd461bf3fce4f","modified":1514806389000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1514806389000},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1514806389000},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1514806389000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"385c066af96bee30be2459dbec8aae1f15d382f5","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"1cd01c6e92ab1913d48e556a92bb4f28b6dc4996","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"5e9bb24c750b49513d9a65799e832f07410002ac","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"fc65b9c98a0a8ab43a5e7aabff6c5f03838e09c8","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1514806389000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1514806389000},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1514806389000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"8175e4a1f00df6d42db4da3803c81b7f5fce3781","modified":1531723777777},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"82f9055955920ed88a2ab6a20ab02169abb2c634","modified":1514806389000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"9ab65361ba0a12a986edd103e56492644c2db0b8","modified":1514806389000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"f29165e36489a87ba32d17dddfd2720d84e3f3ec","modified":1514806389000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1514806389000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"99fbb4686ea9a3e03a4726ed7cf4d8f529034452","modified":1514806389000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"29c261fa6b4046322559074d75239c6b272fb8a3","modified":1514806389000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1514806389000},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1514806389000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1514806389000},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1514806389000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1514806389000},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1514806389000},{"_id":"themes/next/source/js/src/post-details.js","hash":"a13f45f7aa8291cf7244ec5ba93907d119c5dbdd","modified":1514806389000},{"_id":"themes/next/source/js/src/love.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1531718635738},{"_id":"themes/next/source/js/src/motion.js","hash":"754b294394f102c8fd9423a1789ddb1201677898","modified":1514806389000},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1514806389000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1514806389000},{"_id":"themes/next/source/js/src/utils.js","hash":"9b1325801d27213083d1487a12b1a62b539ab6f8","modified":1514806389000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1514806389000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1514806389000},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"ff5915eb2596e890a2fc6697c864f861a1995ec0","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1514806389000},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1514806389000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1514806389000},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1514806389000},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1514806389000},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1514806389000},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1514806389000},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1514806389000},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1514806389000},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1514806389000},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1514806389000},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1514806389000},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"4719ce717962663c5c33ef97b1119a0b3a4ecdc3","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1514806389000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"f7c44b0ee46cf2cf82a4c9455ba8d8b55299976f","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"47a46583a1f3731157a3f53f80ed1ed5e2753e8e","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1514806389000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"18c3336ee3d09bd2da6a876e1336539f03d5a973","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"3b25edfa187d1bbbd0d38b50dd013cef54758abf","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"02fb8fa6b6c252b6bed469539cd057716606a787","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"84ae14e4c38366c42bd682b96b36921d6b3860aa","modified":1531724437709},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"9d16fa3c14ed76b71229f022b63a02fd0f580958","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1514806389000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1514806389000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1514806389000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1514806389000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1514806389000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"7905a7f625702b45645d8be1268cb8af3f698c70","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"25dc25f61a232f03ca72472b7852f882448ec185","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"f5aa2ba3bfffc15475e7e72a55b5c9d18609fdf5","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"0f7f522cc6bfb3401d5afd62b0fcdf48bb2d604b","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"535b3b4f8cb1eec2558e094320e7dfb01f94c0e7","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"36332c8a91f089f545f3c3e8ea90d08aa4d6e60c","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"aea21141015ca8c409d8b33e3e34ec505f464e93","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"d5a4e4fc17f1f7e7c3a61b52d8e2e9677e139de7","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"e4055a0d2cd2b0ad9dc55928e2f3e7bd4e499da3","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"0a6c0efffdf18bddbc1d1238feaed282b09cd0fe","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"89dd4f8b1f1cce3ad46cf2256038472712387d02","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"262debfd4442fa03d9919ceb88b948339df03fb0","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"12937cae17c96c74d5c58db6cb29de3b2dfa14a2","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"50305b6ad7d09d2ffa4854e39f41ec1f4fe984fd","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"37e951e734a252fe8a81f452b963df2ba90bfe90","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1514806389000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"1ccfbd4d0f5754b2dc2719a91245c95f547a7652","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1514806389000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1514806389000},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1514806389000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1514806389000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1514806389000},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1514806389000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1514806389000},{"_id":"public/404/index.html","hash":"0773b6b4a99a428c3914c1b19c6908a1fdfe24ef","modified":1532314458285},{"_id":"public/categories/index.html","hash":"ddb1cededde435fbfdb1c248520046c3ff08233b","modified":1532314458302},{"_id":"public/about/index.html","hash":"d4ed3ffb4a5117e47168df1e8b5492ca35471df8","modified":1532314458303},{"_id":"public/tags/index.html","hash":"ee22704a8bbeebddccf9b5e792bb4c287203edb7","modified":1532314458318},{"_id":"public/archives/2016/06/index.html","hash":"5152266d516e53dbf32fe9cf8c2b15aea9715359","modified":1532314458334},{"_id":"public/archives/2016/10/index.html","hash":"a2bbc1d5539290829ff8f0d21659c8a43984c1d0","modified":1532314458334},{"_id":"public/archives/2017/04/index.html","hash":"6479ef25a777631a62b104724bcdd64bfb895cd4","modified":1532314458335},{"_id":"public/archives/2017/03/index.html","hash":"a2e0f33694c4d8ed87f6895ae7d3f9a29c8afa98","modified":1532314458335},{"_id":"public/categories/算法/index.html","hash":"1ddc405e70930acabc103b4ac92a4c4da6dfa9e3","modified":1532314458335},{"_id":"public/categories/Hexo/index.html","hash":"722b7640224a7f2201e126691a1fdc4493db99ef","modified":1532314458335},{"_id":"public/archives/2017/05/index.html","hash":"e2b56e4a39062a38fcca347e35574c586c826d28","modified":1532314458335},{"_id":"public/tags/blog/index.html","hash":"e9842b2f282d4178a984a6dca8c9cd9033c0debf","modified":1532314458335},{"_id":"public/tags/hexo/index.html","hash":"280a37db51003a9a081ebc81bb454df32e2bcf6d","modified":1532314458336},{"_id":"public/tags/NexT/index.html","hash":"7d991831b7fc23757e73aa3dcdd4aff0f5b29a7d","modified":1532314458336},{"_id":"public/tags/Spark-Streaming/index.html","hash":"0b6fb406369c7f4bd61a4a09c7897a81251c5f60","modified":1532314458336},{"_id":"public/tags/Kafka/index.html","hash":"9a303a2f20d93003e39bc3b31eb76ff66472648d","modified":1532314458336},{"_id":"public/tags/谁看过我/index.html","hash":"3e3044c209d9c011b0bc19d9c2a8b4424dd514c8","modified":1532314458336},{"_id":"public/tags/名片/index.html","hash":"b98141f8cf532f79244c95116cf722594fd5efc0","modified":1532314458336},{"_id":"public/tags/别名/index.html","hash":"395cc88ca7dfdf4377bced160758f278bdb00394","modified":1532314458336},{"_id":"public/tags/NameCard/index.html","hash":"d46ed5f3e44bcf616c40e9b83a028ba908781ba3","modified":1532314458336},{"_id":"public/tags/Levenstein-Distance/index.html","hash":"6aaf0e177dfe0f46f9cc014217600687f23fd1ce","modified":1532314458336},{"_id":"public/tags/Cloudera/index.html","hash":"7ae72b87d3f77be1c1ae2979bf3459378a550cc3","modified":1532314458336},{"_id":"public/tags/opencv/index.html","hash":"d64009c777e355d4053c8cc567e52af2af1d571d","modified":1532314458337},{"_id":"public/tags/bovw/index.html","hash":"3ebb083a927ae4b11c2251b60fee20c4423e05d3","modified":1532314458337},{"_id":"public/tags/imagehash/index.html","hash":"00cea445935c15bac9532594b24aa9acc60fdfc9","modified":1532314458337},{"_id":"public/tags/人脉信息更新/index.html","hash":"97ee9035e412214d985ea47618308ed419ec0658","modified":1532314458337},{"_id":"public/tags/classification/index.html","hash":"25fb00285fb37c6c0fa740e6a32cdead8a99cb06","modified":1532314458337},{"_id":"public/tags/系统提示/index.html","hash":"4b505963a15a902354c8f2febedb3d5e8a9fd710","modified":1532314458337},{"_id":"public/tags/行业分类/index.html","hash":"5941e9526abe363cefda77914a958ce59c6ed9de","modified":1532314458337},{"_id":"public/tags/公司名称/index.html","hash":"6bb574ae504b5727c677623b9b714b1da528dd46","modified":1532314458337},{"_id":"public/tags/Jaro–Winkler/index.html","hash":"31fa10603fcaa5d5f43c5b4eb4fed7b6ede7c309","modified":1532314458337},{"_id":"public/tags/月报/index.html","hash":"84019f2ce964a36d7fb551dc4fa615d5ac287bb0","modified":1532314458337},{"_id":"public/tags/Hexo/index.html","hash":"6972304b9d2b32e5cbaf07a540bdbfe9dc551001","modified":1532314458338},{"_id":"public/tags/统计指标/index.html","hash":"ae9007cb46466f4c1b5369f8152b16130b97571a","modified":1532314458338},{"_id":"public/tags/anaconda/index.html","hash":"22cb4908413bb761f93765081748ba1a65b4c22f","modified":1532314458338},{"_id":"public/tags/基础信息/index.html","hash":"26521fd27fab76924319d5ee69c886c5c84fa7aa","modified":1532314458338},{"_id":"public/tags/Mathjax/index.html","hash":"41e1159dc97d5d6b9af32d856daf316eee053120","modified":1532314458338},{"_id":"public/tags/msyql/index.html","hash":"c09b530a44dd8ecc5b3a7158e1387ed361ff9e98","modified":1532314458338},{"_id":"public/tags/message-queue/index.html","hash":"c254ed43dca1b2003078df82697d03d8d74b7be4","modified":1532314458338},{"_id":"public/2018/07/16/jaro-winkler算法原理和应用/index.html","hash":"0aadd80cac4273610398129b7954bdee87044ebf","modified":1532314458338},{"_id":"public/2017/04/28/namecard_extra/index.html","hash":"215103e34c432d0a8f932464a628994aa96bf864","modified":1532314458339},{"_id":"public/2017/05/08/alias_tag/index.html","hash":"35b5c93e131f54d7276d933434f46c5396ab80f6","modified":1532314458339},{"_id":"public/2018/07/16/如何在hexo中支持Mathjax/index.html","hash":"593a540966509d74d40333905c27733c358507dc","modified":1532314458339},{"_id":"public/2017/02/15/monthlyReport/index.html","hash":"35f5b874588faf99ed51edbc87c7c014cbac40ba","modified":1532314458339},{"_id":"public/2017/02/14/message_pushing/index.html","hash":"08d27101bb864b0fc5b2d330a09d87c285aa2a29","modified":1532314458339},{"_id":"public/2017/03/02/meeting/index.html","hash":"e369643aed4faa34b70c6cb153ad854eca7cebca","modified":1532314458339},{"_id":"public/2017/02/10/Hive3/index.html","hash":"b862630b3a9d4c478dfbddbfb10466bf6a4c8686","modified":1532314458339},{"_id":"public/2017/02/10/Hive2/index.html","hash":"b7365227dbc40f819b122146322cf53115ad2cfb","modified":1532314458339},{"_id":"public/2017/02/10/Hdfs1/index.html","hash":"37039d2a11af5404d52fb6b70ea6a0c540e0daa3","modified":1532314458339},{"_id":"public/2016/10/24/HEXO 安装使用说明/index.html","hash":"7747f3cf93177bbfe6da433c11557690b683d3c9","modified":1532314458339},{"_id":"public/2016/09/30/cardRectify/index.html","hash":"ce8599be5c3564368deb544cc95118ba463d6e53","modified":1532314458340},{"_id":"public/2016/09/27/cardUpdateNotification/index.html","hash":"70229fd0d06325735e967edcbfaf24e237569db5","modified":1532314458340},{"_id":"public/2016/09/26/clouderaCluster/index.html","hash":"2439c33b9f50c76b18d697f5abbe0bad2f7f93da","modified":1532314458340},{"_id":"public/2016/09/26/industryTagger/index.html","hash":"56eb4cac6366b1162461cb2c06993d16c8981932","modified":1532314458340},{"_id":"public/2016/09/26/imageFeatures/index.html","hash":"6b7abedd267d545eae59ec5b20253ee395b04ca0","modified":1532314458340},{"_id":"public/2016/09/26/VisitorStreaming/index.html","hash":"2c37f910df9de17e6cd6043c1cce50d4e3e5f284","modified":1532314458340},{"_id":"public/archives/index.html","hash":"9bdd0b5da1bd99caa8e011e7c72e58f1a16b2b26","modified":1532314458340},{"_id":"public/archives/2016/index.html","hash":"34896cf732dbfde53a0175cad5f2e3a201dd7e28","modified":1532314458340},{"_id":"public/2016/06/23/opencv_installation/index.html","hash":"3e576c784475613e948d13402a0bae925d022cb4","modified":1532314458340},{"_id":"public/archives/page/2/index.html","hash":"0262d52c9f807b2a3b53904de46751a743753ef8","modified":1532314458340},{"_id":"public/archives/2017/index.html","hash":"d331f54ea3695218658ea62d281de9299919939f","modified":1532314458340},{"_id":"public/archives/2017/02/index.html","hash":"eabe1afe688c68a448adbef3807407480aa6dc59","modified":1532314458340},{"_id":"public/archives/2018/index.html","hash":"f4b35bced8a830b3385b7b738597fbe2be9297b3","modified":1532314458341},{"_id":"public/index.html","hash":"09753b75179212bc22079bbbe5e5237a5cdea58d","modified":1532314458341},{"_id":"public/archives/2016/09/index.html","hash":"2f4bb4e4aa2e084efb4de0fbab28441434e87bdf","modified":1532314458341},{"_id":"public/archives/2018/07/index.html","hash":"e147cab60496ada7de044d53261f77698331c4b6","modified":1532314458341},{"_id":"public/categories/IMORA/index.html","hash":"139a8ebe7a849baf7f2c3e49cf72e91425a9e201","modified":1532314458342},{"_id":"public/page/2/index.html","hash":"e90dff2046f703ab0fe691c986a0ab21cdbe7b0a","modified":1532314458342},{"_id":"public/categories/Hive/index.html","hash":"94052e4f7f032496c47142e2f797fd9a2e196609","modified":1532314458342},{"_id":"public/tags/etl-tool/index.html","hash":"ad6584357cc927ab30e584d8e52c8f46b66bfbd5","modified":1532314458342},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1532314458354},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1532314458354},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1532314458354},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1532314458354},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1532314458354},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1532314458354},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1532314458355},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1532314458355},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1532314458355},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1532314458355},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1532314458356},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1532314458357},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1532314458357},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1532314458358},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1532314458358},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1532314458358},{"_id":"public/uploads/wechat-qcode.jpg","hash":"c806e15f44bce0fc5d866b20d41a5a1937e3c0bd","modified":1532314458358},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1532314458358},{"_id":"public/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1532314458358},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1532314458358},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1532314458358},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1532314458358},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1532314458358},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1532314458358},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1532314458358},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1532314458358},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1532314458358},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1532314458358},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1532314458358},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1532314458359},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1532314458359},{"_id":"public/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1532314458359},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1532314458359},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1532314458359},{"_id":"public/images/sim01.jpg","hash":"2f94fad668c9f3f9267867f7d2fc366281143aa0","modified":1532314459628},{"_id":"public/images/sim002.jpg","hash":"5aa35942063111226dbd2317e4e1583aee27a938","modified":1532314459633},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1532314459635},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1532314459635},{"_id":"public/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1532314459654},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1532314459654},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1532314459655},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1532314459656},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1532314459656},{"_id":"public/js/src/post-details.js","hash":"a13f45f7aa8291cf7244ec5ba93907d119c5dbdd","modified":1532314459656},{"_id":"public/js/src/love.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1532314459656},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1532314459656},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1532314459656},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1532314459657},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1532314459657},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1532314459657},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1532314459657},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"ff5915eb2596e890a2fc6697c864f861a1995ec0","modified":1532314459657},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1532314459657},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1532314459657},{"_id":"public/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1532314459657},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1532314459657},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1532314459658},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1532314459658},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1532314459658},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1532314459659},{"_id":"public/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1532314459659},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1532314459659},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1532314459659},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1532314459659},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1532314459659},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1532314459659},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1532314459659},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1532314459659},{"_id":"public/lib/fastclick/README.html","hash":"d6e90449a2c09f3033f7e43d68b0cc8208e22e09","modified":1532314459659},{"_id":"public/lib/jquery_lazyload/README.html","hash":"a08fccd381c8fdb70ba8974b208254c5ba23a95f","modified":1532314459659},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"06811ca2f722dead021493457f27cdc264ef928d","modified":1532314459659},{"_id":"public/css/main.css","hash":"b4e2f93bfe06c21354ccd3d294467415c09d063a","modified":1532314459660},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1532314459660},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1532314459660},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1532314459660},{"_id":"public/js/src/utils.js","hash":"9b1325801d27213083d1487a12b1a62b539ab6f8","modified":1532314459690},{"_id":"public/js/src/motion.js","hash":"754b294394f102c8fd9423a1789ddb1201677898","modified":1532314459690},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1532314459690},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1532314459690},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1532314459690},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1532314459690},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1532314459691},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1532314459691},{"_id":"public/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1532314459710},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1532314459710},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1532314459741},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1532314459741},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1532314459761},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1532314459761},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1532314459762},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1532314459763},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1532314459763},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1532314459764},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1532314459764},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1532314459765},{"_id":"public/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1532314459772},{"_id":"public/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1532314459772},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1532314459773},{"_id":"public/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1532314459775},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1532314459785},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1532314459787},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1532314459790},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1532314459804},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1532314459807}],"Category":[{"name":"Hive","_id":"cjjxogn9p00043a9dc2lrarn4"},{"name":"IMORA","_id":"cjjxogna2000c3a9d8lmj2mh3"},{"name":"算法","_id":"cjjxognar000t3a9dro2hab3b"},{"name":"Hexo","_id":"cjjxognaz00153a9d6ngcfkgw"}],"Data":[],"Page":[{"_content":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"https://qzone.qq.com/gy/404/style/404style.css\">\n</head>\n<body>\n  <script type=\"text/plain\" src=\"http://www.qq.com/404/search_children.js\"\n          charset=\"utf-8\" homePageUrl=\"/\"\n          homePageName=\"回到我的主页\">\n  </script>\n  <script src=\"https://qzone.qq.com/gy/404/data.js\" charset=\"utf-8\"></script>\n  <script src=\"https://qzone.qq.com/gy/404/page.js\" charset=\"utf-8\"></script>\n</body>\n</html>\n","source":"404/index.html","raw":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"https://qzone.qq.com/gy/404/style/404style.css\">\n</head>\n<body>\n  <script type=\"text/plain\" src=\"http://www.qq.com/404/search_children.js\"\n          charset=\"utf-8\" homePageUrl=\"/\"\n          homePageName=\"回到我的主页\">\n  </script>\n  <script src=\"https://qzone.qq.com/gy/404/data.js\" charset=\"utf-8\"></script>\n  <script src=\"https://qzone.qq.com/gy/404/page.js\" charset=\"utf-8\"></script>\n</body>\n</html>\n","date":"2018-07-16T04:53:37.723Z","updated":"2018-07-16T04:53:37.722Z","path":"404/index.html","title":"","comments":1,"layout":"page","_id":"cjjxogn9900003a9dbhu49ufr","content":"<!DOCTYPE HTML>\n<html>\n<head>\n  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n  <meta name=\"robots\" content=\"all\">\n  <meta name=\"robots\" content=\"index,follow\">\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"https://qzone.qq.com/gy/404/style/404style.css\"><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n<body>\n  <!-- hexo-inject:begin --><!-- hexo-inject:end --><script type=\"text/plain\" src=\"http://www.qq.com/404/search_children.js\" charset=\"utf-8\" homepageurl=\"/\" homepagename=\"回到我的主页\">\n  </script>\n  <script src=\"https://qzone.qq.com/gy/404/data.js\" charset=\"utf-8\"></script>\n  <script src=\"https://qzone.qq.com/gy/404/page.js\" charset=\"utf-8\"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</body>\n</html>\n","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE HTML>\n<html>\n<head>\n  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n  <meta name=\"robots\" content=\"all\">\n  <meta name=\"robots\" content=\"index,follow\">\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"https://qzone.qq.com/gy/404/style/404style.css\"><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n<body>\n  <!-- hexo-inject:begin --><!-- hexo-inject:end --><script type=\"text/plain\" src=\"http://www.qq.com/404/search_children.js\" charset=\"utf-8\" homepageurl=\"/\" homepagename=\"回到我的主页\">\n  </script>\n  <script src=\"https://qzone.qq.com/gy/404/data.js\" charset=\"utf-8\"></script>\n  <script src=\"https://qzone.qq.com/gy/404/page.js\" charset=\"utf-8\"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</body>\n</html>\n"},{"title":"关于我","date":"2018-07-16T08:30:13.000Z","_content":"\n#### 偶尔摄影 偶尔叨叨的码农\n","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2018-07-16 16:30:13\n---\n\n#### 偶尔摄影 偶尔叨叨的码农\n","updated":"2018-07-16T08:31:26.029Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjjxogn9k00023a9dohyh2s4j","content":"<h4 id=\"偶尔摄影-偶尔叨叨的码农\"><a href=\"#偶尔摄影-偶尔叨叨的码农\" class=\"headerlink\" title=\"偶尔摄影 偶尔叨叨的码农\"></a>偶尔摄影 偶尔叨叨的码农</h4>","site":{"data":{}},"excerpt":"","more":"<h4 id=\"偶尔摄影-偶尔叨叨的码农\"><a href=\"#偶尔摄影-偶尔叨叨的码农\" class=\"headerlink\" title=\"偶尔摄影 偶尔叨叨的码农\"></a>偶尔摄影 偶尔叨叨的码农</h4>"},{"title":"categories","date":"2018-07-16T04:10:24.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2018-07-16 12:10:24\ntype: \"categories\"\n---\n","updated":"2018-07-16T04:11:16.820Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjjxogn9s00063a9dd3gxgpe4","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2018-07-16T04:10:19.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-07-16 12:10:19\ntype: \"tags\"\n---\n","updated":"2018-07-16T04:10:54.799Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjjxogn9v00083a9dd9r09oby","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Hdfs的block块","date":"2017-02-10T10:00:00.000Z","_content":"\n# Hdfs的block块\n![image](http://img.blog.csdn.net/20160415202744965)\n\n# MapReduce shuffle过程\n![image](https://ss0.bdstatic.com/94oJfD_bAAcT8t7mm9GUKT-xh_/timg?image&quality=100&size=b4000_4000&sec=1486668014&di=b8a686254db1eaf60531d9d61398ce79&src=http://img2.ph.126.net/ePqGrUilx_R_3YRiPsdzdw==/3130564691076091433.png)\n\n\n# Spark RDD shuffle过程\n![image](http://jerryshao.me/img/2014-01-04-spark-shuffle/mapreduce-process.jpg)\n\n# Spark RDD\n![image](http://img.blog.csdn.net/20151208164857435)\n# Spark 窄依赖 宽依赖\n![image](http://img.blog.csdn.net/20151208163736558)\n\n","source":"_posts/Hdfs1.md","raw":"---\ntitle: Hdfs的block块\ndate: 2017-02-10 18:00:00\ntags:\n    - etl tool\ncategories: Hive\n---\n\n# Hdfs的block块\n![image](http://img.blog.csdn.net/20160415202744965)\n\n# MapReduce shuffle过程\n![image](https://ss0.bdstatic.com/94oJfD_bAAcT8t7mm9GUKT-xh_/timg?image&quality=100&size=b4000_4000&sec=1486668014&di=b8a686254db1eaf60531d9d61398ce79&src=http://img2.ph.126.net/ePqGrUilx_R_3YRiPsdzdw==/3130564691076091433.png)\n\n\n# Spark RDD shuffle过程\n![image](http://jerryshao.me/img/2014-01-04-spark-shuffle/mapreduce-process.jpg)\n\n# Spark RDD\n![image](http://img.blog.csdn.net/20151208164857435)\n# Spark 窄依赖 宽依赖\n![image](http://img.blog.csdn.net/20151208163736558)\n\n","slug":"Hdfs1","published":1,"updated":"2018-07-13T11:06:08.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogn9b00013a9dg3rrkjng","content":"<h1 id=\"Hdfs的block块\"><a href=\"#Hdfs的block块\" class=\"headerlink\" title=\"Hdfs的block块\"></a>Hdfs的block块</h1><p><img src=\"http://img.blog.csdn.net/20160415202744965\" alt=\"image\"></p>\n<h1 id=\"MapReduce-shuffle过程\"><a href=\"#MapReduce-shuffle过程\" class=\"headerlink\" title=\"MapReduce shuffle过程\"></a>MapReduce shuffle过程</h1><p><img src=\"https://ss0.bdstatic.com/94oJfD_bAAcT8t7mm9GUKT-xh_/timg?image&amp;quality=100&amp;size=b4000_4000&amp;sec=1486668014&amp;di=b8a686254db1eaf60531d9d61398ce79&amp;src=http://img2.ph.126.net/ePqGrUilx_R_3YRiPsdzdw==/3130564691076091433.png\" alt=\"image\"></p>\n<h1 id=\"Spark-RDD-shuffle过程\"><a href=\"#Spark-RDD-shuffle过程\" class=\"headerlink\" title=\"Spark RDD shuffle过程\"></a>Spark RDD shuffle过程</h1><p><img src=\"http://jerryshao.me/img/2014-01-04-spark-shuffle/mapreduce-process.jpg\" alt=\"image\"></p>\n<h1 id=\"Spark-RDD\"><a href=\"#Spark-RDD\" class=\"headerlink\" title=\"Spark RDD\"></a>Spark RDD</h1><p><img src=\"http://img.blog.csdn.net/20151208164857435\" alt=\"image\"></p>\n<h1 id=\"Spark-窄依赖-宽依赖\"><a href=\"#Spark-窄依赖-宽依赖\" class=\"headerlink\" title=\"Spark 窄依赖 宽依赖\"></a>Spark 窄依赖 宽依赖</h1><p><img src=\"http://img.blog.csdn.net/20151208163736558\" alt=\"image\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Hdfs的block块\"><a href=\"#Hdfs的block块\" class=\"headerlink\" title=\"Hdfs的block块\"></a>Hdfs的block块</h1><p><img src=\"http://img.blog.csdn.net/20160415202744965\" alt=\"image\"></p>\n<h1 id=\"MapReduce-shuffle过程\"><a href=\"#MapReduce-shuffle过程\" class=\"headerlink\" title=\"MapReduce shuffle过程\"></a>MapReduce shuffle过程</h1><p><img src=\"https://ss0.bdstatic.com/94oJfD_bAAcT8t7mm9GUKT-xh_/timg?image&amp;quality=100&amp;size=b4000_4000&amp;sec=1486668014&amp;di=b8a686254db1eaf60531d9d61398ce79&amp;src=http://img2.ph.126.net/ePqGrUilx_R_3YRiPsdzdw==/3130564691076091433.png\" alt=\"image\"></p>\n<h1 id=\"Spark-RDD-shuffle过程\"><a href=\"#Spark-RDD-shuffle过程\" class=\"headerlink\" title=\"Spark RDD shuffle过程\"></a>Spark RDD shuffle过程</h1><p><img src=\"http://jerryshao.me/img/2014-01-04-spark-shuffle/mapreduce-process.jpg\" alt=\"image\"></p>\n<h1 id=\"Spark-RDD\"><a href=\"#Spark-RDD\" class=\"headerlink\" title=\"Spark RDD\"></a>Spark RDD</h1><p><img src=\"http://img.blog.csdn.net/20151208164857435\" alt=\"image\"></p>\n<h1 id=\"Spark-窄依赖-宽依赖\"><a href=\"#Spark-窄依赖-宽依赖\" class=\"headerlink\" title=\"Spark 窄依赖 宽依赖\"></a>Spark 窄依赖 宽依赖</h1><p><img src=\"http://img.blog.csdn.net/20151208163736558\" alt=\"image\"></p>\n"},{"title":"HEXO 安装使用说明","date":"2016-10-24T04:21:51.000Z","_content":"\n### 安装\n1. 安装node.js: https://nodejs.org/en/\n2. npm install hexo-cli -g\n3. hexo init blog\n4. cd blog\n5. npm install\n6. hexo server\n\n## 251 部署信息\n```\n#在服务器端使用supervisor维护后台进程\nsupervisorctl start|stop|restart dmsite\n配置文件：/etc/supervisor/conf.d/hexo.conf\n\n192.168.30.251:4000\n站点位置：/opt/workspace/hexo/dmteam/\n文档位置：/opt/workspace/hexo/dmteam/source/_posts （markdown或HTML文件）\n启动服务：hexo server\n```\n\n\n### 使用leancloud\n[为NexT主题添加文章阅读量统计功能](https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud)\n\n```\nAPP ID: ohqkXUU5txOlX3MjJPCrw7jG-gzGzoHsz\nAPP KEY: bPQhLzRSEsTqdIKAGRcHLhyN\nMASTER KEY: lRx8SU65bjP4SA8cRjMSDwy8\n```\n\n### 文档\n- [官网](https://hexo.io/)\n- [NexT使用文档](http://theme-next.iissnan.com/)\n- [NexT@github](https://github.com/iissnan/hexo-theme-next/blob/master/README.md)\n- [leancloud](https://leancloud.cn/)\n- [七牛云](http://www.qiniu.com/)","source":"_posts/HEXO 安装使用说明.md","raw":"---\ntitle: HEXO 安装使用说明\ndate: 2016-10-24 12:21:51\ntags:\n    - hexo\n    - blog\n    - NexT\n---\n\n### 安装\n1. 安装node.js: https://nodejs.org/en/\n2. npm install hexo-cli -g\n3. hexo init blog\n4. cd blog\n5. npm install\n6. hexo server\n\n## 251 部署信息\n```\n#在服务器端使用supervisor维护后台进程\nsupervisorctl start|stop|restart dmsite\n配置文件：/etc/supervisor/conf.d/hexo.conf\n\n192.168.30.251:4000\n站点位置：/opt/workspace/hexo/dmteam/\n文档位置：/opt/workspace/hexo/dmteam/source/_posts （markdown或HTML文件）\n启动服务：hexo server\n```\n\n\n### 使用leancloud\n[为NexT主题添加文章阅读量统计功能](https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud)\n\n```\nAPP ID: ohqkXUU5txOlX3MjJPCrw7jG-gzGzoHsz\nAPP KEY: bPQhLzRSEsTqdIKAGRcHLhyN\nMASTER KEY: lRx8SU65bjP4SA8cRjMSDwy8\n```\n\n### 文档\n- [官网](https://hexo.io/)\n- [NexT使用文档](http://theme-next.iissnan.com/)\n- [NexT@github](https://github.com/iissnan/hexo-theme-next/blob/master/README.md)\n- [leancloud](https://leancloud.cn/)\n- [七牛云](http://www.qiniu.com/)","slug":"HEXO 安装使用说明","published":1,"updated":"2018-07-13T11:06:08.755Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogn9l00033a9d7w7eimke","content":"<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><ol>\n<li>安装node.js: <a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener\">https://nodejs.org/en/</a></li>\n<li>npm install hexo-cli -g</li>\n<li>hexo init blog</li>\n<li>cd blog</li>\n<li>npm install</li>\n<li>hexo server</li>\n</ol>\n<h2 id=\"251-部署信息\"><a href=\"#251-部署信息\" class=\"headerlink\" title=\"251 部署信息\"></a>251 部署信息</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#在服务器端使用supervisor维护后台进程</span><br><span class=\"line\">supervisorctl start|stop|restart dmsite</span><br><span class=\"line\">配置文件：/etc/supervisor/conf.d/hexo.conf</span><br><span class=\"line\"></span><br><span class=\"line\">192.168.30.251:4000</span><br><span class=\"line\">站点位置：/opt/workspace/hexo/dmteam/</span><br><span class=\"line\">文档位置：/opt/workspace/hexo/dmteam/source/_posts （markdown或HTML文件）</span><br><span class=\"line\">启动服务：hexo server</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用leancloud\"><a href=\"#使用leancloud\" class=\"headerlink\" title=\"使用leancloud\"></a>使用leancloud</h3><p><a href=\"https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud\" target=\"_blank\" rel=\"noopener\">为NexT主题添加文章阅读量统计功能</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">APP ID: ohqkXUU5txOlX3MjJPCrw7jG-gzGzoHsz</span><br><span class=\"line\">APP KEY: bPQhLzRSEsTqdIKAGRcHLhyN</span><br><span class=\"line\">MASTER KEY: lRx8SU65bjP4SA8cRjMSDwy8</span><br></pre></td></tr></table></figure>\n<h3 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h3><ul>\n<li><a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li><a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">NexT使用文档</a></li>\n<li><a href=\"https://github.com/iissnan/hexo-theme-next/blob/master/README.md\" target=\"_blank\" rel=\"noopener\">NexT@github</a></li>\n<li><a href=\"https://leancloud.cn/\" target=\"_blank\" rel=\"noopener\">leancloud</a></li>\n<li><a href=\"http://www.qiniu.com/\" target=\"_blank\" rel=\"noopener\">七牛云</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><ol>\n<li>安装node.js: <a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener\">https://nodejs.org/en/</a></li>\n<li>npm install hexo-cli -g</li>\n<li>hexo init blog</li>\n<li>cd blog</li>\n<li>npm install</li>\n<li>hexo server</li>\n</ol>\n<h2 id=\"251-部署信息\"><a href=\"#251-部署信息\" class=\"headerlink\" title=\"251 部署信息\"></a>251 部署信息</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#在服务器端使用supervisor维护后台进程</span><br><span class=\"line\">supervisorctl start|stop|restart dmsite</span><br><span class=\"line\">配置文件：/etc/supervisor/conf.d/hexo.conf</span><br><span class=\"line\"></span><br><span class=\"line\">192.168.30.251:4000</span><br><span class=\"line\">站点位置：/opt/workspace/hexo/dmteam/</span><br><span class=\"line\">文档位置：/opt/workspace/hexo/dmteam/source/_posts （markdown或HTML文件）</span><br><span class=\"line\">启动服务：hexo server</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用leancloud\"><a href=\"#使用leancloud\" class=\"headerlink\" title=\"使用leancloud\"></a>使用leancloud</h3><p><a href=\"https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud\" target=\"_blank\" rel=\"noopener\">为NexT主题添加文章阅读量统计功能</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">APP ID: ohqkXUU5txOlX3MjJPCrw7jG-gzGzoHsz</span><br><span class=\"line\">APP KEY: bPQhLzRSEsTqdIKAGRcHLhyN</span><br><span class=\"line\">MASTER KEY: lRx8SU65bjP4SA8cRjMSDwy8</span><br></pre></td></tr></table></figure>\n<h3 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h3><ul>\n<li><a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li><a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">NexT使用文档</a></li>\n<li><a href=\"https://github.com/iissnan/hexo-theme-next/blob/master/README.md\" target=\"_blank\" rel=\"noopener\">NexT@github</a></li>\n<li><a href=\"https://leancloud.cn/\" target=\"_blank\" rel=\"noopener\">leancloud</a></li>\n<li><a href=\"http://www.qiniu.com/\" target=\"_blank\" rel=\"noopener\">七牛云</a></li>\n</ul>\n"},{"title":"谁看过我","date":"2016-09-26T03:10:54.000Z","_content":"<Excerpt in index | 首页摘要>\n用户访问记录<!-- more -->\n<The rest of contents | 余下全文>\n\n## 背景\n\n  visitor日志已经由前端APP或API发送到Kafka，需要将数据消费出，导入到MySQL数据库中。\n\n## 源代码：\n\n  `git@192.168.30.251:visitorStreaming.git`\n\n## 程序逻辑\n  使用Spark streaming方式消费数据，并将消费后的数据导入MySQL。\n\n  - 2.1 定义消息格式\n    - 根据visitor消息格式定义消费者需要解析的消息格式\n    ```\n    {\n        \"head\":{\n          \"type\": \"XXXtype\",\n          \"version\": \"XXXversion\"\n        }\n        \"body\":{\n          \"timestamp\": \"XXXtimeString\",\n          \"cardOwnerId\": \"XXXcardOwnerId\",\n          \"vcardId\": \"XXXvcardId\",\n          \"userId\": \"XXXuserId\",\n          \"sendtime\": \"XXXsendtime\"\n        }\n    }\n    ```\n\n  - 2.2 编写streaming逻辑，并提供插入MySQL方法\n      - 2.2.1 解析出配置信息，创建kafka的DirectStream实例，并消费消息；\n      - 2.2.2 创建插入MySQL的逻辑函数，将消费出的信息插入到数据库。\n\n  - 2.3 配置程序环境\n\n    - 2.3.1 kafka环境信息配置\n      - brokers连接地址\n      - topic信息\n\n    - 2.3.2 MySQL环境信息配置\n      - user\n      - password\n      - url\n      - sql （insert语句）\n\n    - 2.3.3 Spark App的环境配置\n      - partitions RDD数据分片（repartition函数的参数）\n      - duration： Streaming的时间间隔\n\n## 提交Spark Job\n\n  - 2.4 将程序打包成jar文件（注意及时将代码提交到版本库）\n    - 使用sbt打包程序\n\n      - `sbt package`\n\n      注意Scala版本需和Spark集群中的Scala版本一致（Scala version： 2.10）\n\n  - 2.5 在集群中提交程序\n\n    - 将打包好的jar文件上传至spark集群中的某个节点（slave2:172.17.4.154/192.168.1.136）\n    - 使用spark-submit提交job (提交时放置到后台，不然退出shell后，程序也将结束)\n\n      `(spark-submit --class com.oradt.hank.VisitorStreaming /path/to/visitorsteaming_2.10-1.0.jar &)`\n---\n","source":"_posts/VisitorStreaming.md","raw":"---\ntitle: 谁看过我\ndate: 2016-09-26 11:10:54\ntags:\n    - Spark Streaming\n    - Kafka\n    - 谁看过我\n---\n<Excerpt in index | 首页摘要>\n用户访问记录<!-- more -->\n<The rest of contents | 余下全文>\n\n## 背景\n\n  visitor日志已经由前端APP或API发送到Kafka，需要将数据消费出，导入到MySQL数据库中。\n\n## 源代码：\n\n  `git@192.168.30.251:visitorStreaming.git`\n\n## 程序逻辑\n  使用Spark streaming方式消费数据，并将消费后的数据导入MySQL。\n\n  - 2.1 定义消息格式\n    - 根据visitor消息格式定义消费者需要解析的消息格式\n    ```\n    {\n        \"head\":{\n          \"type\": \"XXXtype\",\n          \"version\": \"XXXversion\"\n        }\n        \"body\":{\n          \"timestamp\": \"XXXtimeString\",\n          \"cardOwnerId\": \"XXXcardOwnerId\",\n          \"vcardId\": \"XXXvcardId\",\n          \"userId\": \"XXXuserId\",\n          \"sendtime\": \"XXXsendtime\"\n        }\n    }\n    ```\n\n  - 2.2 编写streaming逻辑，并提供插入MySQL方法\n      - 2.2.1 解析出配置信息，创建kafka的DirectStream实例，并消费消息；\n      - 2.2.2 创建插入MySQL的逻辑函数，将消费出的信息插入到数据库。\n\n  - 2.3 配置程序环境\n\n    - 2.3.1 kafka环境信息配置\n      - brokers连接地址\n      - topic信息\n\n    - 2.3.2 MySQL环境信息配置\n      - user\n      - password\n      - url\n      - sql （insert语句）\n\n    - 2.3.3 Spark App的环境配置\n      - partitions RDD数据分片（repartition函数的参数）\n      - duration： Streaming的时间间隔\n\n## 提交Spark Job\n\n  - 2.4 将程序打包成jar文件（注意及时将代码提交到版本库）\n    - 使用sbt打包程序\n\n      - `sbt package`\n\n      注意Scala版本需和Spark集群中的Scala版本一致（Scala version： 2.10）\n\n  - 2.5 在集群中提交程序\n\n    - 将打包好的jar文件上传至spark集群中的某个节点（slave2:172.17.4.154/192.168.1.136）\n    - 使用spark-submit提交job (提交时放置到后台，不然退出shell后，程序也将结束)\n\n      `(spark-submit --class com.oradt.hank.VisitorStreaming /path/to/visitorsteaming_2.10-1.0.jar &)`\n---\n","slug":"VisitorStreaming","published":1,"updated":"2018-07-13T11:06:08.762Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogn9s00073a9dt2rzhhnu","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>用户访问记录<a id=\"more\"></a></excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>  visitor日志已经由前端APP或API发送到Kafka，需要将数据消费出，导入到MySQL数据库中。</p>\n<h2 id=\"源代码：\"><a href=\"#源代码：\" class=\"headerlink\" title=\"源代码：\"></a>源代码：</h2><p>  <code>git@192.168.30.251:visitorStreaming.git</code></p>\n<h2 id=\"程序逻辑\"><a href=\"#程序逻辑\" class=\"headerlink\" title=\"程序逻辑\"></a>程序逻辑</h2><p>  使用Spark streaming方式消费数据，并将消费后的数据导入MySQL。</p>\n<ul>\n<li><p>2.1 定义消息格式</p>\n<ul>\n<li>根据visitor消息格式定义消费者需要解析的消息格式<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;head&quot;:&#123;</span><br><span class=\"line\">      &quot;type&quot;: &quot;XXXtype&quot;,</span><br><span class=\"line\">      &quot;version&quot;: &quot;XXXversion&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &quot;body&quot;:&#123;</span><br><span class=\"line\">      &quot;timestamp&quot;: &quot;XXXtimeString&quot;,</span><br><span class=\"line\">      &quot;cardOwnerId&quot;: &quot;XXXcardOwnerId&quot;,</span><br><span class=\"line\">      &quot;vcardId&quot;: &quot;XXXvcardId&quot;,</span><br><span class=\"line\">      &quot;userId&quot;: &quot;XXXuserId&quot;,</span><br><span class=\"line\">      &quot;sendtime&quot;: &quot;XXXsendtime&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>2.2 编写streaming逻辑，并提供插入MySQL方法</p>\n<ul>\n<li>2.2.1 解析出配置信息，创建kafka的DirectStream实例，并消费消息；</li>\n<li>2.2.2 创建插入MySQL的逻辑函数，将消费出的信息插入到数据库。</li>\n</ul>\n</li>\n<li><p>2.3 配置程序环境</p>\n<ul>\n<li><p>2.3.1 kafka环境信息配置</p>\n<ul>\n<li>brokers连接地址</li>\n<li>topic信息</li>\n</ul>\n</li>\n<li><p>2.3.2 MySQL环境信息配置</p>\n<ul>\n<li>user</li>\n<li>password</li>\n<li>url</li>\n<li>sql （insert语句）</li>\n</ul>\n</li>\n<li><p>2.3.3 Spark App的环境配置</p>\n<ul>\n<li>partitions RDD数据分片（repartition函数的参数）</li>\n<li>duration： Streaming的时间间隔</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"提交Spark-Job\"><a href=\"#提交Spark-Job\" class=\"headerlink\" title=\"提交Spark Job\"></a>提交Spark Job</h2><ul>\n<li><p>2.4 将程序打包成jar文件（注意及时将代码提交到版本库）</p>\n<ul>\n<li><p>使用sbt打包程序</p>\n<ul>\n<li><code>sbt package</code></li>\n</ul>\n<p>注意Scala版本需和Spark集群中的Scala版本一致（Scala version： 2.10）</p>\n</li>\n</ul>\n</li>\n<li><p>2.5 在集群中提交程序</p>\n<ul>\n<li>将打包好的jar文件上传至spark集群中的某个节点（slave2:172.17.4.154/192.168.1.136）</li>\n<li><p>使用spark-submit提交job (提交时放置到后台，不然退出shell后，程序也将结束)</p>\n<p><code>(spark-submit --class com.oradt.hank.VisitorStreaming /path/to/visitorsteaming_2.10-1.0.jar &amp;)</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n</the>","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>用户访问记录","more":"</excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>  visitor日志已经由前端APP或API发送到Kafka，需要将数据消费出，导入到MySQL数据库中。</p>\n<h2 id=\"源代码：\"><a href=\"#源代码：\" class=\"headerlink\" title=\"源代码：\"></a>源代码：</h2><p>  <code>git@192.168.30.251:visitorStreaming.git</code></p>\n<h2 id=\"程序逻辑\"><a href=\"#程序逻辑\" class=\"headerlink\" title=\"程序逻辑\"></a>程序逻辑</h2><p>  使用Spark streaming方式消费数据，并将消费后的数据导入MySQL。</p>\n<ul>\n<li><p>2.1 定义消息格式</p>\n<ul>\n<li>根据visitor消息格式定义消费者需要解析的消息格式<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;head&quot;:&#123;</span><br><span class=\"line\">      &quot;type&quot;: &quot;XXXtype&quot;,</span><br><span class=\"line\">      &quot;version&quot;: &quot;XXXversion&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &quot;body&quot;:&#123;</span><br><span class=\"line\">      &quot;timestamp&quot;: &quot;XXXtimeString&quot;,</span><br><span class=\"line\">      &quot;cardOwnerId&quot;: &quot;XXXcardOwnerId&quot;,</span><br><span class=\"line\">      &quot;vcardId&quot;: &quot;XXXvcardId&quot;,</span><br><span class=\"line\">      &quot;userId&quot;: &quot;XXXuserId&quot;,</span><br><span class=\"line\">      &quot;sendtime&quot;: &quot;XXXsendtime&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>2.2 编写streaming逻辑，并提供插入MySQL方法</p>\n<ul>\n<li>2.2.1 解析出配置信息，创建kafka的DirectStream实例，并消费消息；</li>\n<li>2.2.2 创建插入MySQL的逻辑函数，将消费出的信息插入到数据库。</li>\n</ul>\n</li>\n<li><p>2.3 配置程序环境</p>\n<ul>\n<li><p>2.3.1 kafka环境信息配置</p>\n<ul>\n<li>brokers连接地址</li>\n<li>topic信息</li>\n</ul>\n</li>\n<li><p>2.3.2 MySQL环境信息配置</p>\n<ul>\n<li>user</li>\n<li>password</li>\n<li>url</li>\n<li>sql （insert语句）</li>\n</ul>\n</li>\n<li><p>2.3.3 Spark App的环境配置</p>\n<ul>\n<li>partitions RDD数据分片（repartition函数的参数）</li>\n<li>duration： Streaming的时间间隔</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"提交Spark-Job\"><a href=\"#提交Spark-Job\" class=\"headerlink\" title=\"提交Spark Job\"></a>提交Spark Job</h2><ul>\n<li><p>2.4 将程序打包成jar文件（注意及时将代码提交到版本库）</p>\n<ul>\n<li><p>使用sbt打包程序</p>\n<ul>\n<li><code>sbt package</code></li>\n</ul>\n<p>注意Scala版本需和Spark集群中的Scala版本一致（Scala version： 2.10）</p>\n</li>\n</ul>\n</li>\n<li><p>2.5 在集群中提交程序</p>\n<ul>\n<li>将打包好的jar文件上传至spark集群中的某个节点（slave2:172.17.4.154/192.168.1.136）</li>\n<li><p>使用spark-submit提交job (提交时放置到后台，不然退出shell后，程序也将结束)</p>\n<p><code>(spark-submit --class com.oradt.hank.VisitorStreaming /path/to/visitorsteaming_2.10-1.0.jar &amp;)</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n</the>"},{"title":"名片别名标注","date":"2017-05-08T08:31:19.000Z","_content":"\n## 名片别名标注\n\n\n### 一.业务整体流程\n\n为满足整体橙子语音检索时的需要，为名片现有数据自动添加标签。目前主要包括四部分：\n\n* 根据职位头衔为高管级姓名后添加称呼，如总、董等。\n* 为公司名添加别名，如北京橙鑫数据科技有限公司的别名为橙鑫或IMORA\n* 从公司名通过切词来提取中心词，为公司名增加标签\n* 从公司基本信息表获取城市字段，加为标签\n\n1.**数据来源：**\n可能涉及到如下数据表\n\n* 别名信息表\noradt_cloud_test2.contact_card_removeword_alias\n* 公司别名表\noradt_cloud_test2.orange_company_alias\n\n2.**整体处理流程**\n本系统使用到名片基本信息，需要在名片基本信息拓展系统处理之后运行，处理流程如下图：\n![](http://wx3.sinaimg.cn/mw690/006nSoSwly1ffe26sy9vpj30l40dc3z3.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-step.png\n\n* 对应到代码，整体的入口为main，主要用来通过时间区间来控制需要计算的数据起始时间。并调用jobContrl中的读取数据、处理数据及序列化的方法，控制程序流程。\n* 城市标签\n由于添加城市标签功能为后续添加，没有修改整体处理流程，添加到main中，其他任务结束后，追加更新别名表中的city字段。\n* 由jobContrl实现数据输入输出格式的转换,业务处理逻辑调用dataPreprocessing实现。\n* dataPreprocessing 调用各个功能模块，拼合结果数据。\n\n\n###  二.功能模块说明\n主要功能模块的包结构如下图：\n![](http://wx1.sinaimg.cn/mw690/006nSoSwly1ffe1e2slwuj30q50c60vb.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-classes.png\n\n* 公司名关键词提取\norgKeyWords\n* 公司别名\ncompanyAlias\n* 姓氏后缀\nrespectedTitle\n\n### 三.项目部署\n\n* 当前每日任务部署于： 101.251.193.28:/home/mqian/orange_namecard_tagging\n由crontab每天凌晨4点执行，本系统的需要使用到名片基础信息，需要在名片拓展系统任务完成之后运行\n```\n####为企业打别名、人名后加称呼等打标签\n0 4 * * * /usr/local/bin/python /home/mqian/orange_namecard_tagging/main.py >>\nhome/mqian/aliaslog.log\n```\n* git位置\nhttp://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git\n","source":"_posts/alias_tag.md","raw":"---\ntitle: 名片别名标注\ndate: 2017-05-08 16:31:19\ntags:\n    - 名片\n    - 别名\ncategories: IMORA\n---\n\n## 名片别名标注\n\n\n### 一.业务整体流程\n\n为满足整体橙子语音检索时的需要，为名片现有数据自动添加标签。目前主要包括四部分：\n\n* 根据职位头衔为高管级姓名后添加称呼，如总、董等。\n* 为公司名添加别名，如北京橙鑫数据科技有限公司的别名为橙鑫或IMORA\n* 从公司名通过切词来提取中心词，为公司名增加标签\n* 从公司基本信息表获取城市字段，加为标签\n\n1.**数据来源：**\n可能涉及到如下数据表\n\n* 别名信息表\noradt_cloud_test2.contact_card_removeword_alias\n* 公司别名表\noradt_cloud_test2.orange_company_alias\n\n2.**整体处理流程**\n本系统使用到名片基本信息，需要在名片基本信息拓展系统处理之后运行，处理流程如下图：\n![](http://wx3.sinaimg.cn/mw690/006nSoSwly1ffe26sy9vpj30l40dc3z3.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-step.png\n\n* 对应到代码，整体的入口为main，主要用来通过时间区间来控制需要计算的数据起始时间。并调用jobContrl中的读取数据、处理数据及序列化的方法，控制程序流程。\n* 城市标签\n由于添加城市标签功能为后续添加，没有修改整体处理流程，添加到main中，其他任务结束后，追加更新别名表中的city字段。\n* 由jobContrl实现数据输入输出格式的转换,业务处理逻辑调用dataPreprocessing实现。\n* dataPreprocessing 调用各个功能模块，拼合结果数据。\n\n\n###  二.功能模块说明\n主要功能模块的包结构如下图：\n![](http://wx1.sinaimg.cn/mw690/006nSoSwly1ffe1e2slwuj30q50c60vb.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-classes.png\n\n* 公司名关键词提取\norgKeyWords\n* 公司别名\ncompanyAlias\n* 姓氏后缀\nrespectedTitle\n\n### 三.项目部署\n\n* 当前每日任务部署于： 101.251.193.28:/home/mqian/orange_namecard_tagging\n由crontab每天凌晨4点执行，本系统的需要使用到名片基础信息，需要在名片拓展系统任务完成之后运行\n```\n####为企业打别名、人名后加称呼等打标签\n0 4 * * * /usr/local/bin/python /home/mqian/orange_namecard_tagging/main.py >>\nhome/mqian/aliaslog.log\n```\n* git位置\nhttp://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git\n","slug":"alias_tag","published":1,"updated":"2018-07-13T11:06:08.766Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogn9v00093a9dv7wmtro2","content":"<h2 id=\"名片别名标注\"><a href=\"#名片别名标注\" class=\"headerlink\" title=\"名片别名标注\"></a>名片别名标注</h2><h3 id=\"一-业务整体流程\"><a href=\"#一-业务整体流程\" class=\"headerlink\" title=\"一.业务整体流程\"></a>一.业务整体流程</h3><p>为满足整体橙子语音检索时的需要，为名片现有数据自动添加标签。目前主要包括四部分：</p>\n<ul>\n<li>根据职位头衔为高管级姓名后添加称呼，如总、董等。</li>\n<li>为公司名添加别名，如北京橙鑫数据科技有限公司的别名为橙鑫或IMORA</li>\n<li>从公司名通过切词来提取中心词，为公司名增加标签</li>\n<li>从公司基本信息表获取城市字段，加为标签</li>\n</ul>\n<p>1.<strong>数据来源：</strong><br>可能涉及到如下数据表</p>\n<ul>\n<li>别名信息表<br>oradt_cloud_test2.contact_card_removeword_alias</li>\n<li>公司别名表<br>oradt_cloud_test2.orange_company_alias</li>\n</ul>\n<p>2.<strong>整体处理流程</strong><br>本系统使用到名片基本信息，需要在名片基本信息拓展系统处理之后运行，处理流程如下图：<br><img src=\"http://wx3.sinaimg.cn/mw690/006nSoSwly1ffe26sy9vpj30l40dc3z3.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-step.png</p>\n<ul>\n<li>对应到代码，整体的入口为main，主要用来通过时间区间来控制需要计算的数据起始时间。并调用jobContrl中的读取数据、处理数据及序列化的方法，控制程序流程。</li>\n<li>城市标签<br>由于添加城市标签功能为后续添加，没有修改整体处理流程，添加到main中，其他任务结束后，追加更新别名表中的city字段。</li>\n<li>由jobContrl实现数据输入输出格式的转换,业务处理逻辑调用dataPreprocessing实现。</li>\n<li>dataPreprocessing 调用各个功能模块，拼合结果数据。</li>\n</ul>\n<h3 id=\"二-功能模块说明\"><a href=\"#二-功能模块说明\" class=\"headerlink\" title=\"二.功能模块说明\"></a>二.功能模块说明</h3><p>主要功能模块的包结构如下图：<br><img src=\"http://wx1.sinaimg.cn/mw690/006nSoSwly1ffe1e2slwuj30q50c60vb.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-classes.png</p>\n<ul>\n<li>公司名关键词提取<br>orgKeyWords</li>\n<li>公司别名<br>companyAlias</li>\n<li>姓氏后缀<br>respectedTitle</li>\n</ul>\n<h3 id=\"三-项目部署\"><a href=\"#三-项目部署\" class=\"headerlink\" title=\"三.项目部署\"></a>三.项目部署</h3><ul>\n<li><p>当前每日任务部署于： 101.251.193.28:/home/mqian/orange_namecard_tagging<br>由crontab每天凌晨4点执行，本系统的需要使用到名片基础信息，需要在名片拓展系统任务完成之后运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">####为企业打别名、人名后加称呼等打标签</span><br><span class=\"line\">0 4 * * * /usr/local/bin/python /home/mqian/orange_namecard_tagging/main.py &gt;&gt;</span><br><span class=\"line\">home/mqian/aliaslog.log</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>git位置<br><a href=\"http://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git</a></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"名片别名标注\"><a href=\"#名片别名标注\" class=\"headerlink\" title=\"名片别名标注\"></a>名片别名标注</h2><h3 id=\"一-业务整体流程\"><a href=\"#一-业务整体流程\" class=\"headerlink\" title=\"一.业务整体流程\"></a>一.业务整体流程</h3><p>为满足整体橙子语音检索时的需要，为名片现有数据自动添加标签。目前主要包括四部分：</p>\n<ul>\n<li>根据职位头衔为高管级姓名后添加称呼，如总、董等。</li>\n<li>为公司名添加别名，如北京橙鑫数据科技有限公司的别名为橙鑫或IMORA</li>\n<li>从公司名通过切词来提取中心词，为公司名增加标签</li>\n<li>从公司基本信息表获取城市字段，加为标签</li>\n</ul>\n<p>1.<strong>数据来源：</strong><br>可能涉及到如下数据表</p>\n<ul>\n<li>别名信息表<br>oradt_cloud_test2.contact_card_removeword_alias</li>\n<li>公司别名表<br>oradt_cloud_test2.orange_company_alias</li>\n</ul>\n<p>2.<strong>整体处理流程</strong><br>本系统使用到名片基本信息，需要在名片基本信息拓展系统处理之后运行，处理流程如下图：<br><img src=\"http://wx3.sinaimg.cn/mw690/006nSoSwly1ffe26sy9vpj30l40dc3z3.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-step.png</p>\n<ul>\n<li>对应到代码，整体的入口为main，主要用来通过时间区间来控制需要计算的数据起始时间。并调用jobContrl中的读取数据、处理数据及序列化的方法，控制程序流程。</li>\n<li>城市标签<br>由于添加城市标签功能为后续添加，没有修改整体处理流程，添加到main中，其他任务结束后，追加更新别名表中的city字段。</li>\n<li>由jobContrl实现数据输入输出格式的转换,业务处理逻辑调用dataPreprocessing实现。</li>\n<li>dataPreprocessing 调用各个功能模块，拼合结果数据。</li>\n</ul>\n<h3 id=\"二-功能模块说明\"><a href=\"#二-功能模块说明\" class=\"headerlink\" title=\"二.功能模块说明\"></a>二.功能模块说明</h3><p>主要功能模块的包结构如下图：<br><img src=\"http://wx1.sinaimg.cn/mw690/006nSoSwly1ffe1e2slwuj30q50c60vb.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/alias-classes.png</p>\n<ul>\n<li>公司名关键词提取<br>orgKeyWords</li>\n<li>公司别名<br>companyAlias</li>\n<li>姓氏后缀<br>respectedTitle</li>\n</ul>\n<h3 id=\"三-项目部署\"><a href=\"#三-项目部署\" class=\"headerlink\" title=\"三.项目部署\"></a>三.项目部署</h3><ul>\n<li><p>当前每日任务部署于： 101.251.193.28:/home/mqian/orange_namecard_tagging<br>由crontab每天凌晨4点执行，本系统的需要使用到名片基础信息，需要在名片拓展系统任务完成之后运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">####为企业打别名、人名后加称呼等打标签</span><br><span class=\"line\">0 4 * * * /usr/local/bin/python /home/mqian/orange_namecard_tagging/main.py &gt;&gt;</span><br><span class=\"line\">home/mqian/aliaslog.log</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>git位置<br><a href=\"http://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:10086/git/mengqian/orange_namecard_tagging.git</a></p>\n</li>\n</ul>\n"},{"title":"Hive优化以及数据倾斜问题","date":"2017-02-10T10:00:00.000Z","_content":"# Hive优化以及数据倾斜问题\n\n## HQL优化\n\n1.调整Join顺序，确保以大表作为驱动表,即大表放在后面\n\n2.去除查询中不需要的column\n    \n3.Where条件判断等在TableScan阶段就进行过滤\n    \n4.利用Partition信息，只读取符合条件的Partition\n\n5.Map端join，以大表作驱动，小表载入所有mapper内存中\n\n6.对于数据分布不均衡的表Group by时，为避免数据集中到少数的reducer上，分成两个map-reduce阶段。第一个阶段先用Distinct列进行shuffle，然后在reduce端部分聚合，减小数据规模，第二个map-reduce阶段再按group-by列聚合。\n    \n7.在map端用hash进行部分聚合，减小reduce端数据处理规模。\n\n## 数据倾斜问题\n\n数据倾斜\n概念：数据倾斜是指，map /reduce程序执行时，reduce节点大部分执行完毕，但是\n\n有一个或者几个reduce节点运行很慢，导致整个程序的处理时间很长，这是因为某一\n\n个key的条数比其他key多很多（有时是百倍或者千倍之多），这条key所在的reduce\n\n节点所处理的数据量比其他节点就大很多，从而导致某几个节点迟迟运行不完。\n\n执行操作：\n\n  1.其中一个表较小，但是key集中，可能会导致分发到一个或几个Reduce上的数据远高于平均值\n  2.大表与大表关联，但是空值或者0比较多，这些控制都由一个reduce处理，非常慢。\n  3.group by维度过小，某值的数量过多。处理某值的Reduce非常耗时。\n  4.count distinct 某特殊值过多，处理此特殊值的Reduce耗时。\n  \n原因：\n\n    1.key分布不均\n    2.业务数据本身的特性\n    3.建表时考虑不周\n    4.某些语句本身就有数据倾斜\n  \n\n解决方案：\n\n  1.参数调节\n    hive.map.aggr=true\n    Map端部分聚合，相当于Combiner(合并器)。\n    hive.groupby.skewindata=true\n    有数据倾斜的时候进行负载均衡，当选项设定为 true，生成的查询计划会有两个 MR Job。\n\n    第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分\n\n    聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 \n\n    Reduce 中，从而达到负载均衡的目的；第二个 MR Job 再根据预处理的数据结果按照 Group By Key \n\n    分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完\n\n    成最终的聚合操作。\n\n  2.如何join？关于驱动表的选取，选用join key分布最均匀的表做为驱动表。做好列裁剪和filter操作，\n\n    以达到两表做join的时候数据量相对变小的效果。\n\n  3.使用mapjoin让小的维度表先进内存。在map端完成reduce。\n\n  4.大表join大表时，把空值的key变成一个字符串加上随机数，把倾斜的数据随机分布到不同的reduce上，\n\n    由于null值关联不上，处理后并不影响最终结果。\n\n  5.count distinct时，将值为空的情况单独处理，如果是计算count distinct，可以不用处理，直接过滤，\n\n    在最后结果中加1。如果还有其它计算，需要进行group by，可以先将值为空的记录单独处理，再和其他\n\n    结果进行union。\n\n  6.采用sum() group by的方式来替换count(distinct )进行计算。\n\n  7.在业务逻辑优化效果不大的情况下，有些时候是可以将倾斜的数据单独拿出来处理，最后union回去。\n\n  8.对于控制产生的倾斜问题，解决方案1：为空的数据不参与关联；方案2：随机（rand()）赋予空值新的key。\n\n    把空值的key变成一个字符串加上随机数，就能把倾斜的数据分到不同的reduce上，解决数据的倾斜问题。\n\n  9.不同数据类型关联产生数据倾斜，默认的Hash操作会按int型的id来分配reduce，这样会导致所有的String\n\n    类型数据分配到同一个reduce。\n\n  10.使用 mapjoin 解决小表(记录数少)关联大表的数据倾斜问题，这个方法使用的频率非常高，但如果小表\n\n     很大，大到map join会出现bug或异常，这时就需要特别的处理。","source":"_posts/Hive3.md","raw":"---\ntitle: Hive优化以及数据倾斜问题\ndate: 2017-02-10 18:00:00\ntags:\n    - etl tool\ncategories: Hive\n---\n# Hive优化以及数据倾斜问题\n\n## HQL优化\n\n1.调整Join顺序，确保以大表作为驱动表,即大表放在后面\n\n2.去除查询中不需要的column\n    \n3.Where条件判断等在TableScan阶段就进行过滤\n    \n4.利用Partition信息，只读取符合条件的Partition\n\n5.Map端join，以大表作驱动，小表载入所有mapper内存中\n\n6.对于数据分布不均衡的表Group by时，为避免数据集中到少数的reducer上，分成两个map-reduce阶段。第一个阶段先用Distinct列进行shuffle，然后在reduce端部分聚合，减小数据规模，第二个map-reduce阶段再按group-by列聚合。\n    \n7.在map端用hash进行部分聚合，减小reduce端数据处理规模。\n\n## 数据倾斜问题\n\n数据倾斜\n概念：数据倾斜是指，map /reduce程序执行时，reduce节点大部分执行完毕，但是\n\n有一个或者几个reduce节点运行很慢，导致整个程序的处理时间很长，这是因为某一\n\n个key的条数比其他key多很多（有时是百倍或者千倍之多），这条key所在的reduce\n\n节点所处理的数据量比其他节点就大很多，从而导致某几个节点迟迟运行不完。\n\n执行操作：\n\n  1.其中一个表较小，但是key集中，可能会导致分发到一个或几个Reduce上的数据远高于平均值\n  2.大表与大表关联，但是空值或者0比较多，这些控制都由一个reduce处理，非常慢。\n  3.group by维度过小，某值的数量过多。处理某值的Reduce非常耗时。\n  4.count distinct 某特殊值过多，处理此特殊值的Reduce耗时。\n  \n原因：\n\n    1.key分布不均\n    2.业务数据本身的特性\n    3.建表时考虑不周\n    4.某些语句本身就有数据倾斜\n  \n\n解决方案：\n\n  1.参数调节\n    hive.map.aggr=true\n    Map端部分聚合，相当于Combiner(合并器)。\n    hive.groupby.skewindata=true\n    有数据倾斜的时候进行负载均衡，当选项设定为 true，生成的查询计划会有两个 MR Job。\n\n    第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分\n\n    聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 \n\n    Reduce 中，从而达到负载均衡的目的；第二个 MR Job 再根据预处理的数据结果按照 Group By Key \n\n    分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完\n\n    成最终的聚合操作。\n\n  2.如何join？关于驱动表的选取，选用join key分布最均匀的表做为驱动表。做好列裁剪和filter操作，\n\n    以达到两表做join的时候数据量相对变小的效果。\n\n  3.使用mapjoin让小的维度表先进内存。在map端完成reduce。\n\n  4.大表join大表时，把空值的key变成一个字符串加上随机数，把倾斜的数据随机分布到不同的reduce上，\n\n    由于null值关联不上，处理后并不影响最终结果。\n\n  5.count distinct时，将值为空的情况单独处理，如果是计算count distinct，可以不用处理，直接过滤，\n\n    在最后结果中加1。如果还有其它计算，需要进行group by，可以先将值为空的记录单独处理，再和其他\n\n    结果进行union。\n\n  6.采用sum() group by的方式来替换count(distinct )进行计算。\n\n  7.在业务逻辑优化效果不大的情况下，有些时候是可以将倾斜的数据单独拿出来处理，最后union回去。\n\n  8.对于控制产生的倾斜问题，解决方案1：为空的数据不参与关联；方案2：随机（rand()）赋予空值新的key。\n\n    把空值的key变成一个字符串加上随机数，就能把倾斜的数据分到不同的reduce上，解决数据的倾斜问题。\n\n  9.不同数据类型关联产生数据倾斜，默认的Hash操作会按int型的id来分配reduce，这样会导致所有的String\n\n    类型数据分配到同一个reduce。\n\n  10.使用 mapjoin 解决小表(记录数少)关联大表的数据倾斜问题，这个方法使用的频率非常高，但如果小表\n\n     很大，大到map join会出现bug或异常，这时就需要特别的处理。","slug":"Hive3","published":1,"updated":"2018-07-13T11:06:08.758Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogn9y000a3a9d9r1mxbni","content":"<h1 id=\"Hive优化以及数据倾斜问题\"><a href=\"#Hive优化以及数据倾斜问题\" class=\"headerlink\" title=\"Hive优化以及数据倾斜问题\"></a>Hive优化以及数据倾斜问题</h1><h2 id=\"HQL优化\"><a href=\"#HQL优化\" class=\"headerlink\" title=\"HQL优化\"></a>HQL优化</h2><p>1.调整Join顺序，确保以大表作为驱动表,即大表放在后面</p>\n<p>2.去除查询中不需要的column</p>\n<p>3.Where条件判断等在TableScan阶段就进行过滤</p>\n<p>4.利用Partition信息，只读取符合条件的Partition</p>\n<p>5.Map端join，以大表作驱动，小表载入所有mapper内存中</p>\n<p>6.对于数据分布不均衡的表Group by时，为避免数据集中到少数的reducer上，分成两个map-reduce阶段。第一个阶段先用Distinct列进行shuffle，然后在reduce端部分聚合，减小数据规模，第二个map-reduce阶段再按group-by列聚合。</p>\n<p>7.在map端用hash进行部分聚合，减小reduce端数据处理规模。</p>\n<h2 id=\"数据倾斜问题\"><a href=\"#数据倾斜问题\" class=\"headerlink\" title=\"数据倾斜问题\"></a>数据倾斜问题</h2><p>数据倾斜<br>概念：数据倾斜是指，map /reduce程序执行时，reduce节点大部分执行完毕，但是</p>\n<p>有一个或者几个reduce节点运行很慢，导致整个程序的处理时间很长，这是因为某一</p>\n<p>个key的条数比其他key多很多（有时是百倍或者千倍之多），这条key所在的reduce</p>\n<p>节点所处理的数据量比其他节点就大很多，从而导致某几个节点迟迟运行不完。</p>\n<p>执行操作：</p>\n<p>  1.其中一个表较小，但是key集中，可能会导致分发到一个或几个Reduce上的数据远高于平均值<br>  2.大表与大表关联，但是空值或者0比较多，这些控制都由一个reduce处理，非常慢。<br>  3.group by维度过小，某值的数量过多。处理某值的Reduce非常耗时。<br>  4.count distinct 某特殊值过多，处理此特殊值的Reduce耗时。</p>\n<p>原因：</p>\n<pre><code>1.key分布不均\n2.业务数据本身的特性\n3.建表时考虑不周\n4.某些语句本身就有数据倾斜\n</code></pre><p>解决方案：</p>\n<p>  1.参数调节<br>    hive.map.aggr=true<br>    Map端部分聚合，相当于Combiner(合并器)。<br>    hive.groupby.skewindata=true<br>    有数据倾斜的时候进行负载均衡，当选项设定为 true，生成的查询计划会有两个 MR Job。</p>\n<pre><code>第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分\n\n聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 \n\nReduce 中，从而达到负载均衡的目的；第二个 MR Job 再根据预处理的数据结果按照 Group By Key \n\n分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完\n\n成最终的聚合操作。\n</code></pre><p>  2.如何join？关于驱动表的选取，选用join key分布最均匀的表做为驱动表。做好列裁剪和filter操作，</p>\n<pre><code>以达到两表做join的时候数据量相对变小的效果。\n</code></pre><p>  3.使用mapjoin让小的维度表先进内存。在map端完成reduce。</p>\n<p>  4.大表join大表时，把空值的key变成一个字符串加上随机数，把倾斜的数据随机分布到不同的reduce上，</p>\n<pre><code>由于null值关联不上，处理后并不影响最终结果。\n</code></pre><p>  5.count distinct时，将值为空的情况单独处理，如果是计算count distinct，可以不用处理，直接过滤，</p>\n<pre><code>在最后结果中加1。如果还有其它计算，需要进行group by，可以先将值为空的记录单独处理，再和其他\n\n结果进行union。\n</code></pre><p>  6.采用sum() group by的方式来替换count(distinct )进行计算。</p>\n<p>  7.在业务逻辑优化效果不大的情况下，有些时候是可以将倾斜的数据单独拿出来处理，最后union回去。</p>\n<p>  8.对于控制产生的倾斜问题，解决方案1：为空的数据不参与关联；方案2：随机（rand()）赋予空值新的key。</p>\n<pre><code>把空值的key变成一个字符串加上随机数，就能把倾斜的数据分到不同的reduce上，解决数据的倾斜问题。\n</code></pre><p>  9.不同数据类型关联产生数据倾斜，默认的Hash操作会按int型的id来分配reduce，这样会导致所有的String</p>\n<pre><code>类型数据分配到同一个reduce。\n</code></pre><p>  10.使用 mapjoin 解决小表(记录数少)关联大表的数据倾斜问题，这个方法使用的频率非常高，但如果小表</p>\n<pre><code> 很大，大到map join会出现bug或异常，这时就需要特别的处理。\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Hive优化以及数据倾斜问题\"><a href=\"#Hive优化以及数据倾斜问题\" class=\"headerlink\" title=\"Hive优化以及数据倾斜问题\"></a>Hive优化以及数据倾斜问题</h1><h2 id=\"HQL优化\"><a href=\"#HQL优化\" class=\"headerlink\" title=\"HQL优化\"></a>HQL优化</h2><p>1.调整Join顺序，确保以大表作为驱动表,即大表放在后面</p>\n<p>2.去除查询中不需要的column</p>\n<p>3.Where条件判断等在TableScan阶段就进行过滤</p>\n<p>4.利用Partition信息，只读取符合条件的Partition</p>\n<p>5.Map端join，以大表作驱动，小表载入所有mapper内存中</p>\n<p>6.对于数据分布不均衡的表Group by时，为避免数据集中到少数的reducer上，分成两个map-reduce阶段。第一个阶段先用Distinct列进行shuffle，然后在reduce端部分聚合，减小数据规模，第二个map-reduce阶段再按group-by列聚合。</p>\n<p>7.在map端用hash进行部分聚合，减小reduce端数据处理规模。</p>\n<h2 id=\"数据倾斜问题\"><a href=\"#数据倾斜问题\" class=\"headerlink\" title=\"数据倾斜问题\"></a>数据倾斜问题</h2><p>数据倾斜<br>概念：数据倾斜是指，map /reduce程序执行时，reduce节点大部分执行完毕，但是</p>\n<p>有一个或者几个reduce节点运行很慢，导致整个程序的处理时间很长，这是因为某一</p>\n<p>个key的条数比其他key多很多（有时是百倍或者千倍之多），这条key所在的reduce</p>\n<p>节点所处理的数据量比其他节点就大很多，从而导致某几个节点迟迟运行不完。</p>\n<p>执行操作：</p>\n<p>  1.其中一个表较小，但是key集中，可能会导致分发到一个或几个Reduce上的数据远高于平均值<br>  2.大表与大表关联，但是空值或者0比较多，这些控制都由一个reduce处理，非常慢。<br>  3.group by维度过小，某值的数量过多。处理某值的Reduce非常耗时。<br>  4.count distinct 某特殊值过多，处理此特殊值的Reduce耗时。</p>\n<p>原因：</p>\n<pre><code>1.key分布不均\n2.业务数据本身的特性\n3.建表时考虑不周\n4.某些语句本身就有数据倾斜\n</code></pre><p>解决方案：</p>\n<p>  1.参数调节<br>    hive.map.aggr=true<br>    Map端部分聚合，相当于Combiner(合并器)。<br>    hive.groupby.skewindata=true<br>    有数据倾斜的时候进行负载均衡，当选项设定为 true，生成的查询计划会有两个 MR Job。</p>\n<pre><code>第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分\n\n聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 \n\nReduce 中，从而达到负载均衡的目的；第二个 MR Job 再根据预处理的数据结果按照 Group By Key \n\n分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完\n\n成最终的聚合操作。\n</code></pre><p>  2.如何join？关于驱动表的选取，选用join key分布最均匀的表做为驱动表。做好列裁剪和filter操作，</p>\n<pre><code>以达到两表做join的时候数据量相对变小的效果。\n</code></pre><p>  3.使用mapjoin让小的维度表先进内存。在map端完成reduce。</p>\n<p>  4.大表join大表时，把空值的key变成一个字符串加上随机数，把倾斜的数据随机分布到不同的reduce上，</p>\n<pre><code>由于null值关联不上，处理后并不影响最终结果。\n</code></pre><p>  5.count distinct时，将值为空的情况单独处理，如果是计算count distinct，可以不用处理，直接过滤，</p>\n<pre><code>在最后结果中加1。如果还有其它计算，需要进行group by，可以先将值为空的记录单独处理，再和其他\n\n结果进行union。\n</code></pre><p>  6.采用sum() group by的方式来替换count(distinct )进行计算。</p>\n<p>  7.在业务逻辑优化效果不大的情况下，有些时候是可以将倾斜的数据单独拿出来处理，最后union回去。</p>\n<p>  8.对于控制产生的倾斜问题，解决方案1：为空的数据不参与关联；方案2：随机（rand()）赋予空值新的key。</p>\n<pre><code>把空值的key变成一个字符串加上随机数，就能把倾斜的数据分到不同的reduce上，解决数据的倾斜问题。\n</code></pre><p>  9.不同数据类型关联产生数据倾斜，默认的Hash操作会按int型的id来分配reduce，这样会导致所有的String</p>\n<pre><code>类型数据分配到同一个reduce。\n</code></pre><p>  10.使用 mapjoin 解决小表(记录数少)关联大表的数据倾斜问题，这个方法使用的频率非常高，但如果小表</p>\n<pre><code> 很大，大到map join会出现bug或异常，这时就需要特别的处理。\n</code></pre>"},{"title":"名片纠正服务文档","date":"2016-09-30T10:12:41.000Z","_content":"<Excerpt in index | 首页摘要>\n\n- 源代码\n```\n    git clone git@192.168.30.251@cardRectify.git\n```\n名片中的公司名称、职位名称、姓名等信息需要纠正或重新格式化，以获得更准确的信息，便于消除错误数据，去除冗余数据等，提升数据质量。<!-- more -->\n<The rest of contents | 余下全文>\n\n- - -\n\n- 部署位置：\n\n    - OFFICE：Oradt-BigData:/opt/workspace/cardRectify （IP：192.168.30.251）\n\n    - IDC：   BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardRecity （IP：172.17.4.1 / 192.168.1.138）\n\n- 数据源\n\t> host： 192.168.1.139\n\t> database： dm\n\t> table： scan_card_vcardinfo\n\n\t数据源为从生产库中同步并整合的名片数据表。\n\n- 获取逻辑\n\t每次执行时，以时间戳作为本次执行的批次号，任务执行成功后，记录该批次号。下次任务执行时，先获取上一次记录的批次号，从数据源中取出`updateTime`字段落在新旧批次号之间的所有记录。如果是首次执行，则取出所有`updateTime`字段小于本批次号的记录。\n\n## 处理逻辑\n- 目标\n\t获取与当前字段编辑距离最小的 **K** 个候选（K默认为3）。\n\n- 处理过程\n\t- 获取`handled`状态名片的`ORG`和`TITLE`， 按频率从大到小排序，分别作为比较基准集合。\n\n\t- `ORG`：从数据源中获取`needhandle`状态的名片，取出该名片的`ORG`字段，与基准集合中的`ORG`依次做比较，求编辑距离，将基准集合中编辑距离小于预设阈值的`ORG`按编辑距离大小加入候选集合，**每个编辑距离的候选最多保留K个记录**（编辑距离为0的只有一个）。计算完成后，再从候选集合中取出编辑距离较小的 **K** 个。\n\n\t- `TITLE`的处理逻辑同`ORG`。\n\n## 数据输出\n- 输出位置\n\t> host： 172.17.3.1\n\t> database: oradt_cloud_test\n\t> table： scan_card_rectify\n\n\t将结果 **插入** 或 **更新** 到结果表中（PK：`card_id`）。\n\n\n- - -\n## 后记\n- 分发逻辑：\n\t- 分发时获取生产库表中`handle_state`为`needhandle`状态的名片，在`scan_card_rectify`表中查找纠正建议（理论上`scan_card_rectify`能包含所有`needhandle`状态的记录，**存在数据同步和计算时间差**），然后分发。\n\n","source":"_posts/cardRectify.md","raw":"---\ntitle: 名片纠正服务文档\ndate: 2016-09-30 18:12:41\ntags:\n    - NameCard\n    - Levenstein Distance\n---\n<Excerpt in index | 首页摘要>\n\n- 源代码\n```\n    git clone git@192.168.30.251@cardRectify.git\n```\n名片中的公司名称、职位名称、姓名等信息需要纠正或重新格式化，以获得更准确的信息，便于消除错误数据，去除冗余数据等，提升数据质量。<!-- more -->\n<The rest of contents | 余下全文>\n\n- - -\n\n- 部署位置：\n\n    - OFFICE：Oradt-BigData:/opt/workspace/cardRectify （IP：192.168.30.251）\n\n    - IDC：   BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardRecity （IP：172.17.4.1 / 192.168.1.138）\n\n- 数据源\n\t> host： 192.168.1.139\n\t> database： dm\n\t> table： scan_card_vcardinfo\n\n\t数据源为从生产库中同步并整合的名片数据表。\n\n- 获取逻辑\n\t每次执行时，以时间戳作为本次执行的批次号，任务执行成功后，记录该批次号。下次任务执行时，先获取上一次记录的批次号，从数据源中取出`updateTime`字段落在新旧批次号之间的所有记录。如果是首次执行，则取出所有`updateTime`字段小于本批次号的记录。\n\n## 处理逻辑\n- 目标\n\t获取与当前字段编辑距离最小的 **K** 个候选（K默认为3）。\n\n- 处理过程\n\t- 获取`handled`状态名片的`ORG`和`TITLE`， 按频率从大到小排序，分别作为比较基准集合。\n\n\t- `ORG`：从数据源中获取`needhandle`状态的名片，取出该名片的`ORG`字段，与基准集合中的`ORG`依次做比较，求编辑距离，将基准集合中编辑距离小于预设阈值的`ORG`按编辑距离大小加入候选集合，**每个编辑距离的候选最多保留K个记录**（编辑距离为0的只有一个）。计算完成后，再从候选集合中取出编辑距离较小的 **K** 个。\n\n\t- `TITLE`的处理逻辑同`ORG`。\n\n## 数据输出\n- 输出位置\n\t> host： 172.17.3.1\n\t> database: oradt_cloud_test\n\t> table： scan_card_rectify\n\n\t将结果 **插入** 或 **更新** 到结果表中（PK：`card_id`）。\n\n\n- - -\n## 后记\n- 分发逻辑：\n\t- 分发时获取生产库表中`handle_state`为`needhandle`状态的名片，在`scan_card_rectify`表中查找纠正建议（理论上`scan_card_rectify`能包含所有`needhandle`状态的记录，**存在数据同步和计算时间差**），然后分发。\n\n","slug":"cardRectify","published":1,"updated":"2018-07-13T11:06:08.767Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogna2000e3a9dvbfsbadk","content":"<excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\">\n\n<ul>\n<li>源代码<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git@192.168.30.251@cardRectify.git</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>名片中的公司名称、职位名称、姓名等信息需要纠正或重新格式化，以获得更准确的信息，便于消除错误数据，去除冗余数据等，提升数据质量。<a id=\"more\"></a></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<hr>\n<ul>\n<li><p>部署位置：</p>\n<ul>\n<li><p>OFFICE：Oradt-BigData:/opt/workspace/cardRectify （IP：192.168.30.251）</p>\n</li>\n<li><p>IDC：   BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardRecity （IP：172.17.4.1 / 192.168.1.138）</p>\n</li>\n</ul>\n</li>\n<li><p>数据源</p>\n<blockquote>\n<p>host： 192.168.1.139<br>database： dm<br>table： scan_card_vcardinfo</p>\n</blockquote>\n<p>  数据源为从生产库中同步并整合的名片数据表。</p>\n</li>\n<li><p>获取逻辑<br>  每次执行时，以时间戳作为本次执行的批次号，任务执行成功后，记录该批次号。下次任务执行时，先获取上一次记录的批次号，从数据源中取出<code>updateTime</code>字段落在新旧批次号之间的所有记录。如果是首次执行，则取出所有<code>updateTime</code>字段小于本批次号的记录。</p>\n</li>\n</ul>\n<h2 id=\"处理逻辑\"><a href=\"#处理逻辑\" class=\"headerlink\" title=\"处理逻辑\"></a>处理逻辑</h2><ul>\n<li><p>目标<br>  获取与当前字段编辑距离最小的 <strong>K</strong> 个候选（K默认为3）。</p>\n</li>\n<li><p>处理过程</p>\n<ul>\n<li><p>获取<code>handled</code>状态名片的<code>ORG</code>和<code>TITLE</code>， 按频率从大到小排序，分别作为比较基准集合。</p>\n</li>\n<li><p><code>ORG</code>：从数据源中获取<code>needhandle</code>状态的名片，取出该名片的<code>ORG</code>字段，与基准集合中的<code>ORG</code>依次做比较，求编辑距离，将基准集合中编辑距离小于预设阈值的<code>ORG</code>按编辑距离大小加入候选集合，<strong>每个编辑距离的候选最多保留K个记录</strong>（编辑距离为0的只有一个）。计算完成后，再从候选集合中取出编辑距离较小的 <strong>K</strong> 个。</p>\n</li>\n<li><p><code>TITLE</code>的处理逻辑同<code>ORG</code>。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"数据输出\"><a href=\"#数据输出\" class=\"headerlink\" title=\"数据输出\"></a>数据输出</h2><ul>\n<li><p>输出位置</p>\n<blockquote>\n<p>host： 172.17.3.1<br>database: oradt_cloud_test<br>table： scan_card_rectify</p>\n</blockquote>\n<p>  将结果 <strong>插入</strong> 或 <strong>更新</strong> 到结果表中（PK：<code>card_id</code>）。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><ul>\n<li>分发逻辑：<ul>\n<li>分发时获取生产库表中<code>handle_state</code>为<code>needhandle</code>状态的名片，在<code>scan_card_rectify</code>表中查找纠正建议（理论上<code>scan_card_rectify</code>能包含所有<code>needhandle</code>状态的记录，<strong>存在数据同步和计算时间差</strong>），然后分发。</li>\n</ul>\n</li>\n</ul>\n</the></excerpt>","site":{"data":{}},"excerpt":"<excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\">\n\n<ul>\n<li>源代码<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git@192.168.30.251@cardRectify.git</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>名片中的公司名称、职位名称、姓名等信息需要纠正或重新格式化，以获得更准确的信息，便于消除错误数据，去除冗余数据等，提升数据质量。","more":"</p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<hr>\n<ul>\n<li><p>部署位置：</p>\n<ul>\n<li><p>OFFICE：Oradt-BigData:/opt/workspace/cardRectify （IP：192.168.30.251）</p>\n</li>\n<li><p>IDC：   BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardRecity （IP：172.17.4.1 / 192.168.1.138）</p>\n</li>\n</ul>\n</li>\n<li><p>数据源</p>\n<blockquote>\n<p>host： 192.168.1.139<br>database： dm<br>table： scan_card_vcardinfo</p>\n</blockquote>\n<p>  数据源为从生产库中同步并整合的名片数据表。</p>\n</li>\n<li><p>获取逻辑<br>  每次执行时，以时间戳作为本次执行的批次号，任务执行成功后，记录该批次号。下次任务执行时，先获取上一次记录的批次号，从数据源中取出<code>updateTime</code>字段落在新旧批次号之间的所有记录。如果是首次执行，则取出所有<code>updateTime</code>字段小于本批次号的记录。</p>\n</li>\n</ul>\n<h2 id=\"处理逻辑\"><a href=\"#处理逻辑\" class=\"headerlink\" title=\"处理逻辑\"></a>处理逻辑</h2><ul>\n<li><p>目标<br>  获取与当前字段编辑距离最小的 <strong>K</strong> 个候选（K默认为3）。</p>\n</li>\n<li><p>处理过程</p>\n<ul>\n<li><p>获取<code>handled</code>状态名片的<code>ORG</code>和<code>TITLE</code>， 按频率从大到小排序，分别作为比较基准集合。</p>\n</li>\n<li><p><code>ORG</code>：从数据源中获取<code>needhandle</code>状态的名片，取出该名片的<code>ORG</code>字段，与基准集合中的<code>ORG</code>依次做比较，求编辑距离，将基准集合中编辑距离小于预设阈值的<code>ORG</code>按编辑距离大小加入候选集合，<strong>每个编辑距离的候选最多保留K个记录</strong>（编辑距离为0的只有一个）。计算完成后，再从候选集合中取出编辑距离较小的 <strong>K</strong> 个。</p>\n</li>\n<li><p><code>TITLE</code>的处理逻辑同<code>ORG</code>。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"数据输出\"><a href=\"#数据输出\" class=\"headerlink\" title=\"数据输出\"></a>数据输出</h2><ul>\n<li><p>输出位置</p>\n<blockquote>\n<p>host： 172.17.3.1<br>database: oradt_cloud_test<br>table： scan_card_rectify</p>\n</blockquote>\n<p>  将结果 <strong>插入</strong> 或 <strong>更新</strong> 到结果表中（PK：<code>card_id</code>）。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><ul>\n<li>分发逻辑：<ul>\n<li>分发时获取生产库表中<code>handle_state</code>为<code>needhandle</code>状态的名片，在<code>scan_card_rectify</code>表中查找纠正建议（理论上<code>scan_card_rectify</code>能包含所有<code>needhandle</code>状态的记录，<strong>存在数据同步和计算时间差</strong>），然后分发。</li>\n</ul>\n</li>\n</ul>\n</the></excerpt>"},{"title":"cloudera集群环境说明文档","date":"2016-09-26T08:53:17.000Z","_content":"<Excerpt in index | 首页摘要>\nCDH集群环境说明（含IDC环境和OFFICE环境） <!-- more -->\n<The rest of contents | 余下全文>\n\n\n环境搭建文档：http://192.168.30.251:4000/2016/01/27/BigdataPlatform/\n\n----\nIDC Cloudera集群环境\n\n|简称|节点名|IDC IP| 内网映射IP|在集群|Kafka Broker|备注(其他主要功能)\n|-----|--\n|Cloud  |BJCloud-Spark-Slave-1\t  | 172.17.4.151  |101.251.193.28 | 否 |否 |web service\n|Mongo1 |BJIDC-Oradt-MongoDB-1\t  | 172.17.4.51   |192.168.1.137  | 否 |否 |web service\n|Mongo2 |BJIDC-Oradt-MongoDB-2\t  | 172.17.4.52   |192.168.1.132  | 否 |否 |web service\n||\n|MySQL1 |BJIDC-Oradt-DMMySQL-1\t  | 172.17.4.1    |192.168.1.138  | 是 | 是 |mysql数据库\n|MySQL2 |BJIDC-Oradt-DMMySQL-2\t  | 172.17.4.2    |192.168.1.139  | 是 | 是 |mysql数据库\n|Master1|BJIDC-Oradt-SprakMaster-1|\t172.17.4.101  |192.168.1.133  | 是 |**否**|管理界面（admin/CMadmin）\n|Master2|BJIDC-Oradt-SparkMaster-2|\t172.17.4.102  |192.168.1.134  | 是 | 是 |--\n|Slave1 |BJIDC-Oradt-SparkSlave-1 | 172.17.4.153  |192.168.1.135  | 是 | 是 |--\n|Slave2 |BJIDC-Oradt-SparkSlave-2 | 172.17.4.154  |192.168.1.136  | 是 | 是 |spark job提交\n\n----\nOFFICE Cloudera集群测试环境\n\nroot密码：123456\n\n|简称|节点名|内网IP|备注\n|-----|--\n| vm150| BJOFFICE-Oradt-Spark04 |192.168.30.150 |CDM管理界面（admin/ADMIN）\n| vm149| BJOFFICE-Oradt-Spark03 |192.168.30.149 |--\n| vm148| BJOFFICE-Oradt-Spark02 |192.168.30.148 |--\n| vm147| BJOFFICE-Oradt-Spark01 |192.168.30.147 |--\n----\n\n## 常见问题及解决方案\n\n- 1 未找到第三方jar包？\n\n  - 解决方案一.\n\n    将第三方jar包所在路径添加到/etc/spark/conf/classpath文件末尾， 同步到集群中所有节点\n\n  - 解决方案二.\n\n    通过cloudera manager界面，找到spark下的\"配置\"-->\"Gateway Default Group\"-->\"高级\"，修改spark-defaults.conf，将第三方jar包加入到spark.driver.extraClassPath和spark.executor.extraClassPath选项中\n\n- 2 hdfs文件不存在\n\n  解决方案： 使用命令 hdfs dfs -ls /path/to/file  确认是否存在改文件 （spark分布式系统要确保数据在HDFS上，而非本地文件系统上）\n\n- 3 文件或文件夹无读写权限\n\n  解决方案：确保当前用户在spark job的数据读取路径或数据写入路径中有相应权限；如果没有，添加相应权限或者将数据复制或写入到别处。\n\n- 4 spark job提交后一直等待资源\n\n  解决方案：spark集群中资源被占用，当前的job无法分配到足够的资源以运行任务。如果必要，重启spark集群。\n\n- 5 cloudera升级\n\n  - 方法一：\n\n    登录Cloudera Manager界面，\"主机\" --> \"Parcel\"，进入软件包界面后可看到先用软件版本， 右上角\"检查新Parcel\"可发现新parcel，\"下载\"-->\"分配\"-->\"安装\"\n\n  - 方法二：\n\n    从cloudera官网下载（http://archive.cloudera.com/cdh5， http://archive.cloudera.com/cm5） Parcel包构建本地库（详见文章‘环境搭建文档’），手动更新\n\n\n提示：**错误信息请注意查看log和控制台屏显日志**\n\n---\n","source":"_posts/clouderaCluster.md","raw":"---\ntitle: cloudera集群环境说明文档\ndate: 2016-09-26 16:53:17\ntags:\n    - Cloudera\n    - Kafka\n---\n<Excerpt in index | 首页摘要>\nCDH集群环境说明（含IDC环境和OFFICE环境） <!-- more -->\n<The rest of contents | 余下全文>\n\n\n环境搭建文档：http://192.168.30.251:4000/2016/01/27/BigdataPlatform/\n\n----\nIDC Cloudera集群环境\n\n|简称|节点名|IDC IP| 内网映射IP|在集群|Kafka Broker|备注(其他主要功能)\n|-----|--\n|Cloud  |BJCloud-Spark-Slave-1\t  | 172.17.4.151  |101.251.193.28 | 否 |否 |web service\n|Mongo1 |BJIDC-Oradt-MongoDB-1\t  | 172.17.4.51   |192.168.1.137  | 否 |否 |web service\n|Mongo2 |BJIDC-Oradt-MongoDB-2\t  | 172.17.4.52   |192.168.1.132  | 否 |否 |web service\n||\n|MySQL1 |BJIDC-Oradt-DMMySQL-1\t  | 172.17.4.1    |192.168.1.138  | 是 | 是 |mysql数据库\n|MySQL2 |BJIDC-Oradt-DMMySQL-2\t  | 172.17.4.2    |192.168.1.139  | 是 | 是 |mysql数据库\n|Master1|BJIDC-Oradt-SprakMaster-1|\t172.17.4.101  |192.168.1.133  | 是 |**否**|管理界面（admin/CMadmin）\n|Master2|BJIDC-Oradt-SparkMaster-2|\t172.17.4.102  |192.168.1.134  | 是 | 是 |--\n|Slave1 |BJIDC-Oradt-SparkSlave-1 | 172.17.4.153  |192.168.1.135  | 是 | 是 |--\n|Slave2 |BJIDC-Oradt-SparkSlave-2 | 172.17.4.154  |192.168.1.136  | 是 | 是 |spark job提交\n\n----\nOFFICE Cloudera集群测试环境\n\nroot密码：123456\n\n|简称|节点名|内网IP|备注\n|-----|--\n| vm150| BJOFFICE-Oradt-Spark04 |192.168.30.150 |CDM管理界面（admin/ADMIN）\n| vm149| BJOFFICE-Oradt-Spark03 |192.168.30.149 |--\n| vm148| BJOFFICE-Oradt-Spark02 |192.168.30.148 |--\n| vm147| BJOFFICE-Oradt-Spark01 |192.168.30.147 |--\n----\n\n## 常见问题及解决方案\n\n- 1 未找到第三方jar包？\n\n  - 解决方案一.\n\n    将第三方jar包所在路径添加到/etc/spark/conf/classpath文件末尾， 同步到集群中所有节点\n\n  - 解决方案二.\n\n    通过cloudera manager界面，找到spark下的\"配置\"-->\"Gateway Default Group\"-->\"高级\"，修改spark-defaults.conf，将第三方jar包加入到spark.driver.extraClassPath和spark.executor.extraClassPath选项中\n\n- 2 hdfs文件不存在\n\n  解决方案： 使用命令 hdfs dfs -ls /path/to/file  确认是否存在改文件 （spark分布式系统要确保数据在HDFS上，而非本地文件系统上）\n\n- 3 文件或文件夹无读写权限\n\n  解决方案：确保当前用户在spark job的数据读取路径或数据写入路径中有相应权限；如果没有，添加相应权限或者将数据复制或写入到别处。\n\n- 4 spark job提交后一直等待资源\n\n  解决方案：spark集群中资源被占用，当前的job无法分配到足够的资源以运行任务。如果必要，重启spark集群。\n\n- 5 cloudera升级\n\n  - 方法一：\n\n    登录Cloudera Manager界面，\"主机\" --> \"Parcel\"，进入软件包界面后可看到先用软件版本， 右上角\"检查新Parcel\"可发现新parcel，\"下载\"-->\"分配\"-->\"安装\"\n\n  - 方法二：\n\n    从cloudera官网下载（http://archive.cloudera.com/cdh5， http://archive.cloudera.com/cm5） Parcel包构建本地库（详见文章‘环境搭建文档’），手动更新\n\n\n提示：**错误信息请注意查看log和控制台屏显日志**\n\n---\n","slug":"clouderaCluster","published":1,"updated":"2018-07-13T11:06:08.769Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognad000g3a9d5ol2k15h","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>CDH集群环境说明（含IDC环境和OFFICE环境） <a id=\"more\"></a></excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n\n<p>环境搭建文档：<a href=\"http://192.168.30.251:4000/2016/01/27/BigdataPlatform/\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:4000/2016/01/27/BigdataPlatform/</a></p>\n<hr>\n<p>IDC Cloudera集群环境</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>简称</th>\n<th>节点名</th>\n<th>IDC IP</th>\n<th>内网映射IP</th>\n<th>在集群</th>\n<th>Kafka Broker</th>\n<th>备注(其他主要功能)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cloud</td>\n<td>BJCloud-Spark-Slave-1</td>\n<td>172.17.4.151</td>\n<td>101.251.193.28</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td>Mongo1</td>\n<td>BJIDC-Oradt-MongoDB-1</td>\n<td>172.17.4.51</td>\n<td>192.168.1.137</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td>Mongo2</td>\n<td>BJIDC-Oradt-MongoDB-2</td>\n<td>172.17.4.52</td>\n<td>192.168.1.132</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td></td>\n</tr>\n<tr>\n<td>MySQL1</td>\n<td>BJIDC-Oradt-DMMySQL-1</td>\n<td>172.17.4.1</td>\n<td>192.168.1.138</td>\n<td>是</td>\n<td>是</td>\n<td>mysql数据库</td>\n</tr>\n<tr>\n<td>MySQL2</td>\n<td>BJIDC-Oradt-DMMySQL-2</td>\n<td>172.17.4.2</td>\n<td>192.168.1.139</td>\n<td>是</td>\n<td>是</td>\n<td>mysql数据库</td>\n</tr>\n<tr>\n<td>Master1</td>\n<td>BJIDC-Oradt-SprakMaster-1</td>\n<td>172.17.4.101</td>\n<td>192.168.1.133</td>\n<td>是</td>\n<td><strong>否</strong></td>\n<td>管理界面（admin/CMadmin）</td>\n</tr>\n<tr>\n<td>Master2</td>\n<td>BJIDC-Oradt-SparkMaster-2</td>\n<td>172.17.4.102</td>\n<td>192.168.1.134</td>\n<td>是</td>\n<td>是</td>\n<td>—</td>\n</tr>\n<tr>\n<td>Slave1</td>\n<td>BJIDC-Oradt-SparkSlave-1</td>\n<td>172.17.4.153</td>\n<td>192.168.1.135</td>\n<td>是</td>\n<td>是</td>\n<td>—</td>\n</tr>\n<tr>\n<td>Slave2</td>\n<td>BJIDC-Oradt-SparkSlave-2</td>\n<td>172.17.4.154</td>\n<td>192.168.1.136</td>\n<td>是</td>\n<td>是</td>\n<td>spark job提交</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<p>OFFICE Cloudera集群测试环境</p>\n<p>root密码：123456</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>简称</th>\n<th>节点名</th>\n<th>内网IP</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>vm150</td>\n<td>BJOFFICE-Oradt-Spark04</td>\n<td>192.168.30.150</td>\n<td>CDM管理界面（admin/ADMIN）</td>\n</tr>\n<tr>\n<td>vm149</td>\n<td>BJOFFICE-Oradt-Spark03</td>\n<td>192.168.30.149</td>\n<td>—</td>\n</tr>\n<tr>\n<td>vm148</td>\n<td>BJOFFICE-Oradt-Spark02</td>\n<td>192.168.30.148</td>\n<td>—</td>\n</tr>\n<tr>\n<td>vm147</td>\n<td>BJOFFICE-Oradt-Spark01</td>\n<td>192.168.30.147</td>\n<td>—</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<h2 id=\"常见问题及解决方案\"><a href=\"#常见问题及解决方案\" class=\"headerlink\" title=\"常见问题及解决方案\"></a>常见问题及解决方案</h2><ul>\n<li><p>1 未找到第三方jar包？</p>\n<ul>\n<li><p>解决方案一.</p>\n<p>将第三方jar包所在路径添加到/etc/spark/conf/classpath文件末尾， 同步到集群中所有节点</p>\n</li>\n<li><p>解决方案二.</p>\n<p>通过cloudera manager界面，找到spark下的”配置”—&gt;”Gateway Default Group”—&gt;”高级”，修改spark-defaults.conf，将第三方jar包加入到spark.driver.extraClassPath和spark.executor.extraClassPath选项中</p>\n</li>\n</ul>\n</li>\n<li><p>2 hdfs文件不存在</p>\n<p>解决方案： 使用命令 hdfs dfs -ls /path/to/file  确认是否存在改文件 （spark分布式系统要确保数据在HDFS上，而非本地文件系统上）</p>\n</li>\n<li><p>3 文件或文件夹无读写权限</p>\n<p>解决方案：确保当前用户在spark job的数据读取路径或数据写入路径中有相应权限；如果没有，添加相应权限或者将数据复制或写入到别处。</p>\n</li>\n<li><p>4 spark job提交后一直等待资源</p>\n<p>解决方案：spark集群中资源被占用，当前的job无法分配到足够的资源以运行任务。如果必要，重启spark集群。</p>\n</li>\n<li><p>5 cloudera升级</p>\n<ul>\n<li><p>方法一：</p>\n<p>登录Cloudera Manager界面，”主机” —&gt; “Parcel”，进入软件包界面后可看到先用软件版本， 右上角”检查新Parcel”可发现新parcel，”下载”—&gt;”分配”—&gt;”安装”</p>\n</li>\n<li><p>方法二：</p>\n<p>从cloudera官网下载（<a href=\"http://archive.cloudera.com/cdh5，\" target=\"_blank\" rel=\"noopener\">http://archive.cloudera.com/cdh5，</a> <a href=\"http://archive.cloudera.com/cm5）\" target=\"_blank\" rel=\"noopener\">http://archive.cloudera.com/cm5）</a> Parcel包构建本地库（详见文章‘环境搭建文档’），手动更新</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>提示：<strong>错误信息请注意查看log和控制台屏显日志</strong></p>\n<hr>\n</the>","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>CDH集群环境说明（含IDC环境和OFFICE环境）","more":"</excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n\n<p>环境搭建文档：<a href=\"http://192.168.30.251:4000/2016/01/27/BigdataPlatform/\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:4000/2016/01/27/BigdataPlatform/</a></p>\n<hr>\n<p>IDC Cloudera集群环境</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>简称</th>\n<th>节点名</th>\n<th>IDC IP</th>\n<th>内网映射IP</th>\n<th>在集群</th>\n<th>Kafka Broker</th>\n<th>备注(其他主要功能)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cloud</td>\n<td>BJCloud-Spark-Slave-1</td>\n<td>172.17.4.151</td>\n<td>101.251.193.28</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td>Mongo1</td>\n<td>BJIDC-Oradt-MongoDB-1</td>\n<td>172.17.4.51</td>\n<td>192.168.1.137</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td>Mongo2</td>\n<td>BJIDC-Oradt-MongoDB-2</td>\n<td>172.17.4.52</td>\n<td>192.168.1.132</td>\n<td>否</td>\n<td>否</td>\n<td>web service</td>\n</tr>\n<tr>\n<td></td>\n</tr>\n<tr>\n<td>MySQL1</td>\n<td>BJIDC-Oradt-DMMySQL-1</td>\n<td>172.17.4.1</td>\n<td>192.168.1.138</td>\n<td>是</td>\n<td>是</td>\n<td>mysql数据库</td>\n</tr>\n<tr>\n<td>MySQL2</td>\n<td>BJIDC-Oradt-DMMySQL-2</td>\n<td>172.17.4.2</td>\n<td>192.168.1.139</td>\n<td>是</td>\n<td>是</td>\n<td>mysql数据库</td>\n</tr>\n<tr>\n<td>Master1</td>\n<td>BJIDC-Oradt-SprakMaster-1</td>\n<td>172.17.4.101</td>\n<td>192.168.1.133</td>\n<td>是</td>\n<td><strong>否</strong></td>\n<td>管理界面（admin/CMadmin）</td>\n</tr>\n<tr>\n<td>Master2</td>\n<td>BJIDC-Oradt-SparkMaster-2</td>\n<td>172.17.4.102</td>\n<td>192.168.1.134</td>\n<td>是</td>\n<td>是</td>\n<td>—</td>\n</tr>\n<tr>\n<td>Slave1</td>\n<td>BJIDC-Oradt-SparkSlave-1</td>\n<td>172.17.4.153</td>\n<td>192.168.1.135</td>\n<td>是</td>\n<td>是</td>\n<td>—</td>\n</tr>\n<tr>\n<td>Slave2</td>\n<td>BJIDC-Oradt-SparkSlave-2</td>\n<td>172.17.4.154</td>\n<td>192.168.1.136</td>\n<td>是</td>\n<td>是</td>\n<td>spark job提交</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<p>OFFICE Cloudera集群测试环境</p>\n<p>root密码：123456</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>简称</th>\n<th>节点名</th>\n<th>内网IP</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>vm150</td>\n<td>BJOFFICE-Oradt-Spark04</td>\n<td>192.168.30.150</td>\n<td>CDM管理界面（admin/ADMIN）</td>\n</tr>\n<tr>\n<td>vm149</td>\n<td>BJOFFICE-Oradt-Spark03</td>\n<td>192.168.30.149</td>\n<td>—</td>\n</tr>\n<tr>\n<td>vm148</td>\n<td>BJOFFICE-Oradt-Spark02</td>\n<td>192.168.30.148</td>\n<td>—</td>\n</tr>\n<tr>\n<td>vm147</td>\n<td>BJOFFICE-Oradt-Spark01</td>\n<td>192.168.30.147</td>\n<td>—</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<h2 id=\"常见问题及解决方案\"><a href=\"#常见问题及解决方案\" class=\"headerlink\" title=\"常见问题及解决方案\"></a>常见问题及解决方案</h2><ul>\n<li><p>1 未找到第三方jar包？</p>\n<ul>\n<li><p>解决方案一.</p>\n<p>将第三方jar包所在路径添加到/etc/spark/conf/classpath文件末尾， 同步到集群中所有节点</p>\n</li>\n<li><p>解决方案二.</p>\n<p>通过cloudera manager界面，找到spark下的”配置”—&gt;”Gateway Default Group”—&gt;”高级”，修改spark-defaults.conf，将第三方jar包加入到spark.driver.extraClassPath和spark.executor.extraClassPath选项中</p>\n</li>\n</ul>\n</li>\n<li><p>2 hdfs文件不存在</p>\n<p>解决方案： 使用命令 hdfs dfs -ls /path/to/file  确认是否存在改文件 （spark分布式系统要确保数据在HDFS上，而非本地文件系统上）</p>\n</li>\n<li><p>3 文件或文件夹无读写权限</p>\n<p>解决方案：确保当前用户在spark job的数据读取路径或数据写入路径中有相应权限；如果没有，添加相应权限或者将数据复制或写入到别处。</p>\n</li>\n<li><p>4 spark job提交后一直等待资源</p>\n<p>解决方案：spark集群中资源被占用，当前的job无法分配到足够的资源以运行任务。如果必要，重启spark集群。</p>\n</li>\n<li><p>5 cloudera升级</p>\n<ul>\n<li><p>方法一：</p>\n<p>登录Cloudera Manager界面，”主机” —&gt; “Parcel”，进入软件包界面后可看到先用软件版本， 右上角”检查新Parcel”可发现新parcel，”下载”—&gt;”分配”—&gt;”安装”</p>\n</li>\n<li><p>方法二：</p>\n<p>从cloudera官网下载（<a href=\"http://archive.cloudera.com/cdh5，\" target=\"_blank\" rel=\"noopener\">http://archive.cloudera.com/cdh5，</a> <a href=\"http://archive.cloudera.com/cm5）\" target=\"_blank\" rel=\"noopener\">http://archive.cloudera.com/cm5）</a> Parcel包构建本地库（详见文章‘环境搭建文档’），手动更新</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>提示：<strong>错误信息请注意查看log和控制台屏显日志</strong></p>\n<hr>\n</the>"},{"title":"图像特征抽取","date":"2016-09-26T06:47:25.000Z","_content":"<Excerpt in index | 首页摘要>\npHash, BOV等图像特征抽取方法<!-- more -->\n<The rest of contents | 余下全文>\n\n\n代码库地址： git@192.168.30.251:similarCards.git\n\n### 使用hash函数将图片转化为指纹\n\n参照： https://github.com/paul-schwendenman/imagehash2\n\n使用imagehash获取图片的fingerprint，建立指纹库，然后每次查找指纹的编辑距离最近的几个图片作为候选\n\n### 使用BOVW算法\n\n参见代码：192.168.30.251:/opt/workspace/imgSimilarity/clustering/vocabulary.py\n\n思路：\n  - 抽取descriptor：使用opencv模块获取图像的keypoints之后，抽取descriptor，\n  - 聚类获取码表：由于descriptor是K维向量(列固定)表示的，因此可以用descriptor的向量聚类出一个codebook，每个向量有一个index，\n  - 图片重新表示：每张图片都由这个codebook中的向量表示，即用一组index表示。\n  - 相似度计算： 两张图片的相似度就是两组index的相似度。\n\n### 其他方法\n  - pHash（名片图片集上效果不理想）\n  - LIRE\n\n> 基于Lire的图像检索：\n—— by mazf\n>1、代码：git@192.168.30.251:OraImageRetrival.git\n>2、代码说明：\n>> 2.1 代码有两个部分，都是Java文件，有详细的注释：\n>>--OraIndexer：用来构建索引\n>>--OraSearcher：根据构建好的索引，进行图像检索\n>>>**OraIndexer** 是一个单线程程序，所以，构建索引比较慢，解决方法是加入多线程\n要创建索引，需要一个文档构建对象LocalDocumentBuilder，并给该对象传入提取图像特征的方法，Lire提供了很多特征提取的方法，本程序采用的是快速sift方法CvSurfExtractor。有了LocalDocumentBuilder对象后，可以对图像创建一文档Document，并将该文档写入索引，代码如下：\n</br>*// 创建一个文档对象（Lucene的概念）\nLocalDocumentBuilder localDocumentBuilder = new LocalDocumentBuilder();\n// 给文档对象添加一个提取器，使用Surf的提取器，传入码表\nlocalDocumentBuilder.addExtractor(CvSurfExtractor.class, Cluster.readClusters(codeBook));\n// 读取图像文件，并用文档对象创建一个文档\nBufferedImage img = ImageIO.read(new FileInputStream(imageFilePath));\nDocument doc = localDocumentBuilder.createDocument(img, imageFilePath);\n// 将图像文档写入索引，iw是IndexWriter对象\niw.addDocument(doc);*\n>>></br>\n**OraSearch** 是图像检索对象，检索速度在2s左右，很快。\n检索和创建索引要匹配，都需要使用相同的特征提取方法，这里使用CvSurfExtractor特征提取\n检索的过程需要三个主要的对象：索引读取对象，搜索对象，匹配对象\n</br>*// 创建 索引读取对象，搜索对象，匹配对象\n// 同样，需要将CvSurfExtractor传给搜索对象，hits中保存的是匹配命中的图像文档对象\nIndexReader reader = DirectoryReader.open(FSDirectory.open(Paths.get(indexPath)));\nImageSearcher searcher = new GenericFastImageSearcher(resCnt, CvSurfExtractor.class, new BOVW(),128, true, reader, codeBook);\nImageSearchHits hits = searcher.search(ImageIO.read(new File(imageName)), reader);*</br>\n\n\n\n\n>>2.2 目录介绍\n>>--CardImages：用于测试的名片图片\n>>--CodeBook： CvSURF128码表，不需要修改\n>>--ImageIndex： Lire生成的索引目录\n\n>3、备注：\n>程序在Windows下编译，如果在Linux和Mac上，要重新编译Lire库\n>Lire源程序在 251 上我的目录下：Lire-1.0b2.zip\n>用idea打开，用 maven 编译就可以了\n\n\n### 相关调研工作见：(192.168.30.251)\n  /opt/workspace/imgSimilarity\n  /opt/workspace/similarCards\n\n\n  [1]: git@192.168.30.251:OraImageRetrival.git","source":"_posts/imageFeatures.md","raw":"---\ntitle: 图像特征抽取\ndate: 2016-09-26 14:47:25\ntags:\n    - opencv\n    - bovw\n    - imagehash\n---\n<Excerpt in index | 首页摘要>\npHash, BOV等图像特征抽取方法<!-- more -->\n<The rest of contents | 余下全文>\n\n\n代码库地址： git@192.168.30.251:similarCards.git\n\n### 使用hash函数将图片转化为指纹\n\n参照： https://github.com/paul-schwendenman/imagehash2\n\n使用imagehash获取图片的fingerprint，建立指纹库，然后每次查找指纹的编辑距离最近的几个图片作为候选\n\n### 使用BOVW算法\n\n参见代码：192.168.30.251:/opt/workspace/imgSimilarity/clustering/vocabulary.py\n\n思路：\n  - 抽取descriptor：使用opencv模块获取图像的keypoints之后，抽取descriptor，\n  - 聚类获取码表：由于descriptor是K维向量(列固定)表示的，因此可以用descriptor的向量聚类出一个codebook，每个向量有一个index，\n  - 图片重新表示：每张图片都由这个codebook中的向量表示，即用一组index表示。\n  - 相似度计算： 两张图片的相似度就是两组index的相似度。\n\n### 其他方法\n  - pHash（名片图片集上效果不理想）\n  - LIRE\n\n> 基于Lire的图像检索：\n—— by mazf\n>1、代码：git@192.168.30.251:OraImageRetrival.git\n>2、代码说明：\n>> 2.1 代码有两个部分，都是Java文件，有详细的注释：\n>>--OraIndexer：用来构建索引\n>>--OraSearcher：根据构建好的索引，进行图像检索\n>>>**OraIndexer** 是一个单线程程序，所以，构建索引比较慢，解决方法是加入多线程\n要创建索引，需要一个文档构建对象LocalDocumentBuilder，并给该对象传入提取图像特征的方法，Lire提供了很多特征提取的方法，本程序采用的是快速sift方法CvSurfExtractor。有了LocalDocumentBuilder对象后，可以对图像创建一文档Document，并将该文档写入索引，代码如下：\n</br>*// 创建一个文档对象（Lucene的概念）\nLocalDocumentBuilder localDocumentBuilder = new LocalDocumentBuilder();\n// 给文档对象添加一个提取器，使用Surf的提取器，传入码表\nlocalDocumentBuilder.addExtractor(CvSurfExtractor.class, Cluster.readClusters(codeBook));\n// 读取图像文件，并用文档对象创建一个文档\nBufferedImage img = ImageIO.read(new FileInputStream(imageFilePath));\nDocument doc = localDocumentBuilder.createDocument(img, imageFilePath);\n// 将图像文档写入索引，iw是IndexWriter对象\niw.addDocument(doc);*\n>>></br>\n**OraSearch** 是图像检索对象，检索速度在2s左右，很快。\n检索和创建索引要匹配，都需要使用相同的特征提取方法，这里使用CvSurfExtractor特征提取\n检索的过程需要三个主要的对象：索引读取对象，搜索对象，匹配对象\n</br>*// 创建 索引读取对象，搜索对象，匹配对象\n// 同样，需要将CvSurfExtractor传给搜索对象，hits中保存的是匹配命中的图像文档对象\nIndexReader reader = DirectoryReader.open(FSDirectory.open(Paths.get(indexPath)));\nImageSearcher searcher = new GenericFastImageSearcher(resCnt, CvSurfExtractor.class, new BOVW(),128, true, reader, codeBook);\nImageSearchHits hits = searcher.search(ImageIO.read(new File(imageName)), reader);*</br>\n\n\n\n\n>>2.2 目录介绍\n>>--CardImages：用于测试的名片图片\n>>--CodeBook： CvSURF128码表，不需要修改\n>>--ImageIndex： Lire生成的索引目录\n\n>3、备注：\n>程序在Windows下编译，如果在Linux和Mac上，要重新编译Lire库\n>Lire源程序在 251 上我的目录下：Lire-1.0b2.zip\n>用idea打开，用 maven 编译就可以了\n\n\n### 相关调研工作见：(192.168.30.251)\n  /opt/workspace/imgSimilarity\n  /opt/workspace/similarCards\n\n\n  [1]: git@192.168.30.251:OraImageRetrival.git","slug":"imageFeatures","published":1,"updated":"2018-07-13T11:06:08.773Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognaf000j3a9dup2u8g9y","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>pHash, BOV等图像特征抽取方法<a id=\"more\"></a></excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n\n<p>代码库地址： git@192.168.30.251:similarCards.git</p>\n<h3 id=\"使用hash函数将图片转化为指纹\"><a href=\"#使用hash函数将图片转化为指纹\" class=\"headerlink\" title=\"使用hash函数将图片转化为指纹\"></a>使用hash函数将图片转化为指纹</h3><p>参照： <a href=\"https://github.com/paul-schwendenman/imagehash2\" target=\"_blank\" rel=\"noopener\">https://github.com/paul-schwendenman/imagehash2</a></p>\n<p>使用imagehash获取图片的fingerprint，建立指纹库，然后每次查找指纹的编辑距离最近的几个图片作为候选</p>\n<h3 id=\"使用BOVW算法\"><a href=\"#使用BOVW算法\" class=\"headerlink\" title=\"使用BOVW算法\"></a>使用BOVW算法</h3><p>参见代码：192.168.30.251:/opt/workspace/imgSimilarity/clustering/vocabulary.py</p>\n<p>思路：</p>\n<ul>\n<li>抽取descriptor：使用opencv模块获取图像的keypoints之后，抽取descriptor，</li>\n<li>聚类获取码表：由于descriptor是K维向量(列固定)表示的，因此可以用descriptor的向量聚类出一个codebook，每个向量有一个index，</li>\n<li>图片重新表示：每张图片都由这个codebook中的向量表示，即用一组index表示。</li>\n<li>相似度计算： 两张图片的相似度就是两组index的相似度。</li>\n</ul>\n<h3 id=\"其他方法\"><a href=\"#其他方法\" class=\"headerlink\" title=\"其他方法\"></a>其他方法</h3><ul>\n<li>pHash（名片图片集上效果不理想）</li>\n<li>LIRE</li>\n</ul>\n<blockquote>\n<p>基于Lire的图像检索：<br>—— by mazf<br>1、代码：git@192.168.30.251:OraImageRetrival.git<br>2、代码说明：</p>\n<blockquote>\n<p>2.1 代码有两个部分，都是Java文件，有详细的注释：<br>—OraIndexer：用来构建索引<br>—OraSearcher：根据构建好的索引，进行图像检索</p>\n<blockquote>\n<p><strong>OraIndexer</strong> 是一个单线程程序，所以，构建索引比较慢，解决方法是加入多线程<br>要创建索引，需要一个文档构建对象LocalDocumentBuilder，并给该对象传入提取图像特征的方法，Lire提供了很多特征提取的方法，本程序采用的是快速sift方法CvSurfExtractor。有了LocalDocumentBuilder对象后，可以对图像创建一文档Document，并将该文档写入索引，代码如下：<br>&lt;/br&gt;<em>// 创建一个文档对象（Lucene的概念）<br>LocalDocumentBuilder localDocumentBuilder = new LocalDocumentBuilder();<br>// 给文档对象添加一个提取器，使用Surf的提取器，传入码表<br>localDocumentBuilder.addExtractor(CvSurfExtractor.class, Cluster.readClusters(codeBook));<br>// 读取图像文件，并用文档对象创建一个文档<br>BufferedImage img = ImageIO.read(new FileInputStream(imageFilePath));<br>Document doc = localDocumentBuilder.createDocument(img, imageFilePath);<br>// 将图像文档写入索引，iw是IndexWriter对象<br>iw.addDocument(doc);</em><br>&lt;/br&gt;<br><strong>OraSearch</strong> 是图像检索对象，检索速度在2s左右，很快。<br>检索和创建索引要匹配，都需要使用相同的特征提取方法，这里使用CvSurfExtractor特征提取<br>检索的过程需要三个主要的对象：索引读取对象，搜索对象，匹配对象<br>&lt;/br&gt;<em>// 创建 索引读取对象，搜索对象，匹配对象<br>// 同样，需要将CvSurfExtractor传给搜索对象，hits中保存的是匹配命中的图像文档对象<br>IndexReader reader = DirectoryReader.open(FSDirectory.open(Paths.get(indexPath)));<br>ImageSearcher searcher = new GenericFastImageSearcher(resCnt, CvSurfExtractor.class, new BOVW(),128, true, reader, codeBook);<br>ImageSearchHits hits = searcher.search(ImageIO.read(new File(imageName)), reader);</em>&lt;/br&gt;</p>\n</blockquote>\n<p>2.2 目录介绍<br>—CardImages：用于测试的名片图片<br>—CodeBook： CvSURF128码表，不需要修改<br>—ImageIndex： Lire生成的索引目录</p>\n</blockquote>\n<p>3、备注：<br>程序在Windows下编译，如果在Linux和Mac上，要重新编译Lire库<br>Lire源程序在 251 上我的目录下：Lire-1.0b2.zip<br>用idea打开，用 maven 编译就可以了</p>\n</blockquote>\n<h3 id=\"相关调研工作见：-192-168-30-251\"><a href=\"#相关调研工作见：-192-168-30-251\" class=\"headerlink\" title=\"相关调研工作见：(192.168.30.251)\"></a>相关调研工作见：(192.168.30.251)</h3><p>  /opt/workspace/imgSimilarity<br>  /opt/workspace/similarCards</p>\n</the>","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>pHash, BOV等图像特征抽取方法","more":"</excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n\n<p>代码库地址： git@192.168.30.251:similarCards.git</p>\n<h3 id=\"使用hash函数将图片转化为指纹\"><a href=\"#使用hash函数将图片转化为指纹\" class=\"headerlink\" title=\"使用hash函数将图片转化为指纹\"></a>使用hash函数将图片转化为指纹</h3><p>参照： <a href=\"https://github.com/paul-schwendenman/imagehash2\" target=\"_blank\" rel=\"noopener\">https://github.com/paul-schwendenman/imagehash2</a></p>\n<p>使用imagehash获取图片的fingerprint，建立指纹库，然后每次查找指纹的编辑距离最近的几个图片作为候选</p>\n<h3 id=\"使用BOVW算法\"><a href=\"#使用BOVW算法\" class=\"headerlink\" title=\"使用BOVW算法\"></a>使用BOVW算法</h3><p>参见代码：192.168.30.251:/opt/workspace/imgSimilarity/clustering/vocabulary.py</p>\n<p>思路：</p>\n<ul>\n<li>抽取descriptor：使用opencv模块获取图像的keypoints之后，抽取descriptor，</li>\n<li>聚类获取码表：由于descriptor是K维向量(列固定)表示的，因此可以用descriptor的向量聚类出一个codebook，每个向量有一个index，</li>\n<li>图片重新表示：每张图片都由这个codebook中的向量表示，即用一组index表示。</li>\n<li>相似度计算： 两张图片的相似度就是两组index的相似度。</li>\n</ul>\n<h3 id=\"其他方法\"><a href=\"#其他方法\" class=\"headerlink\" title=\"其他方法\"></a>其他方法</h3><ul>\n<li>pHash（名片图片集上效果不理想）</li>\n<li>LIRE</li>\n</ul>\n<blockquote>\n<p>基于Lire的图像检索：<br>—— by mazf<br>1、代码：git@192.168.30.251:OraImageRetrival.git<br>2、代码说明：</p>\n<blockquote>\n<p>2.1 代码有两个部分，都是Java文件，有详细的注释：<br>—OraIndexer：用来构建索引<br>—OraSearcher：根据构建好的索引，进行图像检索</p>\n<blockquote>\n<p><strong>OraIndexer</strong> 是一个单线程程序，所以，构建索引比较慢，解决方法是加入多线程<br>要创建索引，需要一个文档构建对象LocalDocumentBuilder，并给该对象传入提取图像特征的方法，Lire提供了很多特征提取的方法，本程序采用的是快速sift方法CvSurfExtractor。有了LocalDocumentBuilder对象后，可以对图像创建一文档Document，并将该文档写入索引，代码如下：<br>&lt;/br&gt;<em>// 创建一个文档对象（Lucene的概念）<br>LocalDocumentBuilder localDocumentBuilder = new LocalDocumentBuilder();<br>// 给文档对象添加一个提取器，使用Surf的提取器，传入码表<br>localDocumentBuilder.addExtractor(CvSurfExtractor.class, Cluster.readClusters(codeBook));<br>// 读取图像文件，并用文档对象创建一个文档<br>BufferedImage img = ImageIO.read(new FileInputStream(imageFilePath));<br>Document doc = localDocumentBuilder.createDocument(img, imageFilePath);<br>// 将图像文档写入索引，iw是IndexWriter对象<br>iw.addDocument(doc);</em><br>&lt;/br&gt;<br><strong>OraSearch</strong> 是图像检索对象，检索速度在2s左右，很快。<br>检索和创建索引要匹配，都需要使用相同的特征提取方法，这里使用CvSurfExtractor特征提取<br>检索的过程需要三个主要的对象：索引读取对象，搜索对象，匹配对象<br>&lt;/br&gt;<em>// 创建 索引读取对象，搜索对象，匹配对象<br>// 同样，需要将CvSurfExtractor传给搜索对象，hits中保存的是匹配命中的图像文档对象<br>IndexReader reader = DirectoryReader.open(FSDirectory.open(Paths.get(indexPath)));<br>ImageSearcher searcher = new GenericFastImageSearcher(resCnt, CvSurfExtractor.class, new BOVW(),128, true, reader, codeBook);<br>ImageSearchHits hits = searcher.search(ImageIO.read(new File(imageName)), reader);</em>&lt;/br&gt;</p>\n</blockquote>\n<p>2.2 目录介绍<br>—CardImages：用于测试的名片图片<br>—CodeBook： CvSURF128码表，不需要修改<br>—ImageIndex： Lire生成的索引目录</p>\n</blockquote>\n<p>3、备注：<br>程序在Windows下编译，如果在Linux和Mac上，要重新编译Lire库<br>Lire源程序在 251 上我的目录下：Lire-1.0b2.zip<br>用idea打开，用 maven 编译就可以了</p>\n</blockquote>\n<h3 id=\"相关调研工作见：-192-168-30-251\"><a href=\"#相关调研工作见：-192-168-30-251\" class=\"headerlink\" title=\"相关调研工作见：(192.168.30.251)\"></a>相关调研工作见：(192.168.30.251)</h3><p>  /opt/workspace/imgSimilarity<br>  /opt/workspace/similarCards</p>\n</the>"},{"title":"人脉信息更新","date":"2016-09-27T06:07:19.000Z","_content":"<Excerpt in index | 首页摘要>\n“对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。”<!-- more -->\n<The rest of contents | 余下全文>\n\n## 源码\n- 版本库地址：\n  - OFFICE:   `git@192.168.30.251:cardUpdateNotification.git`\n\n  - IDC: `git@172.17.4.151:cardUpdateNotification.git (云主机 /data/git/ 目录下)`\n\n- 部署位置:\n\n  `BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardUpdateNotification` (IP: `172.17.4.1`/`192.168.1.138`)\n\n\n## 背景\n  > 对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。并推荐持有人（未来）\n\n  > 判断规则：\n\n  > 1）5个以上其他用户也持有（名片 姓名、手机号一致）\n\n  > 2）其他用户持有名片主要信息一致（姓名、手机号、公司名称、职位），但与我持有名片信息不一致（公司名称、职位有至少一项不一致）\n\n  > 3）其他用户是在我对名片的最后修改时间后  获取或更新\n\n  > 提示时间：系统定期（一天）检测，发现有不一致信息后，在每天19点（可配置），为用户 推送该消息 （实现有问题全库轮询？？）\n\n详见黄小明邮件(2016年9月14日13时)\n\n## 数据源及说明\n\n- 获取名片信息\n    - 目标数据库: `172.17.4.3:3306/oradt_cloud`\n\n    - 数据表\n      - **contact_card**: 名片状态表（来源等）\n\n      - **contact_card_vcardinfo**: 名片具体信息表\n\n      - **account_basic**: 注册用户信息表\n\n  从以上数据表中获取所要操作的名片\n\n- 过滤规则\n\n    `cellphone`字段：从名片信息表中获取vCard格式的`TEL`字段，使用正则表达式抽取**第一个**CELL作为该名片的`cellphone`\n\n    - 过滤已注册用户：\n\n      - 从注册用户信息表中获取出已注册手机号集合\n\n      - 过滤掉`cellphone`在已注册手机号集合里的名片\n\n    - `cellphone`不能为空\n\n    如果`cellphone`为空，根据`fn`和`cellphone`进行分组，就退化成**仅用**`fn`进行分组，无法处理重名的名片。\n\n- 名片持有人\n> 5个以上其他用户也持有（名片 姓名、手机号一致）\n\n  这里5个*其他用户*用5个**（姓名，手机号）** 组对代替，而非5个不同的`user_id`。同一用户可能拥有不同**（姓名，手机号）** 组对。\n\n## 整体思路\n\n- 获取数据库表中的名片信息数据，并进行过滤（过滤规则：未注册，且`cellphone`不能为空）\n\n- 先使用`fn`和`cellphone`分组，得到一级分组Group_1L，每组中的名片都属于同一个人，但`org`, `title`可能不同\n\n- 过滤掉一级分组Group_1L中每组数量小于预设值（*`5`个以上其他在用户也持有*）的名片\n\n- 在一级分组Group_1L之上，对每组再使用`org`和`title`进行分组，得到二级分组Group_2L，每组中的名片都是一张特定的名片，`fn`, `cellphone`, `org`, `title`都一样\n\n- 过滤掉二级分组Group_2L中每组数量小于预设值（大于等于`2`，避免名片自身有误带来的影响）\n\n- 从二级分组Group_2L中选取名片最旧的一张（即最先被录入的那张名片），加入候选集\n\n- 从候选集中选出最新的一张（即该用户最新的一张名片），使用该张名片作为最后的目标名片\n\n- 对一级分组Group_1L中**该组**（`fn`和`cellphone`相同）未拥有该张名片（`org`**或**`title`不同）的所有用户提醒更新\n\n- 将提醒消息【`to_user`, `card_id`, `new_card_id`】插入数据库中\n\n## 运行概况\n\n  在BJIDC-Oradt-DMMySQL-1（IDC部署环境 ）上运行该脚本，以下是运行结果：\n\n  从数据库表中获取数据量：**2919117**，过滤后，一级分组输入数据量：**1855257**\n\n  > Total Messages: 128549\n  > python cardUpdateNotification.py  678.20s user 3.95s system 98% cpu 11:34.90 total\n\n  共产生**128549**条消息，用时**11分钟35秒**。\n\n  **注：** 一次产生的消息量`10w` 级，如果每天更新，插入数据库，请考虑可行性。\n\n  *建议： 对于消息通知结果表中，如果插入的数据相同【`to_user`, `card_id`, `new_card_id`】，则不再插入（联合主键可以确保插入相同的数据时，插入操作失败），加入一个`是否通知`列或`最后通知时间`列说明状态，但需根据业务情况考虑什么情况下更新这些状态列（每天一次？谁更新？）。*\n\n## 补充消息推送的格式\n####   ——by mazf\n- 消息json格式（参考黄小明的消息文档 push_message_list.xlsx）：\n{\"messagetype\":124,\"params\":\n{\n\"accountid\":\"所属人clientid\",\n\"imid\":\"11\",\n\"vcardid\":\"名片id\",\n\"picture\":\"名片缩略图\",\n\"contactname\": \"名片姓名\"\n}\n}\n- 数据库 message_queue 表：\n这个表中需要写入的数据有如下4个字段：\ntype, to_uid, content, created_time\n- Python 代码中 notice 函数，返回推送消息列表，循环调用 sendMsg 函数。\n\n\n插入数据接口已预留，但现在数据库还没有建表，具体写入位置还待确定；\n\n## 配置文件依照需求适当修改。\n配置文件示例：\n{\n  \"r\":{ # 读数据配置\n    \"host\": \"192.168.1.138\",\n    \"port\": 3306,\n    \"user\": \"dm_rw\",\n    \"password\": \"dmrw4142\",\n    \"db\": \"oradt_cloud\",\n    \"cardsQuery\": \"select t1.user_id, t1.uuid, FN, TEL, ORG, TITLE, last_modified, t1.picture from contact_card t1 left join contact_card_vcardinfo t2 on t1.uuid = t2.card_id where t1.status = 'active' and t1.self = 'false' limit 100000;\",\n    \"regUsersQuery\": \"select distinct mobile from account_basic;\"\n  },\n  \"w\":{ # 写数据配置\n    \"host\": \"localhost\",\n    \"port\": 3306,\n    \"user\": \"root\",\n    \"password\": \"mazf\",\n    \"db\": \"test\"\n  }\n}\n\n----\n","source":"_posts/cardUpdateNotification.md","raw":"---\ntitle: 人脉信息更新\ndate: 2016-09-27 14:07:19\ntags:\n    - 人脉信息更新\n    - 系统提示\n---\n<Excerpt in index | 首页摘要>\n“对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。”<!-- more -->\n<The rest of contents | 余下全文>\n\n## 源码\n- 版本库地址：\n  - OFFICE:   `git@192.168.30.251:cardUpdateNotification.git`\n\n  - IDC: `git@172.17.4.151:cardUpdateNotification.git (云主机 /data/git/ 目录下)`\n\n- 部署位置:\n\n  `BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardUpdateNotification` (IP: `172.17.4.1`/`192.168.1.138`)\n\n\n## 背景\n  > 对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。并推荐持有人（未来）\n\n  > 判断规则：\n\n  > 1）5个以上其他用户也持有（名片 姓名、手机号一致）\n\n  > 2）其他用户持有名片主要信息一致（姓名、手机号、公司名称、职位），但与我持有名片信息不一致（公司名称、职位有至少一项不一致）\n\n  > 3）其他用户是在我对名片的最后修改时间后  获取或更新\n\n  > 提示时间：系统定期（一天）检测，发现有不一致信息后，在每天19点（可配置），为用户 推送该消息 （实现有问题全库轮询？？）\n\n详见黄小明邮件(2016年9月14日13时)\n\n## 数据源及说明\n\n- 获取名片信息\n    - 目标数据库: `172.17.4.3:3306/oradt_cloud`\n\n    - 数据表\n      - **contact_card**: 名片状态表（来源等）\n\n      - **contact_card_vcardinfo**: 名片具体信息表\n\n      - **account_basic**: 注册用户信息表\n\n  从以上数据表中获取所要操作的名片\n\n- 过滤规则\n\n    `cellphone`字段：从名片信息表中获取vCard格式的`TEL`字段，使用正则表达式抽取**第一个**CELL作为该名片的`cellphone`\n\n    - 过滤已注册用户：\n\n      - 从注册用户信息表中获取出已注册手机号集合\n\n      - 过滤掉`cellphone`在已注册手机号集合里的名片\n\n    - `cellphone`不能为空\n\n    如果`cellphone`为空，根据`fn`和`cellphone`进行分组，就退化成**仅用**`fn`进行分组，无法处理重名的名片。\n\n- 名片持有人\n> 5个以上其他用户也持有（名片 姓名、手机号一致）\n\n  这里5个*其他用户*用5个**（姓名，手机号）** 组对代替，而非5个不同的`user_id`。同一用户可能拥有不同**（姓名，手机号）** 组对。\n\n## 整体思路\n\n- 获取数据库表中的名片信息数据，并进行过滤（过滤规则：未注册，且`cellphone`不能为空）\n\n- 先使用`fn`和`cellphone`分组，得到一级分组Group_1L，每组中的名片都属于同一个人，但`org`, `title`可能不同\n\n- 过滤掉一级分组Group_1L中每组数量小于预设值（*`5`个以上其他在用户也持有*）的名片\n\n- 在一级分组Group_1L之上，对每组再使用`org`和`title`进行分组，得到二级分组Group_2L，每组中的名片都是一张特定的名片，`fn`, `cellphone`, `org`, `title`都一样\n\n- 过滤掉二级分组Group_2L中每组数量小于预设值（大于等于`2`，避免名片自身有误带来的影响）\n\n- 从二级分组Group_2L中选取名片最旧的一张（即最先被录入的那张名片），加入候选集\n\n- 从候选集中选出最新的一张（即该用户最新的一张名片），使用该张名片作为最后的目标名片\n\n- 对一级分组Group_1L中**该组**（`fn`和`cellphone`相同）未拥有该张名片（`org`**或**`title`不同）的所有用户提醒更新\n\n- 将提醒消息【`to_user`, `card_id`, `new_card_id`】插入数据库中\n\n## 运行概况\n\n  在BJIDC-Oradt-DMMySQL-1（IDC部署环境 ）上运行该脚本，以下是运行结果：\n\n  从数据库表中获取数据量：**2919117**，过滤后，一级分组输入数据量：**1855257**\n\n  > Total Messages: 128549\n  > python cardUpdateNotification.py  678.20s user 3.95s system 98% cpu 11:34.90 total\n\n  共产生**128549**条消息，用时**11分钟35秒**。\n\n  **注：** 一次产生的消息量`10w` 级，如果每天更新，插入数据库，请考虑可行性。\n\n  *建议： 对于消息通知结果表中，如果插入的数据相同【`to_user`, `card_id`, `new_card_id`】，则不再插入（联合主键可以确保插入相同的数据时，插入操作失败），加入一个`是否通知`列或`最后通知时间`列说明状态，但需根据业务情况考虑什么情况下更新这些状态列（每天一次？谁更新？）。*\n\n## 补充消息推送的格式\n####   ——by mazf\n- 消息json格式（参考黄小明的消息文档 push_message_list.xlsx）：\n{\"messagetype\":124,\"params\":\n{\n\"accountid\":\"所属人clientid\",\n\"imid\":\"11\",\n\"vcardid\":\"名片id\",\n\"picture\":\"名片缩略图\",\n\"contactname\": \"名片姓名\"\n}\n}\n- 数据库 message_queue 表：\n这个表中需要写入的数据有如下4个字段：\ntype, to_uid, content, created_time\n- Python 代码中 notice 函数，返回推送消息列表，循环调用 sendMsg 函数。\n\n\n插入数据接口已预留，但现在数据库还没有建表，具体写入位置还待确定；\n\n## 配置文件依照需求适当修改。\n配置文件示例：\n{\n  \"r\":{ # 读数据配置\n    \"host\": \"192.168.1.138\",\n    \"port\": 3306,\n    \"user\": \"dm_rw\",\n    \"password\": \"dmrw4142\",\n    \"db\": \"oradt_cloud\",\n    \"cardsQuery\": \"select t1.user_id, t1.uuid, FN, TEL, ORG, TITLE, last_modified, t1.picture from contact_card t1 left join contact_card_vcardinfo t2 on t1.uuid = t2.card_id where t1.status = 'active' and t1.self = 'false' limit 100000;\",\n    \"regUsersQuery\": \"select distinct mobile from account_basic;\"\n  },\n  \"w\":{ # 写数据配置\n    \"host\": \"localhost\",\n    \"port\": 3306,\n    \"user\": \"root\",\n    \"password\": \"mazf\",\n    \"db\": \"test\"\n  }\n}\n\n----\n","slug":"cardUpdateNotification","published":1,"updated":"2018-07-13T11:06:08.767Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognah000l3a9dqsvxmr9s","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>“对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。”<a id=\"more\"></a></excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<h2 id=\"源码\"><a href=\"#源码\" class=\"headerlink\" title=\"源码\"></a>源码</h2><ul>\n<li><p>版本库地址：</p>\n<ul>\n<li><p>OFFICE:   <code>git@192.168.30.251:cardUpdateNotification.git</code></p>\n</li>\n<li><p>IDC: <code>git@172.17.4.151:cardUpdateNotification.git (云主机 /data/git/ 目录下)</code></p>\n</li>\n</ul>\n</li>\n<li><p>部署位置:</p>\n<p><code>BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardUpdateNotification</code> (IP: <code>172.17.4.1</code>/<code>192.168.1.138</code>)</p>\n</li>\n</ul>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><blockquote>\n<p>对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。并推荐持有人（未来）</p>\n<p>判断规则：</p>\n<p>1）5个以上其他用户也持有（名片 姓名、手机号一致）</p>\n<p>2）其他用户持有名片主要信息一致（姓名、手机号、公司名称、职位），但与我持有名片信息不一致（公司名称、职位有至少一项不一致）</p>\n<p>3）其他用户是在我对名片的最后修改时间后  获取或更新</p>\n<p>提示时间：系统定期（一天）检测，发现有不一致信息后，在每天19点（可配置），为用户 推送该消息 （实现有问题全库轮询？？）</p>\n</blockquote>\n<p>详见黄小明邮件(2016年9月14日13时)</p>\n<h2 id=\"数据源及说明\"><a href=\"#数据源及说明\" class=\"headerlink\" title=\"数据源及说明\"></a>数据源及说明</h2><ul>\n<li><p>获取名片信息</p>\n<ul>\n<li><p>目标数据库: <code>172.17.4.3:3306/oradt_cloud</code></p>\n</li>\n<li><p>数据表</p>\n<ul>\n<li><p><strong>contact_card</strong>: 名片状态表（来源等）</p>\n</li>\n<li><p><strong>contact_card_vcardinfo</strong>: 名片具体信息表</p>\n</li>\n<li><p><strong>account_basic</strong>: 注册用户信息表</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>从以上数据表中获取所要操作的名片</p>\n</li>\n<li><p>过滤规则</p>\n<p>  <code>cellphone</code>字段：从名片信息表中获取vCard格式的<code>TEL</code>字段，使用正则表达式抽取<strong>第一个</strong>CELL作为该名片的<code>cellphone</code></p>\n<ul>\n<li><p>过滤已注册用户：</p>\n<ul>\n<li><p>从注册用户信息表中获取出已注册手机号集合</p>\n</li>\n<li><p>过滤掉<code>cellphone</code>在已注册手机号集合里的名片</p>\n</li>\n</ul>\n</li>\n<li><p><code>cellphone</code>不能为空</p>\n<p>如果<code>cellphone</code>为空，根据<code>fn</code>和<code>cellphone</code>进行分组，就退化成<strong>仅用</strong><code>fn</code>进行分组，无法处理重名的名片。</p>\n</li>\n</ul>\n</li>\n<li><p>名片持有人</p>\n<blockquote>\n<p>5个以上其他用户也持有（名片 姓名、手机号一致）</p>\n</blockquote>\n<p>这里5个<em>其他用户</em>用5个<strong>（姓名，手机号）</strong> 组对代替，而非5个不同的<code>user_id</code>。同一用户可能拥有不同<strong>（姓名，手机号）</strong> 组对。</p>\n</li>\n</ul>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><ul>\n<li><p>获取数据库表中的名片信息数据，并进行过滤（过滤规则：未注册，且<code>cellphone</code>不能为空）</p>\n</li>\n<li><p>先使用<code>fn</code>和<code>cellphone</code>分组，得到一级分组Group_1L，每组中的名片都属于同一个人，但<code>org</code>, <code>title</code>可能不同</p>\n</li>\n<li><p>过滤掉一级分组Group_1L中每组数量小于预设值（<em><code>5</code>个以上其他在用户也持有</em>）的名片</p>\n</li>\n<li><p>在一级分组Group_1L之上，对每组再使用<code>org</code>和<code>title</code>进行分组，得到二级分组Group_2L，每组中的名片都是一张特定的名片，<code>fn</code>, <code>cellphone</code>, <code>org</code>, <code>title</code>都一样</p>\n</li>\n<li><p>过滤掉二级分组Group_2L中每组数量小于预设值（大于等于<code>2</code>，避免名片自身有误带来的影响）</p>\n</li>\n<li><p>从二级分组Group_2L中选取名片最旧的一张（即最先被录入的那张名片），加入候选集</p>\n</li>\n<li><p>从候选集中选出最新的一张（即该用户最新的一张名片），使用该张名片作为最后的目标名片</p>\n</li>\n<li><p>对一级分组Group_1L中<strong>该组</strong>（<code>fn</code>和<code>cellphone</code>相同）未拥有该张名片（<code>org</code><strong>或</strong><code>title</code>不同）的所有用户提醒更新</p>\n</li>\n<li><p>将提醒消息【<code>to_user</code>, <code>card_id</code>, <code>new_card_id</code>】插入数据库中</p>\n</li>\n</ul>\n<h2 id=\"运行概况\"><a href=\"#运行概况\" class=\"headerlink\" title=\"运行概况\"></a>运行概况</h2><p>  在BJIDC-Oradt-DMMySQL-1（IDC部署环境 ）上运行该脚本，以下是运行结果：</p>\n<p>  从数据库表中获取数据量：<strong>2919117</strong>，过滤后，一级分组输入数据量：<strong>1855257</strong></p>\n<blockquote>\n<p>Total Messages: 128549<br>python cardUpdateNotification.py  678.20s user 3.95s system 98% cpu 11:34.90 total</p>\n</blockquote>\n<p>  共产生<strong>128549</strong>条消息，用时<strong>11分钟35秒</strong>。</p>\n<p>  <strong>注：</strong> 一次产生的消息量<code>10w</code> 级，如果每天更新，插入数据库，请考虑可行性。</p>\n<p>  <em>建议： 对于消息通知结果表中，如果插入的数据相同【<code>to_user</code>, <code>card_id</code>, <code>new_card_id</code>】，则不再插入（联合主键可以确保插入相同的数据时，插入操作失败），加入一个<code>是否通知</code>列或<code>最后通知时间</code>列说明状态，但需根据业务情况考虑什么情况下更新这些状态列（每天一次？谁更新？）。</em></p>\n<h2 id=\"补充消息推送的格式\"><a href=\"#补充消息推送的格式\" class=\"headerlink\" title=\"补充消息推送的格式\"></a>补充消息推送的格式</h2><h4 id=\"——by-mazf\"><a href=\"#——by-mazf\" class=\"headerlink\" title=\"——by mazf\"></a>——by mazf</h4><ul>\n<li>消息json格式（参考黄小明的消息文档 push_message_list.xlsx）：<br>{“messagetype”:124,”params”:<br>{<br>“accountid”:”所属人clientid”,<br>“imid”:”11”,<br>“vcardid”:”名片id”,<br>“picture”:”名片缩略图”,<br>“contactname”: “名片姓名”<br>}<br>}</li>\n<li>数据库 message_queue 表：<br>这个表中需要写入的数据有如下4个字段：<br>type, to_uid, content, created_time</li>\n<li>Python 代码中 notice 函数，返回推送消息列表，循环调用 sendMsg 函数。</li>\n</ul>\n<p>插入数据接口已预留，但现在数据库还没有建表，具体写入位置还待确定；</p>\n<h2 id=\"配置文件依照需求适当修改。\"><a href=\"#配置文件依照需求适当修改。\" class=\"headerlink\" title=\"配置文件依照需求适当修改。\"></a>配置文件依照需求适当修改。</h2><p>配置文件示例：<br>{<br>  “r”:{ # 读数据配置<br>    “host”: “192.168.1.138”,<br>    “port”: 3306,<br>    “user”: “dm_rw”,<br>    “password”: “dmrw4142”,<br>    “db”: “oradt_cloud”,<br>    “cardsQuery”: “select t1.user_id, t1.uuid, FN, TEL, ORG, TITLE, last_modified, t1.picture from contact_card t1 left join contact_card_vcardinfo t2 on t1.uuid = t2.card_id where t1.status = ‘active’ and t1.self = ‘false’ limit 100000;”,<br>    “regUsersQuery”: “select distinct mobile from account_basic;”<br>  },<br>  “w”:{ # 写数据配置<br>    “host”: “localhost”,<br>    “port”: 3306,<br>    “user”: “root”,<br>    “password”: “mazf”,<br>    “db”: “test”<br>  }<br>}</p>\n<hr>\n</the>","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>“对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。”","more":"</excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<h2 id=\"源码\"><a href=\"#源码\" class=\"headerlink\" title=\"源码\"></a>源码</h2><ul>\n<li><p>版本库地址：</p>\n<ul>\n<li><p>OFFICE:   <code>git@192.168.30.251:cardUpdateNotification.git</code></p>\n</li>\n<li><p>IDC: <code>git@172.17.4.151:cardUpdateNotification.git (云主机 /data/git/ 目录下)</code></p>\n</li>\n</ul>\n</li>\n<li><p>部署位置:</p>\n<p><code>BJIDC-Oradt-DMMySQL-1:/opt/workspace/cardUpdateNotification</code> (IP: <code>172.17.4.1</code>/<code>192.168.1.138</code>)</p>\n</li>\n</ul>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><blockquote>\n<p>对于当前用户持有的非注册用户的名片，系统根据一定规则检测有新的数据更新时提示用户。并推荐持有人（未来）</p>\n<p>判断规则：</p>\n<p>1）5个以上其他用户也持有（名片 姓名、手机号一致）</p>\n<p>2）其他用户持有名片主要信息一致（姓名、手机号、公司名称、职位），但与我持有名片信息不一致（公司名称、职位有至少一项不一致）</p>\n<p>3）其他用户是在我对名片的最后修改时间后  获取或更新</p>\n<p>提示时间：系统定期（一天）检测，发现有不一致信息后，在每天19点（可配置），为用户 推送该消息 （实现有问题全库轮询？？）</p>\n</blockquote>\n<p>详见黄小明邮件(2016年9月14日13时)</p>\n<h2 id=\"数据源及说明\"><a href=\"#数据源及说明\" class=\"headerlink\" title=\"数据源及说明\"></a>数据源及说明</h2><ul>\n<li><p>获取名片信息</p>\n<ul>\n<li><p>目标数据库: <code>172.17.4.3:3306/oradt_cloud</code></p>\n</li>\n<li><p>数据表</p>\n<ul>\n<li><p><strong>contact_card</strong>: 名片状态表（来源等）</p>\n</li>\n<li><p><strong>contact_card_vcardinfo</strong>: 名片具体信息表</p>\n</li>\n<li><p><strong>account_basic</strong>: 注册用户信息表</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>从以上数据表中获取所要操作的名片</p>\n</li>\n<li><p>过滤规则</p>\n<p>  <code>cellphone</code>字段：从名片信息表中获取vCard格式的<code>TEL</code>字段，使用正则表达式抽取<strong>第一个</strong>CELL作为该名片的<code>cellphone</code></p>\n<ul>\n<li><p>过滤已注册用户：</p>\n<ul>\n<li><p>从注册用户信息表中获取出已注册手机号集合</p>\n</li>\n<li><p>过滤掉<code>cellphone</code>在已注册手机号集合里的名片</p>\n</li>\n</ul>\n</li>\n<li><p><code>cellphone</code>不能为空</p>\n<p>如果<code>cellphone</code>为空，根据<code>fn</code>和<code>cellphone</code>进行分组，就退化成<strong>仅用</strong><code>fn</code>进行分组，无法处理重名的名片。</p>\n</li>\n</ul>\n</li>\n<li><p>名片持有人</p>\n<blockquote>\n<p>5个以上其他用户也持有（名片 姓名、手机号一致）</p>\n</blockquote>\n<p>这里5个<em>其他用户</em>用5个<strong>（姓名，手机号）</strong> 组对代替，而非5个不同的<code>user_id</code>。同一用户可能拥有不同<strong>（姓名，手机号）</strong> 组对。</p>\n</li>\n</ul>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><ul>\n<li><p>获取数据库表中的名片信息数据，并进行过滤（过滤规则：未注册，且<code>cellphone</code>不能为空）</p>\n</li>\n<li><p>先使用<code>fn</code>和<code>cellphone</code>分组，得到一级分组Group_1L，每组中的名片都属于同一个人，但<code>org</code>, <code>title</code>可能不同</p>\n</li>\n<li><p>过滤掉一级分组Group_1L中每组数量小于预设值（<em><code>5</code>个以上其他在用户也持有</em>）的名片</p>\n</li>\n<li><p>在一级分组Group_1L之上，对每组再使用<code>org</code>和<code>title</code>进行分组，得到二级分组Group_2L，每组中的名片都是一张特定的名片，<code>fn</code>, <code>cellphone</code>, <code>org</code>, <code>title</code>都一样</p>\n</li>\n<li><p>过滤掉二级分组Group_2L中每组数量小于预设值（大于等于<code>2</code>，避免名片自身有误带来的影响）</p>\n</li>\n<li><p>从二级分组Group_2L中选取名片最旧的一张（即最先被录入的那张名片），加入候选集</p>\n</li>\n<li><p>从候选集中选出最新的一张（即该用户最新的一张名片），使用该张名片作为最后的目标名片</p>\n</li>\n<li><p>对一级分组Group_1L中<strong>该组</strong>（<code>fn</code>和<code>cellphone</code>相同）未拥有该张名片（<code>org</code><strong>或</strong><code>title</code>不同）的所有用户提醒更新</p>\n</li>\n<li><p>将提醒消息【<code>to_user</code>, <code>card_id</code>, <code>new_card_id</code>】插入数据库中</p>\n</li>\n</ul>\n<h2 id=\"运行概况\"><a href=\"#运行概况\" class=\"headerlink\" title=\"运行概况\"></a>运行概况</h2><p>  在BJIDC-Oradt-DMMySQL-1（IDC部署环境 ）上运行该脚本，以下是运行结果：</p>\n<p>  从数据库表中获取数据量：<strong>2919117</strong>，过滤后，一级分组输入数据量：<strong>1855257</strong></p>\n<blockquote>\n<p>Total Messages: 128549<br>python cardUpdateNotification.py  678.20s user 3.95s system 98% cpu 11:34.90 total</p>\n</blockquote>\n<p>  共产生<strong>128549</strong>条消息，用时<strong>11分钟35秒</strong>。</p>\n<p>  <strong>注：</strong> 一次产生的消息量<code>10w</code> 级，如果每天更新，插入数据库，请考虑可行性。</p>\n<p>  <em>建议： 对于消息通知结果表中，如果插入的数据相同【<code>to_user</code>, <code>card_id</code>, <code>new_card_id</code>】，则不再插入（联合主键可以确保插入相同的数据时，插入操作失败），加入一个<code>是否通知</code>列或<code>最后通知时间</code>列说明状态，但需根据业务情况考虑什么情况下更新这些状态列（每天一次？谁更新？）。</em></p>\n<h2 id=\"补充消息推送的格式\"><a href=\"#补充消息推送的格式\" class=\"headerlink\" title=\"补充消息推送的格式\"></a>补充消息推送的格式</h2><h4 id=\"——by-mazf\"><a href=\"#——by-mazf\" class=\"headerlink\" title=\"——by mazf\"></a>——by mazf</h4><ul>\n<li>消息json格式（参考黄小明的消息文档 push_message_list.xlsx）：<br>{“messagetype”:124,”params”:<br>{<br>“accountid”:”所属人clientid”,<br>“imid”:”11”,<br>“vcardid”:”名片id”,<br>“picture”:”名片缩略图”,<br>“contactname”: “名片姓名”<br>}<br>}</li>\n<li>数据库 message_queue 表：<br>这个表中需要写入的数据有如下4个字段：<br>type, to_uid, content, created_time</li>\n<li>Python 代码中 notice 函数，返回推送消息列表，循环调用 sendMsg 函数。</li>\n</ul>\n<p>插入数据接口已预留，但现在数据库还没有建表，具体写入位置还待确定；</p>\n<h2 id=\"配置文件依照需求适当修改。\"><a href=\"#配置文件依照需求适当修改。\" class=\"headerlink\" title=\"配置文件依照需求适当修改。\"></a>配置文件依照需求适当修改。</h2><p>配置文件示例：<br>{<br>  “r”:{ # 读数据配置<br>    “host”: “192.168.1.138”,<br>    “port”: 3306,<br>    “user”: “dm_rw”,<br>    “password”: “dmrw4142”,<br>    “db”: “oradt_cloud”,<br>    “cardsQuery”: “select t1.user_id, t1.uuid, FN, TEL, ORG, TITLE, last_modified, t1.picture from contact_card t1 left join contact_card_vcardinfo t2 on t1.uuid = t2.card_id where t1.status = ‘active’ and t1.self = ‘false’ limit 100000;”,<br>    “regUsersQuery”: “select distinct mobile from account_basic;”<br>  },<br>  “w”:{ # 写数据配置<br>    “host”: “localhost”,<br>    “port”: 3306,<br>    “user”: “root”,<br>    “password”: “mazf”,<br>    “db”: “test”<br>  }<br>}</p>\n<hr>\n</the>"},{"title":"企业名称的行业分类","date":"2016-09-26T07:58:00.000Z","_content":"<Excerpt in index | 首页摘要>\n根据公司名称进行行业分类标注 <!-- more -->\n<The rest of contents | 余下全文>\n\n原项目代码库地址为：git@192.168.30.251:tagIndustryForCompany.git\n\n更新：行业分类标准变动，重新抓取训练数据，并更新分类模型\n\n\n## 数据抓取\n  - 来源：天眼查（http://www.tianyancha.com/）\n  - 爬虫代码：192.168.30.251:/opt/workspace/tianyancha/crawler.py\n  - 数据：192.168.30.251:/opt/workspace/tianyancha/save (备份的天眼查网页文件，未抽取)\n\n\n## 清洗数据\n\n  - 192.168.30.251:/opt/workspace/tianyancha/companys.json\n\n    抽取天眼查页面之后的数据\n\n  - 192.168.30.251:/opt/workspace/tianyancha/misc_TianyanZhiLianCompany.json\n\n    每个公司对应的标签列表\n\n  - 192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json\n\n    与智联数据合并的数据（智联的分类与天眼查的分类对应的，即将智联的数据合并到天眼查的数据中）\n    每一行仅有一个公司名称对应一个分类，存在多行是一个公司的情况（一个公司有多个标签）\n\n  - 192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json_miss2101\n\n    不含有`2101`类别【软件和信息技术服务业】的数据\n\n\n## 训练模型\n  - 详见代码：192.168.30.251:/opt/workspace/tianyancha/industryTagger.py\n\n","source":"_posts/industryTagger.md","raw":"---\ntitle: 企业名称的行业分类\ndate: 2016-09-26 15:58:00\ntags:\n    - classification\n    - 行业分类\n    - 公司名称\n---\n<Excerpt in index | 首页摘要>\n根据公司名称进行行业分类标注 <!-- more -->\n<The rest of contents | 余下全文>\n\n原项目代码库地址为：git@192.168.30.251:tagIndustryForCompany.git\n\n更新：行业分类标准变动，重新抓取训练数据，并更新分类模型\n\n\n## 数据抓取\n  - 来源：天眼查（http://www.tianyancha.com/）\n  - 爬虫代码：192.168.30.251:/opt/workspace/tianyancha/crawler.py\n  - 数据：192.168.30.251:/opt/workspace/tianyancha/save (备份的天眼查网页文件，未抽取)\n\n\n## 清洗数据\n\n  - 192.168.30.251:/opt/workspace/tianyancha/companys.json\n\n    抽取天眼查页面之后的数据\n\n  - 192.168.30.251:/opt/workspace/tianyancha/misc_TianyanZhiLianCompany.json\n\n    每个公司对应的标签列表\n\n  - 192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json\n\n    与智联数据合并的数据（智联的分类与天眼查的分类对应的，即将智联的数据合并到天眼查的数据中）\n    每一行仅有一个公司名称对应一个分类，存在多行是一个公司的情况（一个公司有多个标签）\n\n  - 192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json_miss2101\n\n    不含有`2101`类别【软件和信息技术服务业】的数据\n\n\n## 训练模型\n  - 详见代码：192.168.30.251:/opt/workspace/tianyancha/industryTagger.py\n\n","slug":"industryTagger","published":1,"updated":"2018-07-13T11:06:08.775Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognaj000n3a9davaoe5eh","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>根据公司名称进行行业分类标注 <a id=\"more\"></a></excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<p>原项目代码库地址为：git@192.168.30.251:tagIndustryForCompany.git</p>\n<p>更新：行业分类标准变动，重新抓取训练数据，并更新分类模型</p>\n<h2 id=\"数据抓取\"><a href=\"#数据抓取\" class=\"headerlink\" title=\"数据抓取\"></a>数据抓取</h2><ul>\n<li>来源：天眼查（<a href=\"http://www.tianyancha.com/）\" target=\"_blank\" rel=\"noopener\">http://www.tianyancha.com/）</a></li>\n<li>爬虫代码：192.168.30.251:/opt/workspace/tianyancha/crawler.py</li>\n<li>数据：192.168.30.251:/opt/workspace/tianyancha/save (备份的天眼查网页文件，未抽取)</li>\n</ul>\n<h2 id=\"清洗数据\"><a href=\"#清洗数据\" class=\"headerlink\" title=\"清洗数据\"></a>清洗数据</h2><ul>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/companys.json</p>\n<p>抽取天眼查页面之后的数据</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/misc_TianyanZhiLianCompany.json</p>\n<p>每个公司对应的标签列表</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json</p>\n<p>与智联数据合并的数据（智联的分类与天眼查的分类对应的，即将智联的数据合并到天眼查的数据中）<br>每一行仅有一个公司名称对应一个分类，存在多行是一个公司的情况（一个公司有多个标签）</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json_miss2101</p>\n<p>不含有<code>2101</code>类别【软件和信息技术服务业】的数据</p>\n</li>\n</ul>\n<h2 id=\"训练模型\"><a href=\"#训练模型\" class=\"headerlink\" title=\"训练模型\"></a>训练模型</h2><ul>\n<li>详见代码：192.168.30.251:/opt/workspace/tianyancha/industryTagger.py</li>\n</ul>\n</the>","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>根据公司名称进行行业分类标注","more":"</excerpt></p>\n<the rest=\"\" of=\"\" contents=\"\" |=\"\" 余下全文=\"\">\n\n<p>原项目代码库地址为：git@192.168.30.251:tagIndustryForCompany.git</p>\n<p>更新：行业分类标准变动，重新抓取训练数据，并更新分类模型</p>\n<h2 id=\"数据抓取\"><a href=\"#数据抓取\" class=\"headerlink\" title=\"数据抓取\"></a>数据抓取</h2><ul>\n<li>来源：天眼查（<a href=\"http://www.tianyancha.com/）\" target=\"_blank\" rel=\"noopener\">http://www.tianyancha.com/）</a></li>\n<li>爬虫代码：192.168.30.251:/opt/workspace/tianyancha/crawler.py</li>\n<li>数据：192.168.30.251:/opt/workspace/tianyancha/save (备份的天眼查网页文件，未抽取)</li>\n</ul>\n<h2 id=\"清洗数据\"><a href=\"#清洗数据\" class=\"headerlink\" title=\"清洗数据\"></a>清洗数据</h2><ul>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/companys.json</p>\n<p>抽取天眼查页面之后的数据</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/misc_TianyanZhiLianCompany.json</p>\n<p>每个公司对应的标签列表</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json</p>\n<p>与智联数据合并的数据（智联的分类与天眼查的分类对应的，即将智联的数据合并到天眼查的数据中）<br>每一行仅有一个公司名称对应一个分类，存在多行是一个公司的情况（一个公司有多个标签）</p>\n</li>\n<li><p>192.168.30.251:/opt/workspace/tianyancha/miscFlatten_TianyanZhiLianCompany.json_miss2101</p>\n<p>不含有<code>2101</code>类别【软件和信息技术服务业】的数据</p>\n</li>\n</ul>\n<h2 id=\"训练模型\"><a href=\"#训练模型\" class=\"headerlink\" title=\"训练模型\"></a>训练模型</h2><ul>\n<li>详见代码：192.168.30.251:/opt/workspace/tianyancha/industryTagger.py</li>\n</ul>\n</the>"},{"title":"Jaro–Winkler算法原理和应用","date":"2018-07-16T08:21:51.000Z","mathjax":true,"_content":"### 算法简介\nThe Jaro–Winkler distance (Winkler, 1990)是计算2个字符串之间相似度的一种算法。它是Jaro distance算法的变种。主要用于record linkage/数据连接（duplicate detection/重复记录）方面的领域，Jaro–Winkler distance最后得分越高说明相似度越大。Jaro–Winkler distance 是适合于串比如名字这样较短的字符之间计算相似度。0分表示没有任何相似度，1分则代表完全匹配。\n\n### 算法定义\n1. The Jaro distance算法最后得分公式：\n$$ d_j = \\frac{1}{3}\\left(\\frac{m}{|s1|} + \\frac{m}{|s2|} + \\frac{m-t}{m} \\right) $$\n其中:   \n- s1、s2 是要比对的两个字符\n- $d_j$是最后得分\n- m是匹配的字符数\n- t  是换位的数目\n\n2. Match Window(匹配窗口)计算公式\n$$MW=\\left(\\frac{MAX(|s1|,|s2|)}{2}\\right) - 1$$\n其中：\n- s1、s2 是要比对的两个字符\n- MW是匹配窗口值\n\n3. 上述公式解释\n- 字符串s1与字符串s2在做匹配计算时，当两个字符的距离不大于公式二的最后结果(匹配窗口)即认为是匹配的。\n- 当s1、s2中字符相匹配但是字符位置不一样时发生换位操作、而公式一中换位的数目t为不同顺序的匹配字符的数目的一半。比如:两个字符串CRATE和TRACE做匹配操作，字符串中仅有'R' 'A' 'E'三个字符是匹配的，即m=3。为什么'C', 'T'不算做是匹配的呢。因为虽然'C', 'T'都出现在两个字符串中，但是通过公式二得出匹配窗口值为 (5/2)-1=1.5。而两个字符串中'C', 'T'字符的距离均大于1.5。所以不算做匹配。因此t=0。在另一组字符串DwAyNE 与 DuANE 。匹配的字符D-A-N-E 在两个字符串中有相同的字符顺序，所以不需要进行换位操作，因此t=0,m=4。\n\n4. Jaro–Winkler distance算法公式\nJaro-Winkler算法给予了起始部分就相同的字符串更高的分数，它定义了一个前缀范围p，对于要匹配的两个字符串，如果前缀部分有长度为L的部分字符串相同，则Jaro-Winkler Distance为:\n$$d_w = d_j + L * P(1 - d_J)$$\n其中:   \n- $d_j$是Jaro distance最后得分\n- L是前缀部分匹配的长度\n- P是一个范围因子常量，用来调整前缀匹配的权值，但是P的值不能超过0.25，因为这样最后得分可能超过1分.Winkler的标准默认设置值P=0.1。\n\n### 例子\n给出两个字符串 s1 MARTHA 和 s2 MARHTA、我们可以得出：\n- m = 6\n- |s1| = 6\n- |s2| = 6\n- 两组字符T/H和H/T要进行换位操作，因此t=2/2=1; \n我们可以根据公式一得出Jaro得分：\n$$d_j = \\frac{1}{3}\\left(\\frac{6}{|6|} + \\frac{6}{|6|} + \\frac{6-1}{6}\\right)$$\n如果使用Jaro–Winkler，并且取范围因子P=0.1,我们会得出:\nP=0.1\nL=3\n$d_w = 0.944 + (3 * 0.1(1 - 0.944))=0.961$\n\n### python 运行\n1. 安装lib\n```\npip install jaro_winkler\n```\n2. 程序运行\n```\nprint(jaro.jaro_metric(\"MARTHA\".decode(\"utf-8\"),\"MARHTA\".decode(\"utf-8\")))\n```\n\n### 优化\n\n1. 多进程\n2. pandas\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/jaro-winkler算法原理和应用.md","raw":"---\ntitle: Jaro–Winkler算法原理和应用\ndate: 2018-07-16 16:21:51\ntags:\n    - Jaro–Winkler\n    - blog\n    - NexT\ncategories: 算法\nmathjax: true\n---\n### 算法简介\nThe Jaro–Winkler distance (Winkler, 1990)是计算2个字符串之间相似度的一种算法。它是Jaro distance算法的变种。主要用于record linkage/数据连接（duplicate detection/重复记录）方面的领域，Jaro–Winkler distance最后得分越高说明相似度越大。Jaro–Winkler distance 是适合于串比如名字这样较短的字符之间计算相似度。0分表示没有任何相似度，1分则代表完全匹配。\n\n### 算法定义\n1. The Jaro distance算法最后得分公式：\n$$ d_j = \\frac{1}{3}\\left(\\frac{m}{|s1|} + \\frac{m}{|s2|} + \\frac{m-t}{m} \\right) $$\n其中:   \n- s1、s2 是要比对的两个字符\n- $d_j$是最后得分\n- m是匹配的字符数\n- t  是换位的数目\n\n2. Match Window(匹配窗口)计算公式\n$$MW=\\left(\\frac{MAX(|s1|,|s2|)}{2}\\right) - 1$$\n其中：\n- s1、s2 是要比对的两个字符\n- MW是匹配窗口值\n\n3. 上述公式解释\n- 字符串s1与字符串s2在做匹配计算时，当两个字符的距离不大于公式二的最后结果(匹配窗口)即认为是匹配的。\n- 当s1、s2中字符相匹配但是字符位置不一样时发生换位操作、而公式一中换位的数目t为不同顺序的匹配字符的数目的一半。比如:两个字符串CRATE和TRACE做匹配操作，字符串中仅有'R' 'A' 'E'三个字符是匹配的，即m=3。为什么'C', 'T'不算做是匹配的呢。因为虽然'C', 'T'都出现在两个字符串中，但是通过公式二得出匹配窗口值为 (5/2)-1=1.5。而两个字符串中'C', 'T'字符的距离均大于1.5。所以不算做匹配。因此t=0。在另一组字符串DwAyNE 与 DuANE 。匹配的字符D-A-N-E 在两个字符串中有相同的字符顺序，所以不需要进行换位操作，因此t=0,m=4。\n\n4. Jaro–Winkler distance算法公式\nJaro-Winkler算法给予了起始部分就相同的字符串更高的分数，它定义了一个前缀范围p，对于要匹配的两个字符串，如果前缀部分有长度为L的部分字符串相同，则Jaro-Winkler Distance为:\n$$d_w = d_j + L * P(1 - d_J)$$\n其中:   \n- $d_j$是Jaro distance最后得分\n- L是前缀部分匹配的长度\n- P是一个范围因子常量，用来调整前缀匹配的权值，但是P的值不能超过0.25，因为这样最后得分可能超过1分.Winkler的标准默认设置值P=0.1。\n\n### 例子\n给出两个字符串 s1 MARTHA 和 s2 MARHTA、我们可以得出：\n- m = 6\n- |s1| = 6\n- |s2| = 6\n- 两组字符T/H和H/T要进行换位操作，因此t=2/2=1; \n我们可以根据公式一得出Jaro得分：\n$$d_j = \\frac{1}{3}\\left(\\frac{6}{|6|} + \\frac{6}{|6|} + \\frac{6-1}{6}\\right)$$\n如果使用Jaro–Winkler，并且取范围因子P=0.1,我们会得出:\nP=0.1\nL=3\n$d_w = 0.944 + (3 * 0.1(1 - 0.944))=0.961$\n\n### python 运行\n1. 安装lib\n```\npip install jaro_winkler\n```\n2. 程序运行\n```\nprint(jaro.jaro_metric(\"MARTHA\".decode(\"utf-8\"),\"MARHTA\".decode(\"utf-8\")))\n```\n\n### 优化\n\n1. 多进程\n2. pandas\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"jaro-winkler算法原理和应用","published":1,"updated":"2018-07-16T09:28:13.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognak000p3a9dedtdzk4e","content":"<h3 id=\"算法简介\"><a href=\"#算法简介\" class=\"headerlink\" title=\"算法简介\"></a>算法简介</h3><p>The Jaro–Winkler distance (Winkler, 1990)是计算2个字符串之间相似度的一种算法。它是Jaro distance算法的变种。主要用于record linkage/数据连接（duplicate detection/重复记录）方面的领域，Jaro–Winkler distance最后得分越高说明相似度越大。Jaro–Winkler distance 是适合于串比如名字这样较短的字符之间计算相似度。0分表示没有任何相似度，1分则代表完全匹配。</p>\n<h3 id=\"算法定义\"><a href=\"#算法定义\" class=\"headerlink\" title=\"算法定义\"></a>算法定义</h3><ol>\n<li>The Jaro distance算法最后得分公式：<script type=\"math/tex; mode=display\">d_j = \\frac{1}{3}\\left(\\frac{m}{|s1|} + \\frac{m}{|s2|} + \\frac{m-t}{m} \\right)</script>其中:   </li>\n</ol>\n<ul>\n<li>s1、s2 是要比对的两个字符</li>\n<li>$d_j$是最后得分</li>\n<li>m是匹配的字符数</li>\n<li>t  是换位的数目</li>\n</ul>\n<ol>\n<li>Match Window(匹配窗口)计算公式<script type=\"math/tex; mode=display\">MW=\\left(\\frac{MAX(|s1|,|s2|)}{2}\\right) - 1</script>其中：</li>\n</ol>\n<ul>\n<li>s1、s2 是要比对的两个字符</li>\n<li>MW是匹配窗口值</li>\n</ul>\n<ol>\n<li>上述公式解释</li>\n</ol>\n<ul>\n<li>字符串s1与字符串s2在做匹配计算时，当两个字符的距离不大于公式二的最后结果(匹配窗口)即认为是匹配的。</li>\n<li>当s1、s2中字符相匹配但是字符位置不一样时发生换位操作、而公式一中换位的数目t为不同顺序的匹配字符的数目的一半。比如:两个字符串CRATE和TRACE做匹配操作，字符串中仅有’R’ ‘A’ ‘E’三个字符是匹配的，即m=3。为什么’C’, ‘T’不算做是匹配的呢。因为虽然’C’, ‘T’都出现在两个字符串中，但是通过公式二得出匹配窗口值为 (5/2)-1=1.5。而两个字符串中’C’, ‘T’字符的距离均大于1.5。所以不算做匹配。因此t=0。在另一组字符串DwAyNE 与 DuANE 。匹配的字符D-A-N-E 在两个字符串中有相同的字符顺序，所以不需要进行换位操作，因此t=0,m=4。</li>\n</ul>\n<ol>\n<li>Jaro–Winkler distance算法公式<br>Jaro-Winkler算法给予了起始部分就相同的字符串更高的分数，它定义了一个前缀范围p，对于要匹配的两个字符串，如果前缀部分有长度为L的部分字符串相同，则Jaro-Winkler Distance为:<script type=\"math/tex; mode=display\">d_w = d_j + L * P(1 - d_J)</script>其中:   </li>\n</ol>\n<ul>\n<li>$d_j$是Jaro distance最后得分</li>\n<li>L是前缀部分匹配的长度</li>\n<li>P是一个范围因子常量，用来调整前缀匹配的权值，但是P的值不能超过0.25，因为这样最后得分可能超过1分.Winkler的标准默认设置值P=0.1。</li>\n</ul>\n<h3 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h3><p>给出两个字符串 s1 MARTHA 和 s2 MARHTA、我们可以得出：</p>\n<ul>\n<li>m = 6</li>\n<li>|s1| = 6</li>\n<li>|s2| = 6</li>\n<li>两组字符T/H和H/T要进行换位操作，因此t=2/2=1;<br>我们可以根据公式一得出Jaro得分：<script type=\"math/tex; mode=display\">d_j = \\frac{1}{3}\\left(\\frac{6}{|6|} + \\frac{6}{|6|} + \\frac{6-1}{6}\\right)</script>如果使用Jaro–Winkler，并且取范围因子P=0.1,我们会得出:<br>P=0.1<br>L=3<br>$d_w = 0.944 + (3 * 0.1(1 - 0.944))=0.961$</li>\n</ul>\n<h3 id=\"python-运行\"><a href=\"#python-运行\" class=\"headerlink\" title=\"python 运行\"></a>python 运行</h3><ol>\n<li><p>安装lib</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install jaro_winkler</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>程序运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(jaro.jaro_metric(&quot;MARTHA&quot;.decode(&quot;utf-8&quot;),&quot;MARHTA&quot;.decode(&quot;utf-8&quot;)))</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a>优化</h3><ol>\n<li>多进程</li>\n<li>pandas</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"算法简介\"><a href=\"#算法简介\" class=\"headerlink\" title=\"算法简介\"></a>算法简介</h3><p>The Jaro–Winkler distance (Winkler, 1990)是计算2个字符串之间相似度的一种算法。它是Jaro distance算法的变种。主要用于record linkage/数据连接（duplicate detection/重复记录）方面的领域，Jaro–Winkler distance最后得分越高说明相似度越大。Jaro–Winkler distance 是适合于串比如名字这样较短的字符之间计算相似度。0分表示没有任何相似度，1分则代表完全匹配。</p>\n<h3 id=\"算法定义\"><a href=\"#算法定义\" class=\"headerlink\" title=\"算法定义\"></a>算法定义</h3><ol>\n<li>The Jaro distance算法最后得分公式：<script type=\"math/tex; mode=display\">d_j = \\frac{1}{3}\\left(\\frac{m}{|s1|} + \\frac{m}{|s2|} + \\frac{m-t}{m} \\right)</script>其中:   </li>\n</ol>\n<ul>\n<li>s1、s2 是要比对的两个字符</li>\n<li>$d_j$是最后得分</li>\n<li>m是匹配的字符数</li>\n<li>t  是换位的数目</li>\n</ul>\n<ol>\n<li>Match Window(匹配窗口)计算公式<script type=\"math/tex; mode=display\">MW=\\left(\\frac{MAX(|s1|,|s2|)}{2}\\right) - 1</script>其中：</li>\n</ol>\n<ul>\n<li>s1、s2 是要比对的两个字符</li>\n<li>MW是匹配窗口值</li>\n</ul>\n<ol>\n<li>上述公式解释</li>\n</ol>\n<ul>\n<li>字符串s1与字符串s2在做匹配计算时，当两个字符的距离不大于公式二的最后结果(匹配窗口)即认为是匹配的。</li>\n<li>当s1、s2中字符相匹配但是字符位置不一样时发生换位操作、而公式一中换位的数目t为不同顺序的匹配字符的数目的一半。比如:两个字符串CRATE和TRACE做匹配操作，字符串中仅有’R’ ‘A’ ‘E’三个字符是匹配的，即m=3。为什么’C’, ‘T’不算做是匹配的呢。因为虽然’C’, ‘T’都出现在两个字符串中，但是通过公式二得出匹配窗口值为 (5/2)-1=1.5。而两个字符串中’C’, ‘T’字符的距离均大于1.5。所以不算做匹配。因此t=0。在另一组字符串DwAyNE 与 DuANE 。匹配的字符D-A-N-E 在两个字符串中有相同的字符顺序，所以不需要进行换位操作，因此t=0,m=4。</li>\n</ul>\n<ol>\n<li>Jaro–Winkler distance算法公式<br>Jaro-Winkler算法给予了起始部分就相同的字符串更高的分数，它定义了一个前缀范围p，对于要匹配的两个字符串，如果前缀部分有长度为L的部分字符串相同，则Jaro-Winkler Distance为:<script type=\"math/tex; mode=display\">d_w = d_j + L * P(1 - d_J)</script>其中:   </li>\n</ol>\n<ul>\n<li>$d_j$是Jaro distance最后得分</li>\n<li>L是前缀部分匹配的长度</li>\n<li>P是一个范围因子常量，用来调整前缀匹配的权值，但是P的值不能超过0.25，因为这样最后得分可能超过1分.Winkler的标准默认设置值P=0.1。</li>\n</ul>\n<h3 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h3><p>给出两个字符串 s1 MARTHA 和 s2 MARHTA、我们可以得出：</p>\n<ul>\n<li>m = 6</li>\n<li>|s1| = 6</li>\n<li>|s2| = 6</li>\n<li>两组字符T/H和H/T要进行换位操作，因此t=2/2=1;<br>我们可以根据公式一得出Jaro得分：<script type=\"math/tex; mode=display\">d_j = \\frac{1}{3}\\left(\\frac{6}{|6|} + \\frac{6}{|6|} + \\frac{6-1}{6}\\right)</script>如果使用Jaro–Winkler，并且取范围因子P=0.1,我们会得出:<br>P=0.1<br>L=3<br>$d_w = 0.944 + (3 * 0.1(1 - 0.944))=0.961$</li>\n</ul>\n<h3 id=\"python-运行\"><a href=\"#python-运行\" class=\"headerlink\" title=\"python 运行\"></a>python 运行</h3><ol>\n<li><p>安装lib</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install jaro_winkler</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>程序运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(jaro.jaro_metric(&quot;MARTHA&quot;.decode(&quot;utf-8&quot;),&quot;MARHTA&quot;.decode(&quot;utf-8&quot;)))</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a>优化</h3><ol>\n<li>多进程</li>\n<li>pandas</li>\n</ol>\n"},{"title":"月报会议模块","date":"2017-03-02T06:31:19.000Z","_content":"\n### 会议相关月报样板\n\n您xx月共参加了xx ×x小时的会议，与xx个人进行过会晤，最近较为关注的公司有xx,xx,xx(公司名) \n(数据取自日程，会晤人取日程参与人，关注公司取参与会议的人次较多的前三名公司；会议仅包括：橙子日程中从橙脉和手机日历获取的日程）\n\n\n### 参加会议时间 \noradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n```\nselect user_id,SUM(meeting_time) as total_schedule_hour from(\nselect a.id as schedule_id,a.user_id,content,title,\nFROM_UNIXTIME(start_time) as start_time,\nFROM_UNIXTIME(end_time) as end_time,\n(end_time - start_time)/(60*60*24) as day_diff,\ncase\n-- 本月开始结束且一天之内结束\nwhen (end_time - start_time)/(60*60*24) <= 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - start_time)/(60*60)) \n-- 本月开始结束且一天之内没有结束\nwhen (end_time - start_time)/(60*60*24) > 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - start_time)/(60*60*24) * 8) \n-- 结束时间不是本月，则取月初第一天为结束时间\nwhen (end_time - start_time)/(60*60*24) > 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))!=3 \nthen round((UNIX_TIMESTAMP(last_day(curdate())) - start_time)/(60*60*24) * 8) \n-- 开始时间不是本月，则取月初第一天为开始时间 \nwhen (end_time - start_time)/(60*60*24) > 1 \nand MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - UNIX_TIMESTAMP(DATE_ADD(curdate(),interval -day(curdate())+1 day)))/(60*60*24) * 8)\nend as meeting_time\nfrom oradt_cloud1520.contact_card_schedule a \nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as c on c.user_id = a.user_id and c.uuid = b.uuid \nWHERE a.start_time >0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and c.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))=3)\norder by user_id,schedule_id\n)c GROUP BY user_id;\n```\n\n### 名片角色总会见人数\n先统计每个人参加了几个会议（会议需要去重）\n```\nselect user_id, GROUP_CONCAT(DISTINCT(schedule_id)) as meeting_list from(\nselect a.user_id, a.id as schedule_id\nfrom oradt_cloud1520.contact_card_schedule a\nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as c on c.user_id = a.user_id and c.uuid = b.uuid  \nWHERE a.start_time >0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and c.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)\norder by schedule_id,user_id\n) a GROUP BY user_id;\n```\n然后分别统计每个人的会议时长\n```\nselect DISTINCT(count(uuid)) from oradt_cloud1520.contact_card_schedule_map where status != 0 and uuid != '' and\nschedule_id in (3260,3890,3895,3915,4249,4252,4254,4255,4280,4822);\n```\n\n### 关注公司\noradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n与DM库中公司表关联得到参与人公司,统计公司前三位\n```\nselect user_id, GROUP_CONCAT(companyName ORDER BY com_count desc,last_modified desc) as com_list from(\nselect user_id,companyName,count(*) as com_count,max(last_modified) as last_modified from(\nselect d.*,FROM_UNIXTIME(g.last_modified) as last_modified from(\nselect a.user_id,b.schedule_id,b.uuid,c.companyName\nfrom oradt_cloud1520.contact_card_schedule a \nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft JOIN(select DISTINCT user_id,card_id,companyName from dm_test.company_info_jsonver) as c on b.uuid = c.card_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as f on f.user_id = a.user_id and f.uuid = b.uuid\nWHERE a.start_time > 0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and f.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)\nand c.companyName !='' and c.companyName is NOT null\n)d left join oradt_cloud1520.contact_card g on g.uuid = d.uuid) h\nGROUP BY user_id,companyName ORDER BY com_count desc,last_modified desc\n)e GROUP BY user_id;\n```\n\n### 相关表结构\n```\nCREATE TABLE `contact_card_schedule` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',\n  `user_id` char(40) CHARACTER SET utf8 NOT NULL DEFAULT '' COMMENT '创建人user_id',\n  `vcard_id` char(32) CHARACTER SET utf8 DEFAULT '' COMMENT '日程名片id',\n  `content` text NOT NULL COMMENT '日程内容',\n  `title` varchar(100) DEFAULT '' COMMENT '日程标题',\n  `address` varchar(300) DEFAULT '' COMMENT '地址',\n  `start_time` int(10) NOT NULL DEFAULT '0' COMMENT '日程开始时间',\n  `end_time` int(10) NOT NULL DEFAULT '0' COMMENT '日程结束时间',\n  `remind_time` int(10) NOT NULL DEFAULT '0' COMMENT '提醒时间',\n  `cycle` int(10) NOT NULL DEFAULT '0' COMMENT '提醒周期（例：15分钟为900单位为秒）',\n  `isallday` tinyint(1) NOT NULL DEFAULT '2' COMMENT '是否全天 ：1是  2否 ',\n  `flag_time` int(10) NOT NULL DEFAULT '0' COMMENT '提醒计算字段（为时间戳）',\n  `last_modify` int(10) NOT NULL DEFAULT '0' COMMENT '最后修改时间',\n  `create_time` int(10) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  `latitude` decimal(13,8) NOT NULL DEFAULT '0.00000000' COMMENT '坐标',\n  `longitude` decimal(13,8) NOT NULL DEFAULT '0.00000000' COMMENT '坐标',\n  `is_remind` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否提醒',\n  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1为添加2为删除',\n  `flight_id` int(20) DEFAULT '0' COMMENT '行程卡id',\n  `schedule_from` tinyint(2) NOT NULL DEFAULT '1' COMMENT '日程来源：1.为橙脉2.为手机同步3.短信同步为4.为行程卡5.为还款同步6.航旅卡',\n  `schedule_info` text CHARACTER SET utf8 COMMENT '来源模块信息',\n  `orange_remind` int(10) NOT NULL DEFAULT '0' COMMENT '橙子专用提醒时间',\n  PRIMARY KEY (`id`),\n  KEY `user_id` (`user_id`),\n  KEY `v_cardid_idx` (`vcard_id`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=4771 DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `contact_card_schedule_map` (\n  `id` int(20) unsigned NOT NULL AUTO_INCREMENT,\n  `uuid` char(32) NOT NULL DEFAULT '' COMMENT '邀请人cardid',\n  `schedule_id` bigint(20) NOT NULL DEFAULT '0' COMMENT '日程id',\n  `last_modify` int(10) NOT NULL DEFAULT '0' COMMENT '最后更新时间',\n  `operation` enum('delete','modify','add') NOT NULL COMMENT '参与人状态',\n  `status` tinyint(1) NOT NULL DEFAULT '0' COMMENT '0 不参与 1 未接受 2 已接受 3 完成',\n  PRIMARY KEY (`id`),\n  KEY `sch_id` (`schedule_id`) USING BTREE,\n  KEY `v_uuid_index` (`uuid`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=7093 DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `orange_meeting_follow` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户id',\n  `meeting_hour` int(2) NOT NULL DEFAULT '0' COMMENT '会议小时数',\n  `meeting_people` int(2) NOT NULL DEFAULT '0' COMMENT '面谈人数',\n  `follow_comp` text COMMENT '关注公司列表',\n  `report_month` int(6) NOT NULL COMMENT '月报生成年月,存储格式例：201702',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COMMENT='用户会议相关及关注公司统计表'\n```\n","source":"_posts/meeting.md","raw":"---\ntitle: 月报会议模块\ndate: 2017-03-02 14:31:19\ntags:\n    - 月报\ncategories: IMORA\n---\n\n### 会议相关月报样板\n\n您xx月共参加了xx ×x小时的会议，与xx个人进行过会晤，最近较为关注的公司有xx,xx,xx(公司名) \n(数据取自日程，会晤人取日程参与人，关注公司取参与会议的人次较多的前三名公司；会议仅包括：橙子日程中从橙脉和手机日历获取的日程）\n\n\n### 参加会议时间 \noradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n```\nselect user_id,SUM(meeting_time) as total_schedule_hour from(\nselect a.id as schedule_id,a.user_id,content,title,\nFROM_UNIXTIME(start_time) as start_time,\nFROM_UNIXTIME(end_time) as end_time,\n(end_time - start_time)/(60*60*24) as day_diff,\ncase\n-- 本月开始结束且一天之内结束\nwhen (end_time - start_time)/(60*60*24) <= 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - start_time)/(60*60)) \n-- 本月开始结束且一天之内没有结束\nwhen (end_time - start_time)/(60*60*24) > 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - start_time)/(60*60*24) * 8) \n-- 结束时间不是本月，则取月初第一天为结束时间\nwhen (end_time - start_time)/(60*60*24) > 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))!=3 \nthen round((UNIX_TIMESTAMP(last_day(curdate())) - start_time)/(60*60*24) * 8) \n-- 开始时间不是本月，则取月初第一天为开始时间 \nwhen (end_time - start_time)/(60*60*24) > 1 \nand MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(end_time))=3 \nthen round((end_time - UNIX_TIMESTAMP(DATE_ADD(curdate(),interval -day(curdate())+1 day)))/(60*60*24) * 8)\nend as meeting_time\nfrom oradt_cloud1520.contact_card_schedule a \nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as c on c.user_id = a.user_id and c.uuid = b.uuid \nWHERE a.start_time >0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and c.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))=3)\norder by user_id,schedule_id\n)c GROUP BY user_id;\n```\n\n### 名片角色总会见人数\n先统计每个人参加了几个会议（会议需要去重）\n```\nselect user_id, GROUP_CONCAT(DISTINCT(schedule_id)) as meeting_list from(\nselect a.user_id, a.id as schedule_id\nfrom oradt_cloud1520.contact_card_schedule a\nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as c on c.user_id = a.user_id and c.uuid = b.uuid  \nWHERE a.start_time >0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and c.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)\norder by schedule_id,user_id\n) a GROUP BY user_id;\n```\n然后分别统计每个人的会议时长\n```\nselect DISTINCT(count(uuid)) from oradt_cloud1520.contact_card_schedule_map where status != 0 and uuid != '' and\nschedule_id in (3260,3890,3895,3915,4249,4252,4254,4255,4280,4822);\n```\n\n### 关注公司\noradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n与DM库中公司表关联得到参与人公司,统计公司前三位\n```\nselect user_id, GROUP_CONCAT(companyName ORDER BY com_count desc,last_modified desc) as com_list from(\nselect user_id,companyName,count(*) as com_count,max(last_modified) as last_modified from(\nselect d.*,FROM_UNIXTIME(g.last_modified) as last_modified from(\nselect a.user_id,b.schedule_id,b.uuid,c.companyName\nfrom oradt_cloud1520.contact_card_schedule a \nright join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id\nleft JOIN(select DISTINCT user_id,card_id,companyName from dm_test.company_info_jsonver) as c on b.uuid = c.card_id\nleft join(\nselect user_id,uuid\n    from oradt_cloud1520.contact_card\n    where self='true' and status = 'active'\n) as f on f.user_id = a.user_id and f.uuid = b.uuid\nWHERE a.start_time > 0 and a.end_time > a.start_time \nand b.status != 0 and b.uuid != '' and f.uuid is null and a.status = 1\nand YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017\nand (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)\nand c.companyName !='' and c.companyName is NOT null\n)d left join oradt_cloud1520.contact_card g on g.uuid = d.uuid) h\nGROUP BY user_id,companyName ORDER BY com_count desc,last_modified desc\n)e GROUP BY user_id;\n```\n\n### 相关表结构\n```\nCREATE TABLE `contact_card_schedule` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',\n  `user_id` char(40) CHARACTER SET utf8 NOT NULL DEFAULT '' COMMENT '创建人user_id',\n  `vcard_id` char(32) CHARACTER SET utf8 DEFAULT '' COMMENT '日程名片id',\n  `content` text NOT NULL COMMENT '日程内容',\n  `title` varchar(100) DEFAULT '' COMMENT '日程标题',\n  `address` varchar(300) DEFAULT '' COMMENT '地址',\n  `start_time` int(10) NOT NULL DEFAULT '0' COMMENT '日程开始时间',\n  `end_time` int(10) NOT NULL DEFAULT '0' COMMENT '日程结束时间',\n  `remind_time` int(10) NOT NULL DEFAULT '0' COMMENT '提醒时间',\n  `cycle` int(10) NOT NULL DEFAULT '0' COMMENT '提醒周期（例：15分钟为900单位为秒）',\n  `isallday` tinyint(1) NOT NULL DEFAULT '2' COMMENT '是否全天 ：1是  2否 ',\n  `flag_time` int(10) NOT NULL DEFAULT '0' COMMENT '提醒计算字段（为时间戳）',\n  `last_modify` int(10) NOT NULL DEFAULT '0' COMMENT '最后修改时间',\n  `create_time` int(10) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  `latitude` decimal(13,8) NOT NULL DEFAULT '0.00000000' COMMENT '坐标',\n  `longitude` decimal(13,8) NOT NULL DEFAULT '0.00000000' COMMENT '坐标',\n  `is_remind` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否提醒',\n  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1为添加2为删除',\n  `flight_id` int(20) DEFAULT '0' COMMENT '行程卡id',\n  `schedule_from` tinyint(2) NOT NULL DEFAULT '1' COMMENT '日程来源：1.为橙脉2.为手机同步3.短信同步为4.为行程卡5.为还款同步6.航旅卡',\n  `schedule_info` text CHARACTER SET utf8 COMMENT '来源模块信息',\n  `orange_remind` int(10) NOT NULL DEFAULT '0' COMMENT '橙子专用提醒时间',\n  PRIMARY KEY (`id`),\n  KEY `user_id` (`user_id`),\n  KEY `v_cardid_idx` (`vcard_id`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=4771 DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `contact_card_schedule_map` (\n  `id` int(20) unsigned NOT NULL AUTO_INCREMENT,\n  `uuid` char(32) NOT NULL DEFAULT '' COMMENT '邀请人cardid',\n  `schedule_id` bigint(20) NOT NULL DEFAULT '0' COMMENT '日程id',\n  `last_modify` int(10) NOT NULL DEFAULT '0' COMMENT '最后更新时间',\n  `operation` enum('delete','modify','add') NOT NULL COMMENT '参与人状态',\n  `status` tinyint(1) NOT NULL DEFAULT '0' COMMENT '0 不参与 1 未接受 2 已接受 3 完成',\n  PRIMARY KEY (`id`),\n  KEY `sch_id` (`schedule_id`) USING BTREE,\n  KEY `v_uuid_index` (`uuid`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=7093 DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `orange_meeting_follow` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户id',\n  `meeting_hour` int(2) NOT NULL DEFAULT '0' COMMENT '会议小时数',\n  `meeting_people` int(2) NOT NULL DEFAULT '0' COMMENT '面谈人数',\n  `follow_comp` text COMMENT '关注公司列表',\n  `report_month` int(6) NOT NULL COMMENT '月报生成年月,存储格式例：201702',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COMMENT='用户会议相关及关注公司统计表'\n```\n","slug":"meeting","published":1,"updated":"2018-07-13T11:06:08.776Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognao000r3a9dwt1w7hu6","content":"<h3 id=\"会议相关月报样板\"><a href=\"#会议相关月报样板\" class=\"headerlink\" title=\"会议相关月报样板\"></a>会议相关月报样板</h3><p>您xx月共参加了xx ×x小时的会议，与xx个人进行过会晤，最近较为关注的公司有xx,xx,xx(公司名)<br>(数据取自日程，会晤人取日程参与人，关注公司取参与会议的人次较多的前三名公司；会议仅包括：橙子日程中从橙脉和手机日历获取的日程）</p>\n<h3 id=\"参加会议时间\"><a href=\"#参加会议时间\" class=\"headerlink\" title=\"参加会议时间\"></a>参加会议时间</h3><p>oradt_cloud1520.contact_card_schedule 取会议开始结束时间；<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id,SUM(meeting_time) as total_schedule_hour from(</span><br><span class=\"line\">select a.id as schedule_id,a.user_id,content,title,</span><br><span class=\"line\">FROM_UNIXTIME(start_time) as start_time,</span><br><span class=\"line\">FROM_UNIXTIME(end_time) as end_time,</span><br><span class=\"line\">(end_time - start_time)/(60*60*24) as day_diff,</span><br><span class=\"line\">case</span><br><span class=\"line\">-- 本月开始结束且一天之内结束</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &lt;= 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - start_time)/(60*60)) </span><br><span class=\"line\">-- 本月开始结束且一天之内没有结束</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - start_time)/(60*60*24) * 8) </span><br><span class=\"line\">-- 结束时间不是本月，则取月初第一天为结束时间</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))!=3 </span><br><span class=\"line\">then round((UNIX_TIMESTAMP(last_day(curdate())) - start_time)/(60*60*24) * 8) </span><br><span class=\"line\">-- 开始时间不是本月，则取月初第一天为开始时间 </span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 </span><br><span class=\"line\">and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - UNIX_TIMESTAMP(DATE_ADD(curdate(),interval -day(curdate())+1 day)))/(60*60*24) * 8)</span><br><span class=\"line\">end as meeting_time</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a </span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as c on c.user_id = a.user_id and c.uuid = b.uuid </span><br><span class=\"line\">WHERE a.start_time &gt;0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and c.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))=3)</span><br><span class=\"line\">order by user_id,schedule_id</span><br><span class=\"line\">)c GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"名片角色总会见人数\"><a href=\"#名片角色总会见人数\" class=\"headerlink\" title=\"名片角色总会见人数\"></a>名片角色总会见人数</h3><p>先统计每个人参加了几个会议（会议需要去重）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id, GROUP_CONCAT(DISTINCT(schedule_id)) as meeting_list from(</span><br><span class=\"line\">select a.user_id, a.id as schedule_id</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a</span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as c on c.user_id = a.user_id and c.uuid = b.uuid  </span><br><span class=\"line\">WHERE a.start_time &gt;0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and c.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)</span><br><span class=\"line\">order by schedule_id,user_id</span><br><span class=\"line\">) a GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<p>然后分别统计每个人的会议时长<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select DISTINCT(count(uuid)) from oradt_cloud1520.contact_card_schedule_map where status != 0 and uuid != &apos;&apos; and</span><br><span class=\"line\">schedule_id in (3260,3890,3895,3915,4249,4252,4254,4255,4280,4822);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"关注公司\"><a href=\"#关注公司\" class=\"headerlink\" title=\"关注公司\"></a>关注公司</h3><p>oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；<br>与DM库中公司表关联得到参与人公司,统计公司前三位<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id, GROUP_CONCAT(companyName ORDER BY com_count desc,last_modified desc) as com_list from(</span><br><span class=\"line\">select user_id,companyName,count(*) as com_count,max(last_modified) as last_modified from(</span><br><span class=\"line\">select d.*,FROM_UNIXTIME(g.last_modified) as last_modified from(</span><br><span class=\"line\">select a.user_id,b.schedule_id,b.uuid,c.companyName</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a </span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left JOIN(select DISTINCT user_id,card_id,companyName from dm_test.company_info_jsonver) as c on b.uuid = c.card_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as f on f.user_id = a.user_id and f.uuid = b.uuid</span><br><span class=\"line\">WHERE a.start_time &gt; 0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and f.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)</span><br><span class=\"line\">and c.companyName !=&apos;&apos; and c.companyName is NOT null</span><br><span class=\"line\">)d left join oradt_cloud1520.contact_card g on g.uuid = d.uuid) h</span><br><span class=\"line\">GROUP BY user_id,companyName ORDER BY com_count desc,last_modified desc</span><br><span class=\"line\">)e GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"相关表结构\"><a href=\"#相关表结构\" class=\"headerlink\" title=\"相关表结构\"></a>相关表结构</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `contact_card_schedule` (</span><br><span class=\"line\">  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</span><br><span class=\"line\">  `user_id` char(40) CHARACTER SET utf8 NOT NULL DEFAULT &apos;&apos; COMMENT &apos;创建人user_id&apos;,</span><br><span class=\"line\">  `vcard_id` char(32) CHARACTER SET utf8 DEFAULT &apos;&apos; COMMENT &apos;日程名片id&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;日程内容&apos;,</span><br><span class=\"line\">  `title` varchar(100) DEFAULT &apos;&apos; COMMENT &apos;日程标题&apos;,</span><br><span class=\"line\">  `address` varchar(300) DEFAULT &apos;&apos; COMMENT &apos;地址&apos;,</span><br><span class=\"line\">  `start_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程开始时间&apos;,</span><br><span class=\"line\">  `end_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程结束时间&apos;,</span><br><span class=\"line\">  `remind_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒时间&apos;,</span><br><span class=\"line\">  `cycle` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒周期（例：15分钟为900单位为秒）&apos;,</span><br><span class=\"line\">  `isallday` tinyint(1) NOT NULL DEFAULT &apos;2&apos; COMMENT &apos;是否全天 ：1是  2否 &apos;,</span><br><span class=\"line\">  `flag_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒计算字段（为时间戳）&apos;,</span><br><span class=\"line\">  `last_modify` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;最后修改时间&apos;,</span><br><span class=\"line\">  `create_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `latitude` decimal(13,8) NOT NULL DEFAULT &apos;0.00000000&apos; COMMENT &apos;坐标&apos;,</span><br><span class=\"line\">  `longitude` decimal(13,8) NOT NULL DEFAULT &apos;0.00000000&apos; COMMENT &apos;坐标&apos;,</span><br><span class=\"line\">  `is_remind` tinyint(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;是否提醒&apos;,</span><br><span class=\"line\">  `status` tinyint(1) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1为添加2为删除&apos;,</span><br><span class=\"line\">  `flight_id` int(20) DEFAULT &apos;0&apos; COMMENT &apos;行程卡id&apos;,</span><br><span class=\"line\">  `schedule_from` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;日程来源：1.为橙脉2.为手机同步3.短信同步为4.为行程卡5.为还款同步6.航旅卡&apos;,</span><br><span class=\"line\">  `schedule_info` text CHARACTER SET utf8 COMMENT &apos;来源模块信息&apos;,</span><br><span class=\"line\">  `orange_remind` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;橙子专用提醒时间&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  KEY `user_id` (`user_id`),</span><br><span class=\"line\">  KEY `v_cardid_idx` (`vcard_id`) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=4771 DEFAULT CHARSET=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `contact_card_schedule_map` (</span><br><span class=\"line\">  `id` int(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `uuid` char(32) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;邀请人cardid&apos;,</span><br><span class=\"line\">  `schedule_id` bigint(20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程id&apos;,</span><br><span class=\"line\">  `last_modify` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;最后更新时间&apos;,</span><br><span class=\"line\">  `operation` enum(&apos;delete&apos;,&apos;modify&apos;,&apos;add&apos;) NOT NULL COMMENT &apos;参与人状态&apos;,</span><br><span class=\"line\">  `status` tinyint(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0 不参与 1 未接受 2 已接受 3 完成&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  KEY `sch_id` (`schedule_id`) USING BTREE,</span><br><span class=\"line\">  KEY `v_uuid_index` (`uuid`) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=7093 DEFAULT CHARSET=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `orange_meeting_follow` (</span><br><span class=\"line\">  `id` int(10) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `user_id` varchar(42) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `meeting_hour` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;会议小时数&apos;,</span><br><span class=\"line\">  `meeting_people` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;面谈人数&apos;,</span><br><span class=\"line\">  `follow_comp` text COMMENT &apos;关注公司列表&apos;,</span><br><span class=\"line\">  `report_month` int(6) NOT NULL COMMENT &apos;月报生成年月,存储格式例：201702&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COMMENT=&apos;用户会议相关及关注公司统计表&apos;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"会议相关月报样板\"><a href=\"#会议相关月报样板\" class=\"headerlink\" title=\"会议相关月报样板\"></a>会议相关月报样板</h3><p>您xx月共参加了xx ×x小时的会议，与xx个人进行过会晤，最近较为关注的公司有xx,xx,xx(公司名)<br>(数据取自日程，会晤人取日程参与人，关注公司取参与会议的人次较多的前三名公司；会议仅包括：橙子日程中从橙脉和手机日历获取的日程）</p>\n<h3 id=\"参加会议时间\"><a href=\"#参加会议时间\" class=\"headerlink\" title=\"参加会议时间\"></a>参加会议时间</h3><p>oradt_cloud1520.contact_card_schedule 取会议开始结束时间；<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id,SUM(meeting_time) as total_schedule_hour from(</span><br><span class=\"line\">select a.id as schedule_id,a.user_id,content,title,</span><br><span class=\"line\">FROM_UNIXTIME(start_time) as start_time,</span><br><span class=\"line\">FROM_UNIXTIME(end_time) as end_time,</span><br><span class=\"line\">(end_time - start_time)/(60*60*24) as day_diff,</span><br><span class=\"line\">case</span><br><span class=\"line\">-- 本月开始结束且一天之内结束</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &lt;= 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - start_time)/(60*60)) </span><br><span class=\"line\">-- 本月开始结束且一天之内没有结束</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - start_time)/(60*60*24) * 8) </span><br><span class=\"line\">-- 结束时间不是本月，则取月初第一天为结束时间</span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 and MONTH(FROM_UNIXTIME(start_time)) = 3 and MONTH(FROM_UNIXTIME(end_time))!=3 </span><br><span class=\"line\">then round((UNIX_TIMESTAMP(last_day(curdate())) - start_time)/(60*60*24) * 8) </span><br><span class=\"line\">-- 开始时间不是本月，则取月初第一天为开始时间 </span><br><span class=\"line\">when (end_time - start_time)/(60*60*24) &gt; 1 </span><br><span class=\"line\">and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(start_time)) != 3 and MONTH(FROM_UNIXTIME(end_time))=3 </span><br><span class=\"line\">then round((end_time - UNIX_TIMESTAMP(DATE_ADD(curdate(),interval -day(curdate())+1 day)))/(60*60*24) * 8)</span><br><span class=\"line\">end as meeting_time</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a </span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as c on c.user_id = a.user_id and c.uuid = b.uuid </span><br><span class=\"line\">WHERE a.start_time &gt;0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and c.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))=3)</span><br><span class=\"line\">order by user_id,schedule_id</span><br><span class=\"line\">)c GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"名片角色总会见人数\"><a href=\"#名片角色总会见人数\" class=\"headerlink\" title=\"名片角色总会见人数\"></a>名片角色总会见人数</h3><p>先统计每个人参加了几个会议（会议需要去重）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id, GROUP_CONCAT(DISTINCT(schedule_id)) as meeting_list from(</span><br><span class=\"line\">select a.user_id, a.id as schedule_id</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a</span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as c on c.user_id = a.user_id and c.uuid = b.uuid  </span><br><span class=\"line\">WHERE a.start_time &gt;0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and c.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)</span><br><span class=\"line\">order by schedule_id,user_id</span><br><span class=\"line\">) a GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<p>然后分别统计每个人的会议时长<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select DISTINCT(count(uuid)) from oradt_cloud1520.contact_card_schedule_map where status != 0 and uuid != &apos;&apos; and</span><br><span class=\"line\">schedule_id in (3260,3890,3895,3915,4249,4252,4254,4255,4280,4822);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"关注公司\"><a href=\"#关注公司\" class=\"headerlink\" title=\"关注公司\"></a>关注公司</h3><p>oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；<br>与DM库中公司表关联得到参与人公司,统计公司前三位<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_id, GROUP_CONCAT(companyName ORDER BY com_count desc,last_modified desc) as com_list from(</span><br><span class=\"line\">select user_id,companyName,count(*) as com_count,max(last_modified) as last_modified from(</span><br><span class=\"line\">select d.*,FROM_UNIXTIME(g.last_modified) as last_modified from(</span><br><span class=\"line\">select a.user_id,b.schedule_id,b.uuid,c.companyName</span><br><span class=\"line\">from oradt_cloud1520.contact_card_schedule a </span><br><span class=\"line\">right join oradt_cloud1520.contact_card_schedule_map b on a.id = b.schedule_id</span><br><span class=\"line\">left JOIN(select DISTINCT user_id,card_id,companyName from dm_test.company_info_jsonver) as c on b.uuid = c.card_id</span><br><span class=\"line\">left join(</span><br><span class=\"line\">select user_id,uuid</span><br><span class=\"line\">    from oradt_cloud1520.contact_card</span><br><span class=\"line\">    where self=&apos;true&apos; and status = &apos;active&apos;</span><br><span class=\"line\">) as f on f.user_id = a.user_id and f.uuid = b.uuid</span><br><span class=\"line\">WHERE a.start_time &gt; 0 and a.end_time &gt; a.start_time </span><br><span class=\"line\">and b.status != 0 and b.uuid != &apos;&apos; and f.uuid is null and a.status = 1</span><br><span class=\"line\">and YEAR(FROM_UNIXTIME(start_time)) = 2017 and YEAR(FROM_UNIXTIME(end_time))=2017</span><br><span class=\"line\">and (MONTH(FROM_UNIXTIME(start_time)) = 3 or MONTH(FROM_UNIXTIME(end_time))= 3)</span><br><span class=\"line\">and c.companyName !=&apos;&apos; and c.companyName is NOT null</span><br><span class=\"line\">)d left join oradt_cloud1520.contact_card g on g.uuid = d.uuid) h</span><br><span class=\"line\">GROUP BY user_id,companyName ORDER BY com_count desc,last_modified desc</span><br><span class=\"line\">)e GROUP BY user_id;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"相关表结构\"><a href=\"#相关表结构\" class=\"headerlink\" title=\"相关表结构\"></a>相关表结构</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `contact_card_schedule` (</span><br><span class=\"line\">  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</span><br><span class=\"line\">  `user_id` char(40) CHARACTER SET utf8 NOT NULL DEFAULT &apos;&apos; COMMENT &apos;创建人user_id&apos;,</span><br><span class=\"line\">  `vcard_id` char(32) CHARACTER SET utf8 DEFAULT &apos;&apos; COMMENT &apos;日程名片id&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;日程内容&apos;,</span><br><span class=\"line\">  `title` varchar(100) DEFAULT &apos;&apos; COMMENT &apos;日程标题&apos;,</span><br><span class=\"line\">  `address` varchar(300) DEFAULT &apos;&apos; COMMENT &apos;地址&apos;,</span><br><span class=\"line\">  `start_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程开始时间&apos;,</span><br><span class=\"line\">  `end_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程结束时间&apos;,</span><br><span class=\"line\">  `remind_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒时间&apos;,</span><br><span class=\"line\">  `cycle` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒周期（例：15分钟为900单位为秒）&apos;,</span><br><span class=\"line\">  `isallday` tinyint(1) NOT NULL DEFAULT &apos;2&apos; COMMENT &apos;是否全天 ：1是  2否 &apos;,</span><br><span class=\"line\">  `flag_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;提醒计算字段（为时间戳）&apos;,</span><br><span class=\"line\">  `last_modify` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;最后修改时间&apos;,</span><br><span class=\"line\">  `create_time` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `latitude` decimal(13,8) NOT NULL DEFAULT &apos;0.00000000&apos; COMMENT &apos;坐标&apos;,</span><br><span class=\"line\">  `longitude` decimal(13,8) NOT NULL DEFAULT &apos;0.00000000&apos; COMMENT &apos;坐标&apos;,</span><br><span class=\"line\">  `is_remind` tinyint(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;是否提醒&apos;,</span><br><span class=\"line\">  `status` tinyint(1) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1为添加2为删除&apos;,</span><br><span class=\"line\">  `flight_id` int(20) DEFAULT &apos;0&apos; COMMENT &apos;行程卡id&apos;,</span><br><span class=\"line\">  `schedule_from` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;日程来源：1.为橙脉2.为手机同步3.短信同步为4.为行程卡5.为还款同步6.航旅卡&apos;,</span><br><span class=\"line\">  `schedule_info` text CHARACTER SET utf8 COMMENT &apos;来源模块信息&apos;,</span><br><span class=\"line\">  `orange_remind` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;橙子专用提醒时间&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  KEY `user_id` (`user_id`),</span><br><span class=\"line\">  KEY `v_cardid_idx` (`vcard_id`) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=4771 DEFAULT CHARSET=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `contact_card_schedule_map` (</span><br><span class=\"line\">  `id` int(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `uuid` char(32) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;邀请人cardid&apos;,</span><br><span class=\"line\">  `schedule_id` bigint(20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;日程id&apos;,</span><br><span class=\"line\">  `last_modify` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;最后更新时间&apos;,</span><br><span class=\"line\">  `operation` enum(&apos;delete&apos;,&apos;modify&apos;,&apos;add&apos;) NOT NULL COMMENT &apos;参与人状态&apos;,</span><br><span class=\"line\">  `status` tinyint(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0 不参与 1 未接受 2 已接受 3 完成&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  KEY `sch_id` (`schedule_id`) USING BTREE,</span><br><span class=\"line\">  KEY `v_uuid_index` (`uuid`) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=7093 DEFAULT CHARSET=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `orange_meeting_follow` (</span><br><span class=\"line\">  `id` int(10) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `user_id` varchar(42) NOT NULL COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `meeting_hour` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;会议小时数&apos;,</span><br><span class=\"line\">  `meeting_people` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;面谈人数&apos;,</span><br><span class=\"line\">  `follow_comp` text COMMENT &apos;关注公司列表&apos;,</span><br><span class=\"line\">  `report_month` int(6) NOT NULL COMMENT &apos;月报生成年月,存储格式例：201702&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COMMENT=&apos;用户会议相关及关注公司统计表&apos;</span><br></pre></td></tr></table></figure>\n"},{"title":"月报各统计指标计算方法","date":"2017-02-15T02:14:01.000Z","_content":"\n\n## 月报各项目计算（初版）\n\n\n### 一.消费记录\n\n1.**数据来源：月报表**\n<pre><font size=2>CREATE TABLE `orange_monthly_report` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户ID',\n  `content` text NOT NULL COMMENT '月报内容',\n  `created_time` int(10) NOT NULL COMMENT '月报创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '处理时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COMMENT='月报数据表';\n \n \nCREATE TABLE `orange_consume_detail` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` char(42) NOT NULL COMMENT '用户id',\n  `card_id` char(32) NOT NULL COMMENT '卡片id',\n  `bankcard_id` char(32) NOT NULL COMMENT '银行卡号',\n  `bank_name` varchar(90) NOT NULL COMMENT '银行名',\n  `bill_type` tinyint(1) NOT NULL COMMENT '消费类型：1、手机银行支付，2、支取，3、转账等',\n  `bill` float(10,2) NOT NULL COMMENT '消费金额',\n  `balance` float(10,2) NOT NULL COMMENT '余额',\n  `created_time` int(10) NOT NULL COMMENT '创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '修改时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8 COMMENT='消费详情表';\n</font></pre>\n\n\n2.**消费记录详情SQL**\n\n得到指定月份的用户消费详情\n提供各卡片当月消费金额\n<pre><font size=2>SELECT user_id, bankcard_id,bill_time,cons_type,bill FROM consume_details\nWHERE  MONTH(bill_time) == \"%s\" AND user_id = \"%s\"</font></pre>\n\n<font color=red size=2>待定：短信去重</font>\n\n\n### 二.我在旅途\n1.**数据来源：里程卡，酒店卡**\n\n<font color=red size=2>待定：</font>\n\n    2.里程卡中可能无法得到飞行次数数据。\n    3.里程数可能无法涵盖所有公司。\n    4.酒店卡数据来源？？\n\n5.抵达城市算法，只用手机GPS位置   \n\n### 三.人脉动态\n1.新增名片数，新增好友数\n从数据库中获取新增名片数，新增好友数\n\n新增好友数计算：contact_card(is_friend,from_uid,created_time)。从该表中按创建时间分组后取好友uid最早的记录，看是否落入统计区间。\n\n2.被关注人数\n来自谁看过我的消费结果\ncontact_card_see_me_source(未去重）\n统计自然月的关注过用户的人数\n\n3.参加会议时间 \n\nhttp://192.168.30.191/example/orange_schedule.txt\n日程相关说明\n\n    oradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n\n4.关注公司\n\n    oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n    与DM库中公司表关联得到参与人公司,统计公司前三位。如有参与人公司排名相同的情况，取名片更新时间最新的公司。\n\n\n### 四.卡片统计\n日志中获取卡片展示超过5秒的所有卡片，每找到一对展示开始时间超过5秒的记录，认为是一次使用，记入DM库\n<pre><font size=2>CREATE TABLE `card_used_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `card_id` char(32) DEFAULT '' COMMENT '卡片id',\n  `daily_used_count` int(10) DEFAULT '' COMMENT '卡片当日使用次数',\n  `card_type` char(32) DEFAULT '' COMMENT '卡片类型',\n  `used_time` datetime COMMENT '卡片使用时间',\n  `batch_time` datetime DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='卡片使用次数表'</font></pre>\n\n展示结果为按日别、卡别、用户统计使用次数\n各类卡使用占比则先分组\n常用卡列表来自于hive\n### 附录\n月报json存储格式\n<pre><font size=2>{\n    \"consume\": {\n        \"totle\": 58097.86,\n        \"bank\": [\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 1234567898765,\n                \"amount\": 300.23\n            },\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 9876543212345,\n                \"amount\": 451.8\n            },\n            {\n                \"bank_name\": \"工商银行\",\n                \"card_num\": 66436743634424,\n                \"amount\": 670.83\n            },\n            {\n                \"bank_name\": \"建设银行\",\n                \"card_num\": 63762343254654,\n                \"amount\": 1270.31\n            }\n        ]\n    },\n    \"travel\": {\n        \"flight\": 28,\n        \"mileage\": 10867,\n        \"stay\": 15,\n        \"city\": \"北京、东京、纽约、斯德哥尔摩\"\n    },\n    \"connection\": {\n        \"meeting_hour\": 28,\n        \"meeting_people\": 15,\n        \"new_friend\": 98,\n        \"new_card\": 887,\n        \"followed\": 185,\n        \"follow_comp\": \"苹果、google、三星\"\n    },\n    \"card\": {\n        \"category\": [\n            {\n                \"type\": \"行程卡\",\n                \"freq\": 90\n            },\n            {\n                \"type\": \"名片\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"酒店卡\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"系统卡\",\n                \"freq\": 10\n            },\n            {\n                \"type\": \"other\",\n                \"freq\": 100\n            }\n        ],\n        \"recent_use\": \"33829923329,53829923329,9829923380\"\n    }\n}\n\n** 此处的 other是取使用在4次以上，并不在前4位的卡片，非卡片类型的其它卡片\n</font></pre> \n\n","source":"_posts/monthlyReport.md","raw":"---\ntitle: 月报各统计指标计算方法\ndate: 2017-02-15 10:14:01\ntags:\n    - 月报\n    - 统计指标\ncategories: IMORA\n---\n\n\n## 月报各项目计算（初版）\n\n\n### 一.消费记录\n\n1.**数据来源：月报表**\n<pre><font size=2>CREATE TABLE `orange_monthly_report` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户ID',\n  `content` text NOT NULL COMMENT '月报内容',\n  `created_time` int(10) NOT NULL COMMENT '月报创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '处理时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COMMENT='月报数据表';\n \n \nCREATE TABLE `orange_consume_detail` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` char(42) NOT NULL COMMENT '用户id',\n  `card_id` char(32) NOT NULL COMMENT '卡片id',\n  `bankcard_id` char(32) NOT NULL COMMENT '银行卡号',\n  `bank_name` varchar(90) NOT NULL COMMENT '银行名',\n  `bill_type` tinyint(1) NOT NULL COMMENT '消费类型：1、手机银行支付，2、支取，3、转账等',\n  `bill` float(10,2) NOT NULL COMMENT '消费金额',\n  `balance` float(10,2) NOT NULL COMMENT '余额',\n  `created_time` int(10) NOT NULL COMMENT '创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '修改时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8 COMMENT='消费详情表';\n</font></pre>\n\n\n2.**消费记录详情SQL**\n\n得到指定月份的用户消费详情\n提供各卡片当月消费金额\n<pre><font size=2>SELECT user_id, bankcard_id,bill_time,cons_type,bill FROM consume_details\nWHERE  MONTH(bill_time) == \"%s\" AND user_id = \"%s\"</font></pre>\n\n<font color=red size=2>待定：短信去重</font>\n\n\n### 二.我在旅途\n1.**数据来源：里程卡，酒店卡**\n\n<font color=red size=2>待定：</font>\n\n    2.里程卡中可能无法得到飞行次数数据。\n    3.里程数可能无法涵盖所有公司。\n    4.酒店卡数据来源？？\n\n5.抵达城市算法，只用手机GPS位置   \n\n### 三.人脉动态\n1.新增名片数，新增好友数\n从数据库中获取新增名片数，新增好友数\n\n新增好友数计算：contact_card(is_friend,from_uid,created_time)。从该表中按创建时间分组后取好友uid最早的记录，看是否落入统计区间。\n\n2.被关注人数\n来自谁看过我的消费结果\ncontact_card_see_me_source(未去重）\n统计自然月的关注过用户的人数\n\n3.参加会议时间 \n\nhttp://192.168.30.191/example/orange_schedule.txt\n日程相关说明\n\n    oradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n\n4.关注公司\n\n    oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n    与DM库中公司表关联得到参与人公司,统计公司前三位。如有参与人公司排名相同的情况，取名片更新时间最新的公司。\n\n\n### 四.卡片统计\n日志中获取卡片展示超过5秒的所有卡片，每找到一对展示开始时间超过5秒的记录，认为是一次使用，记入DM库\n<pre><font size=2>CREATE TABLE `card_used_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `card_id` char(32) DEFAULT '' COMMENT '卡片id',\n  `daily_used_count` int(10) DEFAULT '' COMMENT '卡片当日使用次数',\n  `card_type` char(32) DEFAULT '' COMMENT '卡片类型',\n  `used_time` datetime COMMENT '卡片使用时间',\n  `batch_time` datetime DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='卡片使用次数表'</font></pre>\n\n展示结果为按日别、卡别、用户统计使用次数\n各类卡使用占比则先分组\n常用卡列表来自于hive\n### 附录\n月报json存储格式\n<pre><font size=2>{\n    \"consume\": {\n        \"totle\": 58097.86,\n        \"bank\": [\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 1234567898765,\n                \"amount\": 300.23\n            },\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 9876543212345,\n                \"amount\": 451.8\n            },\n            {\n                \"bank_name\": \"工商银行\",\n                \"card_num\": 66436743634424,\n                \"amount\": 670.83\n            },\n            {\n                \"bank_name\": \"建设银行\",\n                \"card_num\": 63762343254654,\n                \"amount\": 1270.31\n            }\n        ]\n    },\n    \"travel\": {\n        \"flight\": 28,\n        \"mileage\": 10867,\n        \"stay\": 15,\n        \"city\": \"北京、东京、纽约、斯德哥尔摩\"\n    },\n    \"connection\": {\n        \"meeting_hour\": 28,\n        \"meeting_people\": 15,\n        \"new_friend\": 98,\n        \"new_card\": 887,\n        \"followed\": 185,\n        \"follow_comp\": \"苹果、google、三星\"\n    },\n    \"card\": {\n        \"category\": [\n            {\n                \"type\": \"行程卡\",\n                \"freq\": 90\n            },\n            {\n                \"type\": \"名片\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"酒店卡\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"系统卡\",\n                \"freq\": 10\n            },\n            {\n                \"type\": \"other\",\n                \"freq\": 100\n            }\n        ],\n        \"recent_use\": \"33829923329,53829923329,9829923380\"\n    }\n}\n\n** 此处的 other是取使用在4次以上，并不在前4位的卡片，非卡片类型的其它卡片\n</font></pre> \n\n","slug":"monthlyReport","published":1,"updated":"2018-07-13T11:06:08.778Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognar000u3a9dn9noob34","content":"<h2 id=\"月报各项目计算（初版）\"><a href=\"#月报各项目计算（初版）\" class=\"headerlink\" title=\"月报各项目计算（初版）\"></a>月报各项目计算（初版）</h2><h3 id=\"一-消费记录\"><a href=\"#一-消费记录\" class=\"headerlink\" title=\"一.消费记录\"></a>一.消费记录</h3><p>1.<strong>数据来源：月报表</strong></p>\n<pre><font size=\"2\">CREATE TABLE `orange_monthly_report` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户ID',\n  `content` text NOT NULL COMMENT '月报内容',\n  `created_time` int(10) NOT NULL COMMENT '月报创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '处理时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COMMENT='月报数据表';\n\n\nCREATE TABLE `orange_consume_detail` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` char(42) NOT NULL COMMENT '用户id',\n  `card_id` char(32) NOT NULL COMMENT '卡片id',\n  `bankcard_id` char(32) NOT NULL COMMENT '银行卡号',\n  `bank_name` varchar(90) NOT NULL COMMENT '银行名',\n  `bill_type` tinyint(1) NOT NULL COMMENT '消费类型：1、手机银行支付，2、支取，3、转账等',\n  `bill` float(10,2) NOT NULL COMMENT '消费金额',\n  `balance` float(10,2) NOT NULL COMMENT '余额',\n  `created_time` int(10) NOT NULL COMMENT '创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '修改时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8 COMMENT='消费详情表';\n</font></pre>\n\n\n<p>2.<strong>消费记录详情SQL</strong></p>\n<p>得到指定月份的用户消费详情<br>提供各卡片当月消费金额</p>\n<pre><font size=\"2\">SELECT user_id, bankcard_id,bill_time,cons_type,bill FROM consume_details\nWHERE  MONTH(bill_time) == \"%s\" AND user_id = \"%s\"</font></pre>\n\n<font color=\"red\" size=\"2\">待定：短信去重</font>\n\n\n<h3 id=\"二-我在旅途\"><a href=\"#二-我在旅途\" class=\"headerlink\" title=\"二.我在旅途\"></a>二.我在旅途</h3><p>1.<strong>数据来源：里程卡，酒店卡</strong></p>\n<font color=\"red\" size=\"2\">待定：</font>\n\n<pre><code>2.里程卡中可能无法得到飞行次数数据。\n3.里程数可能无法涵盖所有公司。\n4.酒店卡数据来源？？\n</code></pre><p>5.抵达城市算法，只用手机GPS位置   </p>\n<h3 id=\"三-人脉动态\"><a href=\"#三-人脉动态\" class=\"headerlink\" title=\"三.人脉动态\"></a>三.人脉动态</h3><p>1.新增名片数，新增好友数<br>从数据库中获取新增名片数，新增好友数</p>\n<p>新增好友数计算：contact_card(is_friend,from_uid,created_time)。从该表中按创建时间分组后取好友uid最早的记录，看是否落入统计区间。</p>\n<p>2.被关注人数<br>来自谁看过我的消费结果<br>contact_card_see_me_source(未去重）<br>统计自然月的关注过用户的人数</p>\n<p>3.参加会议时间 </p>\n<p><a href=\"http://192.168.30.191/example/orange_schedule.txt\" target=\"_blank\" rel=\"noopener\">http://192.168.30.191/example/orange_schedule.txt</a><br>日程相关说明</p>\n<pre><code>oradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n</code></pre><p>4.关注公司</p>\n<pre><code>oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n与DM库中公司表关联得到参与人公司,统计公司前三位。如有参与人公司排名相同的情况，取名片更新时间最新的公司。\n</code></pre><h3 id=\"四-卡片统计\"><a href=\"#四-卡片统计\" class=\"headerlink\" title=\"四.卡片统计\"></a>四.卡片统计</h3><p>日志中获取卡片展示超过5秒的所有卡片，每找到一对展示开始时间超过5秒的记录，认为是一次使用，记入DM库</p>\n<pre><font size=\"2\">CREATE TABLE `card_used_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `card_id` char(32) DEFAULT '' COMMENT '卡片id',\n  `daily_used_count` int(10) DEFAULT '' COMMENT '卡片当日使用次数',\n  `card_type` char(32) DEFAULT '' COMMENT '卡片类型',\n  `used_time` datetime COMMENT '卡片使用时间',\n  `batch_time` datetime DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='卡片使用次数表'</font></pre>\n\n<p>展示结果为按日别、卡别、用户统计使用次数<br>各类卡使用占比则先分组<br>常用卡列表来自于hive</p>\n<h3 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h3><p>月报json存储格式</p>\n<pre><font size=\"2\">{\n    \"consume\": {\n        \"totle\": 58097.86,\n        \"bank\": [\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 1234567898765,\n                \"amount\": 300.23\n            },\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 9876543212345,\n                \"amount\": 451.8\n            },\n            {\n                \"bank_name\": \"工商银行\",\n                \"card_num\": 66436743634424,\n                \"amount\": 670.83\n            },\n            {\n                \"bank_name\": \"建设银行\",\n                \"card_num\": 63762343254654,\n                \"amount\": 1270.31\n            }\n        ]\n    },\n    \"travel\": {\n        \"flight\": 28,\n        \"mileage\": 10867,\n        \"stay\": 15,\n        \"city\": \"北京、东京、纽约、斯德哥尔摩\"\n    },\n    \"connection\": {\n        \"meeting_hour\": 28,\n        \"meeting_people\": 15,\n        \"new_friend\": 98,\n        \"new_card\": 887,\n        \"followed\": 185,\n        \"follow_comp\": \"苹果、google、三星\"\n    },\n    \"card\": {\n        \"category\": [\n            {\n                \"type\": \"行程卡\",\n                \"freq\": 90\n            },\n            {\n                \"type\": \"名片\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"酒店卡\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"系统卡\",\n                \"freq\": 10\n            },\n            {\n                \"type\": \"other\",\n                \"freq\": 100\n            }\n        ],\n        \"recent_use\": \"33829923329,53829923329,9829923380\"\n    }\n}\n\n** 此处的 other是取使用在4次以上，并不在前4位的卡片，非卡片类型的其它卡片\n</font></pre> \n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"月报各项目计算（初版）\"><a href=\"#月报各项目计算（初版）\" class=\"headerlink\" title=\"月报各项目计算（初版）\"></a>月报各项目计算（初版）</h2><h3 id=\"一-消费记录\"><a href=\"#一-消费记录\" class=\"headerlink\" title=\"一.消费记录\"></a>一.消费记录</h3><p>1.<strong>数据来源：月报表</strong></p>\n<pre><font size=\"2\">CREATE TABLE `orange_monthly_report` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(42) NOT NULL COMMENT '用户ID',\n  `content` text NOT NULL COMMENT '月报内容',\n  `created_time` int(10) NOT NULL COMMENT '月报创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '处理时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COMMENT='月报数据表';\n\n\nCREATE TABLE `orange_consume_detail` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `user_id` char(42) NOT NULL COMMENT '用户id',\n  `card_id` char(32) NOT NULL COMMENT '卡片id',\n  `bankcard_id` char(32) NOT NULL COMMENT '银行卡号',\n  `bank_name` varchar(90) NOT NULL COMMENT '银行名',\n  `bill_type` tinyint(1) NOT NULL COMMENT '消费类型：1、手机银行支付，2、支取，3、转账等',\n  `bill` float(10,2) NOT NULL COMMENT '消费金额',\n  `balance` float(10,2) NOT NULL COMMENT '余额',\n  `created_time` int(10) NOT NULL COMMENT '创建时间',\n  `modify_time` int(10) NOT NULL COMMENT '修改时间',\n  `report_month` varchar(6) NOT NULL COMMENT '月报生成年月',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8 COMMENT='消费详情表';\n</font></pre>\n\n\n<p>2.<strong>消费记录详情SQL</strong></p>\n<p>得到指定月份的用户消费详情<br>提供各卡片当月消费金额</p>\n<pre><font size=\"2\">SELECT user_id, bankcard_id,bill_time,cons_type,bill FROM consume_details\nWHERE  MONTH(bill_time) == \"%s\" AND user_id = \"%s\"</font></pre>\n\n<font color=\"red\" size=\"2\">待定：短信去重</font>\n\n\n<h3 id=\"二-我在旅途\"><a href=\"#二-我在旅途\" class=\"headerlink\" title=\"二.我在旅途\"></a>二.我在旅途</h3><p>1.<strong>数据来源：里程卡，酒店卡</strong></p>\n<font color=\"red\" size=\"2\">待定：</font>\n\n<pre><code>2.里程卡中可能无法得到飞行次数数据。\n3.里程数可能无法涵盖所有公司。\n4.酒店卡数据来源？？\n</code></pre><p>5.抵达城市算法，只用手机GPS位置   </p>\n<h3 id=\"三-人脉动态\"><a href=\"#三-人脉动态\" class=\"headerlink\" title=\"三.人脉动态\"></a>三.人脉动态</h3><p>1.新增名片数，新增好友数<br>从数据库中获取新增名片数，新增好友数</p>\n<p>新增好友数计算：contact_card(is_friend,from_uid,created_time)。从该表中按创建时间分组后取好友uid最早的记录，看是否落入统计区间。</p>\n<p>2.被关注人数<br>来自谁看过我的消费结果<br>contact_card_see_me_source(未去重）<br>统计自然月的关注过用户的人数</p>\n<p>3.参加会议时间 </p>\n<p><a href=\"http://192.168.30.191/example/orange_schedule.txt\" target=\"_blank\" rel=\"noopener\">http://192.168.30.191/example/orange_schedule.txt</a><br>日程相关说明</p>\n<pre><code>oradt_cloud1520.contact_card_schedule 取会议开始结束时间；\n</code></pre><p>4.关注公司</p>\n<pre><code>oradt_cloud1520.contact_card_schedule_map 取uuid，即参与人；    \n与DM库中公司表关联得到参与人公司,统计公司前三位。如有参与人公司排名相同的情况，取名片更新时间最新的公司。\n</code></pre><h3 id=\"四-卡片统计\"><a href=\"#四-卡片统计\" class=\"headerlink\" title=\"四.卡片统计\"></a>四.卡片统计</h3><p>日志中获取卡片展示超过5秒的所有卡片，每找到一对展示开始时间超过5秒的记录，认为是一次使用，记入DM库</p>\n<pre><font size=\"2\">CREATE TABLE `card_used_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `card_id` char(32) DEFAULT '' COMMENT '卡片id',\n  `daily_used_count` int(10) DEFAULT '' COMMENT '卡片当日使用次数',\n  `card_type` char(32) DEFAULT '' COMMENT '卡片类型',\n  `used_time` datetime COMMENT '卡片使用时间',\n  `batch_time` datetime DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='卡片使用次数表'</font></pre>\n\n<p>展示结果为按日别、卡别、用户统计使用次数<br>各类卡使用占比则先分组<br>常用卡列表来自于hive</p>\n<h3 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h3><p>月报json存储格式</p>\n<pre><font size=\"2\">{\n    \"consume\": {\n        \"totle\": 58097.86,\n        \"bank\": [\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 1234567898765,\n                \"amount\": 300.23\n            },\n            {\n                \"bank_name\": \"招商银行\",\n                \"card_num\": 9876543212345,\n                \"amount\": 451.8\n            },\n            {\n                \"bank_name\": \"工商银行\",\n                \"card_num\": 66436743634424,\n                \"amount\": 670.83\n            },\n            {\n                \"bank_name\": \"建设银行\",\n                \"card_num\": 63762343254654,\n                \"amount\": 1270.31\n            }\n        ]\n    },\n    \"travel\": {\n        \"flight\": 28,\n        \"mileage\": 10867,\n        \"stay\": 15,\n        \"city\": \"北京、东京、纽约、斯德哥尔摩\"\n    },\n    \"connection\": {\n        \"meeting_hour\": 28,\n        \"meeting_people\": 15,\n        \"new_friend\": 98,\n        \"new_card\": 887,\n        \"followed\": 185,\n        \"follow_comp\": \"苹果、google、三星\"\n    },\n    \"card\": {\n        \"category\": [\n            {\n                \"type\": \"行程卡\",\n                \"freq\": 90\n            },\n            {\n                \"type\": \"名片\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"酒店卡\",\n                \"freq\": 50\n            },\n            {\n                \"type\": \"系统卡\",\n                \"freq\": 10\n            },\n            {\n                \"type\": \"other\",\n                \"freq\": 100\n            }\n        ],\n        \"recent_use\": \"33829923329,53829923329,9829923380\"\n    }\n}\n\n** 此处的 other是取使用在4次以上，并不在前4位的卡片，非卡片类型的其它卡片\n</font></pre> \n\n"},{"title":"COMPILE and INSTALL Opencv-python on Centos6.5","date":"2016-06-23T06:27:19.000Z","_content":"<Excerpt in index | 首页摘要>\nCompile and Install Opencv-python, with **Extra** modules.\n<!-- more -->\n\nFor Ubuntu: Click [Here](http://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html)\n\n######  User: root\n## System Preparation\n  - Install Dependencies\n  ```\n  yum install gcc cmake git gtk2-devel libdc1394-devel \\\n  libv41-devel pkgconfig ffmpeg-devel gstreamer-plugins-base-devel \\\n  libpng-devel libjpeg-turbo-devel jasper-devel openexr-devel \\\n  libtiff-devel libwebp-devel tbb-devel eigen3-devel -y\n```\n\n## Install Anaconda\n  1. Download `Anaconda.<version>.sh` from [ANACONDA Offical Site](https://www.continuum.io/downloads)\n  2. Install Anaconda\n    - `bash Anaconda.<version>.sh`\n      - ** PREFIX=/usr/local/anaconda **\n  3. Set PATH: `export PATH=/usr/local/anaconda/bin:$PATH`\n\n## COMPILE and INSTALL opencv-python\n[Opencv Offical Tutorial](http://docs.opencv.org/3.1.0/dd/dd5/tutorial_py_setup_in_fedora.html)\n  1. Download opencv src to `/usr/local/src/opencv`\n    - `cd /usr/local/src`\n    - `git clone https://github.com/Itseez/opencv.git`\n  2. Download opencv_contrib to `/usr/local/src/opencv_contrib`\n    - `cd /usr/local/src`\n    - `git clone https://github.com/Itseez/opencv_contrib`\n  3. make directory for compile\n    - `mkdir build`\n    - `cd build`\n  4. Compile opencv\n    - Configuring\n    ```\n      cmake -D CMAKE_BUILD_TYPE=RELEASE \\\n      -D OPENCV_EXTRA_MODULES_PATH=/usr/local/src/opencv_contrib/modules \\\n      -D CMAKE_INSTALL_PREFIX=/usr/local \\\n      -D PYTHON_INCLUDE_DIR=/usr/local/anaconda/include/python2.7/ \\\n      -D PYTHON_LIBRARY=/usr/local/anaconda/lib/libpython2.7.so \\\n      -DPYTHON2_PACKAGES_PATH=/usr/local/anaconda/lib/python2.7/site-packages \\\n      -DBUILD_SHARED_LIBS=OFF \\\n      -D BUILD_DOCS=ON \\\n      -D BUILD_TESTS=OFF \\\n      -D BUILD_PERF_TESTS=OFF \\\n      -D BUILD_EXAMPLES=OFF ..\n      ```\n    - Optional Flags\n      - `-D BUILD_opencv_python3=OFF`\n\n  5. Installing\n    - `make && make install`\n  6. Check if `cv2.so` is in Python packages directory\n    - `ls /usr/local/anaconda/lib/python2.7/site-packages/cv2.so`\n    - If no `cv2.so` there, copy from PYTHON_PACKAGES_PATH:\n      - `cp /usr/local/lib/python2.7/site-packages/cv2.so /usr/local/anaconda/lib/python2.7/site-packages`\n  7. Validate opencv-python\n    - `python -c \"import cv2; print cv2.__version__\"`\n","source":"_posts/opencv_installation.md","raw":"---\ntitle: COMPILE and INSTALL Opencv-python on Centos6.5\ndate: 2016-06-23 14:27:19\ntags:\n    - opencv\n    - anaconda\n---\n<Excerpt in index | 首页摘要>\nCompile and Install Opencv-python, with **Extra** modules.\n<!-- more -->\n\nFor Ubuntu: Click [Here](http://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html)\n\n######  User: root\n## System Preparation\n  - Install Dependencies\n  ```\n  yum install gcc cmake git gtk2-devel libdc1394-devel \\\n  libv41-devel pkgconfig ffmpeg-devel gstreamer-plugins-base-devel \\\n  libpng-devel libjpeg-turbo-devel jasper-devel openexr-devel \\\n  libtiff-devel libwebp-devel tbb-devel eigen3-devel -y\n```\n\n## Install Anaconda\n  1. Download `Anaconda.<version>.sh` from [ANACONDA Offical Site](https://www.continuum.io/downloads)\n  2. Install Anaconda\n    - `bash Anaconda.<version>.sh`\n      - ** PREFIX=/usr/local/anaconda **\n  3. Set PATH: `export PATH=/usr/local/anaconda/bin:$PATH`\n\n## COMPILE and INSTALL opencv-python\n[Opencv Offical Tutorial](http://docs.opencv.org/3.1.0/dd/dd5/tutorial_py_setup_in_fedora.html)\n  1. Download opencv src to `/usr/local/src/opencv`\n    - `cd /usr/local/src`\n    - `git clone https://github.com/Itseez/opencv.git`\n  2. Download opencv_contrib to `/usr/local/src/opencv_contrib`\n    - `cd /usr/local/src`\n    - `git clone https://github.com/Itseez/opencv_contrib`\n  3. make directory for compile\n    - `mkdir build`\n    - `cd build`\n  4. Compile opencv\n    - Configuring\n    ```\n      cmake -D CMAKE_BUILD_TYPE=RELEASE \\\n      -D OPENCV_EXTRA_MODULES_PATH=/usr/local/src/opencv_contrib/modules \\\n      -D CMAKE_INSTALL_PREFIX=/usr/local \\\n      -D PYTHON_INCLUDE_DIR=/usr/local/anaconda/include/python2.7/ \\\n      -D PYTHON_LIBRARY=/usr/local/anaconda/lib/libpython2.7.so \\\n      -DPYTHON2_PACKAGES_PATH=/usr/local/anaconda/lib/python2.7/site-packages \\\n      -DBUILD_SHARED_LIBS=OFF \\\n      -D BUILD_DOCS=ON \\\n      -D BUILD_TESTS=OFF \\\n      -D BUILD_PERF_TESTS=OFF \\\n      -D BUILD_EXAMPLES=OFF ..\n      ```\n    - Optional Flags\n      - `-D BUILD_opencv_python3=OFF`\n\n  5. Installing\n    - `make && make install`\n  6. Check if `cv2.so` is in Python packages directory\n    - `ls /usr/local/anaconda/lib/python2.7/site-packages/cv2.so`\n    - If no `cv2.so` there, copy from PYTHON_PACKAGES_PATH:\n      - `cp /usr/local/lib/python2.7/site-packages/cv2.so /usr/local/anaconda/lib/python2.7/site-packages`\n  7. Validate opencv-python\n    - `python -c \"import cv2; print cv2.__version__\"`\n","slug":"opencv_installation","published":1,"updated":"2018-07-13T11:06:08.786Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognat000w3a9dl4bof8yx","content":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>Compile and Install Opencv-python, with <strong>Extra</strong> modules.<br><a id=\"more\"></a></excerpt></p>\n<p>For Ubuntu: Click <a href=\"http://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html\" target=\"_blank\" rel=\"noopener\">Here</a></p>\n<h6 id=\"User-root\"><a href=\"#User-root\" class=\"headerlink\" title=\"User: root\"></a>User: root</h6><h2 id=\"System-Preparation\"><a href=\"#System-Preparation\" class=\"headerlink\" title=\"System Preparation\"></a>System Preparation</h2><ul>\n<li>Install Dependencies<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc cmake git gtk2-devel libdc1394-devel \\</span><br><span class=\"line\">libv41-devel pkgconfig ffmpeg-devel gstreamer-plugins-base-devel \\</span><br><span class=\"line\">libpng-devel libjpeg-turbo-devel jasper-devel openexr-devel \\</span><br><span class=\"line\">libtiff-devel libwebp-devel tbb-devel eigen3-devel -y</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"Install-Anaconda\"><a href=\"#Install-Anaconda\" class=\"headerlink\" title=\"Install Anaconda\"></a>Install Anaconda</h2><ol>\n<li>Download <code>Anaconda.&lt;version&gt;.sh</code> from <a href=\"https://www.continuum.io/downloads\" target=\"_blank\" rel=\"noopener\">ANACONDA Offical Site</a></li>\n<li>Install Anaconda<ul>\n<li><code>bash Anaconda.&lt;version&gt;.sh</code><ul>\n<li><strong> PREFIX=/usr/local/anaconda </strong></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Set PATH: <code>export PATH=/usr/local/anaconda/bin:$PATH</code></li>\n</ol>\n<h2 id=\"COMPILE-and-INSTALL-opencv-python\"><a href=\"#COMPILE-and-INSTALL-opencv-python\" class=\"headerlink\" title=\"COMPILE and INSTALL opencv-python\"></a>COMPILE and INSTALL opencv-python</h2><p><a href=\"http://docs.opencv.org/3.1.0/dd/dd5/tutorial_py_setup_in_fedora.html\" target=\"_blank\" rel=\"noopener\">Opencv Offical Tutorial</a></p>\n<ol>\n<li>Download opencv src to <code>/usr/local/src/opencv</code><ul>\n<li><code>cd /usr/local/src</code></li>\n<li><code>git clone https://github.com/Itseez/opencv.git</code></li>\n</ul>\n</li>\n<li>Download opencv_contrib to <code>/usr/local/src/opencv_contrib</code><ul>\n<li><code>cd /usr/local/src</code></li>\n<li><code>git clone https://github.com/Itseez/opencv_contrib</code></li>\n</ul>\n</li>\n<li>make directory for compile<ul>\n<li><code>mkdir build</code></li>\n<li><code>cd build</code></li>\n</ul>\n</li>\n<li><p>Compile opencv</p>\n<ul>\n<li><p>Configuring</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -D CMAKE_BUILD_TYPE=RELEASE \\</span><br><span class=\"line\">-D OPENCV_EXTRA_MODULES_PATH=/usr/local/src/opencv_contrib/modules \\</span><br><span class=\"line\">-D CMAKE_INSTALL_PREFIX=/usr/local \\</span><br><span class=\"line\">-D PYTHON_INCLUDE_DIR=/usr/local/anaconda/include/python2.7/ \\</span><br><span class=\"line\">-D PYTHON_LIBRARY=/usr/local/anaconda/lib/libpython2.7.so \\</span><br><span class=\"line\">-DPYTHON2_PACKAGES_PATH=/usr/local/anaconda/lib/python2.7/site-packages \\</span><br><span class=\"line\">-DBUILD_SHARED_LIBS=OFF \\</span><br><span class=\"line\">-D BUILD_DOCS=ON \\</span><br><span class=\"line\">-D BUILD_TESTS=OFF \\</span><br><span class=\"line\">-D BUILD_PERF_TESTS=OFF \\</span><br><span class=\"line\">-D BUILD_EXAMPLES=OFF ..</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Optional Flags</p>\n<ul>\n<li><code>-D BUILD_opencv_python3=OFF</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Installing</p>\n<ul>\n<li><code>make &amp;&amp; make install</code></li>\n</ul>\n</li>\n<li>Check if <code>cv2.so</code> is in Python packages directory<ul>\n<li><code>ls /usr/local/anaconda/lib/python2.7/site-packages/cv2.so</code></li>\n<li>If no <code>cv2.so</code> there, copy from PYTHON_PACKAGES_PATH:<ul>\n<li><code>cp /usr/local/lib/python2.7/site-packages/cv2.so /usr/local/anaconda/lib/python2.7/site-packages</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Validate opencv-python<ul>\n<li><code>python -c &quot;import cv2; print cv2.__version__&quot;</code></li>\n</ul>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><excerpt in=\"\" index=\"\" |=\"\" 首页摘要=\"\"><br>Compile and Install Opencv-python, with <strong>Extra</strong> modules.<br>","more":"</excerpt></p>\n<p>For Ubuntu: Click <a href=\"http://docs.opencv.org/master/d7/d9f/tutorial_linux_install.html\" target=\"_blank\" rel=\"noopener\">Here</a></p>\n<h6 id=\"User-root\"><a href=\"#User-root\" class=\"headerlink\" title=\"User: root\"></a>User: root</h6><h2 id=\"System-Preparation\"><a href=\"#System-Preparation\" class=\"headerlink\" title=\"System Preparation\"></a>System Preparation</h2><ul>\n<li>Install Dependencies<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc cmake git gtk2-devel libdc1394-devel \\</span><br><span class=\"line\">libv41-devel pkgconfig ffmpeg-devel gstreamer-plugins-base-devel \\</span><br><span class=\"line\">libpng-devel libjpeg-turbo-devel jasper-devel openexr-devel \\</span><br><span class=\"line\">libtiff-devel libwebp-devel tbb-devel eigen3-devel -y</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"Install-Anaconda\"><a href=\"#Install-Anaconda\" class=\"headerlink\" title=\"Install Anaconda\"></a>Install Anaconda</h2><ol>\n<li>Download <code>Anaconda.&lt;version&gt;.sh</code> from <a href=\"https://www.continuum.io/downloads\" target=\"_blank\" rel=\"noopener\">ANACONDA Offical Site</a></li>\n<li>Install Anaconda<ul>\n<li><code>bash Anaconda.&lt;version&gt;.sh</code><ul>\n<li><strong> PREFIX=/usr/local/anaconda </strong></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Set PATH: <code>export PATH=/usr/local/anaconda/bin:$PATH</code></li>\n</ol>\n<h2 id=\"COMPILE-and-INSTALL-opencv-python\"><a href=\"#COMPILE-and-INSTALL-opencv-python\" class=\"headerlink\" title=\"COMPILE and INSTALL opencv-python\"></a>COMPILE and INSTALL opencv-python</h2><p><a href=\"http://docs.opencv.org/3.1.0/dd/dd5/tutorial_py_setup_in_fedora.html\" target=\"_blank\" rel=\"noopener\">Opencv Offical Tutorial</a></p>\n<ol>\n<li>Download opencv src to <code>/usr/local/src/opencv</code><ul>\n<li><code>cd /usr/local/src</code></li>\n<li><code>git clone https://github.com/Itseez/opencv.git</code></li>\n</ul>\n</li>\n<li>Download opencv_contrib to <code>/usr/local/src/opencv_contrib</code><ul>\n<li><code>cd /usr/local/src</code></li>\n<li><code>git clone https://github.com/Itseez/opencv_contrib</code></li>\n</ul>\n</li>\n<li>make directory for compile<ul>\n<li><code>mkdir build</code></li>\n<li><code>cd build</code></li>\n</ul>\n</li>\n<li><p>Compile opencv</p>\n<ul>\n<li><p>Configuring</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -D CMAKE_BUILD_TYPE=RELEASE \\</span><br><span class=\"line\">-D OPENCV_EXTRA_MODULES_PATH=/usr/local/src/opencv_contrib/modules \\</span><br><span class=\"line\">-D CMAKE_INSTALL_PREFIX=/usr/local \\</span><br><span class=\"line\">-D PYTHON_INCLUDE_DIR=/usr/local/anaconda/include/python2.7/ \\</span><br><span class=\"line\">-D PYTHON_LIBRARY=/usr/local/anaconda/lib/libpython2.7.so \\</span><br><span class=\"line\">-DPYTHON2_PACKAGES_PATH=/usr/local/anaconda/lib/python2.7/site-packages \\</span><br><span class=\"line\">-DBUILD_SHARED_LIBS=OFF \\</span><br><span class=\"line\">-D BUILD_DOCS=ON \\</span><br><span class=\"line\">-D BUILD_TESTS=OFF \\</span><br><span class=\"line\">-D BUILD_PERF_TESTS=OFF \\</span><br><span class=\"line\">-D BUILD_EXAMPLES=OFF ..</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Optional Flags</p>\n<ul>\n<li><code>-D BUILD_opencv_python3=OFF</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Installing</p>\n<ul>\n<li><code>make &amp;&amp; make install</code></li>\n</ul>\n</li>\n<li>Check if <code>cv2.so</code> is in Python packages directory<ul>\n<li><code>ls /usr/local/anaconda/lib/python2.7/site-packages/cv2.so</code></li>\n<li>If no <code>cv2.so</code> there, copy from PYTHON_PACKAGES_PATH:<ul>\n<li><code>cp /usr/local/lib/python2.7/site-packages/cv2.so /usr/local/anaconda/lib/python2.7/site-packages</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Validate opencv-python<ul>\n<li><code>python -c &quot;import cv2; print cv2.__version__&quot;</code></li>\n</ul>\n</li>\n</ol>"},{"title":"名片信息拓展系统","date":"2017-04-28T02:14:01.000Z","_content":"## 名片信息拓展系统\n\n\n### 一.业务整体流程\n\n名片信息拓展系统主要包括两大任务：一.从json格式的数据源提取所需要字段，入dm库供数据挖掘等使用。二.在基础信息上进行拓展，以获得更丰富的数据。\n\n现用到的json字段有：姓名，手机，公司名，公司电话，职位\n拓展字段：手机→城市，公司名→行业，公司电话→城市，职位+行业→职能\n\n1.**数据来源：**\n可能涉及到如下数据表\n\n* 名片基本信息，json格式\noradt_cloud_test2.contact_card\noradt_cloud_test2.contact_card_extend\n* 手机、座机区号\ndm_test.province_city_unique_code\n* 行业职能对照表\noradt_cloud_test2.account_basic_category\n\n2.**整体处理流程**\n本系统的处理流程如下图：\n![](http://i4.buimg.com/4851/24a68975106791ab.png)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/step.png\n\n* 对应到代码，整体的入口为jobsAssigner，主要用来通过命令行参数实现运行每日任务，还是只计算给定区间的数据任务，将时间区间传给makeResultTables。\n* makeResultTables则查询不同数据源，拼合计算所需的数据格式，处理完毕后再拼合入库所需的数据格式，并执行入等库操作。\n* 其中makeResultTables会调用jsonPreprocess，jsonPreprocess主要任务为接受从makeResultTables所传递的时间区间，取出该区间中json数据的结果，拼合为后续信息拓展流程所需的数据格式。\n\n\n\n###  二.功能模块说明\n主要功能模块的包结构如下图：\n![](http://i1.piimg.com/4851/4d54fb562381507a.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/pakages.png\n\n信息拓展的各个模块，结构类似，输入数据格式为pandas.Dataframe，通过prepare()方法转换格式后，传递给transform()方法进行计算。\n\n\n### 三.项目部署\n\n* 当前每日任务部署于： 101.251.193.28:/home/mqian/3366\n由crontab每天凌晨3点执行(3388的暂时弃用)\n```\n#每天凌晨3点整执行，名片数据解析\n#0 3 * * *  /usr/local/bin/python /home/mqian/3388/jobsAssigner.py -d 2>> /home/mqian/3388/log3388\n0 3 * * *  /usr/local/bin/python /home/mqian/3366/jobsAssigner.py -d 2>> /home/mqian/3366/log3366\n```\n* git位置\nhttp://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git\n","source":"_posts/namecard_extra.md","raw":"---\ntitle: 名片信息拓展系统\ndate: 2017-04-28 10:14:01\ntags:\n    - 名片\n    - 基础信息\n\ncategories: IMORA\n---\n## 名片信息拓展系统\n\n\n### 一.业务整体流程\n\n名片信息拓展系统主要包括两大任务：一.从json格式的数据源提取所需要字段，入dm库供数据挖掘等使用。二.在基础信息上进行拓展，以获得更丰富的数据。\n\n现用到的json字段有：姓名，手机，公司名，公司电话，职位\n拓展字段：手机→城市，公司名→行业，公司电话→城市，职位+行业→职能\n\n1.**数据来源：**\n可能涉及到如下数据表\n\n* 名片基本信息，json格式\noradt_cloud_test2.contact_card\noradt_cloud_test2.contact_card_extend\n* 手机、座机区号\ndm_test.province_city_unique_code\n* 行业职能对照表\noradt_cloud_test2.account_basic_category\n\n2.**整体处理流程**\n本系统的处理流程如下图：\n![](http://i4.buimg.com/4851/24a68975106791ab.png)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/step.png\n\n* 对应到代码，整体的入口为jobsAssigner，主要用来通过命令行参数实现运行每日任务，还是只计算给定区间的数据任务，将时间区间传给makeResultTables。\n* makeResultTables则查询不同数据源，拼合计算所需的数据格式，处理完毕后再拼合入库所需的数据格式，并执行入等库操作。\n* 其中makeResultTables会调用jsonPreprocess，jsonPreprocess主要任务为接受从makeResultTables所传递的时间区间，取出该区间中json数据的结果，拼合为后续信息拓展流程所需的数据格式。\n\n\n\n###  二.功能模块说明\n主要功能模块的包结构如下图：\n![](http://i1.piimg.com/4851/4d54fb562381507a.jpg)\n图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/pakages.png\n\n信息拓展的各个模块，结构类似，输入数据格式为pandas.Dataframe，通过prepare()方法转换格式后，传递给transform()方法进行计算。\n\n\n### 三.项目部署\n\n* 当前每日任务部署于： 101.251.193.28:/home/mqian/3366\n由crontab每天凌晨3点执行(3388的暂时弃用)\n```\n#每天凌晨3点整执行，名片数据解析\n#0 3 * * *  /usr/local/bin/python /home/mqian/3388/jobsAssigner.py -d 2>> /home/mqian/3388/log3388\n0 3 * * *  /usr/local/bin/python /home/mqian/3366/jobsAssigner.py -d 2>> /home/mqian/3366/log3366\n```\n* git位置\nhttp://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git\n","slug":"namecard_extra","published":1,"updated":"2018-07-13T11:06:08.782Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognav000z3a9dy765k8vl","content":"<h2 id=\"名片信息拓展系统\"><a href=\"#名片信息拓展系统\" class=\"headerlink\" title=\"名片信息拓展系统\"></a>名片信息拓展系统</h2><h3 id=\"一-业务整体流程\"><a href=\"#一-业务整体流程\" class=\"headerlink\" title=\"一.业务整体流程\"></a>一.业务整体流程</h3><p>名片信息拓展系统主要包括两大任务：一.从json格式的数据源提取所需要字段，入dm库供数据挖掘等使用。二.在基础信息上进行拓展，以获得更丰富的数据。</p>\n<p>现用到的json字段有：姓名，手机，公司名，公司电话，职位<br>拓展字段：手机→城市，公司名→行业，公司电话→城市，职位+行业→职能</p>\n<p>1.<strong>数据来源：</strong><br>可能涉及到如下数据表</p>\n<ul>\n<li>名片基本信息，json格式<br>oradt_cloud_test2.contact_card<br>oradt_cloud_test2.contact_card_extend</li>\n<li>手机、座机区号<br>dm_test.province_city_unique_code</li>\n<li>行业职能对照表<br>oradt_cloud_test2.account_basic_category</li>\n</ul>\n<p>2.<strong>整体处理流程</strong><br>本系统的处理流程如下图：<br><img src=\"http://i4.buimg.com/4851/24a68975106791ab.png\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/step.png</p>\n<ul>\n<li>对应到代码，整体的入口为jobsAssigner，主要用来通过命令行参数实现运行每日任务，还是只计算给定区间的数据任务，将时间区间传给makeResultTables。</li>\n<li>makeResultTables则查询不同数据源，拼合计算所需的数据格式，处理完毕后再拼合入库所需的数据格式，并执行入等库操作。</li>\n<li>其中makeResultTables会调用jsonPreprocess，jsonPreprocess主要任务为接受从makeResultTables所传递的时间区间，取出该区间中json数据的结果，拼合为后续信息拓展流程所需的数据格式。</li>\n</ul>\n<h3 id=\"二-功能模块说明\"><a href=\"#二-功能模块说明\" class=\"headerlink\" title=\"二.功能模块说明\"></a>二.功能模块说明</h3><p>主要功能模块的包结构如下图：<br><img src=\"http://i1.piimg.com/4851/4d54fb562381507a.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/pakages.png</p>\n<p>信息拓展的各个模块，结构类似，输入数据格式为pandas.Dataframe，通过prepare()方法转换格式后，传递给transform()方法进行计算。</p>\n<h3 id=\"三-项目部署\"><a href=\"#三-项目部署\" class=\"headerlink\" title=\"三.项目部署\"></a>三.项目部署</h3><ul>\n<li><p>当前每日任务部署于： 101.251.193.28:/home/mqian/3366<br>由crontab每天凌晨3点执行(3388的暂时弃用)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#每天凌晨3点整执行，名片数据解析</span><br><span class=\"line\">#0 3 * * *  /usr/local/bin/python /home/mqian/3388/jobsAssigner.py -d 2&gt;&gt; /home/mqian/3388/log3388</span><br><span class=\"line\">0 3 * * *  /usr/local/bin/python /home/mqian/3366/jobsAssigner.py -d 2&gt;&gt; /home/mqian/3366/log3366</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>git位置<br><a href=\"http://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git</a></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"名片信息拓展系统\"><a href=\"#名片信息拓展系统\" class=\"headerlink\" title=\"名片信息拓展系统\"></a>名片信息拓展系统</h2><h3 id=\"一-业务整体流程\"><a href=\"#一-业务整体流程\" class=\"headerlink\" title=\"一.业务整体流程\"></a>一.业务整体流程</h3><p>名片信息拓展系统主要包括两大任务：一.从json格式的数据源提取所需要字段，入dm库供数据挖掘等使用。二.在基础信息上进行拓展，以获得更丰富的数据。</p>\n<p>现用到的json字段有：姓名，手机，公司名，公司电话，职位<br>拓展字段：手机→城市，公司名→行业，公司电话→城市，职位+行业→职能</p>\n<p>1.<strong>数据来源：</strong><br>可能涉及到如下数据表</p>\n<ul>\n<li>名片基本信息，json格式<br>oradt_cloud_test2.contact_card<br>oradt_cloud_test2.contact_card_extend</li>\n<li>手机、座机区号<br>dm_test.province_city_unique_code</li>\n<li>行业职能对照表<br>oradt_cloud_test2.account_basic_category</li>\n</ul>\n<p>2.<strong>整体处理流程</strong><br>本系统的处理流程如下图：<br><img src=\"http://i4.buimg.com/4851/24a68975106791ab.png\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/step.png</p>\n<ul>\n<li>对应到代码，整体的入口为jobsAssigner，主要用来通过命令行参数实现运行每日任务，还是只计算给定区间的数据任务，将时间区间传给makeResultTables。</li>\n<li>makeResultTables则查询不同数据源，拼合计算所需的数据格式，处理完毕后再拼合入库所需的数据格式，并执行入等库操作。</li>\n<li>其中makeResultTables会调用jsonPreprocess，jsonPreprocess主要任务为接受从makeResultTables所传递的时间区间，取出该区间中json数据的结果，拼合为后续信息拓展流程所需的数据格式。</li>\n</ul>\n<h3 id=\"二-功能模块说明\"><a href=\"#二-功能模块说明\" class=\"headerlink\" title=\"二.功能模块说明\"></a>二.功能模块说明</h3><p>主要功能模块的包结构如下图：<br><img src=\"http://i1.piimg.com/4851/4d54fb562381507a.jpg\" alt=\"\"><br>图片备份位置：/home/samba/share/mengqian/handover/名片信息拓展/pakages.png</p>\n<p>信息拓展的各个模块，结构类似，输入数据格式为pandas.Dataframe，通过prepare()方法转换格式后，传递给transform()方法进行计算。</p>\n<h3 id=\"三-项目部署\"><a href=\"#三-项目部署\" class=\"headerlink\" title=\"三.项目部署\"></a>三.项目部署</h3><ul>\n<li><p>当前每日任务部署于： 101.251.193.28:/home/mqian/3366<br>由crontab每天凌晨3点执行(3388的暂时弃用)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#每天凌晨3点整执行，名片数据解析</span><br><span class=\"line\">#0 3 * * *  /usr/local/bin/python /home/mqian/3388/jobsAssigner.py -d 2&gt;&gt; /home/mqian/3388/log3388</span><br><span class=\"line\">0 3 * * *  /usr/local/bin/python /home/mqian/3366/jobsAssigner.py -d 2&gt;&gt; /home/mqian/3366/log3366</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>git位置<br><a href=\"http://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git\" target=\"_blank\" rel=\"noopener\">http://192.168.30.251:10086/git/mengqian/namecard_info_extra_basic.git</a></p>\n</li>\n</ul>\n"},{"title":"如何在hexo中支持Mathjax","date":"2018-07-16T10:11:51.000Z","_content":"### 第一步： 使用Kramed代替 Marked\nhexo 默认的渲染引擎是 marked，但是 marked 不支持 mathjax。 kramed 是在 marked 的基础上进行修改。我们在工程目录下执行以下命令来安装 kramed.\n```\nnpm uninstall hexo-renderer-marked --save\nnpm install hexo-renderer-kramed --save\n```\n\n然后，更改/node_modules/hexo-renderer-kramed/lib/renderer.js，更改\n```\n// Change inline math rule\nfunction formatText(text) {\n    // Fit kramed's rule: $$ + \\1 + $$\n    return text.replace(/`\\$(.*?)\\$`/g, '$$$$$1$$$$');\n}\n```\n为\n```\n// Change inline math rule\nfunction formatText(text) {\n    return text;\n}\n```\n\n### 第二步: 停止使用 hexo-math\n首先，如果你已经安装 hexo-math, 请卸载它,然后安装 hexo-renderer-mathjax 包\n```\nnpm uninstall hexo-math --save\nnpm install hexo-renderer-mathjax --save\n```\n### 第三步: 更改默认转义规则\n因为 hexo 默认的转义规则会将一些字符进行转义，比如 _ 转为 <em>, 所以我们需要对默认的规则进行修改. \n```\nvi node_modules/kramed/lib/rules/nline.js\n```\n```\n// 替换11行\nescape: /^\\\\([\\\\`*{}\\[\\]()#$+\\-.!_>])/,\n//修改为\nescape: /^\\\\([`*\\[\\]()# +\\-.!_>])/,\n\n//替换20行\nem: /^\\b_((?:__|[\\s\\S])+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n//修改为\nem: /^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n```\n### 第四步: 开启mathjax\n\n```\nvi themes/next/_config.yml\n```\n开启 mathjax功能\n```\nmathjax:\n  enable: true\n  perpage: false\n  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n```\n并在博客中使用mathjax\n```\n---\ntitle: Testing Mathjax with Hexo\ncategory: Uncategorized\ndate: 2017/05/03\nmathjax: true\n---\n```\n","source":"_posts/如何在hexo中支持Mathjax.md","raw":"---\ntitle: 如何在hexo中支持Mathjax\ndate: 2018-07-16 18:11:51\ntags:\n    - Hexo\n    - Mathjax\ncategories: Hexo\n---\n### 第一步： 使用Kramed代替 Marked\nhexo 默认的渲染引擎是 marked，但是 marked 不支持 mathjax。 kramed 是在 marked 的基础上进行修改。我们在工程目录下执行以下命令来安装 kramed.\n```\nnpm uninstall hexo-renderer-marked --save\nnpm install hexo-renderer-kramed --save\n```\n\n然后，更改/node_modules/hexo-renderer-kramed/lib/renderer.js，更改\n```\n// Change inline math rule\nfunction formatText(text) {\n    // Fit kramed's rule: $$ + \\1 + $$\n    return text.replace(/`\\$(.*?)\\$`/g, '$$$$$1$$$$');\n}\n```\n为\n```\n// Change inline math rule\nfunction formatText(text) {\n    return text;\n}\n```\n\n### 第二步: 停止使用 hexo-math\n首先，如果你已经安装 hexo-math, 请卸载它,然后安装 hexo-renderer-mathjax 包\n```\nnpm uninstall hexo-math --save\nnpm install hexo-renderer-mathjax --save\n```\n### 第三步: 更改默认转义规则\n因为 hexo 默认的转义规则会将一些字符进行转义，比如 _ 转为 <em>, 所以我们需要对默认的规则进行修改. \n```\nvi node_modules/kramed/lib/rules/nline.js\n```\n```\n// 替换11行\nescape: /^\\\\([\\\\`*{}\\[\\]()#$+\\-.!_>])/,\n//修改为\nescape: /^\\\\([`*\\[\\]()# +\\-.!_>])/,\n\n//替换20行\nem: /^\\b_((?:__|[\\s\\S])+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n//修改为\nem: /^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n```\n### 第四步: 开启mathjax\n\n```\nvi themes/next/_config.yml\n```\n开启 mathjax功能\n```\nmathjax:\n  enable: true\n  perpage: false\n  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n```\n并在博客中使用mathjax\n```\n---\ntitle: Testing Mathjax with Hexo\ncategory: Uncategorized\ndate: 2017/05/03\nmathjax: true\n---\n```\n","slug":"如何在hexo中支持Mathjax","published":1,"updated":"2018-07-16T10:17:28.636Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxognax00113a9dl5dp8k9i","content":"<h3 id=\"第一步：-使用Kramed代替-Marked\"><a href=\"#第一步：-使用Kramed代替-Marked\" class=\"headerlink\" title=\"第一步： 使用Kramed代替 Marked\"></a>第一步： 使用Kramed代替 Marked</h3><p>hexo 默认的渲染引擎是 marked，但是 marked 不支持 mathjax。 kramed 是在 marked 的基础上进行修改。我们在工程目录下执行以下命令来安装 kramed.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall hexo-renderer-marked --save</span><br><span class=\"line\">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure></p>\n<p>然后，更改/node_modules/hexo-renderer-kramed/lib/renderer.js，更改<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Change inline math rule</span><br><span class=\"line\">function formatText(text) &#123;</span><br><span class=\"line\">    // Fit kramed&apos;s rule: $$ + \\1 + $$</span><br><span class=\"line\">    return text.replace(/`\\$(.*?)\\$`/g, &apos;$$$$$1$$$$&apos;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Change inline math rule</span><br><span class=\"line\">function formatText(text) &#123;</span><br><span class=\"line\">    return text;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"第二步-停止使用-hexo-math\"><a href=\"#第二步-停止使用-hexo-math\" class=\"headerlink\" title=\"第二步: 停止使用 hexo-math\"></a>第二步: 停止使用 hexo-math</h3><p>首先，如果你已经安装 hexo-math, 请卸载它,然后安装 hexo-renderer-mathjax 包<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall hexo-math --save</span><br><span class=\"line\">npm install hexo-renderer-mathjax --save</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"第三步-更改默认转义规则\"><a href=\"#第三步-更改默认转义规则\" class=\"headerlink\" title=\"第三步: 更改默认转义规则\"></a>第三步: 更改默认转义规则</h3><p>因为 hexo 默认的转义规则会将一些字符进行转义，比如 _ 转为 <em>, 所以我们需要对默认的规则进行修改.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi node_modules/kramed/lib/rules/nline.js</span><br></pre></td></tr></table></figure></em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 替换11行</span><br><span class=\"line\">escape: /^\\\\([\\\\`*&#123;&#125;\\[\\]()#$+\\-.!_&gt;])/,</span><br><span class=\"line\">//修改为</span><br><span class=\"line\">escape: /^\\\\([`*\\[\\]()# +\\-.!_&gt;])/,</span><br><span class=\"line\"></span><br><span class=\"line\">//替换20行</span><br><span class=\"line\">em: /^\\b_((?:__|[\\s\\S])+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br><span class=\"line\">//修改为</span><br><span class=\"line\">em: /^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br></pre></td></tr></table></figure>\n<h3 id=\"第四步-开启mathjax\"><a href=\"#第四步-开启mathjax\" class=\"headerlink\" title=\"第四步: 开启mathjax\"></a>第四步: 开启mathjax</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi themes/next/_config.yml</span><br></pre></td></tr></table></figure>\n<p>开启 mathjax功能<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mathjax:</span><br><span class=\"line\">  enable: true</span><br><span class=\"line\">  perpage: false</span><br><span class=\"line\">  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span><br></pre></td></tr></table></figure></p>\n<p>并在博客中使用mathjax<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Testing Mathjax with Hexo</span><br><span class=\"line\">category: Uncategorized</span><br><span class=\"line\">date: 2017/05/03</span><br><span class=\"line\">mathjax: true</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"第一步：-使用Kramed代替-Marked\"><a href=\"#第一步：-使用Kramed代替-Marked\" class=\"headerlink\" title=\"第一步： 使用Kramed代替 Marked\"></a>第一步： 使用Kramed代替 Marked</h3><p>hexo 默认的渲染引擎是 marked，但是 marked 不支持 mathjax。 kramed 是在 marked 的基础上进行修改。我们在工程目录下执行以下命令来安装 kramed.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall hexo-renderer-marked --save</span><br><span class=\"line\">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure></p>\n<p>然后，更改/node_modules/hexo-renderer-kramed/lib/renderer.js，更改<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Change inline math rule</span><br><span class=\"line\">function formatText(text) &#123;</span><br><span class=\"line\">    // Fit kramed&apos;s rule: $$ + \\1 + $$</span><br><span class=\"line\">    return text.replace(/`\\$(.*?)\\$`/g, &apos;$$$$$1$$$$&apos;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Change inline math rule</span><br><span class=\"line\">function formatText(text) &#123;</span><br><span class=\"line\">    return text;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"第二步-停止使用-hexo-math\"><a href=\"#第二步-停止使用-hexo-math\" class=\"headerlink\" title=\"第二步: 停止使用 hexo-math\"></a>第二步: 停止使用 hexo-math</h3><p>首先，如果你已经安装 hexo-math, 请卸载它,然后安装 hexo-renderer-mathjax 包<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall hexo-math --save</span><br><span class=\"line\">npm install hexo-renderer-mathjax --save</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"第三步-更改默认转义规则\"><a href=\"#第三步-更改默认转义规则\" class=\"headerlink\" title=\"第三步: 更改默认转义规则\"></a>第三步: 更改默认转义规则</h3><p>因为 hexo 默认的转义规则会将一些字符进行转义，比如 _ 转为 <em>, 所以我们需要对默认的规则进行修改.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi node_modules/kramed/lib/rules/nline.js</span><br></pre></td></tr></table></figure></em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 替换11行</span><br><span class=\"line\">escape: /^\\\\([\\\\`*&#123;&#125;\\[\\]()#$+\\-.!_&gt;])/,</span><br><span class=\"line\">//修改为</span><br><span class=\"line\">escape: /^\\\\([`*\\[\\]()# +\\-.!_&gt;])/,</span><br><span class=\"line\"></span><br><span class=\"line\">//替换20行</span><br><span class=\"line\">em: /^\\b_((?:__|[\\s\\S])+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br><span class=\"line\">//修改为</span><br><span class=\"line\">em: /^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br></pre></td></tr></table></figure>\n<h3 id=\"第四步-开启mathjax\"><a href=\"#第四步-开启mathjax\" class=\"headerlink\" title=\"第四步: 开启mathjax\"></a>第四步: 开启mathjax</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi themes/next/_config.yml</span><br></pre></td></tr></table></figure>\n<p>开启 mathjax功能<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mathjax:</span><br><span class=\"line\">  enable: true</span><br><span class=\"line\">  perpage: false</span><br><span class=\"line\">  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span><br></pre></td></tr></table></figure></p>\n<p>并在博客中使用mathjax<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Testing Mathjax with Hexo</span><br><span class=\"line\">category: Uncategorized</span><br><span class=\"line\">date: 2017/05/03</span><br><span class=\"line\">mathjax: true</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure></p>\n"},{"title":"Hive入门讲解","date":"2017-02-10T10:00:00.000Z","_content":"# Hive入门讲解\nHive定位：ETL（数据仓库）工具\n\n将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的工具,如像：kettle\t\n\n## DML\n\n**批量插入/批量导入**\n```\nLOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]\n注：filepath可以是hdfs路径或者是S3路径，如hdfs://namenode:9000/user/hive/project/data1\n```\n```\n1.从本地文件导入到表\nload data local inpath 'test.txt' into table test;\n```\n```\n2.从hdfs导入到表\nload data inpath '/home/test/add.txt' into table test;\n```\n```\n3.从表查询中导入到表\ninsert into table test select id, name, tel from test;\n```\n```\n4.将查询数据导入到多个表\nfrom source_table\ninsert into table test select id, name, tel from dest1_table select src.* where src.id < 100\ninsert into table test select id, name, tel from dest2_table select src.* where src.id < 100\ninsert into table test select id, name, tel from dest3_table select src.* where src.id < 100;\n```\n```\n5.建表时导入\ncreate table test4 as select id, name, tel from test;\n```\n\n**指定分隔符导出数据**\n\n```\ninsert overwrite local directory '/home/hadoop/export_hive' \nrow format delimited \nfields terminated by '\\t' \nselect * from test;\n```\n\n**删除/清空**\n\n```\n1.删除table1中不符合条件的数据\ninsert overwrite table table1 \nselect * from table1 where XXXX;\n```\n```\n2.清空表\ninsert overwrite table t_table1 \nselect * from t_table1 where 1=0;\n```\n```\n3.截断表（注：不能截断外部表）\ntruncate table table_name;\n```\n```\n4.删除hdfs对应的表数据达到清空表（表结构依然存在）\nhdfs dfs -rmr /user/hive/warehouse/test\n\n注：1和2本质是覆写表来实现清除数据\n```\n\n**delete 与 update**\n\n在hive中默认不支持事务，因此默认不支持delete与update，如果需要支持必须在hive-site.xml中配置打开\n\n## DDL\n\n库/表/索引/视图/分区/分桶\n\n#### 数据库\n\n列出/创建/修改/删除/查看信息\n\n```\n1.列出所有数据库\nshow databases;\n```\n```\n2.创建数据库\ncreate database test;\n```\n```\n3.删除\ndrop database test;\n\n处于安全原因，直接drop有数据的数据库会报错，此时需要cascade关键字忽略报错删除\ndrop database if exists test cascade;\n```\n```\n4.查看数据库信息\ndescribe database test;\n\n```\n\n#### 表\n列出/创建/修改/删除/查看信息\n```\n1.列出所有表\n\n当前数据库的所有表\nshow tables;\n\n指定数据库的所有表\nshow tables in db_name;\n\n支持正则\nshow tables '.*s';\n```\n```\n2.创建表\ncreate table test\n(id int,\na string\n)\nROW FORMAT DELIMITED        行分割\nFIELDS TERMINATED BY ‘,’    字段分隔符\nLINES TERMINATED BY ‘\\n’    行分隔符\nSTORED AS TEXTFILE;         作为文本存储\n\n```\n```\n创建基于正则切分行字段的表\nadd jar ../build/contrib/hive_contrib.jar;\n\nCREATE TABLE apachelog (\nhost STRING,\nidentity STRING,\nuser STRING,\ntime STRING,\nrequest STRING,\nstatus STRING,\nsize STRING,\nreferer STRING,\nagent STRING)\nROW FORMAT SERDE 'org.apache.hadoop.hive.contrib.serde2.RegexSerDe'\nWITH SERDEPROPERTIES (\n\"input.regex\" = \"([^ ]*) ([^ ]*) ([^ ]*) (-|//[[^//]]*//]) ([^ /\"]*|/\"[^/\"]*/\") (-|[0-9]*) (-|[0-9]*)(?: ([^ /\"]*|/\"[^/\"]*/\") ([^ /\"]*|/\"[^/\"]*/\"))?\",\n\"output.format.string\" = \"%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s\"\n)\nSTORED AS TEXTFILE;\n```\n```\n3.修改\n加一个新列\nALTER TABLE test ADD COLUMNS (new_col2 INT COMMENT 'a comment');\n\n改表名\nALTER TABLE old_name RENAME TO new_name;\n\n```\n```\n4.删除\ndrop table test;\n```\n```\n5.查看信息\n\n显示列信息\ndesc test;\n\n显示详细表信息\ndesc formatted test;\n\n```\n#### 索引\n\n```\n创建索引\nCREATE INDEX index_name   \nON TABLE base_table_name (col_name, ...)  \nAS 'index.handler.class.name'\n\n如：DROP INDEX index_name ON table_name  \n\n重建索引\nALTER INDEX index_name ON table_name [PARTITION (...)] REBUILD  \n\n如：alter index index1_index_test on index_test rebuild; \n\n删除索引\nDROP INDEX index_name ON table_name  \n\n列出索引\nshow index on index_test; \n```\n\n#### 视图\n```\nCREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENT column_comment], ...) ][COMMENT view_comment][TBLPROPERTIES (property_name = property_value, ...)] AS SELECT\n\n注：hive只支持逻辑视图，不支持物化视图\n•增加视图\n•如果没有提供表名，视图列的名字将由定义的SELECT表达式自动生成\n•如果修改基本表的属性，视图中不会体现，无效查询将会失败\n•视图是只读的，不能用LOAD/INSERT/ALTER\n•删除视图  DROP VIEW view_name\n\n```\n\n\n#### 分区（重点）\n列出/创建/修改/删除\n\n```\n1.列出一个表的所有分区\nshow  partitions test;\n```\n```\n2.创建分区表\ncreate table test\n(id int,\na string,\n)\npartitioned by (b string,c int) \nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ‘,’ \nLINES TERMINATED BY ‘\\n’ \nSTORED AS TEXTFILE;\n```\n```\n3.对现有表添加分区\nALTER TABLE test ADD IF NOT EXISTS\nPARTITION (year = 2017) LOCATION ‘/hiveuser/hive/warehouse/data_zh.db/data_zh/2017.txt’;\n```\n```\n4.删除分区\nALTER TABLE test DROP IF EXISTS PARTITION(year =2017);\n```\n```\n5.加载数据到分区表\nLOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year=2017);\n```\n```\n6.未分区表数据导入分区表\ninsert overwrite table part_table partition (YEAR,MONTH) select * from no_part_table;\n```\n```\n7.动态分区指令\nset hive.exec.dynamic.partition=true;\nset hive.exec.dynamic.partition.mode=nonstrict;\n#set hive.enforce.bucketing = true;\n\n开启动态分区后导入数据时可以省略指定分区的步骤\nLOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year);\n```\n\n#### 分桶\n```\nCREATE TABLE bucketed_user (id INT) name STRING)\nCLUSTERED BY (id) INTO 4 BUCKETS;\n```\n对于每一个表（table）或者分区， Hive可以进一步组织成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是 针对某一列进行桶的组织。Hive采用对列值哈希，然后除以桶的个数求余的方式决定该条记录存放在哪个桶当中。\n\n把表（或者分区）组织成桶（Bucket）有两个理由：\n\n（1）获得更高的查询处理效率。桶为表加上了额外的结构，Hive 在处理有些查询时能利用这个结构。具体而言，连接两个在（包含连接列的）相同列上划分了桶的表，可以使用 Map 端连接 （Map-side join）高效的实现。比如JOIN操作。对于JOIN操作两个表有一个相同的列，如果对这两个表都进行了桶操作。那么将保存相同列值的桶进行JOIN操作就可以，可以大大较少JOIN的数据量。\n\n（2）使取样（sampling）更高效。在处理大规模数据集时，在开发和修改查询的阶段，如果能在数据集的一小部分数据上试运行查询，会带来很多方便。\n\n\n## DQL\n\n```\nhive中的order by、distribute by、sort by和cluster by\n\norder by \n全局排序，只有一个Reduce任务\n\nsort by \n只做jubu排序\n\ndistribute by \n用distribute by 会对指定的字段按照hashCode值对reduce的个数取模，然后将任务分配到对应的reduce中去执行\n\ncluster by \ndistribute by 和 sort by 合用就相当于cluster by，但是cluster by 不能指定排序为asc或 desc 的规则，只能是desc倒序排列\n\n注：distribute by 和 sort by,distribute by 必须在 sort by前面\n```\n```\n表连接\n1.join只支持等值连接\n\n2.可以 join 多于 2 个表\nSELECT a.val, b.val, c.val FROM a JOIN b \n    ON (a.key = b.key1) JOIN c ON (c.key = b.key2)\n注:如果join中多个表的 join key 是同一个，则 join 会被转化为单个 map/reduce 任务\n\n3.LEFT，RIGHT和FULL OUTER\nSELECT a.val, b.val FROM a LEFT OUTER JOIN b ON (a.key=b.key)\n\n如果 d 表中找不到对应 c 表的记录，d 表的所有列都会列出 NULL，包括 ds 列。也就是说，join 会过滤 d 表中不能找到匹配 c 表 join key 的所有记录。这样的话，LEFT OUTER 就使得查询结果与 WHERE 子句无关\n\n•解决办法\n　　SELECT c.val, d.val FROM c LEFT OUTER JOIN d \n     ON (c.key=d.key AND d.ds='2009-07-07' AND c.ds='2009-07-07')\n     \n4.LEFT SEMI JOIN\nLEFT SEMI JOIN 的限制是， JOIN 子句中右边的表只能在 ON 子句中设置过滤条件，在 WHERE 子句、SELECT 子句或其他地方过滤都不行\n\nSELECT a.key, a.value \n  FROM a \n  WHERE a.key in \n   (SELECT b.key \n    FROM B);\n\n可以被重写为：\n\nSELECT a.key, a.val \n   FROM a LEFT SEMI JOIN b on (a.key = b.key)\n   \n5.UNION ALL\n用来合并多个select的查询结果，需要保证select中字段须一致\n　　select_statement UNION ALL select_statement UNION ALL select_statement ...\n```\n```\n分析窗口函数\nover (partition by * order by d desc)\n```\n例子：[Hive分析窗口函数(一) SUM,AVG,MIN,MAX](//www.tuicool.com/articles/zuiIVbZ)\n```\n其他\n1.不支持EXIST ,NOT EXIST\n\n2.Top N 关键字 为Limit\n\n3.支持正则筛选字段，如SELECT `(ds|hr)?+.+` FROM test\n```\n\n\n## DCL\n权限\n\n```\nGrant/revoke语法：\ngrant/revoke priv_type[column_list] on object_type object to/from principal_type principal_name\n\n查看grant 定义：\nshow grant user user_name on table table_name;\n\n\n创建/删除角色：\nCreate/drop Role role_name\n\n角色分配/回收：\nGrant role role_name to user user_name\nRevoke role role_name from user user_name\n\n角色授权：\nGrant/revoke priv_type[col_List] on object_type object from/to role role_name\n\n查看role定义：\nshow role grant role role_name\n\n相关hive元信息表：\nDb_privs:记录了User/Role在DB上的权限\nTbl_privs:记录了User/Role在table上的权限\nTbl_col_privs：记录了User/Role在table column上的权限\nRoles：记录了全部创建的role\nRole_map：记录了User与Role的相应关系\n```\n\n## Hive函数\nUDF、UDAF和UDTF\n\nUDF实现输入一行输出一行行的函数\n\nUDAF实现输入多行输出一行的函数\n\nUDTF实现输入一行输出多行的函数\n\n自定义UDF、UDAF和UDTF\n\n## 相关资料\nhive2.0函数大全\nhttp://www.cnblogs.com/MOBIN/p/5618747.html\n\n## Mysql数据导入Hive\n\n通过sqoop把mysql数据导入到hive(若hive没对应表则自动建表)\n```\n./bin/sqoop import --connect jdbc:mysql://172.17.4.1:3306/poi --username lizt  --table poi_amap --hive-import --password 123456\n```\n## python 客户端\n\n[pyhs2](https://github.com/BradRuderman/pyhs2)\n```\npip install pyhs2\n```\n","source":"_posts/Hive2.md","raw":"---\ntitle: Hive入门讲解\ndate: 2017-02-10 18:00:00\ntags:\n    - etl tool\ncategories: Hive\n---\n# Hive入门讲解\nHive定位：ETL（数据仓库）工具\n\n将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的工具,如像：kettle\t\n\n## DML\n\n**批量插入/批量导入**\n```\nLOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]\n注：filepath可以是hdfs路径或者是S3路径，如hdfs://namenode:9000/user/hive/project/data1\n```\n```\n1.从本地文件导入到表\nload data local inpath 'test.txt' into table test;\n```\n```\n2.从hdfs导入到表\nload data inpath '/home/test/add.txt' into table test;\n```\n```\n3.从表查询中导入到表\ninsert into table test select id, name, tel from test;\n```\n```\n4.将查询数据导入到多个表\nfrom source_table\ninsert into table test select id, name, tel from dest1_table select src.* where src.id < 100\ninsert into table test select id, name, tel from dest2_table select src.* where src.id < 100\ninsert into table test select id, name, tel from dest3_table select src.* where src.id < 100;\n```\n```\n5.建表时导入\ncreate table test4 as select id, name, tel from test;\n```\n\n**指定分隔符导出数据**\n\n```\ninsert overwrite local directory '/home/hadoop/export_hive' \nrow format delimited \nfields terminated by '\\t' \nselect * from test;\n```\n\n**删除/清空**\n\n```\n1.删除table1中不符合条件的数据\ninsert overwrite table table1 \nselect * from table1 where XXXX;\n```\n```\n2.清空表\ninsert overwrite table t_table1 \nselect * from t_table1 where 1=0;\n```\n```\n3.截断表（注：不能截断外部表）\ntruncate table table_name;\n```\n```\n4.删除hdfs对应的表数据达到清空表（表结构依然存在）\nhdfs dfs -rmr /user/hive/warehouse/test\n\n注：1和2本质是覆写表来实现清除数据\n```\n\n**delete 与 update**\n\n在hive中默认不支持事务，因此默认不支持delete与update，如果需要支持必须在hive-site.xml中配置打开\n\n## DDL\n\n库/表/索引/视图/分区/分桶\n\n#### 数据库\n\n列出/创建/修改/删除/查看信息\n\n```\n1.列出所有数据库\nshow databases;\n```\n```\n2.创建数据库\ncreate database test;\n```\n```\n3.删除\ndrop database test;\n\n处于安全原因，直接drop有数据的数据库会报错，此时需要cascade关键字忽略报错删除\ndrop database if exists test cascade;\n```\n```\n4.查看数据库信息\ndescribe database test;\n\n```\n\n#### 表\n列出/创建/修改/删除/查看信息\n```\n1.列出所有表\n\n当前数据库的所有表\nshow tables;\n\n指定数据库的所有表\nshow tables in db_name;\n\n支持正则\nshow tables '.*s';\n```\n```\n2.创建表\ncreate table test\n(id int,\na string\n)\nROW FORMAT DELIMITED        行分割\nFIELDS TERMINATED BY ‘,’    字段分隔符\nLINES TERMINATED BY ‘\\n’    行分隔符\nSTORED AS TEXTFILE;         作为文本存储\n\n```\n```\n创建基于正则切分行字段的表\nadd jar ../build/contrib/hive_contrib.jar;\n\nCREATE TABLE apachelog (\nhost STRING,\nidentity STRING,\nuser STRING,\ntime STRING,\nrequest STRING,\nstatus STRING,\nsize STRING,\nreferer STRING,\nagent STRING)\nROW FORMAT SERDE 'org.apache.hadoop.hive.contrib.serde2.RegexSerDe'\nWITH SERDEPROPERTIES (\n\"input.regex\" = \"([^ ]*) ([^ ]*) ([^ ]*) (-|//[[^//]]*//]) ([^ /\"]*|/\"[^/\"]*/\") (-|[0-9]*) (-|[0-9]*)(?: ([^ /\"]*|/\"[^/\"]*/\") ([^ /\"]*|/\"[^/\"]*/\"))?\",\n\"output.format.string\" = \"%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s\"\n)\nSTORED AS TEXTFILE;\n```\n```\n3.修改\n加一个新列\nALTER TABLE test ADD COLUMNS (new_col2 INT COMMENT 'a comment');\n\n改表名\nALTER TABLE old_name RENAME TO new_name;\n\n```\n```\n4.删除\ndrop table test;\n```\n```\n5.查看信息\n\n显示列信息\ndesc test;\n\n显示详细表信息\ndesc formatted test;\n\n```\n#### 索引\n\n```\n创建索引\nCREATE INDEX index_name   \nON TABLE base_table_name (col_name, ...)  \nAS 'index.handler.class.name'\n\n如：DROP INDEX index_name ON table_name  \n\n重建索引\nALTER INDEX index_name ON table_name [PARTITION (...)] REBUILD  \n\n如：alter index index1_index_test on index_test rebuild; \n\n删除索引\nDROP INDEX index_name ON table_name  \n\n列出索引\nshow index on index_test; \n```\n\n#### 视图\n```\nCREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENT column_comment], ...) ][COMMENT view_comment][TBLPROPERTIES (property_name = property_value, ...)] AS SELECT\n\n注：hive只支持逻辑视图，不支持物化视图\n•增加视图\n•如果没有提供表名，视图列的名字将由定义的SELECT表达式自动生成\n•如果修改基本表的属性，视图中不会体现，无效查询将会失败\n•视图是只读的，不能用LOAD/INSERT/ALTER\n•删除视图  DROP VIEW view_name\n\n```\n\n\n#### 分区（重点）\n列出/创建/修改/删除\n\n```\n1.列出一个表的所有分区\nshow  partitions test;\n```\n```\n2.创建分区表\ncreate table test\n(id int,\na string,\n)\npartitioned by (b string,c int) \nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ‘,’ \nLINES TERMINATED BY ‘\\n’ \nSTORED AS TEXTFILE;\n```\n```\n3.对现有表添加分区\nALTER TABLE test ADD IF NOT EXISTS\nPARTITION (year = 2017) LOCATION ‘/hiveuser/hive/warehouse/data_zh.db/data_zh/2017.txt’;\n```\n```\n4.删除分区\nALTER TABLE test DROP IF EXISTS PARTITION(year =2017);\n```\n```\n5.加载数据到分区表\nLOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year=2017);\n```\n```\n6.未分区表数据导入分区表\ninsert overwrite table part_table partition (YEAR,MONTH) select * from no_part_table;\n```\n```\n7.动态分区指令\nset hive.exec.dynamic.partition=true;\nset hive.exec.dynamic.partition.mode=nonstrict;\n#set hive.enforce.bucketing = true;\n\n开启动态分区后导入数据时可以省略指定分区的步骤\nLOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year);\n```\n\n#### 分桶\n```\nCREATE TABLE bucketed_user (id INT) name STRING)\nCLUSTERED BY (id) INTO 4 BUCKETS;\n```\n对于每一个表（table）或者分区， Hive可以进一步组织成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是 针对某一列进行桶的组织。Hive采用对列值哈希，然后除以桶的个数求余的方式决定该条记录存放在哪个桶当中。\n\n把表（或者分区）组织成桶（Bucket）有两个理由：\n\n（1）获得更高的查询处理效率。桶为表加上了额外的结构，Hive 在处理有些查询时能利用这个结构。具体而言，连接两个在（包含连接列的）相同列上划分了桶的表，可以使用 Map 端连接 （Map-side join）高效的实现。比如JOIN操作。对于JOIN操作两个表有一个相同的列，如果对这两个表都进行了桶操作。那么将保存相同列值的桶进行JOIN操作就可以，可以大大较少JOIN的数据量。\n\n（2）使取样（sampling）更高效。在处理大规模数据集时，在开发和修改查询的阶段，如果能在数据集的一小部分数据上试运行查询，会带来很多方便。\n\n\n## DQL\n\n```\nhive中的order by、distribute by、sort by和cluster by\n\norder by \n全局排序，只有一个Reduce任务\n\nsort by \n只做jubu排序\n\ndistribute by \n用distribute by 会对指定的字段按照hashCode值对reduce的个数取模，然后将任务分配到对应的reduce中去执行\n\ncluster by \ndistribute by 和 sort by 合用就相当于cluster by，但是cluster by 不能指定排序为asc或 desc 的规则，只能是desc倒序排列\n\n注：distribute by 和 sort by,distribute by 必须在 sort by前面\n```\n```\n表连接\n1.join只支持等值连接\n\n2.可以 join 多于 2 个表\nSELECT a.val, b.val, c.val FROM a JOIN b \n    ON (a.key = b.key1) JOIN c ON (c.key = b.key2)\n注:如果join中多个表的 join key 是同一个，则 join 会被转化为单个 map/reduce 任务\n\n3.LEFT，RIGHT和FULL OUTER\nSELECT a.val, b.val FROM a LEFT OUTER JOIN b ON (a.key=b.key)\n\n如果 d 表中找不到对应 c 表的记录，d 表的所有列都会列出 NULL，包括 ds 列。也就是说，join 会过滤 d 表中不能找到匹配 c 表 join key 的所有记录。这样的话，LEFT OUTER 就使得查询结果与 WHERE 子句无关\n\n•解决办法\n　　SELECT c.val, d.val FROM c LEFT OUTER JOIN d \n     ON (c.key=d.key AND d.ds='2009-07-07' AND c.ds='2009-07-07')\n     \n4.LEFT SEMI JOIN\nLEFT SEMI JOIN 的限制是， JOIN 子句中右边的表只能在 ON 子句中设置过滤条件，在 WHERE 子句、SELECT 子句或其他地方过滤都不行\n\nSELECT a.key, a.value \n  FROM a \n  WHERE a.key in \n   (SELECT b.key \n    FROM B);\n\n可以被重写为：\n\nSELECT a.key, a.val \n   FROM a LEFT SEMI JOIN b on (a.key = b.key)\n   \n5.UNION ALL\n用来合并多个select的查询结果，需要保证select中字段须一致\n　　select_statement UNION ALL select_statement UNION ALL select_statement ...\n```\n```\n分析窗口函数\nover (partition by * order by d desc)\n```\n例子：[Hive分析窗口函数(一) SUM,AVG,MIN,MAX](//www.tuicool.com/articles/zuiIVbZ)\n```\n其他\n1.不支持EXIST ,NOT EXIST\n\n2.Top N 关键字 为Limit\n\n3.支持正则筛选字段，如SELECT `(ds|hr)?+.+` FROM test\n```\n\n\n## DCL\n权限\n\n```\nGrant/revoke语法：\ngrant/revoke priv_type[column_list] on object_type object to/from principal_type principal_name\n\n查看grant 定义：\nshow grant user user_name on table table_name;\n\n\n创建/删除角色：\nCreate/drop Role role_name\n\n角色分配/回收：\nGrant role role_name to user user_name\nRevoke role role_name from user user_name\n\n角色授权：\nGrant/revoke priv_type[col_List] on object_type object from/to role role_name\n\n查看role定义：\nshow role grant role role_name\n\n相关hive元信息表：\nDb_privs:记录了User/Role在DB上的权限\nTbl_privs:记录了User/Role在table上的权限\nTbl_col_privs：记录了User/Role在table column上的权限\nRoles：记录了全部创建的role\nRole_map：记录了User与Role的相应关系\n```\n\n## Hive函数\nUDF、UDAF和UDTF\n\nUDF实现输入一行输出一行行的函数\n\nUDAF实现输入多行输出一行的函数\n\nUDTF实现输入一行输出多行的函数\n\n自定义UDF、UDAF和UDTF\n\n## 相关资料\nhive2.0函数大全\nhttp://www.cnblogs.com/MOBIN/p/5618747.html\n\n## Mysql数据导入Hive\n\n通过sqoop把mysql数据导入到hive(若hive没对应表则自动建表)\n```\n./bin/sqoop import --connect jdbc:mysql://172.17.4.1:3306/poi --username lizt  --table poi_amap --hive-import --password 123456\n```\n## python 客户端\n\n[pyhs2](https://github.com/BradRuderman/pyhs2)\n```\npip install pyhs2\n```\n","slug":"Hive2","published":1,"updated":"2018-07-13T11:06:08.757Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogndp002p3a9dx7iz4nqu","content":"<h1 id=\"Hive入门讲解\"><a href=\"#Hive入门讲解\" class=\"headerlink\" title=\"Hive入门讲解\"></a>Hive入门讲解</h1><p>Hive定位：ETL（数据仓库）工具</p>\n<p>将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的工具,如像：kettle    </p>\n<h2 id=\"DML\"><a href=\"#DML\" class=\"headerlink\" title=\"DML\"></a>DML</h2><p><strong>批量插入/批量导入</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOAD DATA [LOCAL] INPATH &apos;filepath&apos; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br><span class=\"line\">注：filepath可以是hdfs路径或者是S3路径，如hdfs://namenode:9000/user/hive/project/data1</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.从本地文件导入到表</span><br><span class=\"line\">load data local inpath &apos;test.txt&apos; into table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.从hdfs导入到表</span><br><span class=\"line\">load data inpath &apos;/home/test/add.txt&apos; into table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.从表查询中导入到表</span><br><span class=\"line\">insert into table test select id, name, tel from test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.将查询数据导入到多个表</span><br><span class=\"line\">from source_table</span><br><span class=\"line\">insert into table test select id, name, tel from dest1_table select src.* where src.id &lt; 100</span><br><span class=\"line\">insert into table test select id, name, tel from dest2_table select src.* where src.id &lt; 100</span><br><span class=\"line\">insert into table test select id, name, tel from dest3_table select src.* where src.id &lt; 100;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.建表时导入</span><br><span class=\"line\">create table test4 as select id, name, tel from test;</span><br></pre></td></tr></table></figure>\n<p><strong>指定分隔符导出数据</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">insert overwrite local directory &apos;/home/hadoop/export_hive&apos; </span><br><span class=\"line\">row format delimited </span><br><span class=\"line\">fields terminated by &apos;\\t&apos; </span><br><span class=\"line\">select * from test;</span><br></pre></td></tr></table></figure>\n<p><strong>删除/清空</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.删除table1中不符合条件的数据</span><br><span class=\"line\">insert overwrite table table1 </span><br><span class=\"line\">select * from table1 where XXXX;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.清空表</span><br><span class=\"line\">insert overwrite table t_table1 </span><br><span class=\"line\">select * from t_table1 where 1=0;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.截断表（注：不能截断外部表）</span><br><span class=\"line\">truncate table table_name;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除hdfs对应的表数据达到清空表（表结构依然存在）</span><br><span class=\"line\">hdfs dfs -rmr /user/hive/warehouse/test</span><br><span class=\"line\"></span><br><span class=\"line\">注：1和2本质是覆写表来实现清除数据</span><br></pre></td></tr></table></figure>\n<p><strong>delete 与 update</strong></p>\n<p>在hive中默认不支持事务，因此默认不支持delete与update，如果需要支持必须在hive-site.xml中配置打开</p>\n<h2 id=\"DDL\"><a href=\"#DDL\" class=\"headerlink\" title=\"DDL\"></a>DDL</h2><p>库/表/索引/视图/分区/分桶</p>\n<h4 id=\"数据库\"><a href=\"#数据库\" class=\"headerlink\" title=\"数据库\"></a>数据库</h4><p>列出/创建/修改/删除/查看信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出所有数据库</span><br><span class=\"line\">show databases;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建数据库</span><br><span class=\"line\">create database test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.删除</span><br><span class=\"line\">drop database test;</span><br><span class=\"line\"></span><br><span class=\"line\">处于安全原因，直接drop有数据的数据库会报错，此时需要cascade关键字忽略报错删除</span><br><span class=\"line\">drop database if exists test cascade;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.查看数据库信息</span><br><span class=\"line\">describe database test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"表\"><a href=\"#表\" class=\"headerlink\" title=\"表\"></a>表</h4><p>列出/创建/修改/删除/查看信息<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出所有表</span><br><span class=\"line\"></span><br><span class=\"line\">当前数据库的所有表</span><br><span class=\"line\">show tables;</span><br><span class=\"line\"></span><br><span class=\"line\">指定数据库的所有表</span><br><span class=\"line\">show tables in db_name;</span><br><span class=\"line\"></span><br><span class=\"line\">支持正则</span><br><span class=\"line\">show tables &apos;.*s&apos;;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建表</span><br><span class=\"line\">create table test</span><br><span class=\"line\">(id int,</span><br><span class=\"line\">a string</span><br><span class=\"line\">)</span><br><span class=\"line\">ROW FORMAT DELIMITED        行分割</span><br><span class=\"line\">FIELDS TERMINATED BY ‘,’    字段分隔符</span><br><span class=\"line\">LINES TERMINATED BY ‘\\n’    行分隔符</span><br><span class=\"line\">STORED AS TEXTFILE;         作为文本存储</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建基于正则切分行字段的表</span><br><span class=\"line\">add jar ../build/contrib/hive_contrib.jar;</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE apachelog (</span><br><span class=\"line\">host STRING,</span><br><span class=\"line\">identity STRING,</span><br><span class=\"line\">user STRING,</span><br><span class=\"line\">time STRING,</span><br><span class=\"line\">request STRING,</span><br><span class=\"line\">status STRING,</span><br><span class=\"line\">size STRING,</span><br><span class=\"line\">referer STRING,</span><br><span class=\"line\">agent STRING)</span><br><span class=\"line\">ROW FORMAT SERDE &apos;org.apache.hadoop.hive.contrib.serde2.RegexSerDe&apos;</span><br><span class=\"line\">WITH SERDEPROPERTIES (</span><br><span class=\"line\">&quot;input.regex&quot; = &quot;([^ ]*) ([^ ]*) ([^ ]*) (-|//[[^//]]*//]) ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;) (-|[0-9]*) (-|[0-9]*)(?: ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;) ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;))?&quot;,</span><br><span class=\"line\">&quot;output.format.string&quot; = &quot;%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.修改</span><br><span class=\"line\">加一个新列</span><br><span class=\"line\">ALTER TABLE test ADD COLUMNS (new_col2 INT COMMENT &apos;a comment&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">改表名</span><br><span class=\"line\">ALTER TABLE old_name RENAME TO new_name;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除</span><br><span class=\"line\">drop table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.查看信息</span><br><span class=\"line\"></span><br><span class=\"line\">显示列信息</span><br><span class=\"line\">desc test;</span><br><span class=\"line\"></span><br><span class=\"line\">显示详细表信息</span><br><span class=\"line\">desc formatted test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建索引</span><br><span class=\"line\">CREATE INDEX index_name   </span><br><span class=\"line\">ON TABLE base_table_name (col_name, ...)  </span><br><span class=\"line\">AS &apos;index.handler.class.name&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">如：DROP INDEX index_name ON table_name  </span><br><span class=\"line\"></span><br><span class=\"line\">重建索引</span><br><span class=\"line\">ALTER INDEX index_name ON table_name [PARTITION (...)] REBUILD  </span><br><span class=\"line\"></span><br><span class=\"line\">如：alter index index1_index_test on index_test rebuild; </span><br><span class=\"line\"></span><br><span class=\"line\">删除索引</span><br><span class=\"line\">DROP INDEX index_name ON table_name  </span><br><span class=\"line\"></span><br><span class=\"line\">列出索引</span><br><span class=\"line\">show index on index_test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"视图\"><a href=\"#视图\" class=\"headerlink\" title=\"视图\"></a>视图</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENT column_comment], ...) ][COMMENT view_comment][TBLPROPERTIES (property_name = property_value, ...)] AS SELECT</span><br><span class=\"line\"></span><br><span class=\"line\">注：hive只支持逻辑视图，不支持物化视图</span><br><span class=\"line\">•增加视图</span><br><span class=\"line\">•如果没有提供表名，视图列的名字将由定义的SELECT表达式自动生成</span><br><span class=\"line\">•如果修改基本表的属性，视图中不会体现，无效查询将会失败</span><br><span class=\"line\">•视图是只读的，不能用LOAD/INSERT/ALTER</span><br><span class=\"line\">•删除视图  DROP VIEW view_name</span><br></pre></td></tr></table></figure>\n<h4 id=\"分区（重点）\"><a href=\"#分区（重点）\" class=\"headerlink\" title=\"分区（重点）\"></a>分区（重点）</h4><p>列出/创建/修改/删除</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出一个表的所有分区</span><br><span class=\"line\">show  partitions test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建分区表</span><br><span class=\"line\">create table test</span><br><span class=\"line\">(id int,</span><br><span class=\"line\">a string,</span><br><span class=\"line\">)</span><br><span class=\"line\">partitioned by (b string,c int) </span><br><span class=\"line\">ROW FORMAT DELIMITED</span><br><span class=\"line\">FIELDS TERMINATED BY ‘,’ </span><br><span class=\"line\">LINES TERMINATED BY ‘\\n’ </span><br><span class=\"line\">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.对现有表添加分区</span><br><span class=\"line\">ALTER TABLE test ADD IF NOT EXISTS</span><br><span class=\"line\">PARTITION (year = 2017) LOCATION ‘/hiveuser/hive/warehouse/data_zh.db/data_zh/2017.txt’;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除分区</span><br><span class=\"line\">ALTER TABLE test DROP IF EXISTS PARTITION(year =2017);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.加载数据到分区表</span><br><span class=\"line\">LOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year=2017);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6.未分区表数据导入分区表</span><br><span class=\"line\">insert overwrite table part_table partition (YEAR,MONTH) select * from no_part_table;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">7.动态分区指令</span><br><span class=\"line\">set hive.exec.dynamic.partition=true;</span><br><span class=\"line\">set hive.exec.dynamic.partition.mode=nonstrict;</span><br><span class=\"line\">#set hive.enforce.bucketing = true;</span><br><span class=\"line\"></span><br><span class=\"line\">开启动态分区后导入数据时可以省略指定分区的步骤</span><br><span class=\"line\">LOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year);</span><br></pre></td></tr></table></figure>\n<h4 id=\"分桶\"><a href=\"#分桶\" class=\"headerlink\" title=\"分桶\"></a>分桶</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE bucketed_user (id INT) name STRING)</span><br><span class=\"line\">CLUSTERED BY (id) INTO 4 BUCKETS;</span><br></pre></td></tr></table></figure>\n<p>对于每一个表（table）或者分区， Hive可以进一步组织成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是 针对某一列进行桶的组织。Hive采用对列值哈希，然后除以桶的个数求余的方式决定该条记录存放在哪个桶当中。</p>\n<p>把表（或者分区）组织成桶（Bucket）有两个理由：</p>\n<p>（1）获得更高的查询处理效率。桶为表加上了额外的结构，Hive 在处理有些查询时能利用这个结构。具体而言，连接两个在（包含连接列的）相同列上划分了桶的表，可以使用 Map 端连接 （Map-side join）高效的实现。比如JOIN操作。对于JOIN操作两个表有一个相同的列，如果对这两个表都进行了桶操作。那么将保存相同列值的桶进行JOIN操作就可以，可以大大较少JOIN的数据量。</p>\n<p>（2）使取样（sampling）更高效。在处理大规模数据集时，在开发和修改查询的阶段，如果能在数据集的一小部分数据上试运行查询，会带来很多方便。</p>\n<h2 id=\"DQL\"><a href=\"#DQL\" class=\"headerlink\" title=\"DQL\"></a>DQL</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive中的order by、distribute by、sort by和cluster by</span><br><span class=\"line\"></span><br><span class=\"line\">order by </span><br><span class=\"line\">全局排序，只有一个Reduce任务</span><br><span class=\"line\"></span><br><span class=\"line\">sort by </span><br><span class=\"line\">只做jubu排序</span><br><span class=\"line\"></span><br><span class=\"line\">distribute by </span><br><span class=\"line\">用distribute by 会对指定的字段按照hashCode值对reduce的个数取模，然后将任务分配到对应的reduce中去执行</span><br><span class=\"line\"></span><br><span class=\"line\">cluster by </span><br><span class=\"line\">distribute by 和 sort by 合用就相当于cluster by，但是cluster by 不能指定排序为asc或 desc 的规则，只能是desc倒序排列</span><br><span class=\"line\"></span><br><span class=\"line\">注：distribute by 和 sort by,distribute by 必须在 sort by前面</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表连接</span><br><span class=\"line\">1.join只支持等值连接</span><br><span class=\"line\"></span><br><span class=\"line\">2.可以 join 多于 2 个表</span><br><span class=\"line\">SELECT a.val, b.val, c.val FROM a JOIN b </span><br><span class=\"line\">    ON (a.key = b.key1) JOIN c ON (c.key = b.key2)</span><br><span class=\"line\">注:如果join中多个表的 join key 是同一个，则 join 会被转化为单个 map/reduce 任务</span><br><span class=\"line\"></span><br><span class=\"line\">3.LEFT，RIGHT和FULL OUTER</span><br><span class=\"line\">SELECT a.val, b.val FROM a LEFT OUTER JOIN b ON (a.key=b.key)</span><br><span class=\"line\"></span><br><span class=\"line\">如果 d 表中找不到对应 c 表的记录，d 表的所有列都会列出 NULL，包括 ds 列。也就是说，join 会过滤 d 表中不能找到匹配 c 表 join key 的所有记录。这样的话，LEFT OUTER 就使得查询结果与 WHERE 子句无关</span><br><span class=\"line\"></span><br><span class=\"line\">•解决办法</span><br><span class=\"line\">　　SELECT c.val, d.val FROM c LEFT OUTER JOIN d </span><br><span class=\"line\">     ON (c.key=d.key AND d.ds=&apos;2009-07-07&apos; AND c.ds=&apos;2009-07-07&apos;)</span><br><span class=\"line\">     </span><br><span class=\"line\">4.LEFT SEMI JOIN</span><br><span class=\"line\">LEFT SEMI JOIN 的限制是， JOIN 子句中右边的表只能在 ON 子句中设置过滤条件，在 WHERE 子句、SELECT 子句或其他地方过滤都不行</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT a.key, a.value </span><br><span class=\"line\">  FROM a </span><br><span class=\"line\">  WHERE a.key in </span><br><span class=\"line\">   (SELECT b.key </span><br><span class=\"line\">    FROM B);</span><br><span class=\"line\"></span><br><span class=\"line\">可以被重写为：</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT a.key, a.val </span><br><span class=\"line\">   FROM a LEFT SEMI JOIN b on (a.key = b.key)</span><br><span class=\"line\">   </span><br><span class=\"line\">5.UNION ALL</span><br><span class=\"line\">用来合并多个select的查询结果，需要保证select中字段须一致</span><br><span class=\"line\">　　select_statement UNION ALL select_statement UNION ALL select_statement ...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">分析窗口函数</span><br><span class=\"line\">over (partition by * order by d desc)</span><br></pre></td></tr></table></figure>\n<p>例子：<a href=\"//www.tuicool.com/articles/zuiIVbZ\">Hive分析窗口函数(一) SUM,AVG,MIN,MAX</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其他</span><br><span class=\"line\">1.不支持EXIST ,NOT EXIST</span><br><span class=\"line\"></span><br><span class=\"line\">2.Top N 关键字 为Limit</span><br><span class=\"line\"></span><br><span class=\"line\">3.支持正则筛选字段，如SELECT `(ds|hr)?+.+` FROM test</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"DCL\"><a href=\"#DCL\" class=\"headerlink\" title=\"DCL\"></a>DCL</h2><p>权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Grant/revoke语法：</span><br><span class=\"line\">grant/revoke priv_type[column_list] on object_type object to/from principal_type principal_name</span><br><span class=\"line\"></span><br><span class=\"line\">查看grant 定义：</span><br><span class=\"line\">show grant user user_name on table table_name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">创建/删除角色：</span><br><span class=\"line\">Create/drop Role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">角色分配/回收：</span><br><span class=\"line\">Grant role role_name to user user_name</span><br><span class=\"line\">Revoke role role_name from user user_name</span><br><span class=\"line\"></span><br><span class=\"line\">角色授权：</span><br><span class=\"line\">Grant/revoke priv_type[col_List] on object_type object from/to role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">查看role定义：</span><br><span class=\"line\">show role grant role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">相关hive元信息表：</span><br><span class=\"line\">Db_privs:记录了User/Role在DB上的权限</span><br><span class=\"line\">Tbl_privs:记录了User/Role在table上的权限</span><br><span class=\"line\">Tbl_col_privs：记录了User/Role在table column上的权限</span><br><span class=\"line\">Roles：记录了全部创建的role</span><br><span class=\"line\">Role_map：记录了User与Role的相应关系</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hive函数\"><a href=\"#Hive函数\" class=\"headerlink\" title=\"Hive函数\"></a>Hive函数</h2><p>UDF、UDAF和UDTF</p>\n<p>UDF实现输入一行输出一行行的函数</p>\n<p>UDAF实现输入多行输出一行的函数</p>\n<p>UDTF实现输入一行输出多行的函数</p>\n<p>自定义UDF、UDAF和UDTF</p>\n<h2 id=\"相关资料\"><a href=\"#相关资料\" class=\"headerlink\" title=\"相关资料\"></a>相关资料</h2><p>hive2.0函数大全<br><a href=\"http://www.cnblogs.com/MOBIN/p/5618747.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/MOBIN/p/5618747.html</a></p>\n<h2 id=\"Mysql数据导入Hive\"><a href=\"#Mysql数据导入Hive\" class=\"headerlink\" title=\"Mysql数据导入Hive\"></a>Mysql数据导入Hive</h2><p>通过sqoop把mysql数据导入到hive(若hive没对应表则自动建表)<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/sqoop import --connect jdbc:mysql://172.17.4.1:3306/poi --username lizt  --table poi_amap --hive-import --password 123456</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"python-客户端\"><a href=\"#python-客户端\" class=\"headerlink\" title=\"python 客户端\"></a>python 客户端</h2><p><a href=\"https://github.com/BradRuderman/pyhs2\" target=\"_blank\" rel=\"noopener\">pyhs2</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install pyhs2</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Hive入门讲解\"><a href=\"#Hive入门讲解\" class=\"headerlink\" title=\"Hive入门讲解\"></a>Hive入门讲解</h1><p>Hive定位：ETL（数据仓库）工具</p>\n<p>将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的工具,如像：kettle    </p>\n<h2 id=\"DML\"><a href=\"#DML\" class=\"headerlink\" title=\"DML\"></a>DML</h2><p><strong>批量插入/批量导入</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOAD DATA [LOCAL] INPATH &apos;filepath&apos; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br><span class=\"line\">注：filepath可以是hdfs路径或者是S3路径，如hdfs://namenode:9000/user/hive/project/data1</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.从本地文件导入到表</span><br><span class=\"line\">load data local inpath &apos;test.txt&apos; into table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.从hdfs导入到表</span><br><span class=\"line\">load data inpath &apos;/home/test/add.txt&apos; into table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.从表查询中导入到表</span><br><span class=\"line\">insert into table test select id, name, tel from test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.将查询数据导入到多个表</span><br><span class=\"line\">from source_table</span><br><span class=\"line\">insert into table test select id, name, tel from dest1_table select src.* where src.id &lt; 100</span><br><span class=\"line\">insert into table test select id, name, tel from dest2_table select src.* where src.id &lt; 100</span><br><span class=\"line\">insert into table test select id, name, tel from dest3_table select src.* where src.id &lt; 100;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.建表时导入</span><br><span class=\"line\">create table test4 as select id, name, tel from test;</span><br></pre></td></tr></table></figure>\n<p><strong>指定分隔符导出数据</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">insert overwrite local directory &apos;/home/hadoop/export_hive&apos; </span><br><span class=\"line\">row format delimited </span><br><span class=\"line\">fields terminated by &apos;\\t&apos; </span><br><span class=\"line\">select * from test;</span><br></pre></td></tr></table></figure>\n<p><strong>删除/清空</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.删除table1中不符合条件的数据</span><br><span class=\"line\">insert overwrite table table1 </span><br><span class=\"line\">select * from table1 where XXXX;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.清空表</span><br><span class=\"line\">insert overwrite table t_table1 </span><br><span class=\"line\">select * from t_table1 where 1=0;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.截断表（注：不能截断外部表）</span><br><span class=\"line\">truncate table table_name;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除hdfs对应的表数据达到清空表（表结构依然存在）</span><br><span class=\"line\">hdfs dfs -rmr /user/hive/warehouse/test</span><br><span class=\"line\"></span><br><span class=\"line\">注：1和2本质是覆写表来实现清除数据</span><br></pre></td></tr></table></figure>\n<p><strong>delete 与 update</strong></p>\n<p>在hive中默认不支持事务，因此默认不支持delete与update，如果需要支持必须在hive-site.xml中配置打开</p>\n<h2 id=\"DDL\"><a href=\"#DDL\" class=\"headerlink\" title=\"DDL\"></a>DDL</h2><p>库/表/索引/视图/分区/分桶</p>\n<h4 id=\"数据库\"><a href=\"#数据库\" class=\"headerlink\" title=\"数据库\"></a>数据库</h4><p>列出/创建/修改/删除/查看信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出所有数据库</span><br><span class=\"line\">show databases;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建数据库</span><br><span class=\"line\">create database test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.删除</span><br><span class=\"line\">drop database test;</span><br><span class=\"line\"></span><br><span class=\"line\">处于安全原因，直接drop有数据的数据库会报错，此时需要cascade关键字忽略报错删除</span><br><span class=\"line\">drop database if exists test cascade;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.查看数据库信息</span><br><span class=\"line\">describe database test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"表\"><a href=\"#表\" class=\"headerlink\" title=\"表\"></a>表</h4><p>列出/创建/修改/删除/查看信息<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出所有表</span><br><span class=\"line\"></span><br><span class=\"line\">当前数据库的所有表</span><br><span class=\"line\">show tables;</span><br><span class=\"line\"></span><br><span class=\"line\">指定数据库的所有表</span><br><span class=\"line\">show tables in db_name;</span><br><span class=\"line\"></span><br><span class=\"line\">支持正则</span><br><span class=\"line\">show tables &apos;.*s&apos;;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建表</span><br><span class=\"line\">create table test</span><br><span class=\"line\">(id int,</span><br><span class=\"line\">a string</span><br><span class=\"line\">)</span><br><span class=\"line\">ROW FORMAT DELIMITED        行分割</span><br><span class=\"line\">FIELDS TERMINATED BY ‘,’    字段分隔符</span><br><span class=\"line\">LINES TERMINATED BY ‘\\n’    行分隔符</span><br><span class=\"line\">STORED AS TEXTFILE;         作为文本存储</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建基于正则切分行字段的表</span><br><span class=\"line\">add jar ../build/contrib/hive_contrib.jar;</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE apachelog (</span><br><span class=\"line\">host STRING,</span><br><span class=\"line\">identity STRING,</span><br><span class=\"line\">user STRING,</span><br><span class=\"line\">time STRING,</span><br><span class=\"line\">request STRING,</span><br><span class=\"line\">status STRING,</span><br><span class=\"line\">size STRING,</span><br><span class=\"line\">referer STRING,</span><br><span class=\"line\">agent STRING)</span><br><span class=\"line\">ROW FORMAT SERDE &apos;org.apache.hadoop.hive.contrib.serde2.RegexSerDe&apos;</span><br><span class=\"line\">WITH SERDEPROPERTIES (</span><br><span class=\"line\">&quot;input.regex&quot; = &quot;([^ ]*) ([^ ]*) ([^ ]*) (-|//[[^//]]*//]) ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;) (-|[0-9]*) (-|[0-9]*)(?: ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;) ([^ /&quot;]*|/&quot;[^/&quot;]*/&quot;))?&quot;,</span><br><span class=\"line\">&quot;output.format.string&quot; = &quot;%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.修改</span><br><span class=\"line\">加一个新列</span><br><span class=\"line\">ALTER TABLE test ADD COLUMNS (new_col2 INT COMMENT &apos;a comment&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">改表名</span><br><span class=\"line\">ALTER TABLE old_name RENAME TO new_name;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除</span><br><span class=\"line\">drop table test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.查看信息</span><br><span class=\"line\"></span><br><span class=\"line\">显示列信息</span><br><span class=\"line\">desc test;</span><br><span class=\"line\"></span><br><span class=\"line\">显示详细表信息</span><br><span class=\"line\">desc formatted test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建索引</span><br><span class=\"line\">CREATE INDEX index_name   </span><br><span class=\"line\">ON TABLE base_table_name (col_name, ...)  </span><br><span class=\"line\">AS &apos;index.handler.class.name&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">如：DROP INDEX index_name ON table_name  </span><br><span class=\"line\"></span><br><span class=\"line\">重建索引</span><br><span class=\"line\">ALTER INDEX index_name ON table_name [PARTITION (...)] REBUILD  </span><br><span class=\"line\"></span><br><span class=\"line\">如：alter index index1_index_test on index_test rebuild; </span><br><span class=\"line\"></span><br><span class=\"line\">删除索引</span><br><span class=\"line\">DROP INDEX index_name ON table_name  </span><br><span class=\"line\"></span><br><span class=\"line\">列出索引</span><br><span class=\"line\">show index on index_test;</span><br></pre></td></tr></table></figure>\n<h4 id=\"视图\"><a href=\"#视图\" class=\"headerlink\" title=\"视图\"></a>视图</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENT column_comment], ...) ][COMMENT view_comment][TBLPROPERTIES (property_name = property_value, ...)] AS SELECT</span><br><span class=\"line\"></span><br><span class=\"line\">注：hive只支持逻辑视图，不支持物化视图</span><br><span class=\"line\">•增加视图</span><br><span class=\"line\">•如果没有提供表名，视图列的名字将由定义的SELECT表达式自动生成</span><br><span class=\"line\">•如果修改基本表的属性，视图中不会体现，无效查询将会失败</span><br><span class=\"line\">•视图是只读的，不能用LOAD/INSERT/ALTER</span><br><span class=\"line\">•删除视图  DROP VIEW view_name</span><br></pre></td></tr></table></figure>\n<h4 id=\"分区（重点）\"><a href=\"#分区（重点）\" class=\"headerlink\" title=\"分区（重点）\"></a>分区（重点）</h4><p>列出/创建/修改/删除</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.列出一个表的所有分区</span><br><span class=\"line\">show  partitions test;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2.创建分区表</span><br><span class=\"line\">create table test</span><br><span class=\"line\">(id int,</span><br><span class=\"line\">a string,</span><br><span class=\"line\">)</span><br><span class=\"line\">partitioned by (b string,c int) </span><br><span class=\"line\">ROW FORMAT DELIMITED</span><br><span class=\"line\">FIELDS TERMINATED BY ‘,’ </span><br><span class=\"line\">LINES TERMINATED BY ‘\\n’ </span><br><span class=\"line\">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3.对现有表添加分区</span><br><span class=\"line\">ALTER TABLE test ADD IF NOT EXISTS</span><br><span class=\"line\">PARTITION (year = 2017) LOCATION ‘/hiveuser/hive/warehouse/data_zh.db/data_zh/2017.txt’;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.删除分区</span><br><span class=\"line\">ALTER TABLE test DROP IF EXISTS PARTITION(year =2017);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5.加载数据到分区表</span><br><span class=\"line\">LOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year=2017);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6.未分区表数据导入分区表</span><br><span class=\"line\">insert overwrite table part_table partition (YEAR,MONTH) select * from no_part_table;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">7.动态分区指令</span><br><span class=\"line\">set hive.exec.dynamic.partition=true;</span><br><span class=\"line\">set hive.exec.dynamic.partition.mode=nonstrict;</span><br><span class=\"line\">#set hive.enforce.bucketing = true;</span><br><span class=\"line\"></span><br><span class=\"line\">开启动态分区后导入数据时可以省略指定分区的步骤</span><br><span class=\"line\">LOAD DATA INPATH ‘/data/2017.txt’ INTO TABLE test PARTITION(year);</span><br></pre></td></tr></table></figure>\n<h4 id=\"分桶\"><a href=\"#分桶\" class=\"headerlink\" title=\"分桶\"></a>分桶</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE bucketed_user (id INT) name STRING)</span><br><span class=\"line\">CLUSTERED BY (id) INTO 4 BUCKETS;</span><br></pre></td></tr></table></figure>\n<p>对于每一个表（table）或者分区， Hive可以进一步组织成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是 针对某一列进行桶的组织。Hive采用对列值哈希，然后除以桶的个数求余的方式决定该条记录存放在哪个桶当中。</p>\n<p>把表（或者分区）组织成桶（Bucket）有两个理由：</p>\n<p>（1）获得更高的查询处理效率。桶为表加上了额外的结构，Hive 在处理有些查询时能利用这个结构。具体而言，连接两个在（包含连接列的）相同列上划分了桶的表，可以使用 Map 端连接 （Map-side join）高效的实现。比如JOIN操作。对于JOIN操作两个表有一个相同的列，如果对这两个表都进行了桶操作。那么将保存相同列值的桶进行JOIN操作就可以，可以大大较少JOIN的数据量。</p>\n<p>（2）使取样（sampling）更高效。在处理大规模数据集时，在开发和修改查询的阶段，如果能在数据集的一小部分数据上试运行查询，会带来很多方便。</p>\n<h2 id=\"DQL\"><a href=\"#DQL\" class=\"headerlink\" title=\"DQL\"></a>DQL</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive中的order by、distribute by、sort by和cluster by</span><br><span class=\"line\"></span><br><span class=\"line\">order by </span><br><span class=\"line\">全局排序，只有一个Reduce任务</span><br><span class=\"line\"></span><br><span class=\"line\">sort by </span><br><span class=\"line\">只做jubu排序</span><br><span class=\"line\"></span><br><span class=\"line\">distribute by </span><br><span class=\"line\">用distribute by 会对指定的字段按照hashCode值对reduce的个数取模，然后将任务分配到对应的reduce中去执行</span><br><span class=\"line\"></span><br><span class=\"line\">cluster by </span><br><span class=\"line\">distribute by 和 sort by 合用就相当于cluster by，但是cluster by 不能指定排序为asc或 desc 的规则，只能是desc倒序排列</span><br><span class=\"line\"></span><br><span class=\"line\">注：distribute by 和 sort by,distribute by 必须在 sort by前面</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表连接</span><br><span class=\"line\">1.join只支持等值连接</span><br><span class=\"line\"></span><br><span class=\"line\">2.可以 join 多于 2 个表</span><br><span class=\"line\">SELECT a.val, b.val, c.val FROM a JOIN b </span><br><span class=\"line\">    ON (a.key = b.key1) JOIN c ON (c.key = b.key2)</span><br><span class=\"line\">注:如果join中多个表的 join key 是同一个，则 join 会被转化为单个 map/reduce 任务</span><br><span class=\"line\"></span><br><span class=\"line\">3.LEFT，RIGHT和FULL OUTER</span><br><span class=\"line\">SELECT a.val, b.val FROM a LEFT OUTER JOIN b ON (a.key=b.key)</span><br><span class=\"line\"></span><br><span class=\"line\">如果 d 表中找不到对应 c 表的记录，d 表的所有列都会列出 NULL，包括 ds 列。也就是说，join 会过滤 d 表中不能找到匹配 c 表 join key 的所有记录。这样的话，LEFT OUTER 就使得查询结果与 WHERE 子句无关</span><br><span class=\"line\"></span><br><span class=\"line\">•解决办法</span><br><span class=\"line\">　　SELECT c.val, d.val FROM c LEFT OUTER JOIN d </span><br><span class=\"line\">     ON (c.key=d.key AND d.ds=&apos;2009-07-07&apos; AND c.ds=&apos;2009-07-07&apos;)</span><br><span class=\"line\">     </span><br><span class=\"line\">4.LEFT SEMI JOIN</span><br><span class=\"line\">LEFT SEMI JOIN 的限制是， JOIN 子句中右边的表只能在 ON 子句中设置过滤条件，在 WHERE 子句、SELECT 子句或其他地方过滤都不行</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT a.key, a.value </span><br><span class=\"line\">  FROM a </span><br><span class=\"line\">  WHERE a.key in </span><br><span class=\"line\">   (SELECT b.key </span><br><span class=\"line\">    FROM B);</span><br><span class=\"line\"></span><br><span class=\"line\">可以被重写为：</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT a.key, a.val </span><br><span class=\"line\">   FROM a LEFT SEMI JOIN b on (a.key = b.key)</span><br><span class=\"line\">   </span><br><span class=\"line\">5.UNION ALL</span><br><span class=\"line\">用来合并多个select的查询结果，需要保证select中字段须一致</span><br><span class=\"line\">　　select_statement UNION ALL select_statement UNION ALL select_statement ...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">分析窗口函数</span><br><span class=\"line\">over (partition by * order by d desc)</span><br></pre></td></tr></table></figure>\n<p>例子：<a href=\"//www.tuicool.com/articles/zuiIVbZ\">Hive分析窗口函数(一) SUM,AVG,MIN,MAX</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其他</span><br><span class=\"line\">1.不支持EXIST ,NOT EXIST</span><br><span class=\"line\"></span><br><span class=\"line\">2.Top N 关键字 为Limit</span><br><span class=\"line\"></span><br><span class=\"line\">3.支持正则筛选字段，如SELECT `(ds|hr)?+.+` FROM test</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"DCL\"><a href=\"#DCL\" class=\"headerlink\" title=\"DCL\"></a>DCL</h2><p>权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Grant/revoke语法：</span><br><span class=\"line\">grant/revoke priv_type[column_list] on object_type object to/from principal_type principal_name</span><br><span class=\"line\"></span><br><span class=\"line\">查看grant 定义：</span><br><span class=\"line\">show grant user user_name on table table_name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">创建/删除角色：</span><br><span class=\"line\">Create/drop Role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">角色分配/回收：</span><br><span class=\"line\">Grant role role_name to user user_name</span><br><span class=\"line\">Revoke role role_name from user user_name</span><br><span class=\"line\"></span><br><span class=\"line\">角色授权：</span><br><span class=\"line\">Grant/revoke priv_type[col_List] on object_type object from/to role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">查看role定义：</span><br><span class=\"line\">show role grant role role_name</span><br><span class=\"line\"></span><br><span class=\"line\">相关hive元信息表：</span><br><span class=\"line\">Db_privs:记录了User/Role在DB上的权限</span><br><span class=\"line\">Tbl_privs:记录了User/Role在table上的权限</span><br><span class=\"line\">Tbl_col_privs：记录了User/Role在table column上的权限</span><br><span class=\"line\">Roles：记录了全部创建的role</span><br><span class=\"line\">Role_map：记录了User与Role的相应关系</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hive函数\"><a href=\"#Hive函数\" class=\"headerlink\" title=\"Hive函数\"></a>Hive函数</h2><p>UDF、UDAF和UDTF</p>\n<p>UDF实现输入一行输出一行行的函数</p>\n<p>UDAF实现输入多行输出一行的函数</p>\n<p>UDTF实现输入一行输出多行的函数</p>\n<p>自定义UDF、UDAF和UDTF</p>\n<h2 id=\"相关资料\"><a href=\"#相关资料\" class=\"headerlink\" title=\"相关资料\"></a>相关资料</h2><p>hive2.0函数大全<br><a href=\"http://www.cnblogs.com/MOBIN/p/5618747.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/MOBIN/p/5618747.html</a></p>\n<h2 id=\"Mysql数据导入Hive\"><a href=\"#Mysql数据导入Hive\" class=\"headerlink\" title=\"Mysql数据导入Hive\"></a>Mysql数据导入Hive</h2><p>通过sqoop把mysql数据导入到hive(若hive没对应表则自动建表)<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/sqoop import --connect jdbc:mysql://172.17.4.1:3306/poi --username lizt  --table poi_amap --hive-import --password 123456</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"python-客户端\"><a href=\"#python-客户端\" class=\"headerlink\" title=\"python 客户端\"></a>python 客户端</h2><p><a href=\"https://github.com/BradRuderman/pyhs2\" target=\"_blank\" rel=\"noopener\">pyhs2</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install pyhs2</span><br></pre></td></tr></table></figure></p>\n"},{"title":"资讯推送|用户推广|活动管理","date":"2017-02-13T18:14:14.000Z","_content":"\n### 整体启动\n\nmain.py\n\n通过多线程同时进行三个任务 (确保每个环境只有一个进程在运行)\nnohup python main.py&\n\n#### 相关配置\n配置写在文件 db.conf中\n只需要根据运行环境更改数据库的配置名称即可，如：\noa = operationActivity.OperationActivity(\"database_dev\") // 192 \noa = operationActivity.OperationActivity(\"database_prd\") // 125\n\n```\n# !/Users/xieqj/py_env/venv python\n# -*- coding: utf-8 -*-\n\n\nimport threading\nfrom mg_handling import msgPushing, userPromotion, operationActivity\nimport util.comm as cm\nimport time\n\n# 资讯推送\ndef msg_pushing():\n    while (True):\n        mp = msgPushing.MsgPushing()\n        msg_contents = mp.scanDBForSending()\n        mp.insert_msg2mq(msg_contents)\n        mp.mark_msg_as_sent(msg_contents)\n        mp.close_database()\n        time.sleep(8)\n\n# 用户推广\ndef user_promotion():\n    while (True):\n        mp = userPromotion.UserPromotion()\n        msg_contents = mp.scanDBForSending()\n        mp.insert_msg2mq(msg_contents)\n        mp.mark_msg_as_sent(msg_contents)\n        mp.close_database()\n        time.sleep(8)\n\n# 活动管理\ndef operation_activity():\n    while (True):\n        oa = operationActivity.OperationActivity()\n        msg_contents = oa.scanDBForSending()\n        oa.insert_msg2mq(msg_contents)\n        oa.mark_msg_as_sent(msg_contents)\n        oa.close_database()\n        time.sleep(8)\n\n\n# 通过多线程同时启动两个步骤\nif __name__ == \"__main__\":\n    cm.initLog(\"pushing.log\", \"INFO\")\n    threads = []\n    t1 = threading.Thread(target=msg_pushing)\n    threads.append(t1)\n    t2 = threading.Thread(target=user_promotion)\n    threads.append(t2)\n    t3 = threading.Thread(target=operation_activity)\n    threads.append(t3)\n    for t in threads:\n        t.setDaemon(True)\n        t.start()\n    t.join()\n\n```\n\n### 资讯推送\n\n读取表 sns_qa_push_setting 中的资讯，将其按照region，industry，func（职能）推送给对应群组的用户。\n具体方法就是将表 sns_qa_push_setting 中的 content 1对1的推送给表 account_basic 中对应群组的用户，即插入 message_queue 表。\n\n需要注意控制推送时间，和在推送后 update 表 sns_qa_push_setting 中 status 字段\n\n#### 仓库位置\n\ngit@192.168.30.251:message_handling.git\n\n{\"messagetype\": 230,\"params\": { \"data\": [{\"newsid\": \" EwtNMSASOSvxjerhni98uQyEXnDIp9fS\",\"title\": \"发布到审核\",\"url\": \"资讯  URL\", \"coverurl\": \"https: //oradtdev.s3.cn-north-  1.amazonaws.com.cn/ukIv0BqxtnjRgjuhJcGKO6jze1liPmZE/gm9YtnBtvQ20160921132139.jpg\",\"createdtime\": \"1474435299\" } ]}}\n\n\n#### 数据表\n\n```\nCREATE TABLE `industry_category` (\n  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n  `category_id` char(8) NOT NULL,\n  `parent_id` char(8) NOT NULL,\n  `name` varchar(128) NOT NULL COMMENT '行业名称',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='国家统计局的两级行业分类标准'\n\n# 保存从名片的json数据解析出来的数据 name * region\nCREATE TABLE `card_info_jsonver` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `card_id` char(32) DEFAULT '' COMMENT '名片id',\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `side` tinyint(4) DEFAULT '0' COMMENT '名片的正反面，0：正面，1：反面',\n  `name` varchar(128) DEFAULT '' COMMENT '名片上的名字',\n  `mobile` varchar(20) DEFAULT '' COMMENT '手机号',\n  `provinceM` varchar(64) DEFAULT '' COMMENT '手机号解出来的省份',\n  `provinceM_code` varchar(16) DEFAULT '' COMMENT '省份编码',\n  `cityM` varchar(64) DEFAULT '' COMMENT '城市',\n  `cityM_code` varchar(16) DEFAULT '' COMMENT '城市编码',\n  `created_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '名片创建时间',\n  `updated_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '名片更新时间',\n  `handle_state` varchar(16) DEFAULT '' COMMENT '处理状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=42333 DEFAULT CHARSET=utf8 COMMENT='保存从名片的json数据解析出来的数据'\n\n# 从名片json数据解析出来的公司信息 companyName * func\nCREATE TABLE `company_info_jsonVer` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `card_id` char(32) DEFAULT NULL COMMENT '名片id',\n  `user_id` char(40) DEFAULT NULL COMMENT '用户id',\n  `companyName` varchar(128) DEFAULT NULL COMMENT '公司名称',\n  `industry` varchar(128) DEFAULT NULL COMMENT '二级行业',\n  `ind_code` char(8) DEFAULT NULL COMMENT '二级行业编码',\n  `title` char(64) DEFAULT NULL COMMENT '职位',\n  `func_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职能名称',\n  `func_code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职能编号',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='从名片json数据解析出来的公司信息'\n\n\n消息类型\n \n{\n    \"messagetype\": 230,\n    \"params\": {\n        \"data\": [\n            {\n                \"newsid\": 资讯id,   \n                \"title\": \"资讯标题\",\n               \"url\": \"资讯URL\",\n                \"coverurl\": \"封面URL\",\n            },\n            ....\n        ]\n    }\n}\n注：排序 按照data中数组的顺序\n```\n\n----\n\n### 用户推广\n\n基本流程与咨询推送相同\n\n#### 仓库位置\n\ngit@192.168.30.251:message_handling.git\n\ngit@192.168.30.251:effective.git\n\nuserPromotion.py\n\n#### 推广表\n\n```\nCREATE TABLE `sys_user_promotion` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `pro_id` char(32) NOT NULL COMMENT '推广ID',\n  `type` tinyint(2) NOT NULL DEFAULT '0' COMMENT '推送方式：1：内部 2：邮件 3：短信',\n  `isalluser` tinyint(2) NOT NULL DEFAULT '1' COMMENT '1发送注册用户2发送全部用户',\n  `push_time` int(10) NOT NULL COMMENT '设置的推送时间',\n  `region` varchar(2000) NOT NULL DEFAULT '' COMMENT '地区（多个,号隔开）',\n  `industry` varchar(2000) NOT NULL DEFAULT '' COMMENT '行业（多个,号隔开）',\n  `func` varchar(2000) NOT NULL DEFAULT '' COMMENT '职能（多个,号隔开）',\n  `title` varchar(50) CHARACTER SET utf8mb4 DEFAULT '' COMMENT '标题',\n  `content` text NOT NULL COMMENT '推送的内容',\n  `created_time` int(10) NOT NULL COMMENT '添加时间',\n  `admin_id` char(40) NOT NULL DEFAULT '' COMMENT '设置人',\n  `status` tinyint(2) NOT NULL DEFAULT '1' COMMENT '状态 1：未发 2：已发',\n  `isntice` tinyint(2) DEFAULT '0' COMMENT '是否通知',\n  `url` varchar(256) NOT NULL COMMENT 'url地址',\n  `json_data` text NOT NULL COMMENT '推送json格式',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=utf8 COMMENT='运营后台-用户推广表'\n\n-- 存储type为2，3的用户推广\nCREATE TABLE `message_promotion` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型：1-内部，2-邮件，3-短信',\n  `mobile` varchar(18) DEFAULT '' COMMENT '手机号',\n  `email` varchar(256) DEFAULT '' COMMENT '邮箱',\n  `title` varchar(100) NOT NULL DEFAULT '' COMMENT '标题',\n  `content` text NOT NULL COMMENT '消息内容',\n  `created_time` int(11) DEFAULT NULL COMMENT '创建时间',\n  `modified_time` int(11) DEFAULT NULL COMMENT '修改时间',\n  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '状态：0-未发送，1-已发送，2-发送失败',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT='推广消息表'\n \n推广消息类型\n \n{\n  \"messagetype\":231,\n  \"params\":{\n     \"id\":\"文章id\"，\n      \"title\": \"资讯标题\",\n      \"content\":\"内容\"，\n      \"createdtime\": \"1345764830\"\n   }\n}\n{\n  \"messagetype\": 231,\n  \"params\": {\n    \"content\": \"hello world！<br/>\",\n    \"createdtime\": 1483620281,\n    \"id\": \"zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b\",\n    \"image\": \"\",\n    \"title\": \"推送测试\",\n    \"type\": \"user\",\n    \"url\": \"h5/News/secretary?type=promotion&id=zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b\"\n  }\n}\n```\n\n----\n\n### 活动管理\n\n#### 背景说明\n系统中，内容管理-推送、运营管理-新增推广、运营管理-新增活动页面中，地区、行业、职能选择时，弹窗样式与“内容管理-推送”样式相同，具体请参见原型\n\n进行推送时，匹配规则如下：\na)  行业：第一次使用APP时所选行业+当前默认身份的并集。采用1级行业-2级行业模式划分\nb)  地区：第一次使用APP时所选手机号+当前默认身份的并集。采用1级地区-2级地区模式划分\nc)  职能：当前默认身份。采用1级行业-职能（只有1级）模式划分\n\n当前默认身份cardid需要通过表 account_basic_detail 的 card_id 字段得到\n\n#### 业务流程\n\n\n#### 仓库位置\ngit@192.168.30.251:message_handling.git\n\nOperationActivity\n\n#### 活动表结构\n\n```\nCREATE TABLE `operation_activity` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `activity_id` char(32) CHARACTER SET utf8 NOT NULL COMMENT '活动id',\n  `type` tinyint(4) NOT NULL DEFAULT '1' COMMENT '类型 1:活动 2:资讯',\n  `isnotify` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1:不通知 2:通知',\n  `push_state` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'isnotify为2时有效，1:未推送，2:已推送',\n  `region` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '地区（多个,号隔开）',\n  `industry` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '行业（多个,号隔开）',\n  `func` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '职能（多个,号隔开）',\n  `show_id` varchar(400) CHARACTER SET utf8 DEFAULT NULL COMMENT '资讯shwo_id（多个,号隔开）type为2时有效',\n  `image` varchar(256) CHARACTER SET utf8 DEFAULT NULL COMMENT '标题图片',\n  `title` varchar(100) CHARACTER SET utf8 DEFAULT NULL COMMENT '活动标题 type为1时使用',\n  `content` text CHARACTER SET utf8 COMMENT '活动标题 type为1时使用',\n  `onlinetime` int(11) NOT NULL DEFAULT '0' COMMENT '上线时间',\n  `offlinetime` int(11) NOT NULL DEFAULT '0' COMMENT '下线时间',\n  `user_id` char(40) CHARACTER SET utf8 NOT NULL COMMENT '发布人用户id',\n  `created_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  `modify_time` int(11) NOT NULL DEFAULT '0' COMMENT '修改时间',\n  `state` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态 1:未发布 2:已发布 3:已下线 4:已删除',\n  `click_count` int(11) NOT NULL DEFAULT '0' COMMENT '点击量',\n  `share_count` int(11) NOT NULL DEFAULT '0' COMMENT '分享量',\n  `share_user_count` int(11) NOT NULL DEFAULT '0' COMMENT '分享用户量',\n  `push_count` int(11) NOT NULL DEFAULT '0' COMMENT '推送用户量',\n  `url` varchar(256) NOT NULL COMMENT 'URL地址',\n  `json_data` text NOT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `activity_id` (`activity_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8mb4 COMMENT='运营活动表'\n\n推送类型\n{\n  \"messagetype\":231,\n  \"params\":{\n      \"id\":\"文章id\"，\n      \"title\": \"标题\",\n      \"content\":\"内容\"，\n      \"createdtime\": \"1345764830\",\n      \"image\":\"图片URL\"，\n      \"type\":\"活动（activity）或者用户推广（user）\"\n   }\n}\n```\n----\n### 带推送消息查询语句\n#### 资讯推送\nselect id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,content from oradt_cloud_test2.sns_qa_push_setting\nwhere `status` <> 2 and industry != '' and func != '' and region != ''\nand ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n#### 用户推广\nselect id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,title,json_data from oradt_cloud_test2.sys_user_promotion\nwhere `status` <> 2 and industry != '' and func != '' and region != ''\nand ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n#### 活动推广\nselect id,push_state, region, industry, func, title, json_data, user_id from oradt_cloud_test2.operation_activity\nwhere push_state <> 2 and industry != '' and func != '' and region != '' and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n\n----\n### 部署情况\n\n#### 125仿真环境 \n\n部署在IDC 云主机 /home/xieqj/python2.7_scenario/fangzhen\n\n```\n0 */1 * * * python2.7 /home/xieqj/python2.7_scenario/fangzhen/CardDeduplication/CardDeduplication3366.py\n```\n名片去重 60分钟运行一次 \n名片异常 5分钟运行一次\n人脉更新 60分钟运行一次\n消息推送 main.py 60分钟一次\n\npython2.7 运行的是125 3366端口\npython2.7 message_handling/main.py (消息推送)\npython2.7 CardDeduplication/CardDeduplication.py\npython2.7 CardExceptionHandling/CardException.py\npython2.7 cardUpdateNotification/CardUpdateNote.py\n\npython 运行的是3388端口\npython CardDeduplication.py\npython CardException.py\n\n#### AWS \n\n部署在ec2 54.223.28.119\n```\n0 0 */1 * * python2.7 /home/ec2-user/namecard/CardDeduplication/CardDeduplication_aws.py\n```\n\n名片异常 每5分钟运行一次\n名片去重 每24小时运行一次\n用户推广 每1分钟运行一次\n消息推送 每1分钟运行一次\n\n","source":"_posts/message_pushing.md","raw":"---\ntitle: 资讯推送|用户推广|活动管理\ndate: 2017-02-14 02:14:14\ntags:\n    - msyql\n    - message queue\ncategories: IMORA\n---\n\n### 整体启动\n\nmain.py\n\n通过多线程同时进行三个任务 (确保每个环境只有一个进程在运行)\nnohup python main.py&\n\n#### 相关配置\n配置写在文件 db.conf中\n只需要根据运行环境更改数据库的配置名称即可，如：\noa = operationActivity.OperationActivity(\"database_dev\") // 192 \noa = operationActivity.OperationActivity(\"database_prd\") // 125\n\n```\n# !/Users/xieqj/py_env/venv python\n# -*- coding: utf-8 -*-\n\n\nimport threading\nfrom mg_handling import msgPushing, userPromotion, operationActivity\nimport util.comm as cm\nimport time\n\n# 资讯推送\ndef msg_pushing():\n    while (True):\n        mp = msgPushing.MsgPushing()\n        msg_contents = mp.scanDBForSending()\n        mp.insert_msg2mq(msg_contents)\n        mp.mark_msg_as_sent(msg_contents)\n        mp.close_database()\n        time.sleep(8)\n\n# 用户推广\ndef user_promotion():\n    while (True):\n        mp = userPromotion.UserPromotion()\n        msg_contents = mp.scanDBForSending()\n        mp.insert_msg2mq(msg_contents)\n        mp.mark_msg_as_sent(msg_contents)\n        mp.close_database()\n        time.sleep(8)\n\n# 活动管理\ndef operation_activity():\n    while (True):\n        oa = operationActivity.OperationActivity()\n        msg_contents = oa.scanDBForSending()\n        oa.insert_msg2mq(msg_contents)\n        oa.mark_msg_as_sent(msg_contents)\n        oa.close_database()\n        time.sleep(8)\n\n\n# 通过多线程同时启动两个步骤\nif __name__ == \"__main__\":\n    cm.initLog(\"pushing.log\", \"INFO\")\n    threads = []\n    t1 = threading.Thread(target=msg_pushing)\n    threads.append(t1)\n    t2 = threading.Thread(target=user_promotion)\n    threads.append(t2)\n    t3 = threading.Thread(target=operation_activity)\n    threads.append(t3)\n    for t in threads:\n        t.setDaemon(True)\n        t.start()\n    t.join()\n\n```\n\n### 资讯推送\n\n读取表 sns_qa_push_setting 中的资讯，将其按照region，industry，func（职能）推送给对应群组的用户。\n具体方法就是将表 sns_qa_push_setting 中的 content 1对1的推送给表 account_basic 中对应群组的用户，即插入 message_queue 表。\n\n需要注意控制推送时间，和在推送后 update 表 sns_qa_push_setting 中 status 字段\n\n#### 仓库位置\n\ngit@192.168.30.251:message_handling.git\n\n{\"messagetype\": 230,\"params\": { \"data\": [{\"newsid\": \" EwtNMSASOSvxjerhni98uQyEXnDIp9fS\",\"title\": \"发布到审核\",\"url\": \"资讯  URL\", \"coverurl\": \"https: //oradtdev.s3.cn-north-  1.amazonaws.com.cn/ukIv0BqxtnjRgjuhJcGKO6jze1liPmZE/gm9YtnBtvQ20160921132139.jpg\",\"createdtime\": \"1474435299\" } ]}}\n\n\n#### 数据表\n\n```\nCREATE TABLE `industry_category` (\n  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n  `category_id` char(8) NOT NULL,\n  `parent_id` char(8) NOT NULL,\n  `name` varchar(128) NOT NULL COMMENT '行业名称',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='国家统计局的两级行业分类标准'\n\n# 保存从名片的json数据解析出来的数据 name * region\nCREATE TABLE `card_info_jsonver` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `card_id` char(32) DEFAULT '' COMMENT '名片id',\n  `user_id` char(40) DEFAULT '' COMMENT '用户id',\n  `side` tinyint(4) DEFAULT '0' COMMENT '名片的正反面，0：正面，1：反面',\n  `name` varchar(128) DEFAULT '' COMMENT '名片上的名字',\n  `mobile` varchar(20) DEFAULT '' COMMENT '手机号',\n  `provinceM` varchar(64) DEFAULT '' COMMENT '手机号解出来的省份',\n  `provinceM_code` varchar(16) DEFAULT '' COMMENT '省份编码',\n  `cityM` varchar(64) DEFAULT '' COMMENT '城市',\n  `cityM_code` varchar(16) DEFAULT '' COMMENT '城市编码',\n  `created_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '名片创建时间',\n  `updated_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '名片更新时间',\n  `handle_state` varchar(16) DEFAULT '' COMMENT '处理状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=42333 DEFAULT CHARSET=utf8 COMMENT='保存从名片的json数据解析出来的数据'\n\n# 从名片json数据解析出来的公司信息 companyName * func\nCREATE TABLE `company_info_jsonVer` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `card_id` char(32) DEFAULT NULL COMMENT '名片id',\n  `user_id` char(40) DEFAULT NULL COMMENT '用户id',\n  `companyName` varchar(128) DEFAULT NULL COMMENT '公司名称',\n  `industry` varchar(128) DEFAULT NULL COMMENT '二级行业',\n  `ind_code` char(8) DEFAULT NULL COMMENT '二级行业编码',\n  `title` char(64) DEFAULT NULL COMMENT '职位',\n  `func_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职能名称',\n  `func_code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职能编号',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='从名片json数据解析出来的公司信息'\n\n\n消息类型\n \n{\n    \"messagetype\": 230,\n    \"params\": {\n        \"data\": [\n            {\n                \"newsid\": 资讯id,   \n                \"title\": \"资讯标题\",\n               \"url\": \"资讯URL\",\n                \"coverurl\": \"封面URL\",\n            },\n            ....\n        ]\n    }\n}\n注：排序 按照data中数组的顺序\n```\n\n----\n\n### 用户推广\n\n基本流程与咨询推送相同\n\n#### 仓库位置\n\ngit@192.168.30.251:message_handling.git\n\ngit@192.168.30.251:effective.git\n\nuserPromotion.py\n\n#### 推广表\n\n```\nCREATE TABLE `sys_user_promotion` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `pro_id` char(32) NOT NULL COMMENT '推广ID',\n  `type` tinyint(2) NOT NULL DEFAULT '0' COMMENT '推送方式：1：内部 2：邮件 3：短信',\n  `isalluser` tinyint(2) NOT NULL DEFAULT '1' COMMENT '1发送注册用户2发送全部用户',\n  `push_time` int(10) NOT NULL COMMENT '设置的推送时间',\n  `region` varchar(2000) NOT NULL DEFAULT '' COMMENT '地区（多个,号隔开）',\n  `industry` varchar(2000) NOT NULL DEFAULT '' COMMENT '行业（多个,号隔开）',\n  `func` varchar(2000) NOT NULL DEFAULT '' COMMENT '职能（多个,号隔开）',\n  `title` varchar(50) CHARACTER SET utf8mb4 DEFAULT '' COMMENT '标题',\n  `content` text NOT NULL COMMENT '推送的内容',\n  `created_time` int(10) NOT NULL COMMENT '添加时间',\n  `admin_id` char(40) NOT NULL DEFAULT '' COMMENT '设置人',\n  `status` tinyint(2) NOT NULL DEFAULT '1' COMMENT '状态 1：未发 2：已发',\n  `isntice` tinyint(2) DEFAULT '0' COMMENT '是否通知',\n  `url` varchar(256) NOT NULL COMMENT 'url地址',\n  `json_data` text NOT NULL COMMENT '推送json格式',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=utf8 COMMENT='运营后台-用户推广表'\n\n-- 存储type为2，3的用户推广\nCREATE TABLE `message_promotion` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型：1-内部，2-邮件，3-短信',\n  `mobile` varchar(18) DEFAULT '' COMMENT '手机号',\n  `email` varchar(256) DEFAULT '' COMMENT '邮箱',\n  `title` varchar(100) NOT NULL DEFAULT '' COMMENT '标题',\n  `content` text NOT NULL COMMENT '消息内容',\n  `created_time` int(11) DEFAULT NULL COMMENT '创建时间',\n  `modified_time` int(11) DEFAULT NULL COMMENT '修改时间',\n  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '状态：0-未发送，1-已发送，2-发送失败',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT='推广消息表'\n \n推广消息类型\n \n{\n  \"messagetype\":231,\n  \"params\":{\n     \"id\":\"文章id\"，\n      \"title\": \"资讯标题\",\n      \"content\":\"内容\"，\n      \"createdtime\": \"1345764830\"\n   }\n}\n{\n  \"messagetype\": 231,\n  \"params\": {\n    \"content\": \"hello world！<br/>\",\n    \"createdtime\": 1483620281,\n    \"id\": \"zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b\",\n    \"image\": \"\",\n    \"title\": \"推送测试\",\n    \"type\": \"user\",\n    \"url\": \"h5/News/secretary?type=promotion&id=zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b\"\n  }\n}\n```\n\n----\n\n### 活动管理\n\n#### 背景说明\n系统中，内容管理-推送、运营管理-新增推广、运营管理-新增活动页面中，地区、行业、职能选择时，弹窗样式与“内容管理-推送”样式相同，具体请参见原型\n\n进行推送时，匹配规则如下：\na)  行业：第一次使用APP时所选行业+当前默认身份的并集。采用1级行业-2级行业模式划分\nb)  地区：第一次使用APP时所选手机号+当前默认身份的并集。采用1级地区-2级地区模式划分\nc)  职能：当前默认身份。采用1级行业-职能（只有1级）模式划分\n\n当前默认身份cardid需要通过表 account_basic_detail 的 card_id 字段得到\n\n#### 业务流程\n\n\n#### 仓库位置\ngit@192.168.30.251:message_handling.git\n\nOperationActivity\n\n#### 活动表结构\n\n```\nCREATE TABLE `operation_activity` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `activity_id` char(32) CHARACTER SET utf8 NOT NULL COMMENT '活动id',\n  `type` tinyint(4) NOT NULL DEFAULT '1' COMMENT '类型 1:活动 2:资讯',\n  `isnotify` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1:不通知 2:通知',\n  `push_state` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'isnotify为2时有效，1:未推送，2:已推送',\n  `region` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '地区（多个,号隔开）',\n  `industry` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '行业（多个,号隔开）',\n  `func` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT '职能（多个,号隔开）',\n  `show_id` varchar(400) CHARACTER SET utf8 DEFAULT NULL COMMENT '资讯shwo_id（多个,号隔开）type为2时有效',\n  `image` varchar(256) CHARACTER SET utf8 DEFAULT NULL COMMENT '标题图片',\n  `title` varchar(100) CHARACTER SET utf8 DEFAULT NULL COMMENT '活动标题 type为1时使用',\n  `content` text CHARACTER SET utf8 COMMENT '活动标题 type为1时使用',\n  `onlinetime` int(11) NOT NULL DEFAULT '0' COMMENT '上线时间',\n  `offlinetime` int(11) NOT NULL DEFAULT '0' COMMENT '下线时间',\n  `user_id` char(40) CHARACTER SET utf8 NOT NULL COMMENT '发布人用户id',\n  `created_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  `modify_time` int(11) NOT NULL DEFAULT '0' COMMENT '修改时间',\n  `state` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态 1:未发布 2:已发布 3:已下线 4:已删除',\n  `click_count` int(11) NOT NULL DEFAULT '0' COMMENT '点击量',\n  `share_count` int(11) NOT NULL DEFAULT '0' COMMENT '分享量',\n  `share_user_count` int(11) NOT NULL DEFAULT '0' COMMENT '分享用户量',\n  `push_count` int(11) NOT NULL DEFAULT '0' COMMENT '推送用户量',\n  `url` varchar(256) NOT NULL COMMENT 'URL地址',\n  `json_data` text NOT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `activity_id` (`activity_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8mb4 COMMENT='运营活动表'\n\n推送类型\n{\n  \"messagetype\":231,\n  \"params\":{\n      \"id\":\"文章id\"，\n      \"title\": \"标题\",\n      \"content\":\"内容\"，\n      \"createdtime\": \"1345764830\",\n      \"image\":\"图片URL\"，\n      \"type\":\"活动（activity）或者用户推广（user）\"\n   }\n}\n```\n----\n### 带推送消息查询语句\n#### 资讯推送\nselect id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,content from oradt_cloud_test2.sns_qa_push_setting\nwhere `status` <> 2 and industry != '' and func != '' and region != ''\nand ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n#### 用户推广\nselect id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,title,json_data from oradt_cloud_test2.sys_user_promotion\nwhere `status` <> 2 and industry != '' and func != '' and region != ''\nand ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n#### 活动推广\nselect id,push_state, region, industry, func, title, json_data, user_id from oradt_cloud_test2.operation_activity\nwhere push_state <> 2 and industry != '' and func != '' and region != '' and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) >= -2;\n\n----\n### 部署情况\n\n#### 125仿真环境 \n\n部署在IDC 云主机 /home/xieqj/python2.7_scenario/fangzhen\n\n```\n0 */1 * * * python2.7 /home/xieqj/python2.7_scenario/fangzhen/CardDeduplication/CardDeduplication3366.py\n```\n名片去重 60分钟运行一次 \n名片异常 5分钟运行一次\n人脉更新 60分钟运行一次\n消息推送 main.py 60分钟一次\n\npython2.7 运行的是125 3366端口\npython2.7 message_handling/main.py (消息推送)\npython2.7 CardDeduplication/CardDeduplication.py\npython2.7 CardExceptionHandling/CardException.py\npython2.7 cardUpdateNotification/CardUpdateNote.py\n\npython 运行的是3388端口\npython CardDeduplication.py\npython CardException.py\n\n#### AWS \n\n部署在ec2 54.223.28.119\n```\n0 0 */1 * * python2.7 /home/ec2-user/namecard/CardDeduplication/CardDeduplication_aws.py\n```\n\n名片异常 每5分钟运行一次\n名片去重 每24小时运行一次\n用户推广 每1分钟运行一次\n消息推送 每1分钟运行一次\n\n","slug":"message_pushing","published":1,"updated":"2018-07-13T11:06:08.777Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjjxogndq002q3a9dntigy0w3","content":"<h3 id=\"整体启动\"><a href=\"#整体启动\" class=\"headerlink\" title=\"整体启动\"></a>整体启动</h3><p>main.py</p>\n<p>通过多线程同时进行三个任务 (确保每个环境只有一个进程在运行)<br>nohup python main.py&amp;</p>\n<h4 id=\"相关配置\"><a href=\"#相关配置\" class=\"headerlink\" title=\"相关配置\"></a>相关配置</h4><p>配置写在文件 db.conf中<br>只需要根据运行环境更改数据库的配置名称即可，如：<br>oa = operationActivity.OperationActivity(“database_dev”) // 192<br>oa = operationActivity.OperationActivity(“database_prd”) // 125</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># !/Users/xieqj/py_env/venv python</span><br><span class=\"line\"># -*- coding: utf-8 -*-</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">import threading</span><br><span class=\"line\">from mg_handling import msgPushing, userPromotion, operationActivity</span><br><span class=\"line\">import util.comm as cm</span><br><span class=\"line\">import time</span><br><span class=\"line\"></span><br><span class=\"line\"># 资讯推送</span><br><span class=\"line\">def msg_pushing():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        mp = msgPushing.MsgPushing()</span><br><span class=\"line\">        msg_contents = mp.scanDBForSending()</span><br><span class=\"line\">        mp.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        mp.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        mp.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"># 用户推广</span><br><span class=\"line\">def user_promotion():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        mp = userPromotion.UserPromotion()</span><br><span class=\"line\">        msg_contents = mp.scanDBForSending()</span><br><span class=\"line\">        mp.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        mp.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        mp.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"># 活动管理</span><br><span class=\"line\">def operation_activity():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        oa = operationActivity.OperationActivity()</span><br><span class=\"line\">        msg_contents = oa.scanDBForSending()</span><br><span class=\"line\">        oa.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        oa.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        oa.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 通过多线程同时启动两个步骤</span><br><span class=\"line\">if __name__ == &quot;__main__&quot;:</span><br><span class=\"line\">    cm.initLog(&quot;pushing.log&quot;, &quot;INFO&quot;)</span><br><span class=\"line\">    threads = []</span><br><span class=\"line\">    t1 = threading.Thread(target=msg_pushing)</span><br><span class=\"line\">    threads.append(t1)</span><br><span class=\"line\">    t2 = threading.Thread(target=user_promotion)</span><br><span class=\"line\">    threads.append(t2)</span><br><span class=\"line\">    t3 = threading.Thread(target=operation_activity)</span><br><span class=\"line\">    threads.append(t3)</span><br><span class=\"line\">    for t in threads:</span><br><span class=\"line\">        t.setDaemon(True)</span><br><span class=\"line\">        t.start()</span><br><span class=\"line\">    t.join()</span><br></pre></td></tr></table></figure>\n<h3 id=\"资讯推送\"><a href=\"#资讯推送\" class=\"headerlink\" title=\"资讯推送\"></a>资讯推送</h3><p>读取表 sns_qa_push_setting 中的资讯，将其按照region，industry，func（职能）推送给对应群组的用户。<br>具体方法就是将表 sns_qa_push_setting 中的 content 1对1的推送给表 account_basic 中对应群组的用户，即插入 message_queue 表。</p>\n<p>需要注意控制推送时间，和在推送后 update 表 sns_qa_push_setting 中 status 字段</p>\n<h4 id=\"仓库位置\"><a href=\"#仓库位置\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>{“messagetype”: 230,”params”: { “data”: [{“newsid”: “ EwtNMSASOSvxjerhni98uQyEXnDIp9fS”,”title”: “发布到审核”,”url”: “资讯  URL”, “coverurl”: “https: //oradtdev.s3.cn-north-  1.amazonaws.com.cn/ukIv0BqxtnjRgjuhJcGKO6jze1liPmZE/gm9YtnBtvQ20160921132139.jpg”,”createdtime”: “1474435299” } ]}}</p>\n<h4 id=\"数据表\"><a href=\"#数据表\" class=\"headerlink\" title=\"数据表\"></a>数据表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `industry_category` (</span><br><span class=\"line\">  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `category_id` char(8) NOT NULL,</span><br><span class=\"line\">  `parent_id` char(8) NOT NULL,</span><br><span class=\"line\">  `name` varchar(128) NOT NULL COMMENT &apos;行业名称&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;国家统计局的两级行业分类标准&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存从名片的json数据解析出来的数据 name * region</span><br><span class=\"line\">CREATE TABLE `card_info_jsonver` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `card_id` char(32) DEFAULT &apos;&apos; COMMENT &apos;名片id&apos;,</span><br><span class=\"line\">  `user_id` char(40) DEFAULT &apos;&apos; COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `side` tinyint(4) DEFAULT &apos;0&apos; COMMENT &apos;名片的正反面，0：正面，1：反面&apos;,</span><br><span class=\"line\">  `name` varchar(128) DEFAULT &apos;&apos; COMMENT &apos;名片上的名字&apos;,</span><br><span class=\"line\">  `mobile` varchar(20) DEFAULT &apos;&apos; COMMENT &apos;手机号&apos;,</span><br><span class=\"line\">  `provinceM` varchar(64) DEFAULT &apos;&apos; COMMENT &apos;手机号解出来的省份&apos;,</span><br><span class=\"line\">  `provinceM_code` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;省份编码&apos;,</span><br><span class=\"line\">  `cityM` varchar(64) DEFAULT &apos;&apos; COMMENT &apos;城市&apos;,</span><br><span class=\"line\">  `cityM_code` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;城市编码&apos;,</span><br><span class=\"line\">  `created_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT &apos;名片创建时间&apos;,</span><br><span class=\"line\">  `updated_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT &apos;名片更新时间&apos;,</span><br><span class=\"line\">  `handle_state` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;处理状态&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=42333 DEFAULT CHARSET=utf8 COMMENT=&apos;保存从名片的json数据解析出来的数据&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"># 从名片json数据解析出来的公司信息 companyName * func</span><br><span class=\"line\">CREATE TABLE `company_info_jsonVer` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `card_id` char(32) DEFAULT NULL COMMENT &apos;名片id&apos;,</span><br><span class=\"line\">  `user_id` char(40) DEFAULT NULL COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `companyName` varchar(128) DEFAULT NULL COMMENT &apos;公司名称&apos;,</span><br><span class=\"line\">  `industry` varchar(128) DEFAULT NULL COMMENT &apos;二级行业&apos;,</span><br><span class=\"line\">  `ind_code` char(8) DEFAULT NULL COMMENT &apos;二级行业编码&apos;,</span><br><span class=\"line\">  `title` char(64) DEFAULT NULL COMMENT &apos;职位&apos;,</span><br><span class=\"line\">  `func_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &apos;职能名称&apos;,</span><br><span class=\"line\">  `func_code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &apos;职能编号&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;从名片json数据解析出来的公司信息&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">消息类型</span><br><span class=\"line\"> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;messagetype&quot;: 230,</span><br><span class=\"line\">    &quot;params&quot;: &#123;</span><br><span class=\"line\">        &quot;data&quot;: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                &quot;newsid&quot;: 资讯id,   </span><br><span class=\"line\">                &quot;title&quot;: &quot;资讯标题&quot;,</span><br><span class=\"line\">               &quot;url&quot;: &quot;资讯URL&quot;,</span><br><span class=\"line\">                &quot;coverurl&quot;: &quot;封面URL&quot;,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            ....</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">注：排序 按照data中数组的顺序</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"用户推广\"><a href=\"#用户推广\" class=\"headerlink\" title=\"用户推广\"></a>用户推广</h3><p>基本流程与咨询推送相同</p>\n<h4 id=\"仓库位置-1\"><a href=\"#仓库位置-1\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>git@192.168.30.251:effective.git</p>\n<p>userPromotion.py</p>\n<h4 id=\"推广表\"><a href=\"#推广表\" class=\"headerlink\" title=\"推广表\"></a>推广表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `sys_user_promotion` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `pro_id` char(32) NOT NULL COMMENT &apos;推广ID&apos;,</span><br><span class=\"line\">  `type` tinyint(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;推送方式：1：内部 2：邮件 3：短信&apos;,</span><br><span class=\"line\">  `isalluser` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1发送注册用户2发送全部用户&apos;,</span><br><span class=\"line\">  `push_time` int(10) NOT NULL COMMENT &apos;设置的推送时间&apos;,</span><br><span class=\"line\">  `region` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;地区（多个,号隔开）&apos;,</span><br><span class=\"line\">  `industry` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;行业（多个,号隔开）&apos;,</span><br><span class=\"line\">  `func` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;职能（多个,号隔开）&apos;,</span><br><span class=\"line\">  `title` varchar(50) CHARACTER SET utf8mb4 DEFAULT &apos;&apos; COMMENT &apos;标题&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;推送的内容&apos;,</span><br><span class=\"line\">  `created_time` int(10) NOT NULL COMMENT &apos;添加时间&apos;,</span><br><span class=\"line\">  `admin_id` char(40) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;设置人&apos;,</span><br><span class=\"line\">  `status` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;状态 1：未发 2：已发&apos;,</span><br><span class=\"line\">  `isntice` tinyint(2) DEFAULT &apos;0&apos; COMMENT &apos;是否通知&apos;,</span><br><span class=\"line\">  `url` varchar(256) NOT NULL COMMENT &apos;url地址&apos;,</span><br><span class=\"line\">  `json_data` text NOT NULL COMMENT &apos;推送json格式&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=utf8 COMMENT=&apos;运营后台-用户推广表&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 存储type为2，3的用户推广</span><br><span class=\"line\">CREATE TABLE `message_promotion` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `type` tinyint(4) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;类型：1-内部，2-邮件，3-短信&apos;,</span><br><span class=\"line\">  `mobile` varchar(18) DEFAULT &apos;&apos; COMMENT &apos;手机号&apos;,</span><br><span class=\"line\">  `email` varchar(256) DEFAULT &apos;&apos; COMMENT &apos;邮箱&apos;,</span><br><span class=\"line\">  `title` varchar(100) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;标题&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;消息内容&apos;,</span><br><span class=\"line\">  `created_time` int(11) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `modified_time` int(11) DEFAULT NULL COMMENT &apos;修改时间&apos;,</span><br><span class=\"line\">  `status` tinyint(4) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;状态：0-未发送，1-已发送，2-发送失败&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT=&apos;推广消息表&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">推广消息类型</span><br><span class=\"line\"> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;:231,</span><br><span class=\"line\">  &quot;params&quot;:&#123;</span><br><span class=\"line\">     &quot;id&quot;:&quot;文章id&quot;，</span><br><span class=\"line\">      &quot;title&quot;: &quot;资讯标题&quot;,</span><br><span class=\"line\">      &quot;content&quot;:&quot;内容&quot;，</span><br><span class=\"line\">      &quot;createdtime&quot;: &quot;1345764830&quot;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;: 231,</span><br><span class=\"line\">  &quot;params&quot;: &#123;</span><br><span class=\"line\">    &quot;content&quot;: &quot;hello world！&lt;br/&gt;&quot;,</span><br><span class=\"line\">    &quot;createdtime&quot;: 1483620281,</span><br><span class=\"line\">    &quot;id&quot;: &quot;zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b&quot;,</span><br><span class=\"line\">    &quot;image&quot;: &quot;&quot;,</span><br><span class=\"line\">    &quot;title&quot;: &quot;推送测试&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;user&quot;,</span><br><span class=\"line\">    &quot;url&quot;: &quot;h5/News/secretary?type=promotion&amp;id=zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"活动管理\"><a href=\"#活动管理\" class=\"headerlink\" title=\"活动管理\"></a>活动管理</h3><h4 id=\"背景说明\"><a href=\"#背景说明\" class=\"headerlink\" title=\"背景说明\"></a>背景说明</h4><p>系统中，内容管理-推送、运营管理-新增推广、运营管理-新增活动页面中，地区、行业、职能选择时，弹窗样式与“内容管理-推送”样式相同，具体请参见原型</p>\n<p>进行推送时，匹配规则如下：<br>a)  行业：第一次使用APP时所选行业+当前默认身份的并集。采用1级行业-2级行业模式划分<br>b)  地区：第一次使用APP时所选手机号+当前默认身份的并集。采用1级地区-2级地区模式划分<br>c)  职能：当前默认身份。采用1级行业-职能（只有1级）模式划分</p>\n<p>当前默认身份cardid需要通过表 account_basic_detail 的 card_id 字段得到</p>\n<h4 id=\"业务流程\"><a href=\"#业务流程\" class=\"headerlink\" title=\"业务流程\"></a>业务流程</h4><h4 id=\"仓库位置-2\"><a href=\"#仓库位置-2\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>OperationActivity</p>\n<h4 id=\"活动表结构\"><a href=\"#活动表结构\" class=\"headerlink\" title=\"活动表结构\"></a>活动表结构</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `operation_activity` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `activity_id` char(32) CHARACTER SET utf8 NOT NULL COMMENT &apos;活动id&apos;,</span><br><span class=\"line\">  `type` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;类型 1:活动 2:资讯&apos;,</span><br><span class=\"line\">  `isnotify` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1:不通知 2:通知&apos;,</span><br><span class=\"line\">  `push_state` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;isnotify为2时有效，1:未推送，2:已推送&apos;,</span><br><span class=\"line\">  `region` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;地区（多个,号隔开）&apos;,</span><br><span class=\"line\">  `industry` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;行业（多个,号隔开）&apos;,</span><br><span class=\"line\">  `func` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;职能（多个,号隔开）&apos;,</span><br><span class=\"line\">  `show_id` varchar(400) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;资讯shwo_id（多个,号隔开）type为2时有效&apos;,</span><br><span class=\"line\">  `image` varchar(256) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;标题图片&apos;,</span><br><span class=\"line\">  `title` varchar(100) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;活动标题 type为1时使用&apos;,</span><br><span class=\"line\">  `content` text CHARACTER SET utf8 COMMENT &apos;活动标题 type为1时使用&apos;,</span><br><span class=\"line\">  `onlinetime` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;上线时间&apos;,</span><br><span class=\"line\">  `offlinetime` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;下线时间&apos;,</span><br><span class=\"line\">  `user_id` char(40) CHARACTER SET utf8 NOT NULL COMMENT &apos;发布人用户id&apos;,</span><br><span class=\"line\">  `created_time` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `modify_time` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;修改时间&apos;,</span><br><span class=\"line\">  `state` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;状态 1:未发布 2:已发布 3:已下线 4:已删除&apos;,</span><br><span class=\"line\">  `click_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;点击量&apos;,</span><br><span class=\"line\">  `share_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;分享量&apos;,</span><br><span class=\"line\">  `share_user_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;分享用户量&apos;,</span><br><span class=\"line\">  `push_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;推送用户量&apos;,</span><br><span class=\"line\">  `url` varchar(256) NOT NULL COMMENT &apos;URL地址&apos;,</span><br><span class=\"line\">  `json_data` text NOT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  UNIQUE KEY `activity_id` (`activity_id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8mb4 COMMENT=&apos;运营活动表&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">推送类型</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;:231,</span><br><span class=\"line\">  &quot;params&quot;:&#123;</span><br><span class=\"line\">      &quot;id&quot;:&quot;文章id&quot;，</span><br><span class=\"line\">      &quot;title&quot;: &quot;标题&quot;,</span><br><span class=\"line\">      &quot;content&quot;:&quot;内容&quot;，</span><br><span class=\"line\">      &quot;createdtime&quot;: &quot;1345764830&quot;,</span><br><span class=\"line\">      &quot;image&quot;:&quot;图片URL&quot;，</span><br><span class=\"line\">      &quot;type&quot;:&quot;活动（activity）或者用户推广（user）&quot;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"带推送消息查询语句\"><a href=\"#带推送消息查询语句\" class=\"headerlink\" title=\"带推送消息查询语句\"></a>带推送消息查询语句</h3><h4 id=\"资讯推送-1\"><a href=\"#资讯推送-1\" class=\"headerlink\" title=\"资讯推送\"></a>资讯推送</h4><p>select id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,content from oradt_cloud_test2.sns_qa_push_setting<br>where <code>status</code> &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’<br>and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<h4 id=\"用户推广-1\"><a href=\"#用户推广-1\" class=\"headerlink\" title=\"用户推广\"></a>用户推广</h4><p>select id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,title,json_data from oradt_cloud_test2.sys_user_promotion<br>where <code>status</code> &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’<br>and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<h4 id=\"活动推广\"><a href=\"#活动推广\" class=\"headerlink\" title=\"活动推广\"></a>活动推广</h4><p>select id,push_state, region, industry, func, title, json_data, user_id from oradt_cloud_test2.operation_activity<br>where push_state &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’ and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<hr>\n<h3 id=\"部署情况\"><a href=\"#部署情况\" class=\"headerlink\" title=\"部署情况\"></a>部署情况</h3><h4 id=\"125仿真环境\"><a href=\"#125仿真环境\" class=\"headerlink\" title=\"125仿真环境\"></a>125仿真环境</h4><p>部署在IDC 云主机 /home/xieqj/python2.7_scenario/fangzhen</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 */1 * * * python2.7 /home/xieqj/python2.7_scenario/fangzhen/CardDeduplication/CardDeduplication3366.py</span><br></pre></td></tr></table></figure>\n<p>名片去重 60分钟运行一次<br>名片异常 5分钟运行一次<br>人脉更新 60分钟运行一次<br>消息推送 main.py 60分钟一次</p>\n<p>python2.7 运行的是125 3366端口<br>python2.7 message_handling/main.py (消息推送)<br>python2.7 CardDeduplication/CardDeduplication.py<br>python2.7 CardExceptionHandling/CardException.py<br>python2.7 cardUpdateNotification/CardUpdateNote.py</p>\n<p>python 运行的是3388端口<br>python CardDeduplication.py<br>python CardException.py</p>\n<h4 id=\"AWS\"><a href=\"#AWS\" class=\"headerlink\" title=\"AWS\"></a>AWS</h4><p>部署在ec2 54.223.28.119<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 0 */1 * * python2.7 /home/ec2-user/namecard/CardDeduplication/CardDeduplication_aws.py</span><br></pre></td></tr></table></figure></p>\n<p>名片异常 每5分钟运行一次<br>名片去重 每24小时运行一次<br>用户推广 每1分钟运行一次<br>消息推送 每1分钟运行一次</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"整体启动\"><a href=\"#整体启动\" class=\"headerlink\" title=\"整体启动\"></a>整体启动</h3><p>main.py</p>\n<p>通过多线程同时进行三个任务 (确保每个环境只有一个进程在运行)<br>nohup python main.py&amp;</p>\n<h4 id=\"相关配置\"><a href=\"#相关配置\" class=\"headerlink\" title=\"相关配置\"></a>相关配置</h4><p>配置写在文件 db.conf中<br>只需要根据运行环境更改数据库的配置名称即可，如：<br>oa = operationActivity.OperationActivity(“database_dev”) // 192<br>oa = operationActivity.OperationActivity(“database_prd”) // 125</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># !/Users/xieqj/py_env/venv python</span><br><span class=\"line\"># -*- coding: utf-8 -*-</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">import threading</span><br><span class=\"line\">from mg_handling import msgPushing, userPromotion, operationActivity</span><br><span class=\"line\">import util.comm as cm</span><br><span class=\"line\">import time</span><br><span class=\"line\"></span><br><span class=\"line\"># 资讯推送</span><br><span class=\"line\">def msg_pushing():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        mp = msgPushing.MsgPushing()</span><br><span class=\"line\">        msg_contents = mp.scanDBForSending()</span><br><span class=\"line\">        mp.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        mp.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        mp.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"># 用户推广</span><br><span class=\"line\">def user_promotion():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        mp = userPromotion.UserPromotion()</span><br><span class=\"line\">        msg_contents = mp.scanDBForSending()</span><br><span class=\"line\">        mp.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        mp.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        mp.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"># 活动管理</span><br><span class=\"line\">def operation_activity():</span><br><span class=\"line\">    while (True):</span><br><span class=\"line\">        oa = operationActivity.OperationActivity()</span><br><span class=\"line\">        msg_contents = oa.scanDBForSending()</span><br><span class=\"line\">        oa.insert_msg2mq(msg_contents)</span><br><span class=\"line\">        oa.mark_msg_as_sent(msg_contents)</span><br><span class=\"line\">        oa.close_database()</span><br><span class=\"line\">        time.sleep(8)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 通过多线程同时启动两个步骤</span><br><span class=\"line\">if __name__ == &quot;__main__&quot;:</span><br><span class=\"line\">    cm.initLog(&quot;pushing.log&quot;, &quot;INFO&quot;)</span><br><span class=\"line\">    threads = []</span><br><span class=\"line\">    t1 = threading.Thread(target=msg_pushing)</span><br><span class=\"line\">    threads.append(t1)</span><br><span class=\"line\">    t2 = threading.Thread(target=user_promotion)</span><br><span class=\"line\">    threads.append(t2)</span><br><span class=\"line\">    t3 = threading.Thread(target=operation_activity)</span><br><span class=\"line\">    threads.append(t3)</span><br><span class=\"line\">    for t in threads:</span><br><span class=\"line\">        t.setDaemon(True)</span><br><span class=\"line\">        t.start()</span><br><span class=\"line\">    t.join()</span><br></pre></td></tr></table></figure>\n<h3 id=\"资讯推送\"><a href=\"#资讯推送\" class=\"headerlink\" title=\"资讯推送\"></a>资讯推送</h3><p>读取表 sns_qa_push_setting 中的资讯，将其按照region，industry，func（职能）推送给对应群组的用户。<br>具体方法就是将表 sns_qa_push_setting 中的 content 1对1的推送给表 account_basic 中对应群组的用户，即插入 message_queue 表。</p>\n<p>需要注意控制推送时间，和在推送后 update 表 sns_qa_push_setting 中 status 字段</p>\n<h4 id=\"仓库位置\"><a href=\"#仓库位置\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>{“messagetype”: 230,”params”: { “data”: [{“newsid”: “ EwtNMSASOSvxjerhni98uQyEXnDIp9fS”,”title”: “发布到审核”,”url”: “资讯  URL”, “coverurl”: “https: //oradtdev.s3.cn-north-  1.amazonaws.com.cn/ukIv0BqxtnjRgjuhJcGKO6jze1liPmZE/gm9YtnBtvQ20160921132139.jpg”,”createdtime”: “1474435299” } ]}}</p>\n<h4 id=\"数据表\"><a href=\"#数据表\" class=\"headerlink\" title=\"数据表\"></a>数据表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `industry_category` (</span><br><span class=\"line\">  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `category_id` char(8) NOT NULL,</span><br><span class=\"line\">  `parent_id` char(8) NOT NULL,</span><br><span class=\"line\">  `name` varchar(128) NOT NULL COMMENT &apos;行业名称&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;国家统计局的两级行业分类标准&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存从名片的json数据解析出来的数据 name * region</span><br><span class=\"line\">CREATE TABLE `card_info_jsonver` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `card_id` char(32) DEFAULT &apos;&apos; COMMENT &apos;名片id&apos;,</span><br><span class=\"line\">  `user_id` char(40) DEFAULT &apos;&apos; COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `side` tinyint(4) DEFAULT &apos;0&apos; COMMENT &apos;名片的正反面，0：正面，1：反面&apos;,</span><br><span class=\"line\">  `name` varchar(128) DEFAULT &apos;&apos; COMMENT &apos;名片上的名字&apos;,</span><br><span class=\"line\">  `mobile` varchar(20) DEFAULT &apos;&apos; COMMENT &apos;手机号&apos;,</span><br><span class=\"line\">  `provinceM` varchar(64) DEFAULT &apos;&apos; COMMENT &apos;手机号解出来的省份&apos;,</span><br><span class=\"line\">  `provinceM_code` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;省份编码&apos;,</span><br><span class=\"line\">  `cityM` varchar(64) DEFAULT &apos;&apos; COMMENT &apos;城市&apos;,</span><br><span class=\"line\">  `cityM_code` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;城市编码&apos;,</span><br><span class=\"line\">  `created_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT &apos;名片创建时间&apos;,</span><br><span class=\"line\">  `updated_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT &apos;名片更新时间&apos;,</span><br><span class=\"line\">  `handle_state` varchar(16) DEFAULT &apos;&apos; COMMENT &apos;处理状态&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=42333 DEFAULT CHARSET=utf8 COMMENT=&apos;保存从名片的json数据解析出来的数据&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"># 从名片json数据解析出来的公司信息 companyName * func</span><br><span class=\"line\">CREATE TABLE `company_info_jsonVer` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `card_id` char(32) DEFAULT NULL COMMENT &apos;名片id&apos;,</span><br><span class=\"line\">  `user_id` char(40) DEFAULT NULL COMMENT &apos;用户id&apos;,</span><br><span class=\"line\">  `companyName` varchar(128) DEFAULT NULL COMMENT &apos;公司名称&apos;,</span><br><span class=\"line\">  `industry` varchar(128) DEFAULT NULL COMMENT &apos;二级行业&apos;,</span><br><span class=\"line\">  `ind_code` char(8) DEFAULT NULL COMMENT &apos;二级行业编码&apos;,</span><br><span class=\"line\">  `title` char(64) DEFAULT NULL COMMENT &apos;职位&apos;,</span><br><span class=\"line\">  `func_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &apos;职能名称&apos;,</span><br><span class=\"line\">  `func_code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &apos;职能编号&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;从名片json数据解析出来的公司信息&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">消息类型</span><br><span class=\"line\"> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;messagetype&quot;: 230,</span><br><span class=\"line\">    &quot;params&quot;: &#123;</span><br><span class=\"line\">        &quot;data&quot;: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                &quot;newsid&quot;: 资讯id,   </span><br><span class=\"line\">                &quot;title&quot;: &quot;资讯标题&quot;,</span><br><span class=\"line\">               &quot;url&quot;: &quot;资讯URL&quot;,</span><br><span class=\"line\">                &quot;coverurl&quot;: &quot;封面URL&quot;,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            ....</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">注：排序 按照data中数组的顺序</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"用户推广\"><a href=\"#用户推广\" class=\"headerlink\" title=\"用户推广\"></a>用户推广</h3><p>基本流程与咨询推送相同</p>\n<h4 id=\"仓库位置-1\"><a href=\"#仓库位置-1\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>git@192.168.30.251:effective.git</p>\n<p>userPromotion.py</p>\n<h4 id=\"推广表\"><a href=\"#推广表\" class=\"headerlink\" title=\"推广表\"></a>推广表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `sys_user_promotion` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `pro_id` char(32) NOT NULL COMMENT &apos;推广ID&apos;,</span><br><span class=\"line\">  `type` tinyint(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;推送方式：1：内部 2：邮件 3：短信&apos;,</span><br><span class=\"line\">  `isalluser` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1发送注册用户2发送全部用户&apos;,</span><br><span class=\"line\">  `push_time` int(10) NOT NULL COMMENT &apos;设置的推送时间&apos;,</span><br><span class=\"line\">  `region` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;地区（多个,号隔开）&apos;,</span><br><span class=\"line\">  `industry` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;行业（多个,号隔开）&apos;,</span><br><span class=\"line\">  `func` varchar(2000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;职能（多个,号隔开）&apos;,</span><br><span class=\"line\">  `title` varchar(50) CHARACTER SET utf8mb4 DEFAULT &apos;&apos; COMMENT &apos;标题&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;推送的内容&apos;,</span><br><span class=\"line\">  `created_time` int(10) NOT NULL COMMENT &apos;添加时间&apos;,</span><br><span class=\"line\">  `admin_id` char(40) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;设置人&apos;,</span><br><span class=\"line\">  `status` tinyint(2) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;状态 1：未发 2：已发&apos;,</span><br><span class=\"line\">  `isntice` tinyint(2) DEFAULT &apos;0&apos; COMMENT &apos;是否通知&apos;,</span><br><span class=\"line\">  `url` varchar(256) NOT NULL COMMENT &apos;url地址&apos;,</span><br><span class=\"line\">  `json_data` text NOT NULL COMMENT &apos;推送json格式&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=utf8 COMMENT=&apos;运营后台-用户推广表&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 存储type为2，3的用户推广</span><br><span class=\"line\">CREATE TABLE `message_promotion` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `type` tinyint(4) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;类型：1-内部，2-邮件，3-短信&apos;,</span><br><span class=\"line\">  `mobile` varchar(18) DEFAULT &apos;&apos; COMMENT &apos;手机号&apos;,</span><br><span class=\"line\">  `email` varchar(256) DEFAULT &apos;&apos; COMMENT &apos;邮箱&apos;,</span><br><span class=\"line\">  `title` varchar(100) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;标题&apos;,</span><br><span class=\"line\">  `content` text NOT NULL COMMENT &apos;消息内容&apos;,</span><br><span class=\"line\">  `created_time` int(11) DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `modified_time` int(11) DEFAULT NULL COMMENT &apos;修改时间&apos;,</span><br><span class=\"line\">  `status` tinyint(4) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;状态：0-未发送，1-已发送，2-发送失败&apos;,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT=&apos;推广消息表&apos;</span><br><span class=\"line\"> </span><br><span class=\"line\">推广消息类型</span><br><span class=\"line\"> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;:231,</span><br><span class=\"line\">  &quot;params&quot;:&#123;</span><br><span class=\"line\">     &quot;id&quot;:&quot;文章id&quot;，</span><br><span class=\"line\">      &quot;title&quot;: &quot;资讯标题&quot;,</span><br><span class=\"line\">      &quot;content&quot;:&quot;内容&quot;，</span><br><span class=\"line\">      &quot;createdtime&quot;: &quot;1345764830&quot;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;: 231,</span><br><span class=\"line\">  &quot;params&quot;: &#123;</span><br><span class=\"line\">    &quot;content&quot;: &quot;hello world！&lt;br/&gt;&quot;,</span><br><span class=\"line\">    &quot;createdtime&quot;: 1483620281,</span><br><span class=\"line\">    &quot;id&quot;: &quot;zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b&quot;,</span><br><span class=\"line\">    &quot;image&quot;: &quot;&quot;,</span><br><span class=\"line\">    &quot;title&quot;: &quot;推送测试&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;user&quot;,</span><br><span class=\"line\">    &quot;url&quot;: &quot;h5/News/secretary?type=promotion&amp;id=zlJjJD6gDvjCdoMcibqCWOGrMo7vbB0b&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"活动管理\"><a href=\"#活动管理\" class=\"headerlink\" title=\"活动管理\"></a>活动管理</h3><h4 id=\"背景说明\"><a href=\"#背景说明\" class=\"headerlink\" title=\"背景说明\"></a>背景说明</h4><p>系统中，内容管理-推送、运营管理-新增推广、运营管理-新增活动页面中，地区、行业、职能选择时，弹窗样式与“内容管理-推送”样式相同，具体请参见原型</p>\n<p>进行推送时，匹配规则如下：<br>a)  行业：第一次使用APP时所选行业+当前默认身份的并集。采用1级行业-2级行业模式划分<br>b)  地区：第一次使用APP时所选手机号+当前默认身份的并集。采用1级地区-2级地区模式划分<br>c)  职能：当前默认身份。采用1级行业-职能（只有1级）模式划分</p>\n<p>当前默认身份cardid需要通过表 account_basic_detail 的 card_id 字段得到</p>\n<h4 id=\"业务流程\"><a href=\"#业务流程\" class=\"headerlink\" title=\"业务流程\"></a>业务流程</h4><h4 id=\"仓库位置-2\"><a href=\"#仓库位置-2\" class=\"headerlink\" title=\"仓库位置\"></a>仓库位置</h4><p>git@192.168.30.251:message_handling.git</p>\n<p>OperationActivity</p>\n<h4 id=\"活动表结构\"><a href=\"#活动表结构\" class=\"headerlink\" title=\"活动表结构\"></a>活动表结构</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `operation_activity` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `activity_id` char(32) CHARACTER SET utf8 NOT NULL COMMENT &apos;活动id&apos;,</span><br><span class=\"line\">  `type` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;类型 1:活动 2:资讯&apos;,</span><br><span class=\"line\">  `isnotify` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;1:不通知 2:通知&apos;,</span><br><span class=\"line\">  `push_state` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;isnotify为2时有效，1:未推送，2:已推送&apos;,</span><br><span class=\"line\">  `region` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;地区（多个,号隔开）&apos;,</span><br><span class=\"line\">  `industry` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;行业（多个,号隔开）&apos;,</span><br><span class=\"line\">  `func` varchar(256) CHARACTER SET utf8 NOT NULL COMMENT &apos;职能（多个,号隔开）&apos;,</span><br><span class=\"line\">  `show_id` varchar(400) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;资讯shwo_id（多个,号隔开）type为2时有效&apos;,</span><br><span class=\"line\">  `image` varchar(256) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;标题图片&apos;,</span><br><span class=\"line\">  `title` varchar(100) CHARACTER SET utf8 DEFAULT NULL COMMENT &apos;活动标题 type为1时使用&apos;,</span><br><span class=\"line\">  `content` text CHARACTER SET utf8 COMMENT &apos;活动标题 type为1时使用&apos;,</span><br><span class=\"line\">  `onlinetime` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;上线时间&apos;,</span><br><span class=\"line\">  `offlinetime` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;下线时间&apos;,</span><br><span class=\"line\">  `user_id` char(40) CHARACTER SET utf8 NOT NULL COMMENT &apos;发布人用户id&apos;,</span><br><span class=\"line\">  `created_time` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;创建时间&apos;,</span><br><span class=\"line\">  `modify_time` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;修改时间&apos;,</span><br><span class=\"line\">  `state` tinyint(4) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;状态 1:未发布 2:已发布 3:已下线 4:已删除&apos;,</span><br><span class=\"line\">  `click_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;点击量&apos;,</span><br><span class=\"line\">  `share_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;分享量&apos;,</span><br><span class=\"line\">  `share_user_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;分享用户量&apos;,</span><br><span class=\"line\">  `push_count` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;推送用户量&apos;,</span><br><span class=\"line\">  `url` varchar(256) NOT NULL COMMENT &apos;URL地址&apos;,</span><br><span class=\"line\">  `json_data` text NOT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  UNIQUE KEY `activity_id` (`activity_id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8mb4 COMMENT=&apos;运营活动表&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">推送类型</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;messagetype&quot;:231,</span><br><span class=\"line\">  &quot;params&quot;:&#123;</span><br><span class=\"line\">      &quot;id&quot;:&quot;文章id&quot;，</span><br><span class=\"line\">      &quot;title&quot;: &quot;标题&quot;,</span><br><span class=\"line\">      &quot;content&quot;:&quot;内容&quot;，</span><br><span class=\"line\">      &quot;createdtime&quot;: &quot;1345764830&quot;,</span><br><span class=\"line\">      &quot;image&quot;:&quot;图片URL&quot;，</span><br><span class=\"line\">      &quot;type&quot;:&quot;活动（activity）或者用户推广（user）&quot;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"带推送消息查询语句\"><a href=\"#带推送消息查询语句\" class=\"headerlink\" title=\"带推送消息查询语句\"></a>带推送消息查询语句</h3><h4 id=\"资讯推送-1\"><a href=\"#资讯推送-1\" class=\"headerlink\" title=\"资讯推送\"></a>资讯推送</h4><p>select id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,content from oradt_cloud_test2.sns_qa_push_setting<br>where <code>status</code> &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’<br>and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<h4 id=\"用户推广-1\"><a href=\"#用户推广-1\" class=\"headerlink\" title=\"用户推广\"></a>用户推广</h4><p>select id,FROM_UNIXTIME(push_time) as push_time,status,region,industry,func,admin_id,title,json_data from oradt_cloud_test2.sys_user_promotion<br>where <code>status</code> &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’<br>and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<h4 id=\"活动推广\"><a href=\"#活动推广\" class=\"headerlink\" title=\"活动推广\"></a>活动推广</h4><p>select id,push_state, region, industry, func, title, json_data, user_id from oradt_cloud_test2.operation_activity<br>where push_state &lt;&gt; 2 and industry != ‘’ and func != ‘’ and region != ‘’ and ROUND((UNIX_TIMESTAMP(SYSDATE()) - push_time)/60) &gt;= -2;</p>\n<hr>\n<h3 id=\"部署情况\"><a href=\"#部署情况\" class=\"headerlink\" title=\"部署情况\"></a>部署情况</h3><h4 id=\"125仿真环境\"><a href=\"#125仿真环境\" class=\"headerlink\" title=\"125仿真环境\"></a>125仿真环境</h4><p>部署在IDC 云主机 /home/xieqj/python2.7_scenario/fangzhen</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 */1 * * * python2.7 /home/xieqj/python2.7_scenario/fangzhen/CardDeduplication/CardDeduplication3366.py</span><br></pre></td></tr></table></figure>\n<p>名片去重 60分钟运行一次<br>名片异常 5分钟运行一次<br>人脉更新 60分钟运行一次<br>消息推送 main.py 60分钟一次</p>\n<p>python2.7 运行的是125 3366端口<br>python2.7 message_handling/main.py (消息推送)<br>python2.7 CardDeduplication/CardDeduplication.py<br>python2.7 CardExceptionHandling/CardException.py<br>python2.7 cardUpdateNotification/CardUpdateNote.py</p>\n<p>python 运行的是3388端口<br>python CardDeduplication.py<br>python CardException.py</p>\n<h4 id=\"AWS\"><a href=\"#AWS\" class=\"headerlink\" title=\"AWS\"></a>AWS</h4><p>部署在ec2 54.223.28.119<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 0 */1 * * python2.7 /home/ec2-user/namecard/CardDeduplication/CardDeduplication_aws.py</span><br></pre></td></tr></table></figure></p>\n<p>名片异常 每5分钟运行一次<br>名片去重 每24小时运行一次<br>用户推广 每1分钟运行一次<br>消息推送 每1分钟运行一次</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjjxogn9b00013a9dg3rrkjng","category_id":"cjjxogn9p00043a9dc2lrarn4","_id":"cjjxognae000h3a9dfdt5pijg"},{"post_id":"cjjxogn9y000a3a9d9r1mxbni","category_id":"cjjxogn9p00043a9dc2lrarn4","_id":"cjjxognag000k3a9dym50m1bg"},{"post_id":"cjjxogn9v00093a9dv7wmtro2","category_id":"cjjxogna2000c3a9d8lmj2mh3","_id":"cjjxognak000o3a9dvsfq26b3"},{"post_id":"cjjxognao000r3a9dwt1w7hu6","category_id":"cjjxogna2000c3a9d8lmj2mh3","_id":"cjjxognaw00103a9d1rqevt9e"},{"post_id":"cjjxognar000u3a9dn9noob34","category_id":"cjjxogna2000c3a9d8lmj2mh3","_id":"cjjxognay00123a9dafq8xf2x"},{"post_id":"cjjxognak000p3a9dedtdzk4e","category_id":"cjjxognar000t3a9dro2hab3b","_id":"cjjxognaz00143a9d264lyhb7"},{"post_id":"cjjxognav000z3a9dy765k8vl","category_id":"cjjxogna2000c3a9d8lmj2mh3","_id":"cjjxognb000163a9d92t11cmz"},{"post_id":"cjjxognax00113a9dl5dp8k9i","category_id":"cjjxognaz00153a9d6ngcfkgw","_id":"cjjxognb1001c3a9d1vumo4fn"},{"post_id":"cjjxogndp002p3a9dx7iz4nqu","category_id":"cjjxogn9p00043a9dc2lrarn4","_id":"cjjxognds002t3a9dw6gseq7w"},{"post_id":"cjjxogndq002q3a9dntigy0w3","category_id":"cjjxogna2000c3a9d8lmj2mh3","_id":"cjjxogndt002u3a9dw9n48gia"}],"PostTag":[{"post_id":"cjjxogn9b00013a9dg3rrkjng","tag_id":"cjjxogn9r00053a9d3jd7otbp","_id":"cjjxogna2000d3a9d6sesleru"},{"post_id":"cjjxogn9y000a3a9d9r1mxbni","tag_id":"cjjxogn9r00053a9d3jd7otbp","_id":"cjjxogna7000f3a9djuevas7x"},{"post_id":"cjjxogn9l00033a9d7w7eimke","tag_id":"cjjxogna0000b3a9d2v2wrx50","_id":"cjjxognar000s3a9d23lm3ia5"},{"post_id":"cjjxogn9l00033a9d7w7eimke","tag_id":"cjjxognaf000i3a9djd8p20hj","_id":"cjjxognat000v3a9dw05i9ugh"},{"post_id":"cjjxogn9l00033a9d7w7eimke","tag_id":"cjjxognai000m3a9dmxzz02px","_id":"cjjxognau000y3a9du5waxug5"},{"post_id":"cjjxogn9s00073a9dt2rzhhnu","tag_id":"cjjxognao000q3a9dztjjpztd","_id":"cjjxognb000183a9dmh31xkq7"},{"post_id":"cjjxogn9s00073a9dt2rzhhnu","tag_id":"cjjxognau000x3a9dkju529ei","_id":"cjjxognb000193a9dd13pc2ff"},{"post_id":"cjjxogn9s00073a9dt2rzhhnu","tag_id":"cjjxognay00133a9dsdwzdynu","_id":"cjjxognb1001b3a9de4l1hh9b"},{"post_id":"cjjxogn9v00093a9dv7wmtro2","tag_id":"cjjxognb000173a9d73unsi28","_id":"cjjxognb8001e3a9dwpqex74u"},{"post_id":"cjjxogn9v00093a9dv7wmtro2","tag_id":"cjjxognb1001a3a9dwf18ghsl","_id":"cjjxognb9001f3a9dudwpo59e"},{"post_id":"cjjxogna2000e3a9dvbfsbadk","tag_id":"cjjxognb2001d3a9dolk8g490","_id":"cjjxognbb001i3a9d7ubztf8o"},{"post_id":"cjjxogna2000e3a9dvbfsbadk","tag_id":"cjjxognb9001g3a9dujoc5vde","_id":"cjjxognbb001j3a9dhl5x5k2w"},{"post_id":"cjjxognad000g3a9d5ol2k15h","tag_id":"cjjxognba001h3a9d1b8tu4vt","_id":"cjjxognbg001m3a9drxtpvj81"},{"post_id":"cjjxognad000g3a9d5ol2k15h","tag_id":"cjjxognau000x3a9dkju529ei","_id":"cjjxognbh001n3a9d7q315boo"},{"post_id":"cjjxognaf000j3a9dup2u8g9y","tag_id":"cjjxognbf001l3a9dok197f7r","_id":"cjjxognbj001r3a9dip6v4qsn"},{"post_id":"cjjxognaf000j3a9dup2u8g9y","tag_id":"cjjxognbh001o3a9dqqwujr3p","_id":"cjjxognbj001s3a9dmx46t7wd"},{"post_id":"cjjxognaf000j3a9dup2u8g9y","tag_id":"cjjxognbi001p3a9dbhm6nt7w","_id":"cjjxognbk001u3a9daqt8hl19"},{"post_id":"cjjxognah000l3a9dqsvxmr9s","tag_id":"cjjxognbi001q3a9dynk6hkxu","_id":"cjjxognbl001w3a9ds5pbdf8w"},{"post_id":"cjjxognah000l3a9dqsvxmr9s","tag_id":"cjjxognbj001t3a9d3kypslcy","_id":"cjjxognbl001x3a9dzoksmwq4"},{"post_id":"cjjxognaj000n3a9davaoe5eh","tag_id":"cjjxognbk001v3a9duatsc6nu","_id":"cjjxognbn00213a9dmhmhsccs"},{"post_id":"cjjxognaj000n3a9davaoe5eh","tag_id":"cjjxognbl001y3a9d6ntl4wkx","_id":"cjjxognbn00223a9dwi6nax02"},{"post_id":"cjjxognaj000n3a9davaoe5eh","tag_id":"cjjxognbm001z3a9dqu2h2vdq","_id":"cjjxognbo00243a9d9l6aehmp"},{"post_id":"cjjxognak000p3a9dedtdzk4e","tag_id":"cjjxognbm00203a9daasrw6a8","_id":"cjjxognbo00253a9dphy2henk"},{"post_id":"cjjxognak000p3a9dedtdzk4e","tag_id":"cjjxognaf000i3a9djd8p20hj","_id":"cjjxognbp00273a9d1nwnd522"},{"post_id":"cjjxognak000p3a9dedtdzk4e","tag_id":"cjjxognai000m3a9dmxzz02px","_id":"cjjxognbq00283a9d0souv0du"},{"post_id":"cjjxognao000r3a9dwt1w7hu6","tag_id":"cjjxognbo00233a9d3oljtns9","_id":"cjjxognbr002a3a9daqq1nbm2"},{"post_id":"cjjxognar000u3a9dn9noob34","tag_id":"cjjxognbo00233a9d3oljtns9","_id":"cjjxognbs002c3a9dfbgk66e5"},{"post_id":"cjjxognar000u3a9dn9noob34","tag_id":"cjjxognbq00293a9dr38cxq43","_id":"cjjxognbt002d3a9db3jithn7"},{"post_id":"cjjxognat000w3a9dl4bof8yx","tag_id":"cjjxognbf001l3a9dok197f7r","_id":"cjjxognbv002g3a9djyhblqy7"},{"post_id":"cjjxognat000w3a9dl4bof8yx","tag_id":"cjjxognbt002e3a9dtr5816lo","_id":"cjjxognbv002h3a9ddggjepir"},{"post_id":"cjjxognav000z3a9dy765k8vl","tag_id":"cjjxognb000173a9d73unsi28","_id":"cjjxognbx002k3a9d4ktv9din"},{"post_id":"cjjxognav000z3a9dy765k8vl","tag_id":"cjjxognbv002i3a9dk05f225m","_id":"cjjxognbx002l3a9d5o9u5pod"},{"post_id":"cjjxognax00113a9dl5dp8k9i","tag_id":"cjjxognbw002j3a9d12f0hou2","_id":"cjjxognby002n3a9dsjeute2b"},{"post_id":"cjjxognax00113a9dl5dp8k9i","tag_id":"cjjxognbx002m3a9dm0j8fzqt","_id":"cjjxognby002o3a9deh04pfka"},{"post_id":"cjjxogndp002p3a9dx7iz4nqu","tag_id":"cjjxogn9r00053a9d3jd7otbp","_id":"cjjxogndr002r3a9dvr1lw518"},{"post_id":"cjjxogndq002q3a9dntigy0w3","tag_id":"cjjxognds002s3a9dd96nltf2","_id":"cjjxogndt002w3a9d5ebq9p0c"},{"post_id":"cjjxogndq002q3a9dntigy0w3","tag_id":"cjjxogndt002v3a9d0rknipnx","_id":"cjjxogndt002x3a9dbm6eremt"}],"Tag":[{"name":"etl tool","_id":"cjjxogn9r00053a9d3jd7otbp"},{"name":"hexo","_id":"cjjxogna0000b3a9d2v2wrx50"},{"name":"blog","_id":"cjjxognaf000i3a9djd8p20hj"},{"name":"NexT","_id":"cjjxognai000m3a9dmxzz02px"},{"name":"Spark Streaming","_id":"cjjxognao000q3a9dztjjpztd"},{"name":"Kafka","_id":"cjjxognau000x3a9dkju529ei"},{"name":"谁看过我","_id":"cjjxognay00133a9dsdwzdynu"},{"name":"名片","_id":"cjjxognb000173a9d73unsi28"},{"name":"别名","_id":"cjjxognb1001a3a9dwf18ghsl"},{"name":"NameCard","_id":"cjjxognb2001d3a9dolk8g490"},{"name":"Levenstein Distance","_id":"cjjxognb9001g3a9dujoc5vde"},{"name":"Cloudera","_id":"cjjxognba001h3a9d1b8tu4vt"},{"name":"opencv","_id":"cjjxognbf001l3a9dok197f7r"},{"name":"bovw","_id":"cjjxognbh001o3a9dqqwujr3p"},{"name":"imagehash","_id":"cjjxognbi001p3a9dbhm6nt7w"},{"name":"人脉信息更新","_id":"cjjxognbi001q3a9dynk6hkxu"},{"name":"系统提示","_id":"cjjxognbj001t3a9d3kypslcy"},{"name":"classification","_id":"cjjxognbk001v3a9duatsc6nu"},{"name":"行业分类","_id":"cjjxognbl001y3a9d6ntl4wkx"},{"name":"公司名称","_id":"cjjxognbm001z3a9dqu2h2vdq"},{"name":"Jaro–Winkler","_id":"cjjxognbm00203a9daasrw6a8"},{"name":"月报","_id":"cjjxognbo00233a9d3oljtns9"},{"name":"统计指标","_id":"cjjxognbq00293a9dr38cxq43"},{"name":"anaconda","_id":"cjjxognbt002e3a9dtr5816lo"},{"name":"基础信息","_id":"cjjxognbv002i3a9dk05f225m"},{"name":"Hexo","_id":"cjjxognbw002j3a9d12f0hou2"},{"name":"Mathjax","_id":"cjjxognbx002m3a9dm0j8fzqt"},{"name":"msyql","_id":"cjjxognds002s3a9dd96nltf2"},{"name":"message queue","_id":"cjjxogndt002v3a9d0rknipnx"}]}}